// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.5/esri/copyright.txt for details.

define(["require","exports","../../core/tsSupport/declareExtendsHelper","../../core/tsSupport/decorateHelper","../../core/accessorSupport/decorators","../../core/Accessor","../../views/2d/draw/Draw","../../core/Evented","../../Graphic","../../core/HandleRegistry","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../symbols/SimpleFillSymbol","../../symbols/SimpleLineSymbol","../../symbols/SimpleMarkerSymbol"],function(e,r,i,o,t,n,a,c,p,l,s,h,y,d,g,v){var w=function(){function e(e,r){this.geometry=e,this.graphic=r,this.type="draw-complete"}return e}(),m=function(e){function r(r){var i=e.call(this,r)||this;return i._actionHandles=new l,i.draw=null,i.graphic=null,i.pointSymbol=new v,i.polygonSymbol=new d,i.polylineSymbol=new g,i.view=null,i}return i(r,e),r.prototype.initialize=function(){this.draw=new a({view:this.view})},r.prototype.destroy=function(){this.reset(),this._actionHandles.destroy(),this._actionHandles=null,this.draw&&(this.draw.destroy(),this.draw=null),this.view=null},Object.defineProperty(r.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0}),r.prototype.create=function(e){this.reset(),"point"===e?this._createPoint():"polygon"===e?this._createPolygon():"polyline"===e&&this._createPolyline()},r.prototype.reset=function(){this._actionHandles.removeAll(),this.graphic&&this.get("view.graphics")&&(this.view.graphics.remove(this.graphic),this.graphic=null),this.get("draw.activeAction")&&(this.draw.activeAction.destroy(),this.draw.activeAction=null)},r.prototype._createPoint=function(){var e=this,r=this.draw.create("point");this._actionHandles.add([r.on("cursor-update",function(r){e.view.graphics.remove(e.graphic);var i=r.coordinates,o=i[0],t=i[1],n=new s({x:o,y:t,spatialReference:e.view.spatialReference});e.graphic=new p(n,e.pointSymbol),e.view.graphics.add(e.graphic)}),r.on("draw-complete",function(r){e.view.graphics.remove(e.graphic);var i=r.coordinates,o=i[0],t=i[1],n=new s({x:o,y:t,spatialReference:e.view.spatialReference});e.graphic=new p(n,e.pointSymbol),e.emit("draw-complete",new w(n,e.graphic.clone()))})])},r.prototype._createPolygon=function(){var e=this,r=this.draw.create("polygon");this._actionHandles.add([r.on("vertex-add",function(r){e.view.graphics.remove(e.graphic),e.graphic=new p(e._createPolygonFromVertices(r.vertices),e.polygonSymbol),e.view.graphics.add(e.graphic)}),r.on("vertex-remove",function(r){e.view.graphics.remove(e.graphic),e.graphic=new p(e._createPolygonFromVertices(r.vertices),e.polygonSymbol),e.view.graphics.add(e.graphic)}),r.on("cursor-update",function(r){e.view.graphics.remove(e.graphic),e.graphic=new p(e._createPolygonFromVertices(r.vertices),e.polygonSymbol),e.view.graphics.add(e.graphic)}),r.on("draw-complete",function(r){e.view.graphics.remove(e.graphic);var i=e._createPolygonFromVertices(r.vertices);e.graphic=new p(i,e.polygonSymbol),e.emit("draw-complete",new w(i,e.graphic.clone()))})])},r.prototype._createPolyline=function(){var e=this,r=this.draw.create("polyline");this._actionHandles.add([r.on("vertex-add",function(r){e.view.graphics.remove(e.graphic),e.graphic=new p(e._createPolylineFromVertices(r.vertices),e.polylineSymbol),e.view.graphics.add(e.graphic)}),r.on("vertex-remove",function(r){e.view.graphics.remove(e.graphic),e.graphic=new p(e._createPolylineFromVertices(r.vertices),e.polylineSymbol),e.view.graphics.add(e.graphic)}),r.on("cursor-update",function(r){e.view.graphics.remove(e.graphic),e.graphic=new p(e._createPolylineFromVertices(r.vertices),e.polylineSymbol),e.view.graphics.add(e.graphic)}),r.on("draw-complete",function(r){e.view.graphics.remove(e.graphic);var i=e._createPolylineFromVertices(r.vertices);e.graphic=new p(i,e.polylineSymbol),e.emit("draw-complete",new w(i,e.graphic.clone()))})])},r.prototype._createPolylineFromVertices=function(e){return new y({paths:e,spatialReference:this.view.spatialReference})},r.prototype._createPolygonFromVertices=function(e){return new h({rings:e,spatialReference:this.view.spatialReference})},o([t.property()],r.prototype,"draw",void 0),o([t.property()],r.prototype,"graphic",void 0),o([t.property()],r.prototype,"pointSymbol",void 0),o([t.property()],r.prototype,"polygonSymbol",void 0),o([t.property()],r.prototype,"polylineSymbol",void 0),o([t.property({dependsOn:["view.ready"],readOnly:!0})],r.prototype,"state",null),o([t.property()],r.prototype,"view",void 0),r=o([t.subclass("esri.views.2d.SketchViewModel")],r)}(t.declared(n,c));return m});