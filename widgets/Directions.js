// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.6/esri/copyright.txt for details.

define(["require","exports","../core/tsSupport/declareExtendsHelper","../core/tsSupport/decorateHelper","../core/tsSupport/assignHelper","./Directions/support/directionsUtils","./Directions/support/maneuverUtils","./support/widget","../core/accessorSupport/decorators","../core/lang","../core/on","../core/watchUtils","./Directions/DirectionsViewModel","./Directions/support/CostSummary","./Directions/support/DatePicker","./Directions/support/RouteSections","./Directions/support/TimePicker","./Search","./Widget","../core/Collection","../core/HandleRegistry","../moment","dojo/i18n!./Directions/nls/Directions","dojo/i18n!../nls/common"],function(e,t,r,o,i,s,n,a,l,c,d,u,p,v,h,_,m,g,S,y,f,w,T,x){function M(e){return e.results[0].results[0]}var b="now",C="depart-by",I={base:"esri-directions esri-widget",button:"esri-directions__button",scroller:"esri-directions__scroller",panelContent:"esri-directions__panel-content",panelContentLoading:"esri-directions__panel-content--loading",panelContentError:"esri-directions__panel-content--error",message:"esri-directions__message",travelModeSelect:"esri-directions__travel-modes-select",departureTime:"esri-directions__departure-time",departureTimeSelect:"esri-directions__departure-time-select",directionsSection:"esri-directions__directions-section",departureTimeControls:"esri-directions__departure-time-controls",section:"esri-directions__section",summary:"esri-directions__summary",stopIcon:"esri-directions__stop-icon",interactiveStopIcon:"esri-directions__stop-icon--interactive",removeStopButton:"esri-directions__remove-stop",removeStop:"esri-directions__remove-stop-icon",reverseStops:"esri-directions__reverse-stops",stopIconContainer:"esri-directions__stop-icon-container",lastStopIconContainer:"esri-directions__stop-icon-container--last",stopHandle:"esri-directions__stop-handle",stopInput:"esri-directions__stop-input",stopOptions:"esri-directions__stop-options",stopUnderline:"esri-directions__stop-underline",underlineDragInProcess:"esri-directions__stop-underline--drag-in-process",stopHandleIcon:"esri-directions__stop-handle-icon",verticalSplitter:"esri-directions__vertical-splitter",stopRow:"esri-directions__stop-row",stopRowGhost:"esri-directions__stop-row-ghost",stopRowDragged:"esri-directions__stop-row--dragged",stopRowDropTarget:"esri-directions__stop-row--target",validStopRow:"esri-directions__stop-row--valid",stops:"esri-directions__stops",addStop:"esri-directions__add-stop",addStopText:"esri-directions__add-stop-text",directionCosts:"esri-directions__costs",costsDetails:"esri-directions__costs-details",primaryCosts:"esri-directions__costs-value",secondaryCosts:"esri-directions__other-costs-total",maneuvers:"esri-directions__maneuvers",maneuverList:"esri-directions__maneuver-list",maneuverSection:"esri-directions__maneuver-section",maneuverSectionHeader:"esri-directions__maneuver-section-header",maneuverSectionHeaderButton:"esri-directions__maneuver-section-header-toggle-button",maneuverSectionTitle:"esri-directions__maneuver-section-title",collapsibleSection:"esri-directions__maneuver-section--collapsible",maneuverSectionToggle:"esri-directions__maneuver-section-toggle",maneuver:"esri-directions__maneuver",maneuverActive:"esri-directions__maneuver--active",maneuverCosts:"esri-directions__maneuver-costs",maneuverCostsContainer:"esri-directions__maneuver-costs-container",maneuverIcon:"esri-directions__maneuver-icon",cumulativeCost:"esri-directions__cost--cumulative",intermediateCost:"esri-directions__cost--intermediate",horizontalSplitter:"esri-directions__horizontal-splitter",sectionSplitter:"esri-directions__section-splitter",disclaimer:"esri-directions__disclaimer",stopsIcon:"esri-icon-radio-unchecked",lastStopIcon:"esri-icon-radio-checked",loadingIcon:"esri-icon-loading-indicator",rotatingIcon:"esri-rotating",handleIcon:"esri-icon-handle-vertical",addStopIcon:"esri-icon-plus",removeStopIcon:"esri-icon-close",reverseStopIcon:"esri-icon-up-down-arrows",openIcon:"esri-icon-right-triangle-arrow",closeIcon:"esri-icon-down-arrow",offscreen:"esri-offscreen",select:"esri-select",screenReaderText:"esri-icon-font-fallback-text"},k={awaitingViewClickStop:"awaiting-view-click-stop"},R=[{},{}],D=e.toUrl("../themes/base/images/maneuvers/"),P=100,H=500,F=function(e){function t(t){var r=e.call(this)||this;return r._autoStopRemovalDelay=P,r._costSummary=new v,r._departureTime=b,r._datePicker=new h,r._handleRegistry=new f,r._newPlaceholderStop=null,r._routeSections=new _,r._stops=new y(R),r._stopsToSearches=new Map,r._timePicker=new m,r.maxStops=null,r.routeServiceUrl=null,r.routeSymbol=null,r.searchProperties=null,r.stopSymbols=null,r.view=null,r.viewModel=new p,r}return r(t,e),t.prototype.postInitialize=function(){var e=this;this.own([u.init(this,"viewModel.lastRoute",function(){e._routeSections.routePath=e.get("viewModel.directionLines"),e._activeManeuver=null,e._focusedManeuver=null,e.scheduleRender()}),u.init(this,"viewModel.selectedTravelMode, viewModel.departureTime",function(){e.get("viewModel.stops.length")>1&&e.getDirections()}),u.when(this,"view",function(t,r){if(r&&(e._viewClickHandle=null,e._handleRegistry.remove(r)),t){var o=e._prepViewClick();e._handleRegistry.add([d.on(t.surface,"mousedown",function(){return e._autoStopRemovalDelay=H}),d.on(t.surface,"mouseup",function(){return e._autoStopRemovalDelay=P}),o],e.view.surface),e._viewClickHandle=o}}),u.whenOnce(this,"routeServiceUrl",function(){return e.viewModel.load()})])},t.prototype.destroy=function(){this._datePicker.destroy(),this._timePicker.destroy(),this._stopsToSearches.forEach(function(e){return e.destroy()})},t.prototype.getDirections=function(){return null},t.prototype.zoomToRoute=function(){},t.prototype.render=function(){return a.tsx("div",{"class":a.join(I.base,I.scroller)},this._renderPanelContent())},t.prototype._renderPanelContent=function(){var e=this.viewModel,t=e.state,r=e.loadStatus,o="initializing"===t,i="error"===t&&"failed"===r,s=(c={},c[I.panelContentLoading]=o,c[I.panelContentError]=i,c),n=o?"presentation":"group",l=i?this._renderMessage(T.serviceError):o?null:this._renderReadyContent();return a.tsx("div",{"class":I.panelContent,classes:s,role:n},l);var c},t.prototype._renderReadyContent=function(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSectionSplitter(),this._renderDirectionsContainer(),this._renderDisclaimer()]},t.prototype._renderTravelModeOptions=function(){var e=this.viewModel,t=e.selectedTravelMode,r=e.travelModes,o=t.name||T.travelMode;return r.length>0?a.tsx("select",{"aria-label":o,bind:this,"class":a.join(I.travelModeSelect,I.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:o},r.map(function(e){var r=e.id===t.id;return a.tsx("option",{key:e,"data-mode":e,selected:r,value:e.id},e.name)})):null},t.prototype._handleTravelModeChange=function(e){var t=e.currentTarget,r=t.item(t.selectedIndex);this.viewModel.selectedTravelMode=r["data-mode"]},t.prototype._renderStopsContainer=function(){return a.tsx("div",{"class":I.section,key:"esri-directions__stops-container",role:"group"},this._renderStops())},t.prototype._renderDepartureTimeControls=function(){var e=this._departureTime===b,t=T.departureTime;return a.tsx("div",{"class":I.departureTime,key:"esri-directions__departure-time-controls",role:"group"},a.tsx("select",{"aria-label":t,bind:this,"class":a.join(I.departureTimeSelect,I.select),onchange:this._handleDepartureOptionChange,title:t},a.tsx("option",{value:b,selected:e},T.leaveNow),a.tsx("option",{value:C,selected:!e},T.departBy)),e?null:this._renderTimeControls())},t.prototype._renderStops=function(){var e=this,t=this._stops,r=t.toArray().map(function(r,o){var i=t.length,s=o>1&&!r.result,n=(D={},D[I.stopsIcon]=o>=0&&i-1>o,D[I.lastStopIcon]=o===i-1,D),l=(P={},P[I.lastStopIconContainer]=o===i-1,P),d=(H={},H[I.stopRowDragged]=e._draggedStopIndex===o,H[I.stopRowDropTarget]=e._dropTargetStopIndex===o,H[I.validStopRow]=!s,H),u=(F={},F[I.underlineDragInProcess]=!isNaN(e._draggedStopIndex),F),p=t.getItemAt(i-1),v=p&&p.result,h=t.getItemAt(o+1),_=h&&h.result,m=o===i-1,g=o===i-2,S=2===i&&0===o||i>2&&!m&&!g||i>2&&g&&_||i>2&&m&&!r.result,y=2===i||3===i&&!v||s,f=s?"false":"true",w=e._acquireSearch(r),x=T.removeStop,M=T.reverseStops,b=T.unlocated,C=c.substitute({number:o+1,label:r.result?r.result.name:b},T.stopLabelTemplate),k=e.id+"__stop--"+o,R=!!w.searchTerm&&!!w.selectedResult&&!!r.result&&w.selectedResult===r.result;return a.tsx("li",{"aria-label":C,afterCreate:e._handleStopFieldCreation,bind:e,"class":I.stopRow,classes:d,id:k,key:o,"data-stop-index":o,ondragend:e._handleStopFieldDragEnd,ondragover:e._handleStopFieldDragOver,ondragstart:e._handleStopFieldDragStart,ondrop:e._handleStopFieldDrop},a.tsx("div",{"class":I.stopHandle,draggable:f},a.tsx("span",{"aria-hidden":"true","class":a.join(I.stopIcon,I.handleIcon,I.stopHandleIcon,I.interactiveStopIcon)}),a.tsx("div",{bind:e,"aria-labelledby":k,"class":I.stopIconContainer,classes:l,"data-stop-index":o,onclick:e._handleStopIconClick,onkeydown:e._handleStopIconClick,role:"button"},a.tsx("span",{"class":I.stopIcon,classes:n,tabindex:R?"0":null}))),a.tsx("div",{"class":I.stopInput},w.render(),a.tsx("div",{"class":I.stopUnderline,classes:u})),a.tsx("div",{"class":I.stopOptions,role:"group"},a.tsx("div",{"aria-label":x,"class":I.removeStopButton,bind:e,"data-stop-index":o,hidden:y,onkeydown:e._handleRemoveStop,onclick:e._handleRemoveStop,role:"button",tabIndex:0,title:x},a.tsx("span",{"aria-hidden":"true","class":a.join(I.stopIcon,I.removeStop,I.removeStopIcon,I.interactiveStopIcon)}),a.tsx("span",{"class":I.screenReaderText},"removeStopTitle")),a.tsx("div",{"aria-label":M,"class":I.reverseStops,bind:e,hidden:S,onkeydown:e._handleReverseStops,onclick:e._handleReverseStops,role:"button",tabIndex:0,title:M},a.tsx("span",{"aria-hidden":"true","class":a.join(I.stopIcon,I.reverseStopIcon,I.interactiveStopIcon)}),a.tsx("span",{"class":I.screenReaderText},"removeStopTitle"))));var D,P,H,F}),o=t.every(function(t){var r=e._stopsToSearches.get(t);return t.result&&r.selectedResult===t.result}),i=this._stops.length>=this.maxStops,s=T.addStop,n=t.length>=2&&o&&!i?a.tsx("div",{"aria-label":s,bind:this,"class":I.addStop,key:"esri-directions__add-stop",onfocus:this._handleAddStopFocus,tabIndex:0},a.tsx("span",{"aria-hidden":"true","class":a.join(I.addStopIcon,I.stopIcon,I.interactiveStopIcon)}),a.tsx("div",{"aria-hidden":"true","class":I.addStopText},s)):null;return a.tsx("div",null,a.tsx("ol",{"class":I.stops,role:"group"},r),n)},t.prototype._handleStopIconClick=function(e){var t=e.currentTarget,r=t["data-stop-index"],o=this._stops.getItemAt(r);o&&o.result&&this._centerAtStop(o)},t.prototype._centerAtStop=function(e){this.viewModel.centerAt(e.result.feature)},t.prototype._handleStopFieldCreation=function(e){var t=this._newPlaceholderStop;if(t){var r=e["data-stop-index"],o=this._stops.getItemAt(r);t===o&&this._acquireSearch(o).focus(),this._newPlaceholderStop=null}},t.prototype._handleStopInputBlur=function(e,t){var r=this;this._handleRegistry.remove(k.awaitingViewClickStop),this.view.cursor=this._previousCursor;var o=!!e.selectedResult&&!!t.result&&e.selectedResult===t.result;return o?void 0:"none"!==e.activeMenu||!e.searchTerm||e.selectedResult===t.result&&(e.selectedResult||t.result)?void(e.searchTerm||(this._viewClickHandle.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout(function(){if(!r.destroyed&&(r._pauseViewClickHandles(),"searching"!==e.state)){r._removeStop(t);var o=!!t.result;o&&(t.result=null,r._processStops()),r.scheduleRender()}},this._autoStopRemovalDelay))):void e.search()},t.prototype._handleStopInputFocus=function(e,t){if(!this._handleRegistry.has(k.awaitingViewClickStop)){var r=this,o=r.view,i=r.view.cursor;this._previousCursor=i,this._handleRegistry.add(u.init(e,"searchTerm",function(e){o.cursor=0===e.length?"copy":i}),k.awaitingViewClickStop),this._activeStop=t}},t.prototype._prepViewClick=function(){var e=this,t=this.get("viewModel.view"),r=d.pausable(t,"click",this._handleViewClick.bind(this)),o=d.pausable(t.surface,"click",function(){clearTimeout(e._autoStopRemovalTimeoutId),o.pause()});return{remove:function(){o.remove(),r.remove()},pause:function(){o.pause(),r.pause()},resume:function(){o.resume(),r.resume()}}},t.prototype._handleViewClick=function(e){var t=this,r=this._stopsToSearches.get(this._activeStop);r&&!r.searchTerm&&(r.search(e.mapPoint).then(function(e){var o=M(e),i=t._activeStop;i.result=o,i.result.feature.attributes.Name=o.name,r.searchTerm=o.name,t._processStops(),t.scheduleRender()}),this.scheduleRender()),this._pauseViewClickHandles(),clearTimeout(this._autoStopRemovalTimeoutId)},t.prototype._pauseViewClickHandles=function(){this._viewClickHandle.pause()},t.prototype._handleAddStopFocus=function(e){this._addNewPlaceholder()},t.prototype._addNewPlaceholder=function(){if(!this._newPlaceholderStop){var e={};this._stops.add(e),this._newPlaceholderStop=e}},t.prototype._handleReverseStops=function(){this._reverseStops()},t.prototype._reverseStops=function(){this._stops.reverse(),this._processStops()},t.prototype._handleRemoveStop=function(e){var t=e.currentTarget,r=t["data-stop-index"];this._removeStop(this._stops.getItemAt(r)),this._processStops()},t.prototype._removeStop=function(e){this._stops.length<=2||(this._disposeSearch(e),this._stops.remove(e))},t.prototype._getStopFieldGhost=function(){var e=this._ghost;return e||(e=document.createElement("div"),e.classList.add(I.stopRowGhost,I.offscreen),this._ghost=e),e},t.prototype._handleStopFieldDragStart=function(e){var t=e.currentTarget,r=e.dataTransfer,o=t,i=Number(o["data-stop-index"]);this._draggedStopIndex=i;var s=this._getStopFieldGhost(),n=this._acquireSearch(this._stops.getItemAt(i));s.innerHTML=n.searchTerm||n.activeSource.placeholder,document.body.appendChild(s);var a=s.getBoundingClientRect().height;r.effectAllowed="move",r.setDragImage(s,20,a/2),r.setData("text/plain",o["data-stop-index"])},t.prototype._handleStopFieldDragEnd=function(){this._draggedStopIndex=null,this._dropTargetStopIndex=null,document.body.removeChild(this._getStopFieldGhost())},t.prototype._handleStopFieldDragOver=function(e){var t=e.currentTarget,r=Number(t["data-stop-index"]);return e.preventDefault(),this._draggedStopIndex===r?void(this._dropTargetStopIndex=null):void(this._dropTargetStopIndex=r)},t.prototype._handleStopFieldDrop=function(e){e.stopPropagation(),e.preventDefault();var t=e.currentTarget,r=Number(t["data-stop-index"]),o=Number(e.dataTransfer.getData("text/plain"));if(o!==r){var i=this._stops;i.reorder(i.getItemAt(o),r),this._processStops()}},t.prototype._handleDepartureOptionChange=function(){var e=this,t=event.currentTarget,r=t.item(t.selectedIndex);r.value===b?(this._departureTime=b,this.viewModel.departureTime=b,this._handleRegistry.remove("departure-time-controls")):r.value===C&&(this._departureTime=C,this._handleRegistry.add([u.init(this._datePicker,"value",function(){return e._updateDepartureTime()}),u.init(this._timePicker,"value",function(){return e._updateDepartureTime()})],"departure-time-controls"))},t.prototype._updateDepartureTime=function(){var e=this._datePicker.value,t=this._timePicker.value,r=w({date:e.date(),month:e.month(),year:e.year(),hour:t.hour(),minute:t.minute()});this.viewModel.departureTime=r.toDate()},t.prototype._renderTimeControls=function(){return a.tsx("div",{"class":I.departureTimeControls,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())},t.prototype._renderSectionSplitter=function(){return a.tsx("div",{"class":I.sectionSplitter})},t.prototype._renderDisclaimer=function(){var e='<a href="http://www.esri.com/legal/software-license" target="_blank">'+T.esriTerms+"</a>",t=c.substitute({esriTerms:e},T.disclaimer);return a.tsx("div",{"class":I.disclaimer,innerHTML:t,key:"esri-directions__disclaimer"})},t.prototype._renderDirectionsContainer=function(){return a.tsx("div",{"class":a.join(I.directionsSection,I.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())},t.prototype._renderDirectionsContainerContent=function(){var e=this.viewModel,t=e.lastRoute,r=e.state,o="error"===r,i="routing"===r;return o?this._renderMessage(T.serviceError,"esri-directions__message"):i?a.tsx("span",{"class":a.join(I.loadingIcon,I.rotatingIcon),key:"esri-directions__loading"}):t?a.tsx("div",{"class":I.summary,key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderManeuverSections()):a.tsx("h3",{"class":I.message,key:"esri-directions__placeholder"},T.directionsPlaceholder)},t.prototype._renderMessage=function(e,t){return a.tsx("h3",{"class":I.message,key:t},e)},t.prototype._renderManeuverSections=function(){var e=this,t=this._routeSections.sections;return a.tsx("div",{"class":I.maneuvers,role:"group"},t.map(function(r,o){var i,s=r.open;r.maneuvers.length>0&&s&&(i=a.tsx("ol",{"class":I.maneuverList},r.maneuvers.map(function(t){return e._renderManeuver(t)})));var n,l=t.length>2,c=o===t.length-1,d=(v={},v[I.collapsibleSection]=l,v),u=(h={},h[I.openIcon]=!s,h[I.closeIcon]=s,h);if(l)if(c)n=a.tsx("header",{"class":I.maneuverSectionHeader,key:"esri-directions__maneuver-section-header"},a.tsx("span",{"aria-hidden":"true","class":I.lastStopIcon}),a.tsx("h2",{"class":I.maneuverSectionTitle},r.name));else{var p=s?x.open:x.close;n=a.tsx("header",{"class":a.join(I.maneuverSectionHeader,I.maneuverSectionToggle),key:"esri-directions__maneuver-section-header"},a.tsx("div",{"aria-expanded":s,"aria-label":p,bind:e,"class":I.maneuverSectionHeaderButton,"data-maneuver-section":r,onkeydown:e._handleSectionToggle,onclick:e._handleSectionToggle,role:"button",tabIndex:0,title:p},a.tsx("span",{"aria-hidden":"true",classes:u}),a.tsx("h2",{"class":I.maneuverSectionTitle},r.name)))}else n=null;return a.tsx("section",{"class":I.maneuverSection,classes:d},n,i);var v,h}))},t.prototype._handleSectionToggle=function(e){var t=e.currentTarget,r=t["data-maneuver-section"];r.open=!r.open},t.prototype._renderCosts=function(){var e=this.get("viewModel.directionLines"),t=e[e.length-1],r=w(t.attributes.arriveTimeUTC),o=r.format("LT"),i=r.format("[GMT]ZZ"),s=this._costSummary.set({directionsViewModel:this.viewModel}),n=T.zoomToRoute,l=c.substitute({time:"<strong>"+o+"</strong>",gmt:i},T.etaTemplate),d=T.primaryCosts,u=T.secondaryCosts,p=T.eta;return a.tsx("div",{"aria-label":n,bind:this,"class":I.directionCosts,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,role:"button",tabIndex:0,title:n},a.tsx("div",{"class":I.costsDetails,role:"group"},a.tsx("div",{"aria-label":d,"class":I.primaryCosts,title:d},s.primary),a.tsx("div",{"class":I.verticalSplitter}),a.tsx("div",{"aria-label":u,"class":I.secondaryCosts,title:u},s.secondary)),a.tsx("div",{"aria-label":p,innerHTML:l,title:p}))},t.prototype._handleSummaryInteraction=function(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()},t.prototype._acquireSearch=function(e){var t=this,r=this.get("viewModel.view"),o=r?T.searchFieldPlaceholder:T.viewlessSearchFieldPlaceholder;if(this._stopsToSearches.has(e)){var s=this._stopsToSearches.get(e);return s.view=r,s.defaultSource.placeholder=o,s}var n=new g(i({view:r,resultGraphicEnabled:!1,popupEnabled:!1},this.searchProperties));return n.defaultSource.placeholder=o,n.defaultSource.autoNavigate=!1,this._handleRegistry.add([n.on("select-result",function(){e.result=n.selectedResult,e.result.feature.attributes.Name=n.selectedResult.name,t._processStops(),t.scheduleRender()}),n.on("search-focus",function(){return t._handleStopInputFocus(n,e)}),n.on("search-blur",function(){return t._handleStopInputBlur(n,e)})],n),this._stopsToSearches.set(e,n),n},t.prototype._disposeSearch=function(e){this._stopsToSearches.get(e).destroy(),this._stopsToSearches["delete"](e)},t.prototype._processStops=function(){var e=this.viewModel;e.stops.removeAll(),e.stops.addMany(this._stops.filter(function(e){return!!e.result}).map(function(e){return e.result.feature})),e.stops.length>1&&e.getDirections()},t.prototype._renderManeuver=function(e){var t,r="",o=e.attributes,i=this.get("viewModel.routeParameters.directionsLengthUnits"),n=s.formatDistance(o.length,{toUnits:i}),l=s.formatTime(o.time),c=s.getAssociatedStop(e);s.useSpatiallyLocalTime(e,this.get("viewModel.routeParameters.startTime"))?t=s.toSpatiallyLocalTimeString(o.arriveTimeUTC,o.ETA,this._departureTime===b):n&&(t=l?n+"&nbsp;&middot;<wbr>&nbsp;"+l:n);var d=c,u=this._getFormattedManeuverText(e),p=this._getIconPath(o.maneuverType);if(d)return a.tsx("li",{"class":I.maneuver,key:e},a.tsx("header",null,c.attributes.Name));var v="esri-directions__maneuver-"+e.uid,h="esri-directions__cumulative-costs-"+e.uid,_="esri-directions__intermediate-costs-"+e.uid,m=(g={},g[I.maneuverActive]=this._activeManeuver===e,g);return a.tsx("li",{"aria-labelledby":v+" "+h+" "+_,bind:this,"class":I.maneuver,classes:m,"data-maneuver":e,key:e,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},a.tsx("img",{alt:"","class":I.maneuverIcon,src:p}),a.tsx("div",{"class":I.maneuverCostsContainer},a.tsx("span",{id:v,innerHTML:u}),a.tsx("div",{"class":I.maneuverCosts},a.tsx("div",{"class":I.horizontalSplitter}),a.tsx("div",{id:h,"aria-label":T.cumulativeCosts,"class":I.cumulativeCost,innerHTML:r,title:T.cumulativeCosts}),a.tsx("div",{id:_,"aria-label":T.intermediateCosts,"class":I.intermediateCost,innerHTML:t,title:T.intermediateCosts}))));var g},t.prototype._getIconPath=function(e){var t=n.toIconName(e),r=2===window.devicePixelRatio?"@2x":"";return""+D+t+r+".png"},t.prototype._handleManeuverClick=function(e){var t=e.currentTarget,r=t["data-maneuver"];return this._activeManeuver===r?(this._activeManeuver=null,void this.zoomToRoute()):(this._activeManeuver=r,this.viewModel.centerAt(r),void this.viewModel.highlightSegment(r))},t.prototype._handleManeuverMouseOver=function(e){if(!this._activeManeuver&&!this._focusedManeuver){var t=e.currentTarget,r=t["data-maneuver"];this.viewModel.highlightSegment(r)}},t.prototype._handleManeuverMouseOut=function(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()},t.prototype._handleManeuverBlur=function(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())},t.prototype._handleManeuverFocus=function(e){if(!this._activeManeuver){var t=e.currentTarget,r=t["data-maneuver"];this._focusedManeuver=r,this.viewModel.highlightSegment(r)}},t.prototype._getFormattedManeuverText=function(e){var t=e.attributes.text,r=e.strings;if(!r)return t;var o=t;return r.forEach(function(e){o=o.replace(e.string,"<strong>"+e.string+"</strong>")}),o},o([l.aliasOf("viewModel.maxStops")],t.prototype,"maxStops",void 0),o([l.aliasOf("viewModel.routeServiceUrl")],t.prototype,"routeServiceUrl",void 0),o([l.aliasOf("viewModel.routeSymbol")],t.prototype,"routeSymbol",void 0),o([l.property()],t.prototype,"searchProperties",void 0),o([l.aliasOf("viewModel.stopSymbols")],t.prototype,"stopSymbols",void 0),o([l.aliasOf("viewModel.view")],t.prototype,"view",void 0),o([a.renderable(["lastRoute","state","travelModes"]),l.property({type:p})],t.prototype,"viewModel",void 0),o([l.aliasOf("viewModel.getDirections")],t.prototype,"getDirections",null),o([l.aliasOf("viewModel.zoomToRoute")],t.prototype,"zoomToRoute",null),o([a.accessibleHandler()],t.prototype,"_handleStopIconClick",null),o([a.accessibleHandler()],t.prototype,"_handleReverseStops",null),o([a.accessibleHandler()],t.prototype,"_handleRemoveStop",null),o([a.accessibleHandler()],t.prototype,"_handleSectionToggle",null),o([a.accessibleHandler()],t.prototype,"_handleSummaryInteraction",null),o([a.accessibleHandler()],t.prototype,"_handleManeuverClick",null),t=o([l.subclass("esri.widgets.Directions")],t)}(l.declared(S));return F});