// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.6/esri/copyright.txt for details.

define(["require","exports","../core/tsSupport/declareExtendsHelper","../core/tsSupport/decorateHelper","../core/tsSupport/assignHelper","dojo/i18n!../nls/common","dojo/i18n!./Directions/nls/Directions","../moment","../core/Collection","../core/Handles","../core/lang","../core/on","../core/watchUtils","../core/accessorSupport/decorators","./Search","./Widget","./Directions/DirectionsViewModel","./Directions/support/CostSummary","./Directions/support/DatePicker","./Directions/support/directionsUtils","./Directions/support/maneuverUtils","./Directions/support/RouteSections","./Directions/support/TimePicker","./support/widget"],function(e,t,r,o,i,s,n,a,l,c,d,u,p,h,v,_,m,S,g,f,y,w,T,x){function M(e){return e.results[0].results[0]}var b="now",C={base:"esri-directions esri-widget esri-widget--panel",button:"esri-directions__button",scroller:"esri-directions__scroller",panelContent:"esri-directions__panel-content",panelContentLoading:"esri-directions__panel-content--loading",panelContentError:"esri-directions__panel-content--error",loader:"esri-directions__loader",message:"esri-directions__message",travelModeSelect:"esri-directions__travel-modes-select",departureTime:"esri-directions__departure-time",departureTimeSelect:"esri-directions__departure-time-select",directionsSection:"esri-directions__directions-section",departureTimeControls:"esri-directions__departure-time-controls",section:"esri-directions__section",summary:"esri-directions__summary",stopIcon:"esri-directions__stop-icon",interactiveStopIcon:"esri-directions__stop-icon--interactive",removeStopButton:"esri-directions__remove-stop",removeStop:"esri-directions__remove-stop-icon",reverseStops:"esri-directions__reverse-stops",stopIconContainer:"esri-directions__stop-icon-container",lastStopIconContainer:"esri-directions__stop-icon-container--last",stopHandle:"esri-directions__stop-handle",stopInput:"esri-directions__stop-input",stopOptions:"esri-directions__stop-options",stopUnderline:"esri-directions__stop-underline",underlineDragInProcess:"esri-directions__stop-underline--drag-in-process",stopHandleIcon:"esri-directions__stop-handle-icon",verticalSplitter:"esri-directions__vertical-splitter",stopRow:"esri-directions__stop-row",stopRowGhost:"esri-directions__stop-row-ghost",stopRowDragged:"esri-directions__stop-row--dragged",stopRowDropTarget:"esri-directions__stop-row--target",validStopRow:"esri-directions__stop-row--valid",stops:"esri-directions__stops",addStop:"esri-directions__add-stop",addStopText:"esri-directions__add-stop-text",directionCosts:"esri-directions__costs",costsDetails:"esri-directions__costs-details",primaryCosts:"esri-directions__costs-value",secondaryCosts:"esri-directions__other-costs-total",maneuvers:"esri-directions__maneuvers",maneuverList:"esri-directions__maneuver-list",maneuverSection:"esri-directions__maneuver-section",maneuverSectionHeader:"esri-directions__maneuver-section-header",maneuverSectionHeaderButton:"esri-directions__maneuver-section-header-toggle-button",maneuverSectionTitle:"esri-directions__maneuver-section-title",collapsibleSection:"esri-directions__maneuver-section--collapsible",maneuverSectionToggle:"esri-directions__maneuver-section-toggle",maneuver:"esri-directions__maneuver",maneuverActive:"esri-directions__maneuver--active",maneuverCosts:"esri-directions__maneuver-costs",maneuverCostsContainer:"esri-directions__maneuver-costs-container",maneuverIcon:"esri-directions__maneuver-icon",cumulativeCost:"esri-directions__cost--cumulative",intermediateCost:"esri-directions__cost--intermediate",horizontalSplitter:"esri-directions__horizontal-splitter",sectionSplitter:"esri-directions__section-splitter",disclaimer:"esri-directions__disclaimer",stopsIcon:"esri-icon-radio-unchecked",lastStopIcon:"esri-icon-radio-checked",handleIcon:"esri-icon-handle-vertical",addStopIcon:"esri-icon-plus",removeStopIcon:"esri-icon-close",reverseStopIcon:"esri-icon-up-down-arrows",openIcon:"esri-icon-right-triangle-arrow",closeIcon:"esri-icon-down-arrow",widgetIcon:"esri-icon-directions",emptyContent:"esri-widget__content--empty",offscreen:"esri-offscreen",select:"esri-select",screenReaderText:"esri-icon-font-fallback-text"},I={awaitingViewClickStop:"awaiting-view-click-stop"},k=[{},{}],D=e.toUrl("../themes/base/images/maneuvers/"),R=100;return function(e){function t(t){var r=e.call(this)||this;return r._autoStopRemovalDelay=R,r._costSummary=new S,r._departureTime=b,r._datePicker=new g,r._handles=new c,r._newPlaceholderStop=null,r._routeSections=new w,r._stops=new l(k),r._stopsToSearches=new Map,r._timePicker=new T,r.iconClass=C.widgetIcon,r.label=n.widgetLabel,r.maxStops=null,r.routeServiceUrl=null,r.routeSymbol=null,r.searchProperties=null,r.stopSymbols=null,r.view=null,r.viewModel=new m,r}return r(t,e),t.prototype.postInitialize=function(){var e=this;this.own([p.init(this,"viewModel.lastRoute",function(){e._routeSections.routePath=e.get("viewModel.directionLines"),e._activeManeuver=null,e._focusedManeuver=null,e.scheduleRender()}),p.init(this,"viewModel.selectedTravelMode, viewModel.departureTime",function(){e.get("viewModel.stops.length")>1&&e.getDirections()}),p.when(this,"view",function(t,r){if(r&&(e._viewClickHandle=null,e._handles.remove(r)),t){var o=e._prepViewClick();e._handles.add([u.on(t.surface,"mousedown",function(){return e._autoStopRemovalDelay=500}),u.on(t.surface,"mouseup",function(){return e._autoStopRemovalDelay=R}),o],e.view.surface),e._viewClickHandle=o}}),p.whenOnce(this,"routeServiceUrl",function(){return e.viewModel.load()})])},t.prototype.destroy=function(){this._datePicker.destroy(),this._timePicker.destroy(),this._stopsToSearches.forEach(function(e){return e.destroy()})},t.prototype.getDirections=function(){return null},t.prototype.zoomToRoute=function(){},t.prototype.render=function(){return x.tsx("div",{class:x.join(C.base,C.scroller)},this._renderPanelContent())},t.prototype._renderPanelContent=function(){var e=this.viewModel,t=e.state,r=e.loadStatus,o="initializing"===t,i="error"===t&&"failed"===r,s=(c={},c[C.panelContentLoading]=o,c[C.panelContentError]=i,c),a=o?"presentation":"group",l=i?this._renderMessage(n.serviceError):o?this._renderLoader():this._renderReadyContent();return x.tsx("div",{class:C.panelContent,classes:s,role:a},l);var c},t.prototype._renderReadyContent=function(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSectionSplitter(),this._renderDirectionsContainer(),this._renderDisclaimer()]},t.prototype._renderTravelModeOptions=function(){var e=this.viewModel,t=e.selectedTravelMode,r=e.travelModes,o=t.name||n.travelMode;return r.length>0?x.tsx("select",{"aria-label":o,bind:this,class:x.join(C.travelModeSelect,C.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:o},r.map(function(e){var r=e.id===t.id;return x.tsx("option",{key:e,"data-mode":e,selected:r,value:e.id},e.name)})):null},t.prototype._handleTravelModeChange=function(e){var t=e.currentTarget,r=t.item(t.selectedIndex);this.viewModel.selectedTravelMode=r["data-mode"]},t.prototype._renderStopsContainer=function(){return x.tsx("div",{class:C.section,key:"esri-directions__stops-container",role:"group"},this._renderStops())},t.prototype._renderDepartureTimeControls=function(){var e=this._departureTime===b,t=n.departureTime;return x.tsx("div",{class:C.departureTime,key:"esri-directions__departure-time-controls",role:"group"},x.tsx("select",{"aria-label":t,bind:this,class:x.join(C.departureTimeSelect,C.select),onchange:this._handleDepartureOptionChange,title:t},x.tsx("option",{value:b,selected:e},n.leaveNow),x.tsx("option",{value:"depart-by",selected:!e},n.departBy)),e?null:this._renderTimeControls())},t.prototype._renderStops=function(){var e=this,t=this._stops,r=t.toArray().map(function(r,o){var i=t.length,s=o>1&&!r.result,a=(R={},R[C.stopsIcon]=o>=0&&o<i-1,R[C.lastStopIcon]=o===i-1,R),l=(P={},P[C.lastStopIconContainer]=o===i-1,P),c=(H={},H[C.stopRowDragged]=e._draggedStopIndex===o,H[C.stopRowDropTarget]=e._dropTargetStopIndex===o,H[C.validStopRow]=!s,H),u=(z={},z[C.underlineDragInProcess]=!isNaN(e._draggedStopIndex),z),p=t.getItemAt(i-1),h=p&&p.result,v=t.getItemAt(o+1),_=v&&v.result,m=o===i-1,S=o===i-2,g=2===i&&0===o||i>2&&!m&&!S||i>2&&S&&_||i>2&&m&&!r.result,f=2===i||3===i&&!h||s,y=s?"false":"true",w=e._acquireSearch(r),T=n.removeStop,M=n.reverseStops,b=n.unlocated,I=d.substitute({number:o+1,label:r.result?r.result.name:b},n.stopLabelTemplate),k=e.id+"__stop--"+o,D=!!w.searchTerm&&!!w.selectedResult&&!!r.result&&w.selectedResult===r.result;return x.tsx("li",{"aria-label":I,afterCreate:e._handleStopFieldCreation,bind:e,class:C.stopRow,classes:c,id:k,key:o,"data-stop-index":o,ondragend:e._handleStopFieldDragEnd,ondragover:e._handleStopFieldDragOver,ondragstart:e._handleStopFieldDragStart,ondrop:e._handleStopFieldDrop},x.tsx("div",{class:C.stopHandle,draggable:y},x.tsx("span",{"aria-hidden":"true",class:x.join(C.stopIcon,C.handleIcon,C.stopHandleIcon,C.interactiveStopIcon)}),x.tsx("div",{bind:e,"aria-labelledby":k,class:C.stopIconContainer,classes:l,"data-stop-index":o,onclick:e._handleStopIconClick,onkeydown:e._handleStopIconClick,role:"button"},x.tsx("span",{class:C.stopIcon,classes:a,tabindex:D?"0":null}))),x.tsx("div",{class:C.stopInput},w.render(),x.tsx("div",{class:C.stopUnderline,classes:u})),x.tsx("div",{class:C.stopOptions,role:"group"},x.tsx("div",{"aria-label":T,class:C.removeStopButton,bind:e,"data-stop-index":o,hidden:f,onkeydown:e._handleRemoveStop,onclick:e._handleRemoveStop,role:"button",tabIndex:0,title:T},x.tsx("span",{"aria-hidden":"true",class:x.join(C.stopIcon,C.removeStop,C.removeStopIcon,C.interactiveStopIcon)}),x.tsx("span",{class:C.screenReaderText},"removeStopTitle")),x.tsx("div",{"aria-label":M,class:C.reverseStops,bind:e,hidden:g,onkeydown:e._handleReverseStops,onclick:e._handleReverseStops,role:"button",tabIndex:0,title:M},x.tsx("span",{"aria-hidden":"true",class:x.join(C.stopIcon,C.reverseStopIcon,C.interactiveStopIcon)}),x.tsx("span",{class:C.screenReaderText},"removeStopTitle"))));var R,P,H,z}),o=t.every(function(t){var r=e._stopsToSearches.get(t);return t.result&&r.selectedResult===t.result}),i=this._stops.length>=this.maxStops,s=n.addStop,a=t.length>=2&&o&&!i?x.tsx("div",{"aria-label":s,bind:this,class:C.addStop,key:"esri-directions__add-stop",onfocus:this._handleAddStopFocus,tabIndex:0},x.tsx("span",{"aria-hidden":"true",class:x.join(C.addStopIcon,C.stopIcon,C.interactiveStopIcon)}),x.tsx("div",{"aria-hidden":"true",class:C.addStopText},s)):null;return x.tsx("div",null,x.tsx("ol",{class:C.stops,role:"group"},r),a)},t.prototype._handleStopIconClick=function(e){var t=e.currentTarget,r=t["data-stop-index"],o=this._stops.getItemAt(r);o&&o.result&&this._centerAtStop(o)},t.prototype._centerAtStop=function(e){this.viewModel.centerAt(e.result.feature)},t.prototype._handleStopFieldCreation=function(e){var t=this._newPlaceholderStop;if(t){var r=e["data-stop-index"],o=this._stops.getItemAt(r);t===o&&this._acquireSearch(o).focus(),this._newPlaceholderStop=null}},t.prototype._handleStopInputBlur=function(e,t){var r=this;if(this._handles.remove(I.awaitingViewClickStop),this.view.cursor=this._previousCursor,!(!!e.selectedResult&&!!t.result&&e.selectedResult===t.result))return"none"!==e.activeMenu||!e.searchTerm||e.selectedResult===t.result&&(e.selectedResult||t.result)?void(e.searchTerm||(this._viewClickHandle.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout(function(){r.destroyed||(r._pauseViewClickHandles(),"searching"===e.state)||(r._removeStop(t),!!t.result&&(t.result=null,r._processStops()),r.scheduleRender())},this._autoStopRemovalDelay))):void e.search()},t.prototype._handleStopInputFocus=function(e,t){if(!this._handles.has(I.awaitingViewClickStop)){var r=this,o=r.view,i=r.view.cursor;this._previousCursor=i,this._handles.add(p.init(e,"searchTerm",function(e){o.cursor=0===e.length?"copy":i}),I.awaitingViewClickStop),this._activeStop=t}},t.prototype._prepViewClick=function(){var e=this,t=this.get("viewModel.view"),r=u.pausable(t,"click",this._handleViewClick.bind(this)),o=u.pausable(t.surface,"click",function(){clearTimeout(e._autoStopRemovalTimeoutId),o.pause()});return{remove:function(){o.remove(),r.remove()},pause:function(){o.pause(),r.pause()},resume:function(){o.resume(),r.resume()}}},t.prototype._handleViewClick=function(e){var t=this,r=this._stopsToSearches.get(this._activeStop);r&&!r.searchTerm&&(r.search(e.mapPoint).then(function(e){var o=M(e),i=t._activeStop;i.result=o,i.result.feature.attributes.Name=o.name,r.searchTerm=o.name,t._processStops(),t.scheduleRender()}),this.scheduleRender()),this._pauseViewClickHandles(),clearTimeout(this._autoStopRemovalTimeoutId)},t.prototype._pauseViewClickHandles=function(){this._viewClickHandle.pause()},t.prototype._handleAddStopFocus=function(e){this._addNewPlaceholder()},t.prototype._addNewPlaceholder=function(){if(!this._newPlaceholderStop){var e={};this._stops.add(e),this._newPlaceholderStop=e}},t.prototype._handleReverseStops=function(){this._reverseStops()},t.prototype._reverseStops=function(){this._stops.reverse(),this._processStops()},t.prototype._handleRemoveStop=function(e){var t=e.currentTarget,r=t["data-stop-index"];this._removeStop(this._stops.getItemAt(r)),this._processStops()},t.prototype._removeStop=function(e){this._stops.length<=2||(this._disposeSearch(e),this._stops.remove(e))},t.prototype._getStopFieldGhost=function(){var e=this._ghost;return e||(e=document.createElement("div"),e.classList.add(C.stopRowGhost,C.offscreen),this._ghost=e),e},t.prototype._handleStopFieldDragStart=function(e){var t=e.currentTarget,r=e.dataTransfer,o=t,i=Number(o["data-stop-index"]);this._draggedStopIndex=i;var s=this._getStopFieldGhost(),n=this._acquireSearch(this._stops.getItemAt(i));s.innerHTML=n.searchTerm||n.activeSource.placeholder,document.body.appendChild(s);var a=s.getBoundingClientRect().height;r.effectAllowed="move",r.setDragImage(s,20,a/2),r.setData("text/plain",o["data-stop-index"])},t.prototype._handleStopFieldDragEnd=function(){this._draggedStopIndex=null,this._dropTargetStopIndex=null,document.body.removeChild(this._getStopFieldGhost())},t.prototype._handleStopFieldDragOver=function(e){var t=e.currentTarget,r=Number(t["data-stop-index"]);if(e.preventDefault(),this._draggedStopIndex===r)return void(this._dropTargetStopIndex=null);this._dropTargetStopIndex=r},t.prototype._handleStopFieldDrop=function(e){e.stopPropagation(),e.preventDefault();var t=e.currentTarget,r=Number(t["data-stop-index"]),o=Number(e.dataTransfer.getData("text/plain"));if(o!==r){var i=this._stops;i.reorder(i.getItemAt(o),r),this._processStops()}},t.prototype._handleDepartureOptionChange=function(){var e=this,t=event.currentTarget,r=t.item(t.selectedIndex);r.value===b?(this._departureTime=b,this.viewModel.departureTime=b,this._handles.remove("departure-time-controls")):"depart-by"===r.value&&(this._departureTime="depart-by",this._handles.add([p.init(this._datePicker,"value",function(){return e._updateDepartureTime()}),p.init(this._timePicker,"value",function(){return e._updateDepartureTime()})],"departure-time-controls"))},t.prototype._updateDepartureTime=function(){var e=this._datePicker.value,t=this._timePicker.value,r=a({date:e.date(),month:e.month(),year:e.year(),hour:t.hour(),minute:t.minute()});this.viewModel.departureTime=r.toDate()},t.prototype._renderTimeControls=function(){return x.tsx("div",{class:C.departureTimeControls,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())},t.prototype._renderSectionSplitter=function(){return x.tsx("div",{class:C.sectionSplitter})},t.prototype._renderDisclaimer=function(){var e='<a href="http://www.esri.com/legal/software-license" target="_blank">'+n.esriTerms+"</a>",t=d.substitute({esriTerms:e},n.disclaimer);return x.tsx("div",{class:C.disclaimer,innerHTML:t,key:"esri-directions__disclaimer"})},t.prototype._renderDirectionsContainer=function(){return x.tsx("div",{class:x.join(C.directionsSection,C.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())},t.prototype._renderLoader=function(){return x.tsx("div",{class:C.loader,key:"loader"})},t.prototype._renderDirectionsContainerContent=function(){var e=this.viewModel,t=e.lastRoute,r=e.state,o="error"===r,i="routing"===r;return o?this._renderMessage(n.serviceError,"esri-directions__message"):i?this._renderLoader():t?x.tsx("div",{class:C.summary,key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderManeuverSections()):x.tsx("div",{key:"esri-directions__placeholder",class:C.emptyContent},x.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},x.tsx("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"})),x.tsx("h4",{class:C.message},n.directionsPlaceholder))},t.prototype._renderMessage=function(e,t){return x.tsx("h3",{class:C.message,key:t},e)},t.prototype._renderManeuverSections=function(){var e=this,t=this._routeSections.sections;return x.tsx("div",{class:C.maneuvers,role:"group"},t.map(function(r,o){var i,n=r.open;r.maneuvers.length>0&&n&&(i=x.tsx("ol",{class:C.maneuverList},r.maneuvers.map(function(t){return e._renderManeuver(t)})));var a,l=t.length>2,c=o===t.length-1,d=(h={},h[C.collapsibleSection]=l,h),u=(v={},v[C.openIcon]=!n,v[C.closeIcon]=n,v);if(l)if(c)a=x.tsx("header",{class:C.maneuverSectionHeader,key:"esri-directions__maneuver-section-header"},x.tsx("span",{"aria-hidden":"true",class:C.lastStopIcon}),x.tsx("h2",{class:C.maneuverSectionTitle},r.name));else{var p=n?s.open:s.close;a=x.tsx("header",{class:x.join(C.maneuverSectionHeader,C.maneuverSectionToggle),key:"esri-directions__maneuver-section-header"},x.tsx("div",{"aria-expanded":n,"aria-label":p,bind:e,class:C.maneuverSectionHeaderButton,"data-maneuver-section":r,onkeydown:e._handleSectionToggle,onclick:e._handleSectionToggle,role:"button",tabIndex:0,title:p},x.tsx("span",{"aria-hidden":"true",classes:u}),x.tsx("h2",{class:C.maneuverSectionTitle},r.name)))}else a=null;return x.tsx("section",{class:C.maneuverSection,classes:d},a,i);var h,v}))},t.prototype._handleSectionToggle=function(e){var t=e.currentTarget,r=t["data-maneuver-section"];r.open=!r.open},t.prototype._renderCosts=function(){var e=this.get("viewModel.directionLines"),t=e[e.length-1],r=a(t.attributes.arriveTimeUTC),o=r.format("LT"),i=r.format("[GMT]ZZ"),s=this._costSummary.set({directionsViewModel:this.viewModel}),l=n.zoomToRoute,c=d.substitute({time:"<strong>"+o+"</strong>",gmt:i},n.etaTemplate),u=n.primaryCosts,p=n.secondaryCosts,h=n.eta;return x.tsx("div",{"aria-label":l,bind:this,class:C.directionCosts,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,role:"button",tabIndex:0,title:l},x.tsx("div",{class:C.costsDetails,role:"group"},x.tsx("div",{"aria-label":u,class:C.primaryCosts,title:u},s.primary),x.tsx("div",{class:C.verticalSplitter}),x.tsx("div",{"aria-label":p,class:C.secondaryCosts,title:p},s.secondary)),x.tsx("div",{"aria-label":h,innerHTML:c,title:h}))},t.prototype._handleSummaryInteraction=function(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()},t.prototype._acquireSearch=function(e){var t=this,r=this.get("viewModel.view"),o=r?n.searchFieldPlaceholder:n.viewlessSearchFieldPlaceholder;if(this._stopsToSearches.has(e)){var s=this._stopsToSearches.get(e);return s.view=r,s.defaultSource.placeholder=o,s}var a=new v(i({view:r,resultGraphicEnabled:!1,popupEnabled:!1},this.searchProperties));return a.defaultSource.placeholder=o,a.defaultSource.autoNavigate=!1,this._handles.add([a.on("select-result",function(){e.result=a.selectedResult,e.result.feature.attributes.Name=a.selectedResult.name,t._processStops(),t.scheduleRender()}),a.on("search-focus",function(){return t._handleStopInputFocus(a,e)}),a.on("search-blur",function(){return t._handleStopInputBlur(a,e)})],a),this._stopsToSearches.set(e,a),a},t.prototype._disposeSearch=function(e){this._stopsToSearches.get(e).destroy(),this._stopsToSearches.delete(e)},t.prototype._processStops=function(){var e=this.viewModel;e.stops.removeAll(),e.stops.addMany(this._stops.filter(function(e){return!!e.result}).map(function(e){return e.result.feature})),e.stops.length>1&&e.getDirections()},t.prototype._renderManeuver=function(e){var t,r=e.attributes,o=this.get("viewModel.routeParameters.directionsLengthUnits"),i=f.formatDistance(r.length,{toUnits:o}),s=f.formatTime(r.time),a=f.getAssociatedStop(e);f.useSpatiallyLocalTime(e,this.get("viewModel.routeParameters.startTime"))?t=f.toSpatiallyLocalTimeString(r.arriveTimeUTC,r.ETA,this._departureTime===b):i&&(t=s?i+"&nbsp;&middot;<wbr>&nbsp;"+s:i);var l=a,c=this._getFormattedManeuverText(e),d=this._getIconPath(r.maneuverType);if(l)return x.tsx("li",{class:C.maneuver,key:e},x.tsx("header",null,a.attributes.Name));var u="esri-directions__maneuver-"+e.uid,p="esri-directions__cumulative-costs-"+e.uid,h="esri-directions__intermediate-costs-"+e.uid,v=(_={},_[C.maneuverActive]=this._activeManeuver===e,_);return x.tsx("li",{"aria-labelledby":u+" "+p+" "+h,bind:this,class:C.maneuver,classes:v,"data-maneuver":e,key:e,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},x.tsx("img",{alt:"",class:C.maneuverIcon,src:d}),x.tsx("div",{class:C.maneuverCostsContainer},x.tsx("span",{id:u,innerHTML:c}),x.tsx("div",{class:C.maneuverCosts},x.tsx("div",{class:C.horizontalSplitter}),x.tsx("div",{id:p,"aria-label":n.cumulativeCosts,class:C.cumulativeCost,innerHTML:"",title:n.cumulativeCosts}),x.tsx("div",{id:h,"aria-label":n.intermediateCosts,class:C.intermediateCost,innerHTML:t,title:n.intermediateCosts}))));var _},t.prototype._getIconPath=function(e){var t=y.toIconName(e),r=2===window.devicePixelRatio?"@2x":"";return""+D+t+r+".png"},t.prototype._handleManeuverClick=function(e){var t=e.currentTarget,r=t["data-maneuver"];if(this._activeManeuver===r)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=r,this.viewModel.centerAt(r),this.viewModel.highlightSegment(r)},t.prototype._handleManeuverMouseOver=function(e){if(!this._activeManeuver&&!this._focusedManeuver){var t=e.currentTarget,r=t["data-maneuver"];this.viewModel.highlightSegment(r)}},t.prototype._handleManeuverMouseOut=function(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()},t.prototype._handleManeuverBlur=function(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())},t.prototype._handleManeuverFocus=function(e){if(!this._activeManeuver){var t=e.currentTarget,r=t["data-maneuver"];this._focusedManeuver=r,this.viewModel.highlightSegment(r)}},t.prototype._getFormattedManeuverText=function(e){var t=e.attributes.text,r=e.strings;if(!r)return t;var o=t;return r.forEach(function(e){o=o.replace(e.string,"<strong>"+e.string+"</strong>")}),o},o([h.property()],t.prototype,"iconClass",void 0),o([h.property()],t.prototype,"label",void 0),o([h.aliasOf("viewModel.maxStops")],t.prototype,"maxStops",void 0),o([h.aliasOf("viewModel.routeServiceUrl")],t.prototype,"routeServiceUrl",void 0),o([h.aliasOf("viewModel.routeSymbol")],t.prototype,"routeSymbol",void 0),o([h.property()],t.prototype,"searchProperties",void 0),o([h.aliasOf("viewModel.stopSymbols")],t.prototype,"stopSymbols",void 0),o([h.aliasOf("viewModel.view")],t.prototype,"view",void 0),o([x.renderable(["lastRoute","state","travelModes"]),h.property({type:m})],t.prototype,"viewModel",void 0),o([h.aliasOf("viewModel.getDirections")],t.prototype,"getDirections",null),o([h.aliasOf("viewModel.zoomToRoute")],t.prototype,"zoomToRoute",null),o([x.accessibleHandler()],t.prototype,"_handleStopIconClick",null),o([x.accessibleHandler()],t.prototype,"_handleReverseStops",null),o([x.accessibleHandler()],t.prototype,"_handleRemoveStop",null),o([x.accessibleHandler()],t.prototype,"_handleSectionToggle",null),o([x.accessibleHandler()],t.prototype,"_handleSummaryInteraction",null),o([x.accessibleHandler()],t.prototype,"_handleManeuverClick",null),t=o([h.subclass("esri.widgets.Directions")],t)}(h.declared(_))});