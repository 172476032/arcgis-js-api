// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.6/esri/copyright.txt for details.

/**
             * Defines the layout template options used by the {@link module:esri/widgets/Print|Print} widget to generate the print page.
             *
             * @name templateOptions
             * @since 4.6
             * @instance
             *
             * @example
             * templateOptions: {
             *   title: "My Print",
             *   author: "Sam",
             *   copyright: "My Company",
             *   legendEnabled: false
             * }
             *
             * @type {module:esri/widgets/Print/TemplateOptions}
             * @autocast
             */

define(["require","exports","../core/tsSupport/declareExtendsHelper","../core/tsSupport/decorateHelper","../core/accessorSupport/decorators","./Print/PrintViewModel","../tasks/support/PrintTemplate","../core/Logger","../core/watchUtils","./Widget","./Print/FileLink","./Print/TemplateOptions","../core/urlUtils","./support/widget","dojo/i18n!./Print/nls/Print"],function(t,e,i,n,a,o,r,s,l,p,d,c,u,h,_){var b={base:"esri-print esri-widget esri-widget--panel",headerTitle:"esri-print__header-title",inputText:"esri-print__input-text",layoutTabList:"esri-print__layout-tab-list",layoutTab:"esri-print__layout-tab",layoutSection:"esri-print__layout-section",mapOnlySection:"esri-print__map-only-section",scaleInput:"esri-print__scale-input",advancedOptionsButton:"esri-print__advanced-options-button",advancedOptionsButtonContainer:"esri-print__advanced-options-button-container",advancedOptionsButtonTitle:"esri-print__advanced-options-button-title",advancedOptionsButtonIconOpened:"esri-print__advanced-options-button-icon--opened",advancedOptionsButtonIconClosed:"esri-print__advanced-options-button-icon--closed",advancedOptionsButtonIconClosed_RTL:"esri-print__advanced-options-button-icon--closed-rtl",refreshButton:"esri-print__refresh-button",swapButton:"esri-print__swap-button",linkButton:"esri-print__link-button",printButton:"esri-print__export-button",formSectionContainer:"esri-print__form-section-container",advancedOptionsSection:"esri-print__advanced-options-section",advancedOptionsContainer:"esri-print__advanced-options-container",authorInfoContainer:"esri-print__author-info-container",copyrightInfoContainer:"esri-print__copyright-info-container",exportedFilesContainer:"esri-print__export-panel-container",exportedFilesTitle:"esri-print__export-title",exportedFile:"esri-print__exported-file",exportedFileLink:"esri-print__exported-file-link",exportedFileLinkTitle:"esri-print__exported-file-link-title",heightContainer:"esri-print__height-container",legendInfoContainer:"esri-print__legend-info-container",printWidgetContainer:"esri-print__container",panelContainer:"esri-print__panel-container",scaleInfoContainer:"esri-print__scale-info-container",scaleInputContainer:"esri-print__scale-input-container",sizeContainer:"esri-print__size-container",widthContainer:"esri-print__width-container",button:"esri-widget-button",select:"esri-select",disabled:"esri-disabled",panelError:"esri-print__panel--error",exportedFileError:"esri-print__exported-file--error",hide:"esri-hidden",rotate:"esri-rotating",iconCheckMark:"esri-icon-check-mark",iconDownload:"esri-icon-download",iconError:"esri-icon-error",iconPrinter:"esri-icon-printer",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconDownArrow:"esri-icon-down-arrow",iconRefresh:"esri-icon-refresh",iconSpinner:"esri-icon-loading-indicator",iconSwap:"esri-icon-swap",iconLinked:"esri-icon-link-horizontal",iconUnlinked:"esri-icon-unlocked-link-horizontal"},x="esri.widgets.Print",f=s.getLogger(x),y="User sets an invalid layout, resetting it to the default valid one...",v="User sets an invalid format, resetting it to the default valid one...",m=function(t){function e(e){var i=t.call(this)||this;return i._exportedFileNameMap={},i._layoutTabSelected=!0,i._advancedOptionsVisible=!1,i._pendingExportScroll=!1,i._rootNode=null,i._templatesInfo=null,i.templateOptions=new c,i.printServiceUrl=null,i.view=null,i.viewModel=new o,i}return i(e,t),e.prototype.postInitialize=function(){var t=this,e=this.templateOptions,i=e.format,n=e.height,a=e.layout,o=e.scale,r=e.scaleEnabled,s=e.width;l.init(this,"viewModel.templatesInfo",function(e){if(e){t._templatesInfo=e;var n=a===e.layout.defaultValue||a&&"MAP_ONLY"===a.toUpperCase()||e.layout.choiceList&&e.layout.choiceList.indexOf(a)>-1,o=i===e.format.defaultValue||e.format.choiceList&&e.format.choiceList.indexOf(i)>-1;n||(a&&f.warn(y),t.templateOptions.layout=t._templatesInfo.layout.defaultValue),o||(i&&f.warn(v),t.templateOptions.format=t._templatesInfo.format.defaultValue),a&&"MAP_ONLY"===a.toUpperCase()&&(t._layoutTabSelected=!1)}}),l.init(this,"templateOptions.format",function(e){if(t._templatesInfo&&e){var i=!1;t._templatesInfo.format.choiceList&&t._templatesInfo.format.choiceList.forEach(function(n){n.toUpperCase()===e.toUpperCase()&&(t.templateOptions.format=n,i=!0)}),i||(t.templateOptions.format=t._templatesInfo.format.defaultValue,f.warn(v)),t.scheduleRender()}}),l.init(this,"templateOptions.layout",function(e){if(t._templatesInfo&&e){t._layoutTabSelected="MAP_ONLY"!==e.toUpperCase();var i=!t._layoutTabSelected;i||t._templatesInfo.layout.choiceList&&t._templatesInfo.layout.choiceList.forEach(function(n){n.toUpperCase()===e.toUpperCase()&&(t.templateOptions.layout=n,i=!0)}),i||(t.templateOptions.layout=t._templatesInfo.layout.defaultValue,f.warn(y)),t.scheduleRender()}}),l.init(this,"viewModel.view.scale",function(e){r&&o||(t.templateOptions.scale=e)}),this.templateOptions.width=s||800,this.templateOptions.height=n||1100},e.prototype.render=function(){var t=this,e=this.templateOptions,i=e.attributionEnabled,n=e.author,a=e.copyright,o=e.format,r=e.height,s=e.layout,l=e.legendEnabled,p=e.title,d=e.scaleEnabled,c=e.scale,u=e.width,x=h.tsx("div",{"class":b.formSectionContainer},h.tsx("label",null,this._layoutTabSelected?_.title:_.fileName,h.tsx("input",{type:"text",tabIndex:0,placeholder:this._layoutTabSelected?_.titlePlaceHolder:_.fileNamePlaceHolder,"class":b.inputText,value:p,"data-input-name":"title",oninput:this._updateInputValue,bind:this}))),f=this.get("_templatesInfo.format.choiceList")||[],y=f.length>0?f.map(function(t){var e=t===o;return h.tsx("option",{key:t,selected:e},t)}):h.tsx("option",{key:"format-default-option"},_.formatDefaultOption),v=h.tsx("div",{"class":b.formSectionContainer},h.tsx("label",null,_.fileFormatTitle,h.tsx("select",{"class":b.select,onchange:this._updateFromOption,"data-target-property":"format",bind:this},y))),m=this.get("_templatesInfo.layout.choiceList")||[],g=m.length>0?m.map(function(e){var i=e===s;return h.tsx("option",{key:e,bind:t,selected:i},e)}):h.tsx("option",{key:"layout-default-option"},_.layoutDefaultOption),O=h.tsx("div",{"class":b.formSectionContainer},h.tsx("label",null,_.layoutTitle,h.tsx("select",{"class":b.select,onchange:this._updateFromOption,"data-target-property":"layout",bind:this},g))),w=this._advancedOptionsVisible?h.tsx("div",{"aria-labelledby":this.id+"__advancedOptions","class":b.advancedOptionsContainer},h.tsx("div",{"class":h.join(b.scaleInfoContainer,b.formSectionContainer)},h.tsx("label",null,h.tsx("input",{"data-option-name":"scaleEnabled",checked:d,type:"checkbox",tabIndex:0,onchange:this._toggleInputValue,bind:this}),_.scale),h.tsx("div",{"class":b.scaleInputContainer},h.tsx("input",{"aria-label":_.scaleLabel,"aria-valuenow":""+c,role:"spinbutton",type:"number","class":h.join(b.inputText,b.scaleInput),tabIndex:0,"data-input-name":"scale",oninput:this._updateInputValue,disabled:!d,value:""+c,bind:this}),h.tsx("button",{role:"button","aria-label":_.reset,"class":h.join(b.button,b.refreshButton,b.iconRefresh),tabIndex:0,onclick:this._resetToCurrentScale,bind:this}))),h.tsx("div",{"class":h.join(b.authorInfoContainer,b.formSectionContainer)},h.tsx("label",null,_.author,h.tsx("input",{type:"text",value:n,"class":b.inputText,tabIndex:0,"data-input-name":"author",oninput:this._updateInputValue,bind:this}))),h.tsx("div",{"class":h.join(b.copyrightInfoContainer,b.formSectionContainer)},h.tsx("label",null,_.copyright,h.tsx("input",{type:"text","class":b.inputText,tabIndex:0,value:a,"data-input-value":"copyright",oninput:this._updateInputValue,bind:this}))),h.tsx("div",{"class":h.join(b.legendInfoContainer,b.formSectionContainer)},h.tsx("label",null,h.tsx("input",{type:"checkbox","data-option-name":"legendEnabled",tabIndex:0,checked:l,onchange:this._toggleInputValue,bind:this}),_.legend))):null,I=this._layoutTabSelected?h.tsx("section",{key:"esri-print__layoutContent",id:this.id+"__layoutContent","aria-labelledby":this.id+"__layoutTab","class":b.layoutSection,role:"tabpanel","aria-selected":this._layoutTabSelected},h.tsx("div",{"class":b.panelContainer},x,O,this._layoutTabSelected?v:null),h.tsx("div",{"class":h.join(b.panelContainer,b.advancedOptionsSection)},h.tsx("button",{"aria-label":_.advancedOptions,"aria-expanded":this._advancedOptionsVisible?"true":"false",role:"button","class":b.advancedOptionsButton,onclick:this._showAdvancedOptions,bind:this},h.tsx("div",{"class":b.advancedOptionsButtonContainer},h.tsx("span",{"aria-hidden":"true","class":h.join(b.iconRightTriangleArrow,b.advancedOptionsButtonIconClosed)}),h.tsx("span",{"aria-hidden":"true","class":h.join(b.iconLeftTriangleArrow,b.advancedOptionsButtonIconClosed_RTL)}),h.tsx("span",{"aria-hidden":"true","class":h.join(b.iconDownArrow,b.advancedOptionsButtonIconOpened)}),h.tsx("span",{"class":b.advancedOptionsButtonTitle},_.advancedOptions))),w)):h.tsx("section",{key:"esri-print__mapOnlyContent",id:this.id+"__mapOnlyContent","aria-selected":!this._layoutTabSelected,"aria-labelledby":this.id+"__mapOnlyTab","class":b.mapOnlySection,role:"tabpanel"},h.tsx("div",{"class":b.panelContainer},x,this._layoutTabSelected?null:v,h.tsx("div",{"class":h.join(b.sizeContainer,b.formSectionContainer)},h.tsx("div",{"class":b.widthContainer},h.tsx("label",null,_.width,h.tsx("input",{type:"text","class":b.inputText,"data-input-name":"width",onchange:this._updateInputValue,value:""+u,tabIndex:0,bind:this}))),h.tsx("div",{"class":b.heightContainer},h.tsx("label",null,_.height,h.tsx("input",{type:"text","class":b.inputText,"data-input-name":"height",onchange:this._updateInputValue,value:""+r,tabIndex:0,bind:this}))),h.tsx("button",{role:"button","aria-label":_.swap,"class":h.join(b.button,b.swapButton,b.iconSwap),onclick:this._switchInput,tabIndex:0,bind:this})),h.tsx("div",{"class":b.formSectionContainer},h.tsx("label",null,h.tsx("input",{"data-option-name":"attributionEnabled",type:"checkbox",onchange:this._toggleInputValue,tabIndex:0,checked:i,bind:this}),_.attribution)))),T=this.exportedLinks.toArray(),C=this._renderExportedLink(T),k=(M={},M[b.disabled]=!s&&!o,M),S=null!=this.get("view")&&"2d"!==this.get("view.type"),L=h.tsx("div",{"class":b.panelError},S?_.sceneViewError:_.serviceError),E=h.tsx("div",null,h.tsx("ul",{"class":b.layoutTabList,role:"tablist",onclick:this._toggleLayoutPanel,onkeydown:this._toggleLayoutPanel,bind:this},h.tsx("li",{id:this.id+"__layoutTab","data-tab-id":"layoutTab","class":b.layoutTab,role:"tab",tabIndex:0,"aria-selected":""+this._layoutTabSelected,bind:this},_.layoutTab),h.tsx("li",{id:this.id+"__mapOnlyTab","data-tab-id":"mapOnlyTab","class":b.layoutTab,role:"tab",tabIndex:0,"aria-selected":""+!this._layoutTabSelected,bind:this},_.mapOnlyTab)),I,h.tsx("button",{"aria-label":_.exportDescription,role:"button","class":b.printButton,tabIndex:0,classes:k,onclick:this._handlePrintMap,bind:this},_["export"]),h.tsx("div",{"class":b.exportedFilesContainer,afterUpdate:this._scrollExportIntoView,onclick:this._removeLink,bind:this},h.tsx("h2",{"class":b.exportedFilesTitle},_.exportText),T.length>0?null:h.tsx("div",null,h.tsx("div",null,_.exportHint)),C)),V=h.tsx("div",null,h.tsx("div",{"class":b.printWidgetContainer},h.tsx("header",{"class":b.headerTitle},_["export"]),this.error||!this.printServiceUrl||S||!this.view?L:E));return h.tsx("div",{afterCreate:h.storeNode,bind:this,"class":b.base,"data-node-ref":"_rootNode"},V);var M},e.prototype._addFileLink=function(t){var e=t.layoutOptions.titleText||_.untitled,i=t.format.toLowerCase(),n=i.indexOf("png")>-1?"png":i,a=e+n,o=void 0!==this._exportedFileNameMap[a];o?this._exportedFileNameMap[a]++:this._exportedFileNameMap[a]=0,this.exportedLinks.add(new d({name:e,extension:n,count:this._exportedFileNameMap[a]}))},e.prototype._toPrintTemplate=function(t){var e=this.templateOptions,i=e.attributionEnabled,n=e.author,a=e.copyright,o=e.format,s=e.height,l=e.layout,p=e.legendEnabled,d=e.title,c=e.scale,u=e.width,h=new r({attributionVisible:i,layoutOptions:{authorText:n||"",copyrightText:a||"",titleText:d||""},format:o,layout:l,outScale:c});return u&&(h.exportOptions.width=u),s&&(h.exportOptions.height=s),p||(h.layoutOptions.legendLayers=[]),h},e.prototype._resetToCurrentScale=function(){this.templateOptions.scale=this.viewModel.view.scale},e.prototype._updateInputValue=function(t){var e=t.target,i=e.getAttribute("data-input-name");this.templateOptions[i]=e.value},e.prototype._handlePrintMap=function(){this._pendingExportScroll=!0;var t=this._toPrintTemplate(this.templateOptions);this._addFileLink(t),this.viewModel.print(t)},e.prototype._updateFromOption=function(t){var e=t.target,i=e.selectedOptions?e.selectedOptions.item(0).value:e.options[e.selectedIndex].value,n=e.getAttribute("data-target-property");this.templateOptions[n]=i},e.prototype._switchInput=function(){t=[this.templateOptions.height,this.templateOptions.width],this.templateOptions.width=t[0],this.templateOptions.height=t[1];var t},e.prototype._showAdvancedOptions=function(){this._advancedOptionsVisible=!this._advancedOptionsVisible},e.prototype._scrollExportIntoView=function(){if(this._pendingExportScroll){this._pendingExportScroll=!1;var t=this,e=t._rootNode,i=t._rootNode,n=i.clientHeight,a=i.scrollHeight,o=a-n;o>0&&(e.scrollTop=o)}},e.prototype._toggleInputValue=function(t){var e=t.target,i=e.getAttribute("data-option-name");this.templateOptions[i]=e.checked,"scaleEnabled"===i&&(this.viewModel.scaleEnabled=this.templateOptions.scaleEnabled,this.templateOptions[i]||this._resetToCurrentScale())},e.prototype._removeLink=function(t){var e=t.target,i=e["data-item"];i&&"error"===i.state&&this.exportedLinks.remove(i)},e.prototype._renderExportedLink=function(t){return t.map(function(t){var e=(o={},o[b.iconSpinner]="pending"===t.state,o[b.rotate]="pending"===t.state,o[b.iconDownload]="ready"===t.state,o[b.iconError]="error"===t.state,o[b.exportedFileError]="error"===t.state,o),i=(r={},r[b.disabled]="pending"===t.state,r[b.exportedFileError]="error"===t.state,r),n=""===t.url?null:t.url;n&&(n=u.addProxy(n));var a;return a="pending"===t.state?_.pending:"ready"===t.state?_.ready:_.error,h.tsx("div",{"aria-label":a,key:t.formattedName,"class":b.exportedFile},h.tsx("a",{"aria-label":t.formattedName+". "+_.linkReady,href:n,tabIndex:0,target:"_blank","class":b.exportedFileLink},h.tsx("span",{"data-item":t,classes:e}),h.tsx("span",{"data-item":t,"class":b.exportedFileLinkTitle,classes:i},t.formattedName)));var o,r})},e.prototype._resetInputValue=function(){this.templateOptions.title=""},e.prototype._toggleLayoutPanel=function(t){this._resetInputValue();var e=t.target;if(this._layoutTabSelected="layoutTab"===e.getAttribute("data-tab-id"),this._layoutTabSelected){var i=this.get("_templatesInfo.layout.choiceList");this.templateOptions.layout=i&&i[0]}else this.templateOptions.layout="MAP_ONLY"},n([a.aliasOf("viewModel.exportedLinks"),h.renderable()],e.prototype,"exportedLinks",void 0),n([h.renderable(),a.property({type:c})],e.prototype,"templateOptions",void 0),n([a.aliasOf("viewModel.error")],e.prototype,"error",void 0),n([a.aliasOf("viewModel.printServiceUrl")],e.prototype,"printServiceUrl",void 0),n([a.aliasOf("viewModel.view"),h.renderable()],e.prototype,"view",void 0),n([a.property({type:o}),h.renderable(["viewModel.templatesInfo","viewModel.state"])],e.prototype,"viewModel",void 0),n([h.accessibleHandler()],e.prototype,"_toggleLayoutPanel",null),e=n([a.subclass("esri.widgets.Print")],e)}(a.declared(p));return m});