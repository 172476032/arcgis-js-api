// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.5/esri/copyright.txt for details.

define(["require","exports","../../../core/tsSupport/assignHelper","../../../core/tsSupport/declareExtendsHelper","../../../core/tsSupport/decorateHelper","../../../core/accessorSupport/decorators","../../../core/promiseUtils","../../../core/urlUtils","../../../symbols/support/styleUtils","../../../symbols/support/symbolPreview","../../../Color","../../../core/Accessor","../../../request","../../../symbols/support/jsonUtils","../../../symbols/support/gfxUtils","dojo/dom-construct","dojo/i18n!../nls/SymbolStyler"],function(t,e,r,o,i,n,a,l,s,p,m,y,u,c,d,h,v){function b(t){var e=h.create("div"),r=t.data.title,o=t.get("data.thumbnail.href");return o?u(l.makeAbsolute(o,t.get("portalItem.itemUrl")),{responseType:"image"}).then(function(t){return t.data}).otherwise(function(){return S(r)}).then(function(t){return e.appendChild(t),e}):(e.appendChild(S(r)),a.resolve(e))}function S(t){return void 0===t&&(t=v.noTitle),h.create("span",{innerHTML:t,alt:""})}function f(t,e,r){var o=s.styleNameFromItem(r),i=null;o||(i=r.itemUrl+"/data");var n={data:t,baseUrl:r.itemUrl,styleName:o,styleUrl:i};return s.fetchSymbolFromStyle(n,e,{portal:r.portal})}Object.defineProperty(e,"__esModule",{value:!0});var g=[{name:"Circle",type:"esriSMS",style:"esriSMSCircle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Square",type:"esriSMS",style:"esriSMSSquare",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Diamond",type:"esriSMS",style:"esriSMSDiamond",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Cross",type:"esriSMS",style:"esriSMSCross",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"X",type:"esriSMS",style:"esriSMSX",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}}],w=10,I=5,_=[{name:v.circle,primitive:"circle"},{name:v.square,primitive:"square"},{name:v.cross,primitive:"cross"},{name:v.x,primitive:"x"},{name:v.kite,primitive:"kite"}],C=[{name:v.sphere,primitive:"sphere"},{name:v.tallCylinder,primitive:"cylinder",mixins:{width:I,height:w,depth:I}},{name:v.cylinder,primitive:"cylinder"},{name:v.tallCube,primitive:"cube",mixins:{width:I,height:w,depth:I,anchor:"bottom"}},{name:v.cube,primitive:"cube"},{name:v.tallCone,primitive:"cone",mixins:{width:I,height:w,depth:I}},{name:v.cone,primitive:"cone"},{name:v.invertedCone,primitive:"inverted-cone"},{name:v.diamond,primitive:"diamond"},{name:v.tetrahedron,primitive:"tetrahedron"}],O=_.map(function(t){return{dimensionality:"flat",title:t.name,type:"PointSymbol3D",symbolLayers:[{type:"Icon",resource:{primitive:t.primitive},material:{color:d.defaultThematicColor},outline:{color:[0,0,0]}}]}}),M=C.map(function(t){return{dimensionality:"volumetric",title:t.name,type:"PointSymbol3D",symbolLayers:[r({type:"Object",resource:{primitive:t.primitive}},t.mixins)]}}),T={getSymbol:function(t){var e=t.data,r=t.parentData,o=t.portalItem;return f(r,e.name,o).then(function(t){return"point-3d"===t.type&&t.symbolLayers.forEach(function(t){t.get("material.color")&&("icon"===t.type?t.material.color=d.defaultThematicColor.clone():"object"===t.type&&(t.material.color=t.material.color||new m([255,255,255])))}),t})},getThumbnail:function(t){return b(t)}},D={getSymbol:function(t){return a.resolve(c.fromJSON(t.data))},getThumbnail:function(t){var e=24;return t.getSymbol().then(function(t){return p.renderPreviewHTML(t,{size:e})})}},P={getSymbol:function(t){return a.resolve(c.fromJSON(t.data))},getThumbnail:function(t){var e=48;return t.getSymbol().then(function(t){return p.renderPreviewHTML(t,{size:e})})}},U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.getSymbol=function(){var t=this;return this._symbol?a.resolve(this._symbol):this.strategy.getSymbol(this).then(function(e){return t._symbol=e})},e.prototype.getThumbnail=function(t){var e=this;return this._thumbnail?(t.appendChild(this._thumbnail),a.resolve()):this.strategy.getThumbnail(this).then(function(r){e._thumbnail=r,t.appendChild(e._thumbnail)})},i([n.property()],e.prototype,"strategy",void 0),i([n.property()],e.prototype,"data",void 0),i([n.property()],e.prototype,"parentData",void 0),i([n.property()],e.prototype,"portalItem",void 0),e=i([n.subclass("esri.widgets.SymbolStyler.SymbolItem")],e)}(n.declared(y));e.SymbolItem=U;var x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.fetchData=function(){var t=this;return this.data?a.resolve(this.data):this.portalItem.fetchData().then(function(e){return t._set("data",e),e})},i([n.property({readOnly:!0})],e.prototype,"data",void 0),i([n.property({aliasOf:"portalItem.id"})],e.prototype,"id",void 0),i([n.property({aliasOf:"portalItem.name"})],e.prototype,"name",void 0),i([n.property({aliasOf:"portalItem.title"})],e.prototype,"title",void 0),i([n.property()],e.prototype,"portalItem",void 0),e=i([n.subclass("esri.widgets.SymbolStyler.PortalItemSymbolSourceBase")],e)}(n.declared(y)),j=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="symbol-set",e}return o(e,t),e.prototype.getItems=function(){return a.resolve(null)},i([n.property({readOnly:!0})],e.prototype,"type",void 0),e=i([n.subclass("esri.widgets.SymbolStyler.SymbolSetSymbolSource")],e)}(n.declared(x));e.SymbolSetSymbolSource=j;var z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="web-style",e}return o(e,t),e.prototype.getItems=function(){var t=this;return this._items?a.resolve(this._items):this.fetchData().then(function(e){return e.items.map(function(r){return new U({data:r,parentData:e,portalItem:t.portalItem,strategy:T})})}).then(function(e){return t._items=e})},i([n.property({readOnly:!0})],e.prototype,"type",void 0),e=i([n.subclass("esri.widgets.SymbolStyler.WebStyleSymbolSource")],e)}(n.declared(x));e.WebStyleSymbolSource=z;var q=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=g,e.id="basic-symbol-set",e.name="Basic",e.title=v.basic,e.type="symbol-set",e}return o(e,t),e.prototype.getItems=function(){return a.resolve(null)},i([n.property()],e.prototype,"data",void 0),i([n.property()],e.prototype,"id",void 0),i([n.property()],e.prototype,"name",void 0),i([n.property()],e.prototype,"title",void 0),i([n.property({readOnly:!0})],e.prototype,"type",void 0),e=i([n.subclass("esri.widgets.SymbolStyler.BasicSymbolSetSource")],e)}(n.declared(y));e.BasicSymbolSetSource=q;var B=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data={items:O},e.id="basic-web-style:flat",e.name="Basic",e.title=v.basic,e.type="web-style",e}return o(e,t),e.prototype.getItems=function(){if(this._items)return a.resolve(this._items);var t=this.data.items.map(function(t){return new U({data:t,strategy:D})});return a.resolve(this._items=t)},i([n.property()],e.prototype,"data",void 0),i([n.property()],e.prototype,"id",void 0),i([n.property()],e.prototype,"name",void 0),i([n.property()],e.prototype,"title",void 0),i([n.property({readOnly:!0})],e.prototype,"type",void 0),e=i([n.subclass("esri.widgets.SymbolStyler.IconPrimitiveWebStyleSource")],e)}(n.declared(y));e.IconPrimitiveWebStyleSource=B;var H=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data={items:M},e.id="basic-web-style:volumetric",e.name="Basic",e.title=v.basic,e.type="web-style",e}return o(e,t),e.prototype.getItems=function(){var t=this;if(this._items)return a.resolve(this._items);var e=this.data.items.map(function(e){return new U({data:e,parentData:t.data,strategy:P})});return a.resolve(this._items=e)},i([n.property()],e.prototype,"data",void 0),i([n.property()],e.prototype,"id",void 0),i([n.property()],e.prototype,"name",void 0),i([n.property()],e.prototype,"title",void 0),i([n.property({readOnly:!0})],e.prototype,"type",void 0),e=i([n.subclass("esri.widgets.SymbolStyler.ObjectPrimitiveWebStyleSource")],e)}(n.declared(y));e.ObjectPrimitiveWebStyleSource=H});