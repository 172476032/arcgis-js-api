// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.23/esri/copyright.txt for details.

define(["dojo/_base/window","dojo/sniff","../kernel"],function(r,e,n){function i(){if(v)return v;v={available:!1,version:0,supportsHighPrecisionFragment:!1};var r,e=function(r,e){for(var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null,t=0;t<n.length;++t){try{i=r.getContext(n[t],e)}catch(a){}if(i)break}return i};try{if(!b.WebGLRenderingContext)throw 0;r=document.createElement("canvas")}catch(n){return v}var i=e(r,{failIfMajorPerformanceCaveat:!0});if(i||(i=e(r),i&&(v.majorPerformanceCaveat=!0)),!i)return v;var t=i.getParameter(i.VERSION);if(!t)return v;var a=t.match(/^WebGL\s+([\d.]*)/);if(a){v.version=parseFloat(a[1]),v.available=v.version>=.94;var o=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);v.supportsHighPrecisionFragment=o&&o.precision>0,v.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0,v.supportsElementIndexUint=null!=i.getExtension("OES_element_index_uint")}return v}function t(){return!!i().available}function a(){return!!i().supportsHighPrecisionFragment}function o(){return!!i().supportsVertexShaderSamplers}function s(){return!!i().supportsElementIndexUint}function d(){return!!i().majorPerformanceCaveat}if(e("host-node"))return e;var m,f=e("ff"),c=e("ie"),u=void 0===c&&e("trident")>=7,l=e("webkit"),p=e("opera"),x=e("chrome"),g=e("safari"),b=r.global,h=navigator.userAgent;if(m=h.match(/(iPhone|iPad|CPU)\s+OS\s+(\d+\_\d+)/i),m&&e.add("esri-iphone",parseFloat(m[2].replace("_","."))),m=h.match(/Android\s+(\d+\.\d+)/i),m&&e.add("esri-android",parseFloat(m[1])),m=h.match(/Fennec\/(\d+\.\d+)/i),m&&e.add("esri-fennec",parseFloat(m[1])),h.indexOf("BlackBerry")>=0&&h.indexOf("WebKit")>=0&&e.add("esri-blackberry",1),e.add("esri-touch",e("esri-iphone")||e("esri-android")||e("esri-blackberry")||e("esri-fennec")>=6||(f||l)&&b.document&&b.document.createTouch?!0:!1),m=h.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i),m&&e.add("esri-mobile",m),e.add("esri-pointer",navigator.pointerEnabled||navigator.msPointerEnabled),n._getDOMAccessor=function(r){var e="";return f?e="Moz":l?e="Webkit":c?e="ms":p&&(e="O"),e+r.charAt(0).toUpperCase()+r.substr(1)},e.add("esri-phonegap",!!b.cordova),e.add("esri-cors",e("esri-phonegap")||"XMLHttpRequest"in b&&"withCredentials"in new XMLHttpRequest),e.add("esri-canvas-svg-support",function(){return!(e("trident")||e("ie"))}),e.add("esri-wasm","WebAssembly"in b),e("host-webworker"))return e;e.add("esri-workers","Worker"in b),e.add("esri-script-sandbox",function(){return"MessageChannel"in b&&"HTMLIFrameElement"in b&&"sandbox"in HTMLIFrameElement.prototype}),e.add("esri-transforms",u||c>=9||f>=3.5||x>=4||g>=3.1||p>=10.5||e("esri-iphone")>=3.2||e("esri-android")>=2.1),e.add("esri-transitions",u||c>=10||f>=4||x>=4||g>=3.1||p>=10.5||e("esri-iphone")>=3.2||e("esri-android")>=2.1),e.add("esri-transforms3d",u||f>=10||x>=12||g>=4||e("esri-iphone")>=3.2||e("esri-android")>=3),e.add("esri-url-encodes-apostrophe",function(){var r=b.document.createElement("a");return r.href="?'",r.href.indexOf("?%27")>-1}),e("esri-android")<3&&(e.add("esri-transforms",!1,!1,!0),e.add("esri-transitions",!1,!1,!0),e.add("esri-transforms3d",!1,!1,!0)),n._css=function(r){var n=e("esri-transforms3d");void 0!==r&&null!==r?n=r:n&&(x||g&&!e("esri-iphone"))&&(n=!1);var i=n?"translate3d(":"translate(",t=n?x?",-1px)":",0px)":")",a=n?"scale3d(":"scale(",o=n?",1)":")",s=n?"rotate3d(0,0,1,":"rotate(",d=n?"matrix3d(":"matrix(",m=n?",0,0,":",",u=n?",0,0,0,0,1,0,":",",b=n?",0,1)":")";return{names:{transition:l&&"-webkit-transition"||f&&"MozTransition"||p&&"OTransition"||c&&"msTransition"||"transition",transform:l&&"-webkit-transform"||f&&"MozTransform"||p&&"OTransform"||c&&"msTransform"||"transform",transformName:l&&"-webkit-transform"||f&&"-moz-transform"||p&&"-o-transform"||c&&"-ms-transform"||"transform",origin:l&&"-webkit-transform-origin"||f&&"MozTransformOrigin"||p&&"OTransformOrigin"||c&&"msTransformOrigin"||"transformOrigin",endEvent:l&&"webkitTransitionEnd"||f&&"transitionend"||p&&"oTransitionEnd"||c&&"MSTransitionEnd"||"transitionend"},translate:function(r,e){return i+r+"px,"+e+"px"+t},scale:function(r){return a+r+","+r+o},rotate:function(r){return s+r+"deg)"},matrix:function(r){return r.m?(r=r.m,d+r[0].toFixed(10)+","+r[1].toFixed(10)+m+r[2].toFixed(10)+","+r[3].toFixed(10)+u+r[4].toFixed(10)+(f?"px,":",")+r[5].toFixed(10)+(f?"px":"")+b):d+r.xx.toFixed(10)+","+r.yx.toFixed(10)+m+r.xy.toFixed(10)+","+r.yy.toFixed(10)+u+r.dx.toFixed(10)+(f?"px,":",")+r.dy.toFixed(10)+(f?"px":"")+b},matrix3d:function(r){return r=r.m,"matrix3d("+r[0].toFixed(10)+","+r[1].toFixed(10)+",0,0,"+r[2].toFixed(10)+","+r[3].toFixed(10)+",0,0,0,0,1,0,"+r[4].toFixed(10)+","+r[5].toFixed(10)+",0,1)"},getScaleFromMatrix:function(r){if(!r)return 1;r=r.toLowerCase();var e=r.indexOf("matrix3d")>-1?"matrix3d(":"matrix(";return Number(r.substring(e.length,r.indexOf(",")))}}};var v;return e.add("esri-webgl",t),e.add("esri-webgl-high-precision-fragment",a),e.add("esri-webgl-vertex-shader-samplers",o),e.add("esri-webgl-element-index-uint",s),e.add("esri-webgl-major-performance-caveat",d),e});