// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.19/esri/copyright.txt for details.

define(["require","exports"],function(t,e){function s(t){for(var e={items:new Array,count:0},s=0;t>s;++s)e.items.push({v1:{vector:[void 0,void 0],side:void 0},v2:{vector:[void 0,void 0],side:void 0},v3:{vector:[void 0,void 0],side:void 0}});return e}function r(t){for(var e={items:new Array,count:0},s=0;t>s;++s)e.items.push(void 0);return e}function o(t){for(var e={items:new Array,count:0},s=0;t>s;++s)e.items.push({vector:[void 0,void 0],side:void 0});return e}function i(t){for(var e={items:new Array,count:0},s=0;t>s;++s)e.items.push([void 0,void 0]);return e}function v(){var t=o(30),e={};e[g.ENTRY]=r(20),e[g.EXIT]=r(20),e[g.CAP]=r(20);var s={vectors:t,lists:e};return s}function c(t,e){return t[0]*e[0]+t[1]*e[1]}function n(t){return Math.sqrt(c(t,t))}function a(t,e){var s=n(e);return t[0]=e[0]/s,t[1]=e[1]/s,t}function m(t,e){return t[0]=-e[1],t[1]=e[0],t}function u(t,e){var s=t[0]*e[1]-t[1]*e[0];return s}function d(t,e){return t[0]=-e[0],t[1]=-e[1],t}function l(t,e,s){return t[0]=e[0]*s,t[1]=e[1]*s,t}function f(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t}function T(t){return Math.round(t*D)}function E(t,e){var s=c(t,e);return s>.999?0:-.999>s?Math.PI:Math.acos(s)}function C(t,e,s,r,o){if(0===r)return void(t.count=0);for(var i=n(e),v=l(V[0],e,1/i),c=l(V[1],s,1/i),a=E(v,c),m=(o?-1:1)*a/r,u=Math.cos(m),d=Math.sin(m),f=e[0],T=e[1],C=0;r-1>C;++C){var A=f,M=T;f=u*A-d*M,T=d*A+u*M,t.items[C][0]=f,t.items[C][1]=T}t.count=r-1}function A(t){for(var e=t.count,s=Math.floor(e/2),r=0;s>r;++r){var o=t.items[r];t.items[r]=t.items[e-r-1],t.items[e-r-1]=o}}function M(t,e,s,r){var o,i,v,c,n=e.vectors,a=e.lists[g.EXIT],m=s.vectors,u=s.lists[g.ENTRY];if(a.count===u.count+1)o=a.items,i=n.items,v=u.items,c=m.items;else if(u.count===a.count+1)o=u.items,i=m.items,v=a.items,c=n.items;else{if(a.count!==u.count)throw new Error("Cannot bridge "+a.count+" to "+u.count+".");r?(o=a.items,i=n.items,v=u.items,c=m.items):(o=u.items,i=m.items,v=a.items,c=n.items)}var d=a.count+u.count-2;t.count=d,F[0]=o,F[1]=v,O[0]=i,O[1]=c;for(var l=0;d>l;++l){var f=t.items[l],T=(l+0)%2,E=Math.floor((l+0)/2),C=O[T][F[T][E]];f.v1.vector[0]=C.vector[0],f.v1.vector[1]=C.vector[1],f.v1.side=C.side,f.v1.base=C.base;var A=(l+1)%2,M=Math.floor((l+1)/2),h=O[A][F[A][M]];f.v2.vector[0]=h.vector[0],f.v2.vector[1]=h.vector[1],f.v2.side=h.side,f.v2.base=h.base;var R=(l+2)%2,I=Math.floor((l+2)/2),p=O[R][F[R][I]];f.v3.vector[0]=p.vector[0],f.v3.vector[1]=p.vector[1],f.v3.side=p.side,f.v3.base=p.base}}function h(t,e){if(0===e.lists[g.CAP].count)return void(t.count=0);if(1===e.lists[g.CAP].count)throw new Error("A single vector is not enough to define a pie.");t.count=e.lists[g.CAP].count-1;for(var s=0;s<t.count;++s){var r=t.items[s],o=e.lists[g.CAP].items[s],i=e.vectors.items[o];r.v1.vector[0]=i.vector[0],r.v1.vector[1]=i.vector[1],r.v1.side=i.side,r.v1.base=i.base;var v=e.lists[g.CAP].items[s+1],c=e.vectors.items[v];r.v2.vector[0]=c.vector[0],r.v2.vector[1]=c.vector[1],r.v2.side=c.side,r.v2.base=c.base;var n=e.capCenter,a=e.vectors.items[n];r.v3.vector[0]=a.vector[0],r.v3.vector[1]=a.vector[1],r.v3.side=a.side,r.v3.base=a.base}}function R(t,e,s){Y(t,e,s)}function I(t,e,s,r,o){Y(t,e,s);var i=r===q.START?0:1,v=r===q.START?1:0;t.capCenter=t.vectors.count;var c=t.vectors.items[t.capCenter];c.vector[0]=0,c.vector[1]=0,c.side=G,++t.vectors.count,C(z,t.vectors.items[i].vector,t.vectors.items[v].vector,o,!1);var n=t.vectors.count,a=t.lists[g.CAP];a.items[0]=i;for(var m=t.vectors.items[i].side,u=t.vectors.items[v].side,d=0;d<z.count;++d){var l=d<z.count/2?m:u,f=z.items[d],T=t.vectors.items[n+d];T.vector[0]=f[0],T.vector[1]=f[1],T.side=l,a.items[d+1]=n+d}a.items[z.count+1]=v,a.count=z.count+2,t.vectors.count=n+z.count}function p(t,e,s,r){Y(t,e,s);var o=r===q.START?0:1,i=r===q.START?1:0,v=V[0],c=V[1],n=V[2],a=V[3],m=V[4],u=t.vectors.items[o].vector;v[0]=j*u[0]-k*u[1],v[1]=k*u[0]+j*u[1],l(a,v,B),c[0]=j*v[0]-k*v[1],c[1]=k*v[0]+j*v[1],n[0]=j*c[0]-k*c[1],n[1]=k*c[0]+j*c[1],l(m,n,B);var d=t.vectors.items[o];d.vector[0]=a[0],d.vector[1]=a[1];var f=t.vectors.items[i];f.vector[0]=m[0],f.vector[1]=m[1]}function P(t,e,s,r){Y(t,e,s);var o=r===q.START?0:1,i=r===q.START?1:0;t.capCenter=t.vectors.count;var v=t.vectors.items[t.capCenter];v.vector[0]=0,v.vector[1]=0,v.side=G,++t.vectors.count;var c=V[0],n=V[1],a=V[2],m=V[3],u=V[4],d=t.vectors.items[o].vector;c[0]=j*d[0]-k*d[1],c[1]=k*d[0]+j*d[1],l(m,c,B),n[0]=j*c[0]-k*c[1],n[1]=k*c[0]+j*c[1],a[0]=j*n[0]-k*n[1],a[1]=k*n[0]+j*n[1],l(u,a,B);var f=t.vectors.count,T=t.lists[g.CAP];T.items[0]=o;var E=t.vectors.items[f+0];E.vector[0]=m[0],E.vector[1]=m[1],E.side=t.vectors.items[o].side,T.items[1]=f+0;var C=t.vectors.items[f+1];C.vector[0]=u[0],C.vector[1]=u[1],C.side=t.vectors.items[i].side,T.items[2]=f+1,T.items[3]=i,T.count=4,t.vectors.count+=2}function Y(t,e,s){var r=m(V[0],s),o=r,i=d(V[1],r),v=t.vectors.items[0];v.vector[0]=o[0],v.vector[1]=o[1],v.side=J;var c=t.vectors.items[1];c.vector[0]=i[0],c.vector[1]=i[1],c.side=y,t.vectors.count=2;var n=t.lists[g.ENTRY];n.items[0]=0,n.items[1]=1,n.count=2;var a=t.lists[g.EXIT];a.items[0]=0,a.items[1]=1,a.count=2,t.lists[g.CAP].count=0,t.capCenter=void 0}function N(t,e,s){var r=m(V[0],e),o=m(V[1],s),i=V[2];i[0]=r[0]+o[0],i[1]=r[1]+o[1];var v=a(V[3],i),n=c(v,r);v=l(V[4],v,1/n);var u=d(V[5],v),f=t.vectors.items[0];f.vector[0]=v[0],f.vector[1]=v[1],f.side=J;var T=t.vectors.items[1];T.vector[0]=u[0],T.vector[1]=u[1],T.side=y,t.vectors.count=2;var E=t.lists[g.ENTRY];E.items[0]=0,E.items[1]=1,E.count=2;var C=t.lists[g.EXIT];C.items[0]=0,C.items[1]=1,C.count=2,t.lists[g.CAP].count=0,t.capCenter=void 0}function b(t,e,s,r){var o=r*r,i=u(e,s),v=i>0?[J,y]:[y,J],n=v[0],T=v[1],E=i>0?d(V[0],m(V[1],e)):m(V[2],e),C=i>0?d(V[3],m(V[4],s)):m(V[5],s),M=V[6];M[0]=E[0]+C[0],M[1]=E[1]+C[1];var h=a(V[7],M),R=d(V[8],h),I=c(h,E),p=u(h,E),P=Math.abs(p/I),Y=1+P*P,N=w>Y?[P,!1]:[Math.sqrt(w-1),!0],b=N[0],S=N[1],X=o>Y?[P,!1]:[Math.sqrt(o-1),!0],_=X[0],q=X[1];if(q&&S){var L=t.vectors.items[0];f(L.vector,d(V[9],E),l(V[10],d(V[11],e),b)),L.side=n;var D=t.vectors.items[1];f(D.vector,d(V[12],C),l(V[13],s,b)),D.side=n;var x=t.vectors.items[2];x.vector[0]=0,x.vector[1]=0,x.side=G;var z=t.vectors.items[3];f(z.vector,E,l(V[14],e,_)),z.side=T;var F=t.vectors.items[4];f(F.vector,C,l(V[15],d(V[16],s),_)),F.side=T,t.vectors.count=5;var O=t.lists[g.ENTRY];O.items[0]=0,O.items[1]=2,O.items[2]=3,O.count=3;var j=t.lists[g.EXIT];j.items[0]=1,j.items[1]=2,j.items[2]=4,j.count=3;var k=t.lists[g.CAP];k.items[0]=3,k.items[1]=4,k.count=2,t.capCenter=2}else if(!q&&S){var L=t.vectors.items[0];f(L.vector,d(V[9],E),l(V[10],d(V[11],e),b)),L.side=n;var D=t.vectors.items[1];f(D.vector,d(V[12],C),l(V[13],s,b)),D.side=n;var x=t.vectors.items[2];x.vector[0]=0,x.vector[1]=0,x.side=G;var z=t.vectors.items[3];l(z.vector,h,1/I),z.side=T,t.vectors.count=4;var O=t.lists[g.ENTRY];O.items[0]=0,O.items[1]=2,O.items[2]=3,O.count=3;var j=t.lists[g.EXIT];j.items[0]=1,j.items[1]=2,j.items[2]=3,j.count=3,t.lists[g.CAP].count=0,t.capCenter=void 0}else if(q&&!S){var L=t.vectors.items[0];l(L.vector,R,1/I),L.side=n;var D=t.vectors.items[1];D.vector[0]=0,D.vector[1]=0,D.side=G;var x=t.vectors.items[2];f(x.vector,E,l(V[9],e,_)),x.side=T;var z=t.vectors.items[3];f(z.vector,C,l(V[10],d(V[11],s),_)),z.side=T,t.vectors.count=4;var O=t.lists[g.ENTRY];O.items[0]=0,O.items[1]=1,O.items[2]=2,O.count=3;var j=t.lists[g.EXIT];j.items[0]=0,j.items[1]=1,j.items[2]=3,j.count=3;var k=t.lists[g.CAP];k.items[0]=2,k.items[1]=3,k.count=2,t.capCenter=1}else if(!q&&!S){var L=t.vectors.items[0];l(L.vector,R,1/I),L.side=n;var D=t.vectors.items[1];l(D.vector,h,1/I),D.side=T,t.vectors.count=2;var O=t.lists[g.ENTRY];O.items[0]=0,O.items[1]=1,O.count=2;var j=t.lists[g.EXIT];j.items[0]=0,j.items[1]=1,j.count=2,t.lists[g.CAP].count=0,t.capCenter=void 0}0>i&&(A(t.lists[g.ENTRY]),A(t.lists[g.EXIT]))}function S(t,e,s,r){var o=u(e,s),i=o>0?[J,y]:[y,J],v=i[0],n=i[1],T=o>0?d(V[0],m(V[1],e)):m(V[2],e),E=o>0?d(V[3],m(V[4],s)):m(V[5],s),M=V[6];M[0]=T[0]+E[0],M[1]=T[1]+E[1];var h=a(V[7],M),R=d(V[8],h),I=c(h,T),p=u(h,T),P=Math.abs(p/I),Y=1+P*P,N=w>Y?[P,!1]:[Math.sqrt(w-1),!0],b=N[0],S=N[1];if(S){var X=t.vectors.items[0];X.vector[0]=T[0],X.vector[1]=T[1],X.side=n;var _=t.vectors.items[1];_.vector[0]=E[0],_.vector[1]=E[1],_.side=n;var q=t.vectors.items[2];f(q.vector,d(V[9],T),l(V[10],d(V[11],e),b)),q.side=v;var L=t.vectors.items[3];f(L.vector,d(V[12],E),l(V[13],s,b)),L.side=v;var D=t.vectors.items[4];D.vector[0]=0,D.vector[1]=0,D.side=G,t.vectors.count=5;var x=t.lists[g.ENTRY];x.items[0]=2,x.items[1]=4,x.items[2]=0,x.count=3;var F=t.lists[g.EXIT];F.items[0]=3,F.items[1]=4,F.items[2]=1,F.count=3,t.capCenter=4}else{var X=t.vectors.items[0];X.vector[0]=T[0],X.vector[1]=T[1],X.side=n;var _=t.vectors.items[1];_.vector[0]=E[0],_.vector[1]=E[1],_.side=n;var q=t.vectors.items[2];l(q.vector,R,1/I),q.side=v;var L=t.vectors.items[3];L.vector[0]=0,L.vector[1]=0,L.side=G,t.vectors.count=4;var x=t.lists[g.ENTRY];x.items[0]=2,x.items[1]=3,x.items[2]=0,x.count=3;var F=t.lists[g.EXIT];F.items[0]=2,F.items[1]=3,F.items[2]=1,F.count=3,t.capCenter=3}C(z,T,E,r,0>o);var O=t.vectors.count,j=t.lists[g.CAP];j.items[0]=0;for(var k=0;k<z.count;++k){var B=z.items[k],H=t.vectors.items[O+k];H.vector[0]=B[0],H.vector[1]=B[1],H.side=n,j.items[k+1]=O+k}j.items[z.count+1]=1,j.count=z.count+2,t.vectors.count=O+z.count,0>o&&(A(t.lists[g.ENTRY]),A(t.lists[g.EXIT]))}function X(t,e,s,r){var o=u(e,s),i=o>0?[J,y]:[y,J],v=i[0],c=i[1],n=o>0?d(V[0],m(V[1],e)):m(V[2],e),a=o>0?d(V[3],m(V[4],s)):m(V[5],s),l=t.vectors.items[0];l.vector[0]=n[0],l.vector[1]=n[1],l.side=c;var f=t.vectors.items[1];f.vector[0]=a[0],f.vector[1]=a[1],f.side=c;var T=t.vectors.items[2];d(T.vector,n),T.side=v;var E=t.vectors.items[3];d(E.vector,a),E.side=v;var M=t.vectors.items[4];M.vector[0]=0,M.vector[1]=0,M.side=G,t.vectors.count=5;var h=t.lists[g.ENTRY];h.items[0]=2,h.items[1]=4,h.items[2]=0,h.count=3;var R=t.lists[g.EXIT];R.items[0]=3,R.items[1]=4,R.items[2]=1,R.count=3,t.capCenter=4,C(z,n,a,r,0>o);var I=t.vectors.count,p=t.lists[g.CAP];p.items[0]=0;for(var P=0;P<z.count;++P){var Y=z.items[P],N=t.vectors.items[I+P];N.vector[0]=Y[0],N.vector[1]=Y[1],N.side=c,p.items[P+1]=I+P}p.items[z.count+1]=1,p.count=z.count+2,t.vectors.count=I+z.count,0>o&&(A(t.lists[g.ENTRY]),A(t.lists[g.EXIT]))}function _(t,e,s){var r=m(V[0],e),o=m(V[1],s),i=t.vectors.items[0];i.vector[0]=r[0],i.vector[1]=r[1],i.side=J;var v=t.vectors.items[1];v.vector[0]=o[0],v.vector[1]=o[1],v.side=J;var c=t.vectors.items[2];d(c.vector,r),c.side=y;var n=t.vectors.items[3];d(n.vector,o),n.side=y,t.vectors.count=4;var a=t.lists[g.ENTRY];a.items[0]=0,a.items[1]=2,a.count=2;var u=t.lists[g.EXIT];u.items[0]=1,u.items[1]=3,u.count=2,t.capCenter=void 0}var g;!function(t){t[t.ENTRY=1]="ENTRY",t[t.EXIT=2]="EXIT",t[t.CAP=3]="CAP"}(g=e.VectorRole||(e.VectorRole={}));var q;!function(t){t[t.START=1]="START",t[t.END=2]="END"}(q=e.CapPosition||(e.CapPosition={})),e.SYSTEM_MAG_LIMIT=3.8,e.MITER_SAFE_RADS=2*Math.acos(1/e.SYSTEM_MAG_LIMIT);var w=e.SYSTEM_MAG_LIMIT*e.SYSTEM_MAG_LIMIT,J=-1,y=1,G=0,L=16,D=L/(2*Math.PI);e.allocTriangles=s,e.allocExtrudeVectors=v;for(var V=[],x=0;32>x;++x)V.push([void 0,void 0]);var z=i(L);e.length=n,e.normalize=a,e.getNumberOfSlices=T,e.getRads=E;var F=[void 0,void 0],O=[void 0,void 0];e.bridge=M,e.pie=h,e.buttCap=R,e.roundCap=I;var j=Math.cos(Math.PI/4),k=Math.sin(Math.PI/4),B=Math.sqrt(2);e.squareCap=p,e.squareCapAlt=P,e.fastMiterJoin=Y,e.miterJoin=N,e.bevelJoin=b,e.roundJoin=S,e.unitRoundJoin=X,e.rectJoin=_});