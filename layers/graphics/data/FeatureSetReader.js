// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.6/esri/copyright.txt for details.

define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/tsSupport/generatorHelper","../../../geometry/support/boundsUtils","../../../geometry/support/centroid","../../../geometry/support/quantizationUtils","@dojo/shim/Symbol"],function(t,e,r,n,o,i,u){function s(t){switch(t.geometryType){case"esriGeometryEnvelope":return new y(t);case"esriGeometryMultipoint":return new h(t);case"esriGeometryPoint":return new d(t);case"esriGeometryPolygon":return new p(t);case"esriGeometryPolyline":return new f(t);default:throw new TypeError("invalid feature set")}}Object.defineProperty(e,"__esModule",{value:!0}),e.createFeatureSetReader=s;var a=function(){function t(t){this._boundsByOID=new Map,this._hydratedGeometryByOID=new Map,this._centroidByOID=new Map,this._features=t.features,this._hasM=t.hasM,this._hasZ=t.hasZ,this._objectIdFieldName=t.objectIdFieldName,this._transform=t.transform,this._transform&&(this._hydrateX=u.getHydrateX(this._transform),this._hydrateY=u.getHydrateY(this._transform))}return t.prototype.add=function(t){if(!u.equals(t.transform,this._transform))throw new Error("transform not equivalent");(a=this._features).push.apply(a,t.features);var e=this._featureByOID;if(e)for(var r=t.features,n=this._objectIdFieldName,o=0,i=r;o<i.length;o++){var s=i[o];e.set(s.attributes[n],s)}var a},t.prototype.oids=function(){var t,e,r;return n(this,function(n){switch(n.label){case 0:t=0,e=this._features,n.label=1;case 1:return t<e.length?(r=e[t],[4,r.attributes[this._objectIdFieldName]]):[3,4];case 2:n.sent(),n.label=3;case 3:return t++,[3,1];case 4:return[2]}})},t.prototype.getAttributes=function(t){return this._getFeatureByOID(t).attributes},t.prototype.getBounds=function(t){if(this._boundsByOID.has(t))return this._boundsByOID.get(t);var e;return e=this._transform?u.hydrateBounds(this._getBounds(this._getRawGeometry(t)),this._hydrateX,this._hydrateY):this._getHydratedBounds(this.getGeometry(t)),this._boundsByOID.set(t,e),e},t.prototype.getCentroid=function(t){var e=this._centroidByOID;if(e.has(t))return e.get(t);var r=this.getGeometry(t),n=this._getCentroid(r);return e.set(t,n),n},t.prototype.getCentroidQuantized=function(t,e,r,n){var o=this.getCentroid(t);return o?u.hydratePoint({},o,r,n,this._hasZ,this._hasM):null},t.prototype.getGeometry=function(t){if(!this._transform)return this._getRawGeometry(t);var e=this._hydratedGeometryByOID;if(e.has(t))return e.get(t);var r=this._hydrateGeometry(this._getRawGeometry(t),this._hydrateX,this._hydrateY,this._hasZ,this._hasM);return e.set(t,r),r},t.prototype.getProjectedGeometry=function(t,e){this.getGeometry(e)},t.prototype.getGeometryQuantized=function(t,e,r,n){return u.equals(e,this._transform)?this._getRawGeometry(t):this._quantizeGeometry(this.getGeometry(t),r,n,this._hasZ,this._hasM)},t.prototype._getRawGeometry=function(t){return this._getFeatureByOID(t).geometry},t.prototype._getFeatureByOID=function(t){if(this._featureByOID)return this._featureByOID.get(t);for(var e=this._featureByOID=new Map,r=this._features,n=this._objectIdFieldName,o=0,i=r;o<i.length;o++){var u=i[o];e.set(u.attributes[n],u)}return e.get(t)},t}();e.FeatureSetReader=a;var y=function(t){function e(e){return t.call(this,e)||this}return r(e,t),e.prototype._getBounds=function(t){return[t.xmin,t.ymin,t.xmax,t.ymax]},e.prototype._getCentroid=function(t){var e=i.extentCentroid(t);return{x:e[0],y:e[1]}},e.prototype._getHydratedBounds=function(t){return[t.xmin,t.ymin,t.xmax,t.ymax]},e.prototype._hydrateGeometry=function(t,e,r,n,o){return u.hydrateExtent({},t,e,r,n,o)},e.prototype._quantizeGeometry=function(t,e,r,n,o){return u.quantizeExtent({},t,e,r,n,o)},e}(a);e.ExtentFeatureSetReader=y;var h=function(t){function e(e){return t.call(this,e)||this}return r(e,t),e.prototype._getBounds=function(t){return u.getQuantizedBoundsPoints(t.points)},e.prototype._getCentroid=function(t){var e=this._getHydratedBounds(t);return{x:e[0]-e[2],y:e[3]-e[1]}},e.prototype._getHydratedBounds=function(t){return o.getPointsBounds(t.points)},e.prototype._hydrateGeometry=function(t,e,r,n,o){return u.hydrateMultipoint({},t,e,r,n,o)},e.prototype._quantizeGeometry=function(t,e,r,n,o){return u.quantizeMultipoint({},t,e,r,n,o)},e}(a);e.MultipointFeatureSetReader=h;var d=function(t){function e(e){return t.call(this,e)||this}return r(e,t),e.prototype._getBounds=function(t){return[t.x,t.y,t.x,t.y]},e.prototype._getCentroid=function(t){return t},e.prototype._getHydratedBounds=function(t){return[t.x,t.y,t.x,t.y]},e.prototype._hydrateGeometry=function(t,e,r,n,o){return u.hydratePoint({},t,e,r,n,o)},e.prototype._quantizeGeometry=function(t,e,r,n,o){return u.hydratePoint({},t,e,r,n,o)},e}(a);e.PointFeatureSetReader=d;var p=function(t){function e(e){return t.call(this,e)||this}return r(e,t),e.prototype._getBounds=function(t){return u.getQuantizedBoundsRings(t.rings)},e.prototype._getCentroid=function(t){var e=i.polygonCentroid(t);return{x:e[0],y:e[1]}},e.prototype._getHydratedBounds=function(t){return o.getRingsOrPathsBounds(t.rings)},e.prototype._hydrateGeometry=function(t,e,r,n,o){return u.hydratePolygon({},t,e,r,n,o)},e.prototype._quantizeGeometry=function(t,e,r,n,o){return u.quantizePolygon({},t,e,r,n,o)},e}(a);e.PolygonFeatureSetReader=p;var f=function(t){function e(e){return t.call(this,e)||this}return r(e,t),e.prototype._getBounds=function(t){return u.getQuantizedBoundsPaths(t.paths)},e.prototype._getCentroid=function(t){var e=this._getHydratedBounds(t);return{x:e[0]-e[2],y:e[3]-e[1]}},e.prototype._getHydratedBounds=function(t){return o.getRingsOrPathsBounds(t.paths)},e.prototype._hydrateGeometry=function(t,e,r,n,o){return u.hydratePolyline({},t,e,r,n,o)},e.prototype._quantizeGeometry=function(t,e,r,n,o){return u.quantizePolyline({},t,e,r,n,o)},e}(a);e.PolylineFeatureSetReader=f});