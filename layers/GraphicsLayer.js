// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.21/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/dom-attr","dojo/dom-construct","dojo/dom-style","dojo/dom","dojox/gfx","dojox/gfx/matrix","./gfxSniff!esri-svg?dojox/gfx/filters","./layer","../kernel","../lang","../sniff","../Color","../domUtils","../symbols/MarkerSymbol","../symbols/SimpleMarkerSymbol","../geometry/Point","../geometry/ScreenPoint","../geometry/Extent","../geometry/mathUtils","../geometry/screenUtils","../PluginTarget","./gfxSniff!esri-svg?dojox/gfx/svgext"],function(e,t,i,n,r,s,a,o,h,l,c,_,u,d,p,f,g,m,v,y,S,x,b,M,w,E){var P,k=-1!==l.renderer.toLowerCase().indexOf("svg"),C=-1!==l.renderer.toLowerCase().indexOf("canvas"),I=f("ie")<9,G=9===f("ie"),L=10===f("ie"),T=void 0===f("ie")&&7==f("trident"),R=L||T,H="http://www.w3.org/2000/svg",O=f("esri-touch"),A=e(null,{declaredClass:"esri.layers._GraphicsContainer",_setMap:function(e,i){var n,r=this._connects=[];if(this._map=e,this._useWillChange="css-transforms"===e.navigationMode&&k&&f("esri-will-change"),C)n=a.create("div",{style:"overflow: visible; position: absolute;"},i),this._surface={getEventSource:function(){return n}},r.push(t.connect(n,"onmousedown",this,this._canvasDownHandler)),r.push(t.connect(n,"onmouseup",this,this._canvasUpHandler)),r.push(t.connect(n,"onclick",this,this._canvasClickHandler)),P.prototype._canvas=!0;else{var s=this._surface=l.createSurface(i,e.width,e.height);n=s.getEventSource(),this._useWillChange&&o.set(n,"will-change","transform"),o.set(n=I?n.parentNode:n,{overflow:"visible",position:"absolute"})}return r.push(t.connect(e,"onResize",this,"_onResizeHandler")),this._useWillChange&&(r.push(t.connect(e,"onPan",this,"_onPanHandler")),r.push(t.connect(e,"onPanEnd",this,"_onPanEndHandler")),r.push(t.connect(e,"onExtentChange",this,"_onExtentChangeHandler"))),n},_onPanHandler:function(e,t){var i=this._map.__visibleRect,n=i.x+t.x,r=i.y+t.y;this._panDx=n,this._panDy=r,o.set(this._surface.getEventSource(),d._css.names.transform,d._css.translate(n,r))},_onPanEndHandler:function(e,t){var i=this._map.__visibleRect,n=i.x,r=i.y;this._panDx=n,this._panDy=r,o.set(this._surface.getEventSource(),d._css.names.transform,d._css.translate(n,r))},_onExtentChangeHandler:function(e,t,i,n){if(i){var r=0,s=0;this._panDx=r,this._panDy=s,o.set(this._surface.getEventSource(),d._css.names.transform,d._css.translate(r,s))}},_getTransform:function(){return{dx:this._panDx||0,dy:this._panDy||0}},_onResizeHandler:function(e,t,i){var r,a=this._surface.getEventSource(),h=this._map;I&&o.set(a=a.parentNode,{width:t+"px",height:i+"px",clip:"rect(0px "+t+"px "+i+"px 0px)"}),s.set(a,"width",t),s.set(a,"height",i),this._surface.declaredClass||n.forEach(a.childNodes,function(e){s.set(e,"width",t),s.set(e,"height",i)}),h.loaded&&(h.graphics.suspended||(h.graphics._resized=!0),n.forEach(h.graphicsLayerIds,function(e){r=h.getLayer(e),r.suspended||(r._resized=!0,r._childLayer&&(r._childLayer._resized=!0)),r._updateSVGFilters(null,null,t,i)}),h.graphics._updateSVGFilters(null,null,t,i),h._labels&&h._labels._updateSVGFilters(null,null,t,i))},_cleanUp:function(){n.forEach(this._connects,t.disconnect,t),this._map=this._surface=null},_processEvent:function(e){var t=this._map;e.screenPoint=new x(e.pageX-t.position.x,e.pageY-t.position.y),e.mapPoint=t.toMap(e.screenPoint)},_canvasDownHandler:function(e){this._processEvent(e),this._downPt=e.screenPoint.x+","+e.screenPoint.y},_canvasUpHandler:function(e){this._processEvent(e),this._upPt=e.screenPoint.x+","+e.screenPoint.y},_tolerance:15,_isPrimaryMatch:function(e,t,i,r){if(!e.visible||!t)return!1;var s,a=t.getTransformedBoundingBox();return a?(s=new b(a[0].x,a[0].y,a[2].x,a[2].y),delete s.spatialReference,O?s.intersects(i):s.contains(r)):n.some(t.children||[],function(e){return a=e.getTransformedBoundingBox(),s=new b(a[0].x,a[0].y,a[2].x,a[2].y),delete s.spatialReference,O?s.intersects(i):s.contains(r)})},_canvasClickHandler:function(e){if(this._downPt&&this._upPt&&this._downPt===this._upPt){this._processEvent(e);var t=this._map,i=n.map(t.graphicsLayerIds,function(e){return t.getLayer(e)});i.push(t.graphics),i.reverse(),i=n.filter(i,function(e){return e.loaded&&e._mouseEvents&&!e.suspended&&(!p.isDefined(e.opacity)||e.opacity>0)});var r,s=e.screenPoint,a=this._tolerance,o=s.x-a,h=s.y+a,l=s.x+a,c=s.y-a,_=new b(o,c,l,h),u=t.toMap(new x(o,h)),d=t.toMap(new x(l,c)),f=u.spatialReference._getInfo(),g=new b(b.prototype._normalizeX(u.x,f).x,u.y,b.prototype._normalizeX(d.x,f).x,d.y,u.spatialReference);if(delete _.spatialReference,n.some(i,function(e){var t=n.filter(e.graphics,function(e){return this._isPrimaryMatch(e,e.getDojoShape(),_,s)||!(!e._bgShape||!this._isPrimaryMatch(e,e._bgShape,_,s))},this);if(t.reverse(),t.length>0){var i;if(n.some(t,function(e){return e.geometry&&g.intersects(e.geometry)?(i=e,!0):!1}),i)return r=i,!0}return!1},this),r){var m=r.getLayer();m&&(e.graphic=r,m.onClick(e))}}}});P=e(u,{declaredClass:"esri.layers._GraphicsLayer",managedSuspension:!0,surfaceType:C?"canvas-2d":l.renderer,_eventMap:{"graphic-add":["graphic"],"graphic-remove":["graphic"],"renderer-change":["renderer"]},constructor:function(e){e&&(i.isString(e)||i.isObject(e)&&(e.layerDefinition||e.query))&&(e=arguments[1]),this._params=i.mixin({displayOnPan:!0,drawMode:!0,styling:!0},e||{});var t=this._params.dataAttributes;"string"==typeof t&&(t=[t]),this.styling=k?this._params.styling:!0,this.dataAttributes=t,this.infoTemplate=e&&e.infoTemplate,this.graphics=[],this._draw=i.hitch(this,this._draw),this._refresh=i.hitch(this,this._refresh),this.registerConnectEvents()},getNode:function(){return this._div&&this._div.getEventSource()},setDrawMode:function(e){this._params.drawMode=e},renderer:null,_setMap:function(e,t){return this.inherited(arguments),this._map=e,this._wrap=e.wrapAround180,this._srInfo=e.spatialReference._getInfo(),this._svgFilters={},this._lineMarkers={},this._canvas?(t=l.createSurface(t.getEventSource(),e.width,e.height),o.set(t.rawNode,"position","absolute"),this._div=t.createGroup(),this._renderProto=this._div.constructor.prototype._render,this._div._render=i.hitch(this,this._canvasRender)):this._div=t.createGroup(),this._bgGroup=this._div.createGroup(),this._div.getEventSource().id=this.id+"_layer",this._initOpacity(),this._div},_unsetMap:function(e,t){n.forEach(this.graphics,function(e){e._shape=null}),this._canvas?(t=this._div.getParent(),t._parent={},a.destroy(t.rawNode),t.destroy()):(this._div.clear(),t.remove(this._div),a.destroy(this._div.getEventSource())),this._map=this._div=this._svgFilters=this._lineMarkers=null,clearTimeout(this._wakeTimer),this._wakeTimer=null,this._disableDrawConnectors(),this.inherited(arguments)},_initOpacity:function(){var e=this.opacity;p.isDefined(e)&&1>e&&this.setOpacity(e,!0)},_onZoomStartHandler:function(){m.hide(this._div.getEventSource())},_onExtentChangeHandler:function(e,t,i,n){if(clearTimeout(this._wakeTimer),this._wakeTimer=null,i){var r=this._map.__visibleRect,s=this._div;this._evalSDRenderer(),this._refresh(!0),this._updateTransform(s,r.x,r.y,!0),this._renderProto&&s.surface.pendingRender?this._dirty=!0:this.suspended||m.show(s.getEventSource())}else this._resized&&(this._resized=!1,this._refresh(!1));this.graphics.length>0&&this.onUpdate()},_canvasRender:function(){var e=this._div;return this._dirty&&(delete this._dirty,this.suspended||m.show(e.getEventSource())),this._renderProto.apply(e,arguments)},_refresh:function(e){var t,i=this.graphics,n=i.length,r=this._draw;for(t=0;n>t;t++)r(i[t],e)},refresh:function(){this._refresh(!0)},redraw:function(){this._refresh(!0)},_getTransform:function(){var e={dx:0,dy:0};return this._map&&(this._map._gc._useWillChange?e=this._map._gc._getTransform():this._div&&(e=this._div.getTransform())),e},_onPanHandler:function(e,t){this._panDx=t.x,this._panDy=t.y;var i=this._map.__visibleRect;this._updateTransform(this._div,i.x+t.x,i.y+t.y),T&&this._updateSVGMarkers()},_onPanEndUpdateHandler:function(e,t){var i=this._map.__visibleRect;this._params._child||t.x===this._panDx&&t.y===this._panDy?(this._updateSVGFilters(-i.x,-i.y),this._updateSVGMarkers()):this._updateTransform(this._div,i.x,i.y,!0),this._refresh(!1),this.graphics.length&&this.onUpdate()},_onPanStartHandler:function(){m.hide(this._div.getEventSource())},_onPanEndHandler:function(){var e=this._map.__visibleRect,t=this._div;this._updateTransform(t,e.x,e.y,!0),this._refresh(!1),this._renderProto&&t.surface.pendingRender?this._dirty=!0:m.show(t.getEventSource()),this.graphics.length&&this.onUpdate()},_updateTransform:function(e,t,i,n){this._map._gc._useWillChange||e.setTransform(c.translate({x:t,y:i})),n&&(this._updateSVGFilters(-t,-i),this._updateSVGMarkers())},onSuspend:function(){this.inherited(arguments),m.hide(this._div.getEventSource()),clearTimeout(this._wakeTimer),this._wakeTimer=null,this._disableDrawConnectors()},onResume:function(e){this.inherited(arguments),e.firstOccurrence&&this._evalSDRenderer(),this._enableDrawConnectors(),this._wakeTimer=this._wakeTimer||setTimeout(i.hitch(this,function(){this.suspended||this._map.__zooming||this._onExtentChangeHandler(null,null,!0)}),0)},_enableDrawConnectors:function(){var e=this._map,i=t.connect;this._disableDrawConnectors(),this._params.displayOnPan?(this._params._child||(this._onPanHandler_connect=i(e,"onPan",this,"_onPanHandler")),this._onPanEndHandler_connect=i(e,"onPanEnd",this,"_onPanEndUpdateHandler")):(this._onPanStartHandler_connect=i(e,"onPanStart",this,"_onPanStartHandler"),this._onPanEndHandler_connect=i(e,"onPanEnd",this,"_onPanEndHandler")),this._onZoomStartHandler_connect=i(e,"onZoomStart",this,"_onZoomStartHandler"),this._onExtentChangeHandler_connect=i(e,"onExtentChange",this,"_onExtentChangeHandler")},_disableDrawConnectors:function(){var e=t.disconnect;e(this._onExtentChangeHandler_connect),e(this._onZoomStartHandler_connect),e(this._onPanHandler_connect),e(this._onPanStartHandler_connect),e(this._onPanEndHandler_connect),this._onExtentChangeHandler_connect=this._onZoomStartHandler_connect=this._onPanHandler_connect=this._onPanStartHandler_connect=this._onPanEndHandler_connect=null},_updateExtent:function(e){var t=e.geometry;if(!t)return void(e._extent=null);var i=e._extent=t.getExtent();if(!i){var n,r;if("esri.geometry.Point"===t.declaredClass)n=t.x,r=t.y;else{if("esri.geometry.Multipoint"!==t.declaredClass)return void(e._extent=null);n=t.points[0][0],r=t.points[0][1]}e._extent=new b(n,r,n,r,t.spatialReference)}},_intersects:function(e,t,i){var r=e.spatialReference,s=t.spatialReference,a=r&&s&&!r.equals(s)&&r._canProject(s)&&4326===s.wkid;if(this._wrap&&!i){var o,h,l,c,_,u,d,p,f,g,m=[],v=e._getFrameWidth(),y=this._srInfo,S=e._clip?e._getAvailExtent():e.extent,x=[],b=t._partwise;if(a&&(S=e.geographicExtent,y=s._getInfo()),h=S._getParts(y),b&&b.length)for(o=[],l=0,u=b.length;u>l;l++)o=o.concat(b[l]._getParts(y));else o=t._getParts(y);for(l=0,u=o.length;u>l;l++)for(f=o[l],c=0,d=h.length;d>c;c++)if(g=h[c],g.extent.intersects(f.extent))for(_=0,p=f.frameIds.length;p>_;_++)m.push((g.frameIds[0]-f.frameIds[_])*v);for(l=0,u=m.length;u>l;l++)_=m[l],n.indexOf(m,_)===l&&x.push(_);return x.length?x:null}return(a?e.geographicExtent:e.extent).intersects(t)?[0]:null},_defaultMarker:{type:"simplemarkersymbol",style:"square",size:1,xoffset:0,yoffset:0,angle:0},_draw:function(e,t){if(this._params.drawMode&&this._map&&!this.suspended&&!this._map.__zooming&&!this._resized)try{var i,n,r,s=e._extent,a=!k||this.styling,o=k&&this.dataAttributes,h=e.getDojoShape();if(e.visible&&s&&(i=this._intersects(this._map,s,e.geometry._originOnly))&&(n=a?this._getSymbol(e):this._defaultMarker)){if(e._offsets&&e._offsets.join(",")===i.join(",")?r=!0:e._offsets=i,!h||t||!r){var l=e.geometry.type,c={graphic:e},_=e._bgShape,u=a&&!e.symbol?this._getRenderer(e):null,d=u&&u.backgroundFillSymbol;if("point"===l)this._isInvalidShape(n,h)&&this._removeShape(e),e._shape=this._drawPoint(this._div,e.geometry,n,e.getDojoShape(),i,u,e),a&&this._symbolizePoint(e.getDojoShape(),n,u,e);else if("multipoint"===l)this._drawMarkers(e,n,i,u),a&&this._symbolizeMarkers(e,n,u);else{var p,f,g,m,v=n;if(a&&(p="simplemarkersymbol"===n.type||"picturemarkersymbol"===n.type||"textsymbol"===n.type?n:null,v=p?d:n),a&&v&&v.type.indexOf("fillsymbol")>-1&&(f=this._bgGroup,m=!(!f||!p)),_&&!m&&this._removeBgShape(e),v&&(!m&&this._isInvalidShape(v,e._shape)&&this._removeShape(e,!1),g=this._drawShape(e,i,f||this._div,m?_:e.getDojoShape()),a&&this._symbolizeShape(g,v,u,v===d,e),e[m?"_bgShape":"_shape"]=g),p){this._isInvalidShape(p,e._shape)&&this._removeShape(e,!1);var y=e.geometry.getCentroid();g=y&&this._drawPoint(this._div,y,p,e._shape,i,u,e),g&&this._symbolizePoint(g,p,u,e),e._shape=g}}C||(e._bgShape&&this._initNode(e,e._bgShape,e._bgShape!==_,c,o),e._shape&&this._initNode(e,e._shape,e._shape!==h,c,o)),c.node=e.getNode(),this.onGraphicDraw(c)}}else h&&this._removeShape(e)}catch(S){this._errorHandler(S,e)}},_initNode:function(e,t,i,n,r){var s=t&&t.getNode();s&&(s.e_graphic=e,this._addDataAttrs(e,r,s),i&&(n.node=s,this.onGraphicNodeAdd(n)))},_removeShape:function(e,t,i){var n=e.getDojoShape(),r=n&&n.getNode();n&&!i&&(n.removeShape(),n.destroy()),e._shape=e._offsets=null,t!==!1&&this._removeBgShape(e,i),r&&(r.e_graphic=null,C||this.onGraphicNodeRemove({graphic:e,node:r}))},_removeBgShape:function(e,t){var i=e._bgShape,n=i&&i.getNode();i&&!t&&(i.removeShape(),i.destroy()),e._bgShape=null,n&&(n.e_graphic=null,C||this.onGraphicNodeRemove({graphic:e,node:n}))},_addDataAttrs:function(e,t,i){var n,r,s,a=e.attributes,o=t?t.length:0,h=this._getRenderer(e);if(i&&a){for(r=0;o>r;r++)n=t[r],n&&e.attr("data-"+n,a[n]);!this.styling&&h&&(h.getBreakIndex?(s=h.getBreakIndex(e),e.attr("data-class-break",-1!==s?s:null)):h.getUniqueValueInfo&&(s=h.getUniqueValueInfo(e),e.attr("data-unique-value",s?s.value:null)))}},_drawShape:function(e,t,i,n){var r,s,a,o,h,l,c=e.geometry,_=c.type,u=this._map,d=u.extent,p=u.width,f=u.height,g=u.__visibleRect,m=[],v="extent"===_;if("rect"===_||v)o={x:0,y:0,spatialReference:c.spatialReference},o.x=v?c.xmin:c.x,o.y=v?c.ymax:c.y,h=w.toScreenPoint(d,p,f,o),o.x=v?c.xmax:c.x+c.width,o.y=v?c.ymin:c.y+c.height,l=w.toScreenPoint(d,p,f,o),a={x:h.x-g.x+t[0],y:h.y-g.y,width:Math.abs(l.x-h.x),height:Math.abs(l.y-h.y)},0===a.width&&(a.width=1),0===a.height&&(a.height=1),n=this._drawRect(i,n,a);else if("polyline"===_||"polygon"===_){for(r=0,s=t.length;s>r;r++)m=m.concat(w._toScreenPath(d,p,f,c,-g.x+t[r],-g.y));n=this._drawPath(i,n,m),this._rendererLimits&&("polyline"===_?this._clipPolyline(n,c):this._clipPolygon(n,c))}return n},_drawRect:function(e,t,i){return t?t.setShape(i):e.createRect(i)},_drawImage:function(e,t,i){return t?t.setShape(i):e.createImage(i)},_drawCircle:function(e,t,i){return t?t.setShape(i):e.createCircle(i)},_drawPath:function(){return I?function(e,t,i,n){if(i=n?i:i.join(" "),t)return t.setShape(i);var r=e.createObject(n?l.Path:l.EsriPath,i);return e._overrideSize(r.getEventSource()),r}:function(e,t,i,n){return i=n?i:i.join(" "),t?t.setShape(i):e.createPath(i)}}(),_drawText:function(e,t,i){return t?t.setShape(i):e.createText(i)},_evalSDRenderer:function(e){var t,i=this._map,n=this.renderer,r=this._rndForScale;i&&i.loaded&&n&&n.getRendererInfo&&(t="zoom"===n.rangeType?n.getRendererInfoByZoom(i.getZoom()):n.getRendererInfoByScale(i.getScale())),this._rndForScale=t&&t.renderer;var s=this._getRenderer();s&&s.prepareForViewChange(),e||this._rndForScale==r||this.emit("renderer-change",{renderer:this._rndForScale})},_getRenderer:function(e){var t=this._rndForScale||this.renderer;return e&&t&&t.getObservationRenderer&&(t=t.getObservationRenderer(e)),t},_getSymbol:function(e){var t=this._getRenderer();return e.symbol||t&&t.getSymbol(e)},_getVariable:function(e,t,i){var n,r;return e&&(n=e.getVisualVariablesForType(t,i),r=n&&n[0]),r},_applyOpacity:function(e,t,i,n){var r=t.getOpacity(n,{opacityInfo:i});return null!=r&&(e=new g(e),e.a=r),e},_symbolizeShape:function(e,t,n,r,s){var a,o,h=t.getStroke(),l=t.getFill(),c=t.type,_=-1!==c.indexOf("linesymbol"),u=-1!==c.indexOf("fillsymbol"),d=u?null:this._getVariable(n,"sizeInfo",!1),p=this._getVariable(n,"colorInfo",!1),f=this._getVariable(n,"opacityInfo",!1),g=_?"none"!==t.style:t.outline&&"none"!==t.outline.style,m=_?null:this._getVariable(n,"sizeInfo","outline"),v=r?m:m||d,y=v?n.getSize(s,{sizeInfo:v,resolution:this._map.getResolutionInMeters(),scale:this._map.getScale()}):null;r&&(p=f=null),(p||f)&&"picturefillsymbol"!==c&&(_?(a=h&&h.color,p&&(a=n.getColor(s,{colorInfo:p})||a),a&&f&&(a=this._applyOpacity(a,n,f,s))):l&&l.toCss&&(o=l,p&&(o=n.getColor(s,{colorInfo:p})||o),o&&f&&(o=this._applyOpacity(o,n,f,s)))),e.setStroke(!g||null==y&&!a?h:i.mixin({},h,null!=y?{width:y}:null,a&&{color:a})).setFill(o||l),_&&this._applyLineMarker(e,t)},_smsToPath:function(){return I?function(e,t,i,n,r,s,a,o,h){switch(t){case e.STYLE_SQUARE:return["M",r+","+a,"L",s+","+a,s+","+o,r+","+o,"X","E"];case e.STYLE_CROSS:return["M",i+","+a,"L",i+","+o,"M",r+","+n,"L",s+","+n,"E"];case e.STYLE_X:return["M",r+","+a,"L",s+","+o,"M",r+","+o,"L",s+","+a,"E"];case e.STYLE_DIAMOND:return["M",i+","+a,"L",s+","+n,i+","+o,r+","+n,"X","E"];case e.STYLE_TARGET:return["M",r+","+a,"L",s+","+a,s+","+o,r+","+o,r+","+a,"M",r-h+","+n,"L",r+","+n,"M",i+","+(a-h),"L",i+","+a,"M",s+h+","+n,"L",s+","+n,"M",i+","+(o+h),"L",i+","+o,"E"]}}:function(e,t,i,n,r,s,a,o,h){switch(t){case e.STYLE_SQUARE:return["M",r+","+a,s+","+a,s+","+o,r+","+o,"Z"];case e.STYLE_CROSS:return["M",i+","+a,i+","+o,"M",r+","+n,s+","+n];case e.STYLE_X:return["M",r+","+a,s+","+o,"M",r+","+o,s+","+a];case e.STYLE_DIAMOND:return["M",i+","+a,s+","+n,i+","+o,r+","+n,"Z"];case e.STYLE_TARGET:return["M",r+","+a,s+","+a,s+","+o,r+","+o,r+","+a,"M",r-h+","+n,r+","+n,"M",i+","+(a-h),i+","+a,"M",s+h+","+n,s+","+n,"M",i+","+(o+h),i+","+o]}}}(),_pathStyles:{square:1,cross:1,x:1,diamond:1,target:1},_typeMaps:{picturemarkersymbol:"image",picturefillsymbol:"path",simplefillsymbol:"path",simplelinesymbol:"path",cartographiclinesymbol:"path",textsymbol:"text"},_isInvalidShape:function(e,t){var i=t&&t.shape&&t.shape.type,n=e&&e.type,r=e&&e.style;return"rect"===i&&(i="path"),n&&(r=this._typeMaps[n]||r),this._pathStyles[r]&&(r="path"),"shieldlabelsymbol"===n?!0:!(!i||!r||i===r)},_reArialFont:/\s*(^|,)\s*arial\s*(,|$)\s*/i,_fallbackFont:"Arial",_drawPoint:function(e,t,i,n,r,s,a){var o,h,l,_,u=i.type,d=this._map,p=d.__visibleRect,f=w.toScreenPoint(d.extent,d.width,d.height,t).offset(-p.x+r[0],-p.y),g=f.x,m=f.y,v=[],S=this._getVariable(s,"rotationInfo",!1),x=S?s.getRotationAngle(a,{rotationInfo:S}):null,b=this._getVariable(s,"sizeInfo",!1),M=b?s.getSize(a,{sizeInfo:b,shape:i.style,resolution:d.getResolutionInMeters(),scale:d.getScale()}):null;if(x&&v.push(c.rotategAt(x,f)),(0!==i.xoffset||0!==i.yoffset)&&(_=c.translate(i.xoffset,-i.yoffset),v.push(_)),0!==i.angle&&v.push(c.rotategAt(i.angle,f)),"simplemarkersymbol"===u){var E,P=i.style,C=Math.round;switch(M=null!=M?M:i.size,P){case y.STYLE_SQUARE:case y.STYLE_CROSS:case y.STYLE_X:case y.STYLE_DIAMOND:E=isNaN(M)?16:M/2,o=this._drawPath(e,n,this._smsToPath(y,P,g,m,C(g-E),C(g+E),C(m-E),C(m+E)));break;case y.STYLE_TARGET:var I=i._targetWidth/2,G=i._targetHeight/2;o=this._drawPath(e,n,this._smsToPath(y,P,g,m,C(g-I),C(g+I),C(m-G),C(m+G),i._spikeSize));break;case y.STYLE_PATH:o=this._drawPath(e,n,i.path,!0);var L=o.getBoundingBox(),T=this._getScaleMatrix(L,M);(1!==T.xx||1!==T.yy)&&v.push(c.scaleAt(T.xx,T.yy,f)),v.push(c.translate(-(L.x+L.width/2)+g,-(L.y+L.height/2)+m));break;default:E=isNaN(M)?16:M/2,o=this._drawCircle(e,n,{cx:g,cy:m,r:E})}}else if("shieldlabelsymbol"===u){h=i.width,l=i.height;var R=e.createGroup(),H=e.createImage({x:g-h/2,y:m-l/2,width:h,height:l,src:i.url});if(R.add(H),null!=i.font){var O=g,A=m+.2*i.getHeight(),D=e.createText({type:"text",text:i.text,x:O,y:A,align:"middle",decoration:i.decoration,rotated:i.rotated,kerning:i.kerning});D.setFont(i.font),D.setFill(i.color),R.add(D)}o=R}else if("picturemarkersymbol"===u){if(null==M?(h=i.width,l=i.height):(l=M,h=l*(i.width/i.height),_&&(null!=_.dx&&(_.dx=h*(_.dx/i.width)),null!=_.dy&&(_.dy=l*(_.dy/i.height)))),o=this._drawImage(e,n,{x:g-h/2,y:m-l/2,width:h,height:l,src:i.url}),k){var F=o.getNode();if(F){var N=this._getVariable(s,"opacityInfo",!1),V=N?s.getOpacity(a,{opacityInfo:N}):null;null!=V?F.setAttribute("opacity",V):F.setAttribute("opacity",1)}}}else if("textsymbol"===u){var j=i.font;if(j){var z=null!=M,B=j.family&&!this._reArialFont.test(j.family);(z||B)&&(j=new j.constructor(j.toJson())),z&&j.setSize(M),B&&j.setFamily(j.family+","+this._fallbackFont)}if(o=this._drawText(e,n,{type:"text",text:i.text,x:g,y:m,align:i.getSVGAlign(),decoration:i.decoration||j&&j.decoration,rotated:i.rotated,kerning:i.kerning}),j&&o.setFont(j),k){var F=o.getNode(),U=i.getSVGBaseline(),Y=i.getSVGBaselineShift();F&&(F.setAttribute("dominant-baseline",U),Y&&F.setAttribute("baseline-shift",Y),this._applyHalo(o,i.haloColor,i.haloSize))}}return o.setTransform(c.multiply(v)),o._wrapOffsets=r,o},_applyLineMarker:function(e,t){if(k&&!G){var i=e&&e.rawNode,n=t.color,r=t.marker;if(!(i&&n&&r&&"arrow"===r.style&&r.placement))return void(i&&this._removeSVGMarkers(i));if(i.getTotalLength&&0===i.getTotalLength())return void this._removeSVGMarkers(i);var s=-1!==r.placement.indexOf("begin"),a=-1!==r.placement.indexOf("end"),o="spear";if(!s&&!a)return void this._removeSVGMarkers(i);i.removeAttribute("stroke-opacity"),i.setAttribute("opacity",n.a),s?this._applySVGMarker(i,n,o,"start"):i.removeAttribute("marker-start"),a?this._applySVGMarker(i,n,o,"end"):i.removeAttribute("marker-end")}},_lineMarkerInfo:{marker:{markerWidth:"6",markerHeight:"6",markerUnits:"strokeWidth",orient:"auto"},spear:{marker:{end:{viewBox:"0 0 25.4 23.43",refX:"20",refY:"12.76"},start:{viewBox:"-25.4 0 25.4 23.43",refX:"-20",refY:"12.76"}},path:{common:{d:"M1.63 23.43 L5.37 16.6 L5.37 8.93 L1.63 2.09 L25.4 12.76 L1.63 23.43 Z","stroke-width":"0","fill-opacity":"1"},start:{transform:"matrix(-1, 0, 0, 1, 0, 0)"}}}},_applySVGMarker:function(e,t,i,n){var r=this._getSVGMarkerId(t,n),s=!!this._getSVGMarker(r);s||this._createSVGMarker(t,r,i,n);var a="url(#"+r+")";e.setAttribute("marker-"+n,a)},_removeSVGMarkers:function(e){e.removeAttribute("marker-start"),e.removeAttribute("marker-end"),e.removeAttribute("opacity")},_getSVGMarkerId:function(e,t){return"marker_"+this._map.id+"_"+e.r+"_"+e.g+"_"+e.b+"_"+t},_getSVGMarker:function(e){return this._lineMarkers[e]},_createSVGMarker:function(e,t,i,n){var s=this._lineMarkerInfo,a=s[i],o=r.doc.createElementNS(H,"marker");o.setAttribute("id",t),this._setAttributes(o,s.marker),this._setAttributes(o,a.marker[n]);var h=r.doc.createElementNS(H,"path");return h.setAttribute("fill",e.toCss()),this._setAttributes(h,a.path.common),this._setAttributes(h,a.path[n]),o.appendChild(h),this._div.getParent().defNode.appendChild(o),this._lineMarkers[t]=o,o},_setAttributes:function(e,t){for(var i in t)e.setAttribute(i,t[i])},_updateSVGMarkers:function(){if(k&&R){var e=this._lineMarkers;for(var t in e){var i=e[t];i.setAttribute("id",t+"_temp"),i.setAttribute("id",t)}}},_applyHalo:function(e,t,i){var n=t&&i?this._getHaloId(t,i):null;e.setFilter(t&&i?f("webkit")||f("ff")?this._getDilateFilter(t,i,n):this._getOffsetFilter(t,i,n):null)},_getDilateFilter:function(e,t,i){var n=this._getSVGFilter(i);return n||(n=this._createSVGFilter({id:i},[_.feMorphology({operator:"dilate",radius:t,result:"dilated"}),_.feFlood({"flood-color":e.toCss(!0)}),_.feComposite({in2:"dilated",operator:"in",result:"composite"}),_.feMerge("composite","SourceGraphic")])),n},_getOffsetFilter:function(e,t,i){var n=this._getSVGFilter(i);if(!n){var r,s=e.toCss(!0),a=this._offsetPrimitives,o=a.length,h=[],l=[];for(r=0;o>r;r++){var c=a[r],u="offset"+c.dir,d="composite"+c.dir;l.push(d),h.push(_.feOffset({dx:c.dx*t,dy:c.dy*t,"in":"SourceAlpha",result:u}),_.feFlood({"flood-color":s}),_.feComposite({in2:u,operator:"in",result:d}))}l.push("SourceGraphic"),h.push(_.feMerge.apply(_.feMerge,l)),n=this._createSVGFilter({id:i},h)}return n},_offsetPrimitives:[{dir:"L",dx:-1,dy:0},{dir:"TL",dx:-1,dy:-1},{dir:"T",dx:0,dy:-1},{dir:"TR",dx:1,dy:-1},{dir:"R",dx:1,dy:0},{dir:"BR",dx:1,dy:1},{dir:"B",dx:0,dy:1},{dir:"BL",dx:-1,dy:1}],_getHaloId:function(e,t){return"halo_"+this._map.id+"_"+this.id+"_"+e.r+"_"+e.g+"_"+e.b+"_"+e.a+"_"+t},_getSVGFilter:function(e){return this._svgFilters[e]},_createSVGFilter:function(e,t){var i=_.createFilter(e,t),n=this._map,r=n.__visibleRect;return i.x=-r.x,i.y=-r.y,i.width=n.width,i.height=n.height,this._svgFilters[e.id]=i,i},_updateSVGFilters:function(e,t,i,n){var r,s,a,o=this._svgFilters;for(s in o)r=o[s],r&&(a=h.byId(s),a&&(null!=e&&a.setAttribute("x",e),null!=t&&a.setAttribute("y",t),null!=i&&a.setAttribute("width",i),null!=n&&a.setAttribute("height",n)),null!=e&&(r.x=e),null!=t&&(r.y=t),null!=i&&(r.width=i),null!=n&&(r.height=n))},_getScaleMatrix:function(e,t){var i=e.width/e.height,n=1,r=1;return isNaN(t)||(i>1?(n=t/e.width,r=t/i/e.height):(r=t/e.height,n=t*i/e.width)),{xx:n,yy:r}},_symbolizePoint:function(e,t,n,r){var s=t.type,a=t.style;if("shieldlabelsymbol"!==s&&"picturemarkersymbol"!==s){var o=t.getStroke(),h=t.getFill(),l=a===y.STYLE_X||a===y.STYLE_CROSS,c=o&&o.color,_=l?c:h;if(n){var u=this._getVariable(n,"colorInfo",!1),d=this._getVariable(n,"opacityInfo",!1);u&&(_=n.getColor(r,{colorInfo:u})||_),_&&d&&(_=this._applyOpacity(_,n,d,r)),_&&(l?_!==c&&(o=o?i.mixin({},o):{},o.color=_):_!==h&&(h=_))}"textsymbol"===s?e.setFill(h):"simplemarkersymbol"===s&&e.setFill(h).setStroke(o)}},_drawMarkers:function(e,t,i,n){var r,s,a,o=e.geometry,h=o.points,l=e.getDojoShape()||this._div.createGroup(),c=h.length,_=[],u=0,d=i?i.length:0;for(l.children[0]&&this._isInvalidShape(t,l.children[0])&&l.clear(),s=0;c>s;s++)for(r=h[s],a=0;d>a;a++)_[0]=i[a],this._drawPoint(l,{x:r[0],y:r[1],spatialReference:o.spatialReference},t,l.children[u++],_,n,e);var p=l.children.length;if(c*i.length<p)for(s=p-1;s>=c*i.length;s--)l.children[s].removeShape();e._shape=l},_symbolizeMarkers:function(e,t,i){var n,r=e.getDojoShape(),s=r.children,a=s.length;for(n=0;a>n;n++)this._symbolizePoint(s[n],t,i,e)},_errorHandler:function(e,t){var i="Unable to draw graphic ";t?e.message=i+"(geometry:"+(t.geometry?t.geometry.declaredClass:null)+", symbol:"+(t.symbol?t.symbol.declaredClass:null)+"): "+e.message:e.message=i+"(null): "+e.message,this.inherited(arguments)},_rendererLimits:function(){var e,t,i;if(f("ff")?(e=16125,t=-32250,i=32250):I?(e=1e5,t=-1e5,i=1e5):f("chrome")&&f("chrome")<6&&(e=8150,t=-1e4,i=1e4),e){var n,r;return n=[-e,-e,e,e],r=[[[-e,-e],[e,-e]],[[e,-e],[e,e]],[[e,e],[-e,e]],[[-e,e],[-e,-e]]],{clipLimit:e,rangeMin:t,rangeMax:i,clipBBox:n,clipSegments:r}}}(),_clipPolyline:function(e,t){var i=this._getCorners(e,t),r=i.tl,s=i.br,a=this._rendererLimits,o=a.rangeMin,h=a.rangeMax,l=a.clipBBox,c=a.clipSegments,_=this._isPointWithinRange,u=this._isPointWithinBBox,d=this._getClipperIntersection,p=this._getPlaneIndex;if(!_(r,o,h)||!_(s,o,h)){I&&this._createSegments(e);var f=[];n.forEach(e.segments,function(e){var t,i=e.args,n=i.length,r=[];for(t=0;n>t;t+=2){var s=[i[t],i[t+1]],a=[i[t+2],i[t+3]],o=u(s,l),h=u(a,l);if(o^h){var _=d([s,a],c);_&&(o?(t?r.push(_[1]):r.push(s,_[1]),f.push(r),r=[]):r.push(_[1],a))}else if(o)t?r.push(a):r.push(s,a);else{var g=p(s,l),m=p(a,l);if(-1===g||-1===m||g===m)continue;var v=d([s,a],c,!0);if(v.length>0){v[g]||(g=v[g[0]]?g[0]:g[1]),v[m]||(m=v[m[0]]?m[0]:m[1]);var y=v[g],S=v[m];y&&r.push(y),S&&(r.push(S),f.push(r),r=[])}}}f.push(r)}),e.setShape(this._getPathStringFromPaths(f))}},_clipPolygon:function(e,t){var r=this._getCorners(e,t),s=r.tl,a=r.br,o=this._rendererLimits,h=o.clipLimit,l=o.rangeMin,c=o.rangeMax,_=o.clipBBox,u=o.clipSegments,d=this._isPointWithinRange,p=this._isPointWithinBBox,f=this._getClipperIntersection,g=this._getPlaneIndex,m=M._pointLineDistance;if(!d(s,l,c)||!d(a,l,c)){I&&this._createSegments(e);var v=n.filter(e.segments,function(e){return e.args&&e.args.length}),y=n.map(v,function(e){var t,r=e.args,s=r.length,a=[],o=[];for(t=0;s>t;t+=2){var l=[r[t],r[t+1]],c=[r[t+2],r[t+3]];if(t===s-2){a.push(l);break}var d,v=p(l,_),y=p(c,_);if(a.push(l),v^y){if(d=f([l,c],u)){var S=d[1];S[v?"inOut":"outIn"]=!0,a.push(S),o.push([v?"INOUT":"OUTIN",a.length-1,d[0]])}}else if(!v){var x=g(l,_),b=g(c,_);if(-1===x||-1===b||x===b)continue;if(d=f([l,c],u,!0),d.length>0){d[x]||(x=d[x[0]]?x[0]:x[1]),d[b]||(b=d[b[0]]?b[0]:b[1]);var M=d[x],w=d[b];M&&(M.outIn=!0,a.push(M),o.push(["OUTIN",a.length-1,x])),w&&(w.inOut=!0,a.push(w),o.push(["INOUT",a.length-1,b]))}else if(i.isArray(x)&&i.isArray(b)){var E=x.concat(b);if(E.sort(),"0123"===E.join("")){var P=[];x[0]+x[1]===3?P.push([h,-h],[-h,h]):P.push([-h,-h],[h,h]);var k=m(P[0],[l,c]),C=m(P[1],[l,c]);a.push(C>k?P[0]:P[1])}}}}var I=_[0],G=_[1],L=_[2],T=_[3];n.forEach(a,function(e){e[0]<I&&(e[1]>=G&&e[1]<=T?e[0]=I:(e[0]=I,e[1]=e[1]<G?G:T))}),n.forEach(a,function(e){e[1]<G&&(e[0]>=I&&e[0]<=L?e[1]=G:(e[1]=G,e[0]=e[0]<I?I:L))}),n.forEach(a,function(e){e[0]>L&&(e[1]>=G&&e[1]<=T?e[0]=L:(e[0]=L,e[1]=e[1]<G?G:T))}),n.forEach(a,function(e){e[1]>T&&(e[0]>=I&&e[0]<=L?e[1]=T:(e[1]=T,e[0]=e[0]<I?I:L))});var R,H,O=0;if(s=o.length,s>0)do{if(R=o[O],H=o[(O+1)%s],R[2]===H[2]&&"INOUT"===R[0]&&"OUTIN"===H[0]){var A,D=R[1],F=H[1];if(F>D)for(A=D+1;F>A;A++)a[A][2]=!0;else if(D>F){for(A=D+1;A<a.length;A++)a[A][2]=!0;for(A=0;F>A;A++)a[A][2]=!0}}O=(O+1)%s}while(0!==O);var N,V=a[0],j=a[a.length-1];for(V[2]&&(j[2]=!0,n.some(o,function(e){return 1===e[1]?(a.splice(a.length-1,0,i.clone(a[1])),!0):!1})),a=n.filter(a,function(e){return e[2]?!1:!0}),O=0;O<a.length-1;O++)N=a[O],H=a[O+1],H&&N[0]===H[0]&&N[1]===H[1]&&(H.outIn?N.outIn=!0:H.inOut&&(N.inOut=!0),a.splice(O+1,1));var z=Math.abs,B=[];for(O=0;O<a.length-1;O++){R=a[O];var U=R[0],Y=R[1],W=z(U)===h,X=z(Y)===h;H=a[O+1];var Z=H[0],q=H[1],Q=z(Z)===h,J=z(q)===h;W&&J?B.push([O+1,[U,q]]):X&&Q&&B.push([O+1,[Z,Y]])}for(O=B.length-1;O>=0;O--){var $=B[O],K=a[$[0]-1];N=a[$[0]],K.outIn||K.inOut||N.outIn||N.inOut||a.splice($[0],0,$[1])}return V=a[0],j=a[a.length-1],(V[0]!==j[0]||V[1]!==j[1])&&a.push(V),a});e.setShape(this._getPathStringFromPaths(y))}},_getCorners:function(e,t){if(I){var i=this._map,n=t.getExtent(),r=n.spatialReference,s=i.toScreen(new S(n.xmin,n.ymax,r)),a=i.toScreen(new S(n.xmax,n.ymin,r));return{tl:s,br:a}}var o=e.getTransformedBoundingBox();return{tl:o[0],br:o[2]}},_createSegments:function(e){e.shape.path=e.vmlPath,e.segmented=!1,e._confirmSegmented();var t=e.segments;t.length>1&&(e.segments=n.filter(t,function(e,t,i){var n=i[t+1];return"M"===e.action&&n&&"L"===n.action?(e.args=e.args.concat(n.args),!0):!1}))},_getPathStringFromPaths:function(e){return I?(e=n.map(e,function(e){var t=n.map(e,function(e,t){return(1===t?"l ":"")+e.join(",")});return"m "+t.join(" ")}),e.push("e")):e=n.map(e,function(e){var t=n.map(e,function(e){return e.join(",")});return"M "+t.join(" ")}),e.join(" ")},_isPointWithinBBox:function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],a=e[0],o=e[1];return a>i&&r>a&&o>n&&s>o?!0:!1},_isPointWithinRange:function(e,t,i){var n=e.x,r=e.y;return t>n||t>r||n>i||r>i?!1:!0},_getClipperIntersection:function(e,t,i){var n,r=M._getLineIntersection2,s=Math.round,a={length:0};for(n=0;4>n;n++){var o=r(e,t[n]);if(o){if(o[0]=s(o[0]),o[1]=s(o[1]),!i)return[n,o];a[n]=o,a.length++}}return i?a:null},_getPlaneIndex:function(e,t){var i=e[0],n=e[1],r=t[0],s=t[1],a=t[2],o=t[3];return r>=i?n>=s&&o>=n?3:s>n?[0,3]:[2,3]:s>=n?i>=r&&a>=i?0:r>i?[3,0]:[1,0]:i>=a?n>=s&&o>=n?1:s>n?[0,1]:[2,1]:n>=o?i>=r&&a>=i?2:r>i?[3,2]:[1,2]:-1},onGraphicAdd:function(){},onGraphicRemove:function(){},onGraphicNodeAdd:function(){},onGraphicNodeRemove:function(){},onGraphicDraw:function(){},onGraphicsClear:function(){},onRendererChange:function(){},onOpacityChange:function(){},setInfoTemplate:function(e){this.infoTemplate=e},add:function(e,t){return e._graphicsLayer===this?e:(t||this.graphics.push(e),e._graphicsLayer=this,e._sourceLayer||(e._layer&&"esri.layers.GraphicsLayer"!==e._layer.declaredClass?e._sourceLayer=e._layer:"esri.layers.GraphicsLayer"!==this.declaredClass&&(e._sourceLayer=this)),
e._layer=this,this._updateExtent(e),this._draw(e),t||this.onGraphicAdd(e),e)},remove:function(e,t,i){if(!t&&!i){var r,s=this.graphics;if(-1===(r=n.indexOf(s,e)))return null;e=s.splice(r,1)[0]}return e.getDojoShape()&&this._removeShape(e,null,i),e._shape=e._graphicsLayer=null,this.onGraphicRemove(e),e},clear:function(){var e,t=arguments[1],i=this.graphics,n=i.length,r=!I;for(e=n-1;e>=0;e--)this.remove(i[e],null,r);this.graphics=[],this._destroyAllNodes(),t||this.onGraphicsClear()},_destroyAllNodes:function(){var e=!I;if(e&&this._div){var t;this._childLayer&&(t=this._childLayer.getNode(),t&&t.parentNode&&t.parentNode.removeChild(t)),this._bgGroup.clear(),this._div.clear(),this._bgGroup=this._div.createGroup(),t&&this._div.getEventSource().appendChild(t),this._initOpacity()}},clearNodes:function(){var e,t=this.graphics,i=t.length;for(e=0;i>e;e++)this._removeShape(t[e],!0,!0);this._destroyAllNodes()},_setIEOpacity:function(e,t){var i=e&&e.getNode();if(i){var n=e.strokeStyle,r=i.stroke;n&&r&&(r.opacity=n.color.a*t);var s=e.fillStyle,a=i.fill;s&&a&&("tile"===a.type?o.set(i,"opacity",t):a.opacity=s.a*t)}},setOpacity:function(e,t){if(t||this.opacity!=e){var i=this._div;i&&(I?(n.forEach(this.graphics,function(t){this._setIEOpacity(t._shape,e),this._setIEOpacity(t._bgShape,e)},this),i._esriIeOpacity=e,this._bgGroup._esriIeOpacity=e):this._canvas?o.set(i.getEventSource(),"opacity",e):i.getEventSource().setAttribute("opacity",e)),this.opacity=e,t||this.onOpacityChange(e)}},setRenderer:function(e){this.renderer=e,this._evalSDRenderer(!0),this.emit("renderer-change",{renderer:this._rndForScale||e})}});var D=e([P,E],{declaredClass:"esri.layers.GraphicsLayer",constructor:function(){this.enableMouseEvents=i.hitch(this,this.enableMouseEvents),this.disableMouseEvents=i.hitch(this,this.disableMouseEvents),this._processEvent=i.hitch(this,this._processEvent),this._initLayer()},_initLayer:function(){this.loaded=!0,this.onLoad(this)},_setMap:function(){var e=this.inherited("_setMap",arguments);return this.enableMouseEvents(),e},_unsetMap:function(){this.disableMouseEvents(),this.inherited("_unsetMap",arguments)},_processEvent:function(e){var t,i=this._map,n=e.target;for(e.screenPoint=new x(e.pageX-i.position.x,e.pageY-i.position.y),e.mapPoint=i.toMap(e.screenPoint);n&&!(t=n.e_graphic);)n=n.parentNode;return t?(e.graphic=t,e):void 0},_onMouseOverHandler:function(e){this._processEvent(e)&&this.onMouseOver(e)},_onMouseMoveHandler:function(e){this._processEvent(e)&&this.onMouseMove(e)},_onMouseDragHandler:function(e){this._processEvent(e)&&this.onMouseDrag(e)},_onMouseOutHandler:function(e){this._processEvent(e)&&this.onMouseOut(e)},_onMouseDownHandler:function(e){this._downGr=this._downPt=null,this._processEvent(e)&&(t.disconnect(this._onmousemove_connect),t.disconnect(this._onmousedrag_connect),this._onmousedrag_connect=t.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseDragHandler"),this._downGr=e.graphic,this._downPt=e.screenPoint.x+","+e.screenPoint.y,this.onMouseDown(e))},_onMouseUpHandler:function(e){this._upGr=this._upPt=null,this._processEvent(e)&&(t.disconnect(this._onmousedrag_connect),t.disconnect(this._onmousemove_connect),this._onmousemove_connect=t.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseMoveHandler"),this._upGr=e.graphic,this._upPt=e.screenPoint.x+","+e.screenPoint.y,this.onMouseUp(e))},_onClickHandler:function(e){if(this._processEvent(e)){var t=this._downGr,i=this._upGr;t&&i&&t===i&&this._downPt===this._upPt&&(I&&(d._ieGraphic=e.graphic),this.onClick(e))}},_onDblClickHandler:function(e){this._processEvent(e)&&this.onDblClick(e)},onMouseOver:function(){},onMouseMove:function(){},onMouseDrag:function(){},onMouseOut:function(){},onMouseDown:function(){},onMouseUp:function(){},onClick:function(){},onDblClick:function(){},enableMouseEvents:function(){if(!this._mouseEvents){var e=t.connect,i=this._div.getEventSource();C||(this._onmouseover_connect=e(i,"onmouseover",this,"_onMouseOverHandler"),this._onmousemove_connect=e(i,"onmousemove",this,"_onMouseMoveHandler"),this._onmouseout_connect=e(i,"onmouseout",this,"_onMouseOutHandler"),this._onmousedown_connect=e(i,"onmousedown",this,"_onMouseDownHandler"),this._onmouseup_connect=e(i,"onmouseup",this,"_onMouseUpHandler"),this._onclick_connect=e(i,"onclick",this,"_onClickHandler"),this._ondblclick_connect=e(i,"ondblclick",this,"_onDblClickHandler")),this._mouseEvents=!0}},disableMouseEvents:function(){if(this._mouseEvents){var e=t.disconnect;e(this._onmouseover_connect),e(this._onmousemove_connect),e(this._onmousedrag_connect),e(this._onmouseout_connect),e(this._onmousedown_connect),e(this._onmouseup_connect),e(this._onclick_connect),e(this._ondblclick_connect),this._mouseEvents=!1}}});return D._GraphicsContainer=A,D._GraphicsLayer=P,f("extend-esri")&&(i.setObject("layers.GraphicsLayer",D,d),i.setObject("layers._GraphicsContainer",A,d),i.setObject("layers._GraphicsLayer",P,d)),D});