// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.23/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/dom-attr","dojo/dom-construct","dojo/dom-style","dojo/dom","dojox/gfx","dojox/gfx/matrix","./gfxSniff!esri-svg?dojox/gfx/filters","./layer","../kernel","../lang","../sniff","../Color","../domUtils","../symbols/MarkerSymbol","../symbols/SimpleMarkerSymbol","../symbols/utils","../geometry/Point","../geometry/ScreenPoint","../geometry/Extent","../geometry/mathUtils","../geometry/screenUtils","../PluginTarget","./gfxSniff!esri-svg?dojox/gfx/svgext"],function(e,t,n,i,r,s,a,o,h,c,l,_,u,d,p,f,g,m,v,y,S,x,b,M,w,E,P){var k,C=-1!==c.renderer.toLowerCase().indexOf("svg"),I=-1!==c.renderer.toLowerCase().indexOf("canvas"),G=I?"canvas-2d":c.renderer,T=f("ie")<9,R=10===f("ie"),H=void 0===f("ie")&&7==f("trident"),L=R||H,O=f("esri-touch"),D=e(null,{declaredClass:"esri.layers._GraphicsContainer",_setMap:function(e,n){var i,r=this._connects=[];if(this._map=e,this._useWillChange="css-transforms"===e.navigationMode&&C&&f("esri-will-change"),I)i=a.create("div",{style:"overflow: visible; position: absolute;"},n),this._surface={getEventSource:function(){return i}},r.push(t.connect(i,"onmousedown",this,this._canvasDownHandler)),r.push(t.connect(i,"onmouseup",this,this._canvasUpHandler)),r.push(t.connect(i,"onclick",this,this._canvasClickHandler)),k.prototype._canvas=!0;else{var s=this._surface=c.createSurface(n,e.width,e.height);i=s.getEventSource(),this._useWillChange&&o.set(i,"will-change","transform"),o.set(i=T?i.parentNode:i,{overflow:"visible",position:"absolute"})}return r.push(t.connect(e,"onResize",this,"_onResizeHandler")),this._useWillChange&&(r.push(t.connect(e,"onPan",this,"_onPanHandler")),r.push(t.connect(e,"onPanEnd",this,"_onPanEndHandler")),r.push(t.connect(e,"onExtentChange",this,"_onExtentChangeHandler"))),i},_onPanHandler:function(e,t){var n=this._map.__visibleRect,i=n.x+t.x,r=n.y+t.y;this._panDx=i,this._panDy=r,o.set(this._surface.getEventSource(),d._css.names.transform,d._css.translate(i,r))},_onPanEndHandler:function(e,t){var n=this._map.__visibleRect,i=n.x,r=n.y;this._panDx=i,this._panDy=r,o.set(this._surface.getEventSource(),d._css.names.transform,d._css.translate(i,r))},_onExtentChangeHandler:function(e,t,n,i){if(n){var r=0,s=0;this._panDx=r,this._panDy=s,o.set(this._surface.getEventSource(),d._css.names.transform,d._css.translate(r,s))}},_getTransform:function(){return{dx:this._panDx||0,dy:this._panDy||0}},_onResizeHandler:function(e,t,n){var r,a=this._surface.getEventSource(),h=this._map;T&&o.set(a=a.parentNode,{width:t+"px",height:n+"px",clip:"rect(0px "+t+"px "+n+"px 0px)"}),s.set(a,"width",t),s.set(a,"height",n),this._surface.declaredClass||i.forEach(a.childNodes,function(e){s.set(e,"width",t),s.set(e,"height",n)}),h.loaded&&(h.graphics.suspended||(h.graphics._resized=!0),i.forEach(h.graphicsLayerIds,function(e){r=h.getLayer(e),r.suspended||(r._resized=!0,r._childLayer&&(r._childLayer._resized=!0)),r._updateSVGFilters(null,null,t,n)}),h.graphics._updateSVGFilters(null,null,t,n),h._labels&&h._labels._updateSVGFilters(null,null,t,n))},_cleanUp:function(){i.forEach(this._connects,t.disconnect,t),this._map=this._surface=null},_processEvent:function(e){var t=this._map;e.screenPoint=new b(e.pageX-t.position.x,e.pageY-t.position.y),e.mapPoint=t.toMap(e.screenPoint)},_canvasDownHandler:function(e){this._processEvent(e),this._downPt=e.screenPoint.x+","+e.screenPoint.y},_canvasUpHandler:function(e){this._processEvent(e),this._upPt=e.screenPoint.x+","+e.screenPoint.y},_tolerance:15,_isPrimaryMatch:function(e,t,n,r){if(!e.visible||!t)return!1;var s,a=t.getTransformedBoundingBox();return a?(s=new M(a[0].x,a[0].y,a[2].x,a[2].y),delete s.spatialReference,O?s.intersects(n):s.contains(r)):i.some(t.children||[],function(e){return a=e.getTransformedBoundingBox(),s=new M(a[0].x,a[0].y,a[2].x,a[2].y),delete s.spatialReference,O?s.intersects(n):s.contains(r)})},_canvasClickHandler:function(e){if(this._downPt&&this._upPt&&this._downPt===this._upPt){this._processEvent(e);var t=this._map,n=i.map(t.graphicsLayerIds,function(e){return t.getLayer(e)});n.push(t.graphics),n.reverse(),n=i.filter(n,function(e){return e.loaded&&e._mouseEvents&&!e.suspended&&(!p.isDefined(e.opacity)||e.opacity>0)});var r,s=e.screenPoint,a=this._tolerance,o=s.x-a,h=s.y+a,c=s.x+a,l=s.y-a,_=new M(o,l,c,h),u=t.toMap(new b(o,h)),d=t.toMap(new b(c,l)),f=u.spatialReference._getInfo(),g=new M(M.prototype._normalizeX(u.x,f).x,u.y,M.prototype._normalizeX(d.x,f).x,d.y,u.spatialReference);if(delete _.spatialReference,i.some(n,function(e){var t=i.filter(e.graphics,function(e){return this._isPrimaryMatch(e,e.getDojoShape(),_,s)||!(!e._bgShape||!this._isPrimaryMatch(e,e._bgShape,_,s))},this);if(t.reverse(),t.length>0){var n;if(i.some(t,function(e){return e.geometry&&g.intersects(e.geometry)?(n=e,!0):!1}),n)return r=n,!0}return!1},this),r){var m=r.getLayer();m&&(e.graphic=r,m.onClick(e))}}}});k=e(u,{declaredClass:"esri.layers._GraphicsLayer",managedSuspension:!0,surfaceType:G,renderer:null,_eventMap:{"graphic-add":["graphic"],"graphic-remove":["graphic"],"renderer-change":["renderer"]},_suspendGraphics:!1,constructor:function(e){e=e||{},(n.isString(e)||n.isObject(e)&&(e.layerDefinition||e.query))&&(e=arguments[1]),this._params=n.mixin({displayOnPan:!0,drawMode:!0,styling:!0},e);var t=this._params.dataAttributes;"string"==typeof t&&(t=[t]),this.styling=C?this._params.styling:!0,this.dataAttributes=t,this.infoTemplate=e&&e.infoTemplate,this.graphics=[],this._draw=n.hitch(this,this._draw),this._refresh=n.hitch(this,this._refresh),this._acquireSVGMarker=n.hitch(this,this._acquireSVGMarker),this.registerConnectEvents()},getNode:function(){return this._div&&this._div.getEventSource()},setDrawMode:function(e){this._params.drawMode=e},suspendGraphics:function(e){this._suspendGraphics=e,i.forEach(this.graphics,function(t){t._suspended=e})},_setMap:function(e,t){return this.inherited(arguments),this._map=e,this._wrap=e.wrapAround180,this._srInfo=e.spatialReference._getInfo(),this._svgFilters={},this._lineMarkers={},this._canvas?(t=c.createSurface(t.getEventSource(),e.width,e.height),o.set(t.rawNode,"position","absolute"),this._div=t.createGroup(),this._renderProto=this._div.constructor.prototype._render,this._div._render=n.hitch(this,this._canvasRender)):this._div=t.createGroup(),this._bgGroup=this._div.createGroup(),this._div.getEventSource().id=this.id+"_layer",this._initOpacity(),this._div},_unsetMap:function(e,t){i.forEach(this.graphics,function(e){e._shape=null}),this._canvas?(t=this._div.getParent(),t._parent={},a.destroy(t.rawNode),t.destroy()):(this._div.clear(),t.remove(this._div),a.destroy(this._div.getEventSource())),this._map=this._div=this._svgFilters=this._lineMarkers=null,clearTimeout(this._wakeTimer),this._wakeTimer=null,this._disableDrawConnectors(),this.inherited(arguments)},_initOpacity:function(){var e=this.opacity;p.isDefined(e)&&1>e&&this.setOpacity(e,!0)},_onZoomStartHandler:function(){m.hide(this._div.getEventSource())},_onExtentChangeHandler:function(e,t,n,i){if(clearTimeout(this._wakeTimer),this._wakeTimer=null,n){var r=this._map.__visibleRect,s=this._div;this._evalSDRenderer(),this._refresh(!0),this._params._child||this._updateTransform(s,r.x,r.y,!0),this._renderProto&&s.surface.pendingRender?this._dirty=!0:this.suspended||m.show(s.getEventSource())}else this._resized&&(this._resized=!1,this._refresh(!1));this.graphics.length>0&&this.onUpdate()},_canvasRender:function(){var e=this._div;return this._dirty&&(delete this._dirty,this.suspended||m.show(e.getEventSource())),this._renderProto.apply(e,arguments)},_refresh:function(e){var t,n=this.graphics,i=n.length,r=this._draw;for(t=0;i>t;t++)r(n[t],e)},refresh:function(){this._refresh(!0)},redraw:function(){this._refresh(!0)},_getTransform:function(){var e={dx:0,dy:0};return this._map&&(this._map._gc._useWillChange?e=this._map._gc._getTransform():this._div&&(e=this._div.getTransform())),e},_onPanHandler:function(e,t){this._panDx=t.x,this._panDy=t.y;var n=this._map.__visibleRect;this._updateTransform(this._div,n.x+t.x,n.y+t.y),H&&this._updateSVGMarkers()},_onPanEndUpdateHandler:function(e,t){var n=this._map.__visibleRect;this._params._child||t.x===this._panDx&&t.y===this._panDy?(this._updateSVGFilters(-n.x,-n.y),this._updateSVGMarkers()):this._updateTransform(this._div,n.x,n.y,!0),this._refresh(!1),this.graphics.length&&this.onUpdate()},_onPanStartHandler:function(){m.hide(this._div.getEventSource())},_onPanEndHandler:function(){var e=this._map.__visibleRect,t=this._div;this._updateTransform(t,e.x,e.y,!0),this._refresh(!1),this._renderProto&&t.surface.pendingRender?this._dirty=!0:m.show(t.getEventSource()),this.graphics.length&&this.onUpdate()},_updateTransform:function(e,t,n,i){this._map._gc._useWillChange||e.setTransform(l.translate({x:t,y:n})),i&&(this._updateSVGFilters(-t,-n),this._updateSVGMarkers())},onSuspend:function(){this.inherited(arguments),m.hide(this._div.getEventSource()),clearTimeout(this._wakeTimer),this._wakeTimer=null,this._disableDrawConnectors()},onResume:function(e){this.inherited(arguments),e.firstOccurrence&&this._evalSDRenderer(),this._enableDrawConnectors(),this._wakeTimer=this._wakeTimer||setTimeout(n.hitch(this,function(){this.suspended||this._map.__zooming||this._onExtentChangeHandler(null,null,!0)}),0)},_enableDrawConnectors:function(){var e=this._map,n=t.connect;this._disableDrawConnectors(),this._params.displayOnPan?(this._params._child||(this._onPanHandler_connect=n(e,"onPan",this,"_onPanHandler")),this._onPanEndHandler_connect=n(e,"onPanEnd",this,"_onPanEndUpdateHandler")):(this._onPanStartHandler_connect=n(e,"onPanStart",this,"_onPanStartHandler"),this._onPanEndHandler_connect=n(e,"onPanEnd",this,"_onPanEndHandler")),this._onZoomStartHandler_connect=n(e,"onZoomStart",this,"_onZoomStartHandler"),this._onExtentChangeHandler_connect=n(e,"onExtentChange",this,"_onExtentChangeHandler")},_disableDrawConnectors:function(){var e=t.disconnect;e(this._onExtentChangeHandler_connect),e(this._onZoomStartHandler_connect),e(this._onPanHandler_connect),e(this._onPanStartHandler_connect),e(this._onPanEndHandler_connect),this._onExtentChangeHandler_connect=this._onZoomStartHandler_connect=this._onPanHandler_connect=this._onPanStartHandler_connect=this._onPanEndHandler_connect=null},_updateExtent:function(e){var t=e.geometry;if(!t)return void(e._extent=null);var n=e._extent=t.getExtent();if(!n){var i,r;if("esri.geometry.Point"===t.declaredClass)i=t.x,r=t.y;else{if("esri.geometry.Multipoint"!==t.declaredClass)return void(e._extent=null);i=t.points[0][0],r=t.points[0][1]}e._extent=new M(i,r,i,r,t.spatialReference)}},_intersects:function(e,t,n){var r=e.spatialReference,s=t.spatialReference,a=r&&s&&!r.equals(s)&&r._canProject(s)&&4326===s.wkid;if(this._wrap&&!n){var o,h,c,l,_,u,d,p,f,g,m=[],v=e._getFrameWidth(),y=this._srInfo,S=e._clip?e._getAvailExtent():e.extent,x=[],b=t._partwise;if(a&&(S=e.geographicExtent,y=s._getInfo()),h=S._getParts(y),b&&b.length)for(o=[],c=0,u=b.length;u>c;c++)o=o.concat(b[c]._getParts(y));else o=t._getParts(y);for(c=0,u=o.length;u>c;c++)for(f=o[c],l=0,d=h.length;d>l;l++)if(g=h[l],g.extent.intersects(f.extent))for(_=0,p=f.frameIds.length;p>_;_++)m.push((g.frameIds[0]-f.frameIds[_])*v);for(c=0,u=m.length;u>c;c++)_=m[c],i.indexOf(m,_)===c&&x.push(_);return x.length?x:null}return(a?e.geographicExtent:e.extent).intersects(t)?[0]:null},_defaultMarker:{type:"simplemarkersymbol",style:"square",size:1,xoffset:0,yoffset:0,angle:0},_draw:function(e,t){if(this._params.drawMode&&this._map&&!this.suspended&&!this._map.__zooming&&!this._resized)try{var n,i,r,s=e._extent,a=!C||this.styling,o=C&&this.dataAttributes,h=e.getDojoShape();if(!e._suspended&&e.visible&&s&&(n=this._intersects(this._map,s,e.geometry._originOnly))&&(i=a?this._getSymbol(e):this._defaultMarker)){if(e._offsets&&e._offsets.join(",")===n.join(",")?r=!0:e._offsets=n,!h||t||!r){var c=e.geometry.type,l={graphic:e},_=e._bgShape,u=a&&!e.symbol?this._getRenderer(e):null,d=u&&u.backgroundFillSymbol;if("point"===c)this._isInvalidShape(i,h)&&this._removeShape(e),e._shape=this._drawPoint(this._div,e.geometry,i,e.getDojoShape(),n,u,e),a&&this._symbolizePoint(e.getDojoShape(),i,u,e);else if("multipoint"===c)this._drawMarkers(e,i,n,u),a&&this._symbolizeMarkers(e,i,u);else{var p,f,g,m,v=i;if(a&&(p="simplemarkersymbol"===i.type||"picturemarkersymbol"===i.type||"textsymbol"===i.type?i:null,v=p?d:i),a&&v&&v.type.indexOf("fillsymbol")>-1&&(f=this._bgGroup,m=!(!f||!p)),_&&!m&&this._removeBgShape(e),v&&(!m&&this._isInvalidShape(v,e._shape)&&this._removeShape(e,!1),g=this._drawShape(e,n,f||this._div,m?_:e.getDojoShape()),a&&this._symbolizeShape(g,v,u,v===d,e),e[m?"_bgShape":"_shape"]=g),p){this._isInvalidShape(p,e._shape)&&this._removeShape(e,!1);var y=e.geometry.getCentroid();g=y&&this._drawPoint(this._div,y,p,e._shape,n,u,e),g&&this._symbolizePoint(g,p,u,e),e._shape=g}}I||(e._bgShape&&this._initNode(e,e._bgShape,e._bgShape!==_,l,o),e._shape&&this._initNode(e,e._shape,e._shape!==h,l,o)),e._applyDataAttrs(),l.node=e.getNode(),this.onGraphicDraw(l)}}else h&&this._removeShape(e)}catch(S){this._errorHandler(S,e)}},_initNode:function(e,t,n,i,r){var s=t&&t.getNode();s&&(s.e_graphic=e,this._addDataAttrs(e,r,s),n&&(i.node=s,this.onGraphicNodeAdd(i)))},_removeShape:function(e,t,n){var i=e.getDojoShape(),r=i&&i.getNode();i&&!n&&(i.removeShape(),i.destroy()),e._shape=e._offsets=null,t!==!1&&this._removeBgShape(e,n),r&&(r.e_graphic=null,I||this.onGraphicNodeRemove({graphic:e,node:r}))},_removeBgShape:function(e,t){var n=e._bgShape,i=n&&n.getNode();n&&!t&&(n.removeShape(),n.destroy()),e._bgShape=null,i&&(i.e_graphic=null,I||this.onGraphicNodeRemove({graphic:e,node:i}))},_addDataAttrs:function(e,t,n){var i,r,s,a=e.attributes,o=t?t.length:0,h=this._getRenderer(e);if(n&&a){for(r=0;o>r;r++)i=t[r],i&&e.attr("data-"+i,a[i]);!this.styling&&h&&(h.getBreakIndex?(s=h.getBreakIndex(e),e.attr("data-class-break",-1!==s?s:null)):h.getUniqueValueInfo&&(s=h.getUniqueValueInfo(e),e.attr("data-unique-value",s?s.value:null)))}},_drawShape:function(e,t,n,i){var r,s,a,o,h,c,l=e.geometry,_=l.type,u=this._map,d=u.extent,p=u.width,f=u.height,g=u.__visibleRect,m=[],v="extent"===_;if("rect"===_||v)o={x:0,y:0,spatialReference:l.spatialReference},o.x=v?l.xmin:l.x,o.y=v?l.ymax:l.y,h=E.toScreenPoint(d,p,f,o),o.x=v?l.xmax:l.x+l.width,o.y=v?l.ymin:l.y+l.height,c=E.toScreenPoint(d,p,f,o),a={x:h.x-g.x+t[0],y:h.y-g.y,width:Math.abs(c.x-h.x),height:Math.abs(c.y-h.y)},0===a.width&&(a.width=1),0===a.height&&(a.height=1),i=this._drawRect(n,i,a);else if("polyline"===_||"polygon"===_){for(r=0,s=t.length;s>r;r++)m=m.concat(E._toScreenPath(d,p,f,l,-g.x+t[r],-g.y));i=this._drawPath(n,i,m),this._rendererLimits&&("polyline"===_?this._clipPolyline(i,l):this._clipPolygon(i,l))}return i},_drawRect:function(e,t,n){return t?t.setShape(n):e.createRect(n)},_drawImage:function(e,t,n){return t?t.setShape(n):e.createImage(n)},_drawCircle:function(e,t,n){return t?t.setShape(n):e.createCircle(n)},_drawPath:function(){return T?function(e,t,n,i){if(n=i?n:n.join(" "),t)return t.setShape(n);var r=e.createObject(i?c.Path:c.EsriPath,n);return e._overrideSize(r.getEventSource()),r}:function(e,t,n,i){return n=i?n:n.join(" "),t?t.setShape(n):e.createPath(n)}}(),_drawText:function(e,t,n){return t?t.setShape(n):e.createText(n)},_evalSDRenderer:function(e){var t,n=this._map,i=this.renderer,r=this._rndForScale;n&&n.loaded&&i&&i.getRendererInfo&&(t="zoom"===i.rangeType?i.getRendererInfoByZoom(n.getZoom()):i.getRendererInfoByScale(n.getScale())),this._rndForScale=t&&t.renderer,e||this._rndForScale==r||this.emit("renderer-change",{renderer:this._rndForScale})},_getRenderer:function(e){var t=this._rndForScale||this.renderer;return e&&t&&t.getObservationRenderer&&(t=t.getObservationRenderer(e)),t},_getSymbol:function(e){var t=this._getRenderer();return e.symbol||t&&t.getSymbol(e)},_getVariable:function(e,t,n){var i,r;return e&&(i=e.getVisualVariablesForType(t,n),r=i&&i[0]),r},_applyOpacity:function(e,t,n,i){var r=t.getOpacity(i,{opacityInfo:n});return null!=r&&(e=new g(e),e.a=r),e},_symbolizeShape:function(e,t,i,r,s){var a,o,h=t.getStroke(),c=t.getFill(),l=t.type,_=-1!==l.indexOf("linesymbol"),u=-1!==l.indexOf("fillsymbol"),d=u?null:this._getVariable(i,"sizeInfo",!1),p=this._getVariable(i,"colorInfo",!1),f=this._getVariable(i,"opacityInfo",!1),g=_?"none"!==t.style:t.outline&&"none"!==t.outline.style,m=_?null:this._getVariable(i,"sizeInfo","outline"),v=r?m:m||d,y=v?i.getSize(s,{sizeInfo:v,resolution:this._map.getResolutionInMeters(),scale:this._map.getScale()}):null;r&&(p=f=null),(p||f)&&"picturefillsymbol"!==l&&(_?(a=h&&h.color,p&&(a=i.getColor(s,{colorInfo:p})||a),a&&f&&(a=this._applyOpacity(a,i,f,s))):c&&c.toCss&&(o=c,p&&(o=i.getColor(s,{colorInfo:p})||o),o&&f&&(o=this._applyOpacity(o,i,f,s)))),e.setStroke(!g||null==y&&!a?h:n.mixin({},h,null!=y?{width:y}:null,a&&{color:a})).setFill(o||c),_&&S.applyLineMarker(e,t,a,this._acquireSVGMarker)},_smsToPath:function(){return T?function(e,t,n,i,r,s,a,o,h){switch(t){case e.STYLE_SQUARE:return["M",r+","+a,"L",s+","+a,s+","+o,r+","+o,"X","E"];case e.STYLE_CROSS:return["M",n+","+a,"L",n+","+o,"M",r+","+i,"L",s+","+i,"E"];case e.STYLE_X:return["M",r+","+a,"L",s+","+o,"M",r+","+o,"L",s+","+a,"E"];case e.STYLE_DIAMOND:return["M",n+","+a,"L",s+","+i,n+","+o,r+","+i,"X","E"];case e.STYLE_TARGET:return["M",r+","+a,"L",s+","+a,s+","+o,r+","+o,r+","+a,"M",r-h+","+i,"L",r+","+i,"M",n+","+(a-h),"L",n+","+a,"M",s+h+","+i,"L",s+","+i,"M",n+","+(o+h),"L",n+","+o,"E"]}}:function(e,t,n,i,r,s,a,o,h){switch(t){case e.STYLE_SQUARE:return["M",r+","+a,s+","+a,s+","+o,r+","+o,"Z"];case e.STYLE_CROSS:return["M",n+","+a,n+","+o,"M",r+","+i,s+","+i];case e.STYLE_X:return["M",r+","+a,s+","+o,"M",r+","+o,s+","+a];case e.STYLE_DIAMOND:return["M",n+","+a,s+","+i,n+","+o,r+","+i,"Z"];case e.STYLE_TARGET:return["M",r+","+a,s+","+a,s+","+o,r+","+o,r+","+a,"M",r-h+","+i,r+","+i,"M",n+","+(a-h),n+","+a,"M",s+h+","+i,s+","+i,"M",n+","+(o+h),n+","+o]}}}(),_pathStyles:{square:1,cross:1,x:1,diamond:1,target:1},_typeMaps:{picturemarkersymbol:"image",picturefillsymbol:"path",simplefillsymbol:"path",simplelinesymbol:"path",cartographiclinesymbol:"path",textsymbol:"text"},_isInvalidShape:function(e,t){var n=t&&t.shape&&t.shape.type,i=e&&e.type,r=e&&e.style;return"rect"===n&&(n="path"),i&&(r=this._typeMaps[i]||r),this._pathStyles[r]&&(r="path"),"shieldlabelsymbol"===i?!0:!(!n||!r||n===r)},_reArialFont:/\s*(^|,)\s*arial\s*(,|$)\s*/i,_fallbackFont:"Arial",_drawPoint:function(e,t,n,i,r,s,a){var o,h,c,_,u=n.type,d=this._map,p=d.__visibleRect,f=E.toScreenPoint(d.extent,d.width,d.height,t).offset(-p.x+r[0],-p.y),g=f.x,m=f.y,v=[],S=this._getVariable(s,"rotationInfo",!1),x=S?s.getRotationAngle(a,{rotationInfo:S}):null,b=this._getVariable(s,"sizeInfo",!1),M=b?s.getSize(a,{sizeInfo:b,shape:n.style,resolution:d.getResolutionInMeters(),scale:d.getScale()}):a.size;if(x&&v.push(l.rotategAt(x,f)),(0!==n.xoffset||0!==n.yoffset)&&(_=l.translate(n.xoffset,-n.yoffset),v.push(_)),0!==n.angle&&v.push(l.rotategAt(n.angle,f)),"simplemarkersymbol"===u){var w,P=n.style,k=Math.round;switch(M=null!=M?M:n.size,P){case y.STYLE_SQUARE:case y.STYLE_CROSS:case y.STYLE_X:case y.STYLE_DIAMOND:w=isNaN(M)?16:M/2,o=this._drawPath(e,i,this._smsToPath(y,P,g,m,k(g-w),k(g+w),k(m-w),k(m+w)));break;case y.STYLE_TARGET:var I=n._targetWidth/2,G=n._targetHeight/2;o=this._drawPath(e,i,this._smsToPath(y,P,g,m,k(g-I),k(g+I),k(m-G),k(m+G),n._spikeSize));break;case y.STYLE_PATH:o=this._drawPath(e,i,n.path,!0);var T=o.getBoundingBox(),R=this._getScaleMatrix(T,M);(1!==R.xx||1!==R.yy)&&v.push(l.scaleAt(R.xx,R.yy,f)),v.push(l.translate(-(T.x+T.width/2)+g,-(T.y+T.height/2)+m));break;default:w=isNaN(M)?16:M/2,o=this._drawCircle(e,i,{cx:g,cy:m,r:w})}}else if("shieldlabelsymbol"===u){h=n.width,c=n.height;var H=e.createGroup(),L=e.createImage({x:g-h/2,y:m-c/2,width:h,height:c,src:n.url});if(H.add(L),null!=n.font){var O=g,D=m+.2*n.getHeight(),F=e.createText({type:"text",text:n.text,x:O,y:D,align:"middle",decoration:n.decoration,rotated:n.rotated,kerning:n.kerning});F.setFont(n.font),F.setFill(n.color),H.add(F)}o=H}else if("picturemarkersymbol"===u){if(null==M?(h=n.width,c=n.height):(c=M,h=c*(n.width/n.height),_&&(null!=_.dx&&(_.dx=h*(_.dx/n.width)),null!=_.dy&&(_.dy=c*(_.dy/n.height)))),o=this._drawImage(e,i,{x:g-h/2,y:m-c/2,width:h,height:c,src:n.url}),C){var A=o.getNode();if(A){var N=this._getVariable(s,"opacityInfo",!1),V=N?s.getOpacity(a,{opacityInfo:N}):null;null!=V?A.setAttribute("opacity",V):A.setAttribute("opacity",1)}}}else if("textsymbol"===u){var j=n.font;if(j){var z=null!=M,B=j.family&&!this._reArialFont.test(j.family);(z||B)&&(j=new j.constructor(j.toJson())),z&&j.setSize(M),B&&j.setFamily(j.family+","+this._fallbackFont)}if(o=this._drawText(e,i,{type:"text",text:n.text,x:g,y:m,align:n.getSVGAlign(),decoration:n.decoration||j&&j.decoration,rotated:n.rotated,kerning:n.kerning}),j&&o.setFont(j),C){var A=o.getNode(),U=n.getSVGBaseline(),Y=n.getSVGBaselineShift();A&&(A.setAttribute("dominant-baseline",U),Y&&A.setAttribute("baseline-shift",Y),this._applyHalo(o,n.haloColor,n.haloSize))}}return o.setTransform(l.multiply(v)),o._wrapOffsets=r,o},_acquireSVGMarker:function(e,t,n,i){var r=this._getSVGMarkerId(t,i),s=this._getSVGMarker(r);return s||(s=S.createSVGMarker(t,r,n,i),this._div.getParent().defNode.appendChild(s),this._lineMarkers[r]=s),s},_getSVGMarkerId:function(e,t){return"marker_"+this._map.id+"_"+e.r+"_"+e.g+"_"+e.b+"_"+t},_getSVGMarker:function(e){return this._lineMarkers[e]},_updateSVGMarkers:function(){if(C&&L){var e=this._lineMarkers;for(var t in e){var n=e[t];n.setAttribute("id",t+"_temp"),n.setAttribute("id",t)}}},_applyHalo:function(e,t,n){var i=t&&n?this._getHaloId(t,n):null;e.setFilter(t&&n?f("webkit")||f("ff")?this._getDilateFilter(t,n,i):this._getOffsetFilter(t,n,i):null)},_getDilateFilter:function(e,t,n){var i=this._getSVGFilter(n);return i||(i=this._createSVGFilter({id:n},[_.feMorphology({operator:"dilate",radius:t,result:"dilated"}),_.feFlood({"flood-color":e.toCss(!0)}),_.feComposite({in2:"dilated",operator:"in",result:"composite"}),_.feMerge("composite","SourceGraphic")])),i},_getOffsetFilter:function(e,t,n){var i=this._getSVGFilter(n);if(!i){var r,s=e.toCss(!0),a=this._offsetPrimitives,o=a.length,h=[],c=[];for(r=0;o>r;r++){var l=a[r],u="offset"+l.dir,d="composite"+l.dir;c.push(d),h.push(_.feOffset({dx:l.dx*t,dy:l.dy*t,"in":"SourceAlpha",result:u}),_.feFlood({"flood-color":s}),_.feComposite({in2:u,operator:"in",result:d}))}c.push("SourceGraphic"),h.push(_.feMerge.apply(_.feMerge,c)),i=this._createSVGFilter({id:n},h)}return i},_offsetPrimitives:[{dir:"L",dx:-1,dy:0},{dir:"TL",dx:-1,dy:-1},{dir:"T",dx:0,dy:-1},{dir:"TR",dx:1,dy:-1},{dir:"R",dx:1,dy:0},{dir:"BR",dx:1,dy:1},{dir:"B",dx:0,dy:1},{dir:"BL",dx:-1,dy:1}],_getHaloId:function(e,t){return"halo_"+this._map.id+"_"+this.id+"_"+e.r+"_"+e.g+"_"+e.b+"_"+e.a+"_"+t},_getSVGFilter:function(e){return this._svgFilters[e]},_createSVGFilter:function(e,t){var n=_.createFilter(e,t),i=this._map,r=i.__visibleRect;return n.x=-r.x,n.y=-r.y,n.width=i.width,n.height=i.height,this._svgFilters[e.id]=n,n},_updateSVGFilters:function(e,t,n,i){var r,s,a,o=this._svgFilters;for(s in o)r=o[s],r&&(a=h.byId(s),a&&(null!=e&&a.setAttribute("x",e),null!=t&&a.setAttribute("y",t),null!=n&&a.setAttribute("width",n),null!=i&&a.setAttribute("height",i)),null!=e&&(r.x=e),null!=t&&(r.y=t),null!=n&&(r.width=n),null!=i&&(r.height=i))},_getScaleMatrix:function(e,t){var n=e.width/e.height,i=1,r=1;return isNaN(t)||(n>1?(i=t/e.width,r=t/n/e.height):(r=t/e.height,i=t*n/e.width)),{xx:i,yy:r}},_symbolizePoint:function(e,t,i,r){var s=t.type,a=t.style;if("shieldlabelsymbol"!==s&&"picturemarkersymbol"!==s){var o=t.getStroke(),h=t.getFill(),c=a===y.STYLE_X||a===y.STYLE_CROSS,l=o&&o.color,_=c?l:h;if(i){var u=this._getVariable(i,"colorInfo",!1),d=this._getVariable(i,"opacityInfo",!1);u&&(_=i.getColor(r,{colorInfo:u})||_),_&&d&&(_=this._applyOpacity(_,i,d,r)),_&&(c?_!==l&&(o=o?n.mixin({},o):{},o.color=_):_!==h&&(h=_))}"textsymbol"===s?e.setFill(h):"simplemarkersymbol"===s&&e.setFill(h).setStroke(o)}},_drawMarkers:function(e,t,n,i){var r,s,a,o=e.geometry,h=o.points,c=e.getDojoShape()||this._div.createGroup(),l=h.length,_=[],u=0,d=n?n.length:0;for(c.children[0]&&this._isInvalidShape(t,c.children[0])&&c.clear(),s=0;l>s;s++)for(r=h[s],a=0;d>a;a++)_[0]=n[a],this._drawPoint(c,{x:r[0],y:r[1],spatialReference:o.spatialReference},t,c.children[u++],_,i,e);var p=c.children.length;if(l*n.length<p)for(s=p-1;s>=l*n.length;s--)c.children[s].removeShape();e._shape=c},_symbolizeMarkers:function(e,t,n){var i,r=e.getDojoShape(),s=r.children,a=s.length;for(i=0;a>i;i++)this._symbolizePoint(s[i],t,n,e)},_errorHandler:function(e,t){var n="Unable to draw graphic ";t?e.message=n+"(geometry:"+(t.geometry?t.geometry.declaredClass:null)+", symbol:"+(t.symbol?t.symbol.declaredClass:null)+"): "+e.message:e.message=n+"(null): "+e.message,this.inherited(arguments)},_rendererLimits:function(){var e,t,n;if(T?(e=1e5,t=-1e5,n=1e5):f("chrome")&&f("chrome")<6&&(e=8150,t=-1e4,n=1e4),e){var i,r;return i=[-e,-e,e,e],r=[[[-e,-e],[e,-e]],[[e,-e],[e,e]],[[e,e],[-e,e]],[[-e,e],[-e,-e]]],{clipLimit:e,rangeMin:t,rangeMax:n,clipBBox:i,clipSegments:r}}}(),_clipPolyline:function(e,t){var n=this._getCorners(e,t),r=n.tl,s=n.br,a=this._rendererLimits,o=a.rangeMin,h=a.rangeMax,c=a.clipBBox,l=a.clipSegments,_=this._isPointWithinRange,u=this._isPointWithinBBox,d=this._getClipperIntersection,p=this._getPlaneIndex;if(!_(r,o,h)||!_(s,o,h)){T&&this._createSegments(e);var f=[];i.forEach(e.segments,function(e){var t,n=e.args,i=n.length,r=[];for(t=0;i>t;t+=2){var s=[n[t],n[t+1]],a=[n[t+2],n[t+3]],o=u(s,c),h=u(a,c);if(o^h){var _=d([s,a],l);_&&(o?(t?r.push(_[1]):r.push(s,_[1]),f.push(r),r=[]):r.push(_[1],a))}else if(o)t?r.push(a):r.push(s,a);else{var g=p(s,c),m=p(a,c);if(-1===g||-1===m||g===m)continue;var v=d([s,a],l,!0);if(v.length>0){v[g]||(g=v[g[0]]?g[0]:g[1]),v[m]||(m=v[m[0]]?m[0]:m[1]);var y=v[g],S=v[m];y&&r.push(y),S&&(r.push(S),f.push(r),r=[])}}}f.push(r)}),e.setShape(this._getPathStringFromPaths(f))}},_clipPolygon:function(e,t){var r=this._getCorners(e,t),s=r.tl,a=r.br,o=this._rendererLimits,h=o.clipLimit,c=o.rangeMin,l=o.rangeMax,_=o.clipBBox,u=o.clipSegments,d=this._isPointWithinRange,p=this._isPointWithinBBox,f=this._getClipperIntersection,g=this._getPlaneIndex,m=w._pointLineDistance;if(!d(s,c,l)||!d(a,c,l)){T&&this._createSegments(e);var v=i.filter(e.segments,function(e){return e.args&&e.args.length}),y=i.map(v,function(e){var t,r=e.args,s=r.length,a=[],o=[];for(t=0;s>t;t+=2){var c=[r[t],r[t+1]],l=[r[t+2],r[t+3]];if(t===s-2){a.push(c);break}var d,v=p(c,_),y=p(l,_);if(a.push(c),v^y){if(d=f([c,l],u)){var S=d[1];S[v?"inOut":"outIn"]=!0,a.push(S),o.push([v?"INOUT":"OUTIN",a.length-1,d[0]])}}else if(!v){var x=g(c,_),b=g(l,_);if(-1===x||-1===b||x===b)continue;if(d=f([c,l],u,!0),d.length>0){d[x]||(x=d[x[0]]?x[0]:x[1]),d[b]||(b=d[b[0]]?b[0]:b[1]);var M=d[x],w=d[b];M&&(M.outIn=!0,a.push(M),o.push(["OUTIN",a.length-1,x])),w&&(w.inOut=!0,a.push(w),o.push(["INOUT",a.length-1,b]))}else if(n.isArray(x)&&n.isArray(b)){var E=x.concat(b);if(E.sort(),"0123"===E.join("")){var P=[];x[0]+x[1]===3?P.push([h,-h],[-h,h]):P.push([-h,-h],[h,h]);var k=m(P[0],[c,l]),C=m(P[1],[c,l]);a.push(C>k?P[0]:P[1])}}}}var I=_[0],G=_[1],T=_[2],R=_[3];i.forEach(a,function(e){e[0]<I&&(e[1]>=G&&e[1]<=R?e[0]=I:(e[0]=I,e[1]=e[1]<G?G:R))}),i.forEach(a,function(e){e[1]<G&&(e[0]>=I&&e[0]<=T?e[1]=G:(e[1]=G,e[0]=e[0]<I?I:T))}),i.forEach(a,function(e){e[0]>T&&(e[1]>=G&&e[1]<=R?e[0]=T:(e[0]=T,e[1]=e[1]<G?G:R))}),i.forEach(a,function(e){e[1]>R&&(e[0]>=I&&e[0]<=T?e[1]=R:(e[1]=R,e[0]=e[0]<I?I:T))});var H,L,O=0;if(s=o.length,s>0)do{if(H=o[O],L=o[(O+1)%s],H[2]===L[2]&&"INOUT"===H[0]&&"OUTIN"===L[0]){var D,F=H[1],A=L[1];if(A>F)for(D=F+1;A>D;D++)a[D][2]=!0;else if(F>A){for(D=F+1;D<a.length;D++)a[D][2]=!0;for(D=0;A>D;D++)a[D][2]=!0}}O=(O+1)%s}while(0!==O);var N,V=a[0],j=a[a.length-1];for(V[2]&&(j[2]=!0,i.some(o,function(e){return 1===e[1]?(a.splice(a.length-1,0,n.clone(a[1])),!0):!1})),a=i.filter(a,function(e){return e[2]?!1:!0}),O=0;O<a.length-1;O++)N=a[O],L=a[O+1],L&&N[0]===L[0]&&N[1]===L[1]&&(L.outIn?N.outIn=!0:L.inOut&&(N.inOut=!0),a.splice(O+1,1));var z=Math.abs,B=[];for(O=0;O<a.length-1;O++){H=a[O];var U=H[0],Y=H[1],W=z(U)===h,q=z(Y)===h;L=a[O+1];var X=L[0],Z=L[1],Q=z(X)===h,J=z(Z)===h;W&&J?B.push([O+1,[U,Z]]):q&&Q&&B.push([O+1,[X,Y]])}for(O=B.length-1;O>=0;O--){var $=B[O],K=a[$[0]-1];N=a[$[0]],K.outIn||K.inOut||N.outIn||N.inOut||a.splice($[0],0,$[1])}return V=a[0],j=a[a.length-1],(V[0]!==j[0]||V[1]!==j[1])&&a.push(V),a});e.setShape(this._getPathStringFromPaths(y))}},_getCorners:function(e,t){if(T){var n=this._map,i=t.getExtent(),r=i.spatialReference,s=n.toScreen(new x(i.xmin,i.ymax,r)),a=n.toScreen(new x(i.xmax,i.ymin,r));return{tl:s,br:a}}var o=e.getTransformedBoundingBox();return{tl:o[0],br:o[2]}},_createSegments:function(e){e.shape.path=e.vmlPath,e.segmented=!1,e._confirmSegmented();var t=e.segments;t.length>1&&(e.segments=i.filter(t,function(e,t,n){var i=n[t+1];return"M"===e.action&&i&&"L"===i.action?(e.args=e.args.concat(i.args),!0):!1}))},_getPathStringFromPaths:function(e){return T?(e=i.map(e,function(e){var t=i.map(e,function(e,t){return(1===t?"l ":"")+e.join(",")});return"m "+t.join(" ")}),e.push("e")):e=i.map(e,function(e){var t=i.map(e,function(e){return e.join(",")});return"M "+t.join(" ")}),e.join(" ")},_isPointWithinBBox:function(e,t){var n=t[0],i=t[1],r=t[2],s=t[3],a=e[0],o=e[1];return a>n&&r>a&&o>i&&s>o?!0:!1},_isPointWithinRange:function(e,t,n){var i=e.x,r=e.y;return t>i||t>r||i>n||r>n?!1:!0},_getClipperIntersection:function(e,t,n){var i,r=w._getLineIntersection2,s=Math.round,a={length:0};for(i=0;4>i;i++){var o=r(e,t[i]);if(o){if(o[0]=s(o[0]),o[1]=s(o[1]),!n)return[i,o];a[i]=o,a.length++}}return n?a:null},_getPlaneIndex:function(e,t){var n=e[0],i=e[1],r=t[0],s=t[1],a=t[2],o=t[3];return r>=n?i>=s&&o>=i?3:s>i?[0,3]:[2,3]:s>=i?n>=r&&a>=n?0:r>n?[3,0]:[1,0]:n>=a?i>=s&&o>=i?1:s>i?[0,1]:[2,1]:i>=o?n>=r&&a>=n?2:r>n?[3,2]:[1,2]:-1},onGraphicAdd:function(){},onGraphicRemove:function(){},onGraphicNodeAdd:function(){},onGraphicNodeRemove:function(){},onGraphicDraw:function(){},onGraphicsClear:function(){},onRendererChange:function(){},onOpacityChange:function(){},onInfoTemplateChange:function(){},setInfoTemplate:function(e){this.infoTemplate=e,this.onInfoTemplateChange()},add:function(e,t){return e._graphicsLayer===this?e:(e._suspended=this._suspendGraphics,t||this.graphics.push(e),e._graphicsLayer=this,e._sourceLayer||(e._layer&&"esri.layers.GraphicsLayer"!==e._layer.declaredClass?e._sourceLayer=e._layer:"esri.layers.GraphicsLayer"!==this.declaredClass&&(e._sourceLayer=this)),e._layer=this,this._updateExtent(e),this._draw(e),t||this.onGraphicAdd(e),e)},remove:function(e,t,n){if(!t&&!n){var r,s=this.graphics;if(-1===(r=i.indexOf(s,e)))return null;e=s.splice(r,1)[0]}return e.getDojoShape()&&this._removeShape(e,null,n),e._shape=e._graphicsLayer=null,this.onGraphicRemove(e),e},clear:function(){var e,t=arguments[1],n=this.graphics,i=n.length,r=!T;for(e=i-1;e>=0;e--)this.remove(n[e],null,r);this.graphics=[],this._destroyAllNodes(),t||this.onGraphicsClear()},_destroyAllNodes:function(){var e=!T;if(e&&this._div){var t;this._childLayer&&(t=this._childLayer.getNode(),t&&t.parentNode&&t.parentNode.removeChild(t)),this._bgGroup.clear(),this._div.clear(),this._bgGroup=this._div.createGroup(),t&&this._div.getEventSource().appendChild(t),this._initOpacity()}},clearNodes:function(){var e,t=this.graphics,n=t.length;for(e=0;n>e;e++)this._removeShape(t[e],!0,!0);this._destroyAllNodes()},_setIEOpacity:function(e,t){var n=e&&e.getNode();if(n){var i=e.strokeStyle,r=n.stroke;i&&r&&(r.opacity=i.color.a*t);var s=e.fillStyle,a=n.fill;s&&a&&("tile"===a.type?o.set(n,"opacity",t):a.opacity=s.a*t)}},setOpacity:function(e,t){if(t||this.opacity!=e){var n=this._div;n&&(T?(i.forEach(this.graphics,function(t){this._setIEOpacity(t._shape,e),this._setIEOpacity(t._bgShape,e);
},this),n._esriIeOpacity=e,this._bgGroup._esriIeOpacity=e):this._canvas?o.set(n.getEventSource(),"opacity",e):n.getEventSource().setAttribute("opacity",e)),this.opacity=e,t||this.onOpacityChange(e)}},setRenderer:function(e){this.renderer=e,this._evalSDRenderer(!0),this.emit("renderer-change",{renderer:this._rndForScale||e})}});var F=e([k,P],{declaredClass:"esri.layers.GraphicsLayer",constructor:function(){this.enableMouseEvents=n.hitch(this,this.enableMouseEvents),this.disableMouseEvents=n.hitch(this,this.disableMouseEvents),this._processEvent=n.hitch(this,this._processEvent),this._initLayer()},_initLayer:function(){this.loaded=!0,this.onLoad(this)},_setMap:function(){var e=this.inherited("_setMap",arguments);return this.enableMouseEvents(),e},_unsetMap:function(){this.disableMouseEvents(),this.inherited("_unsetMap",arguments)},_processEvent:function(e){var t,n=this._map,i=e.target;for(e.screenPoint=new b(e.pageX-n.position.x,e.pageY-n.position.y),e.mapPoint=n.toMap(e.screenPoint);i&&!(t=i.e_graphic);)i=i.parentNode;return t?(e.graphic=t,e):void 0},_onMouseOverHandler:function(e){this._processEvent(e)&&this.onMouseOver(e)},_onMouseMoveHandler:function(e){this._processEvent(e)&&this.onMouseMove(e)},_onMouseDragHandler:function(e){this._processEvent(e)&&this.onMouseDrag(e)},_onMouseOutHandler:function(e){this._processEvent(e)&&this.onMouseOut(e)},_onMouseDownHandler:function(e){this._downGr=this._downPt=null,this._processEvent(e)&&(t.disconnect(this._onmousemove_connect),t.disconnect(this._onmousedrag_connect),this._onmousedrag_connect=t.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseDragHandler"),this._downGr=e.graphic,this._downPt=e.screenPoint.x+","+e.screenPoint.y,this.onMouseDown(e))},_onMouseUpHandler:function(e){this._upGr=this._upPt=null,this._processEvent(e)&&(t.disconnect(this._onmousedrag_connect),t.disconnect(this._onmousemove_connect),this._onmousemove_connect=t.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseMoveHandler"),this._upGr=e.graphic,this._upPt=e.screenPoint.x+","+e.screenPoint.y,this.onMouseUp(e))},_onClickHandler:function(e){if(this._processEvent(e)){var t=this._downGr,n=this._upGr;t&&n&&t===n&&this._downPt===this._upPt&&(T&&(d._ieGraphic=e.graphic),this.onClick(e))}},_onDblClickHandler:function(e){this._processEvent(e)&&this.onDblClick(e)},onMouseOver:function(){},onMouseMove:function(){},onMouseDrag:function(){},onMouseOut:function(){},onMouseDown:function(){},onMouseUp:function(){},onClick:function(){},onDblClick:function(){},enableMouseEvents:function(){if(!this._mouseEvents){var e=t.connect,n=this._div.getEventSource();I||(this._onmouseover_connect=e(n,"onmouseover",this,"_onMouseOverHandler"),this._onmousemove_connect=e(n,"onmousemove",this,"_onMouseMoveHandler"),this._onmouseout_connect=e(n,"onmouseout",this,"_onMouseOutHandler"),this._onmousedown_connect=e(n,"onmousedown",this,"_onMouseDownHandler"),this._onmouseup_connect=e(n,"onmouseup",this,"_onMouseUpHandler"),this._onclick_connect=e(n,"onclick",this,"_onClickHandler"),this._ondblclick_connect=e(n,"ondblclick",this,"_onDblClickHandler")),this._mouseEvents=!0}},disableMouseEvents:function(){if(this._mouseEvents){var e=t.disconnect;e(this._onmouseover_connect),e(this._onmousemove_connect),e(this._onmousedrag_connect),e(this._onmouseout_connect),e(this._onmousedown_connect),e(this._onmouseup_connect),e(this._onclick_connect),e(this._ondblclick_connect),this._mouseEvents=!1}}});return F._GraphicsContainer=D,F._GraphicsLayer=k,f("extend-esri")&&(n.setObject("layers.GraphicsLayer",F,d),n.setObject("layers._GraphicsContainer",D,d),n.setObject("layers._GraphicsLayer",k,d)),F});