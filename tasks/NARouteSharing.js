// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.22/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/_base/array","dojo/json","dojo/Deferred","dojo/promise/all","dojo/_base/lang","dojo/i18n!../nls/jsapi","dojo/number","../request","../graphic","../renderers/SimpleRenderer","../renderers/UniqueValueRenderer","../symbols/PictureMarkerSymbol","../symbols/SimpleMarkerSymbol","../symbols/SimpleLineSymbol","../arcgis/Portal","../tasks/RouteParameters","../tasks/RouteResult","../SpatialReference","../tasks/FeatureSet","../tasks/GeometryService","../tasks/ProjectParameters","../geometry/webMercatorUtils"],function(e,t,i,r,s,a,n,o,l,d,u,c,p,f,m,b,h,T,g,y,v,A,S){var D=e(null,{declaredClass:"esri.tasks.NARouteSharing",portal:null,outSR:null,firstStopSymbol:{angle:0,xoffset:0,yoffset:9,type:"esriPMS",width:17,height:24,imageData:"iVBORw0KGgoAAAANSUhEUgAAABYAAAAgCAYAAAAWl4iLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAADLElEQVRIS42WP2vbQBjG/VUyatR4640aNWormoroEEyGYryYksEYDyZ4MMGDIR4MzhBwhkCngDsE3KGQDh3yMTJen+c9nXQ6ndMKHlt+7/TTe++fOw+MMWd1/Hk0s/sbU62GpliUJp8Wck/b4eU7psSfo6LG/fNBIPo6M+lUGbXQRm8yUYr79FphTJvsOjecGz5P9Qz0SE0AWmcmfygaZdQ9lRu9o/CSJV4yVqZaVni0y+n8qFYVvIEnO8AesXRfD2UD1zVcEb7WJpmkEiqf1ULxVjUFlB56wMK7pyy8Bast4BvAER7fc/m4e7qTJfEBWXoNLJ6qVg7e8boGbxGStRLG7eOtwAXMJCjE1HnrQ0soW2Mcq1EIk17ZeY3XACuC6fUSiR5rC6a3EgLf2ycLznelSa8w+Uqb0WYk4n1yiapglTThsOB0oyTe9NrGFtnl8lowl16Z5EuKmp3Rg85FG8f0thtnAc9tIgd6jAGGIQDreWaKuWQ6enGM9dwDr2w4BvxgIkIwQ3B4keKPXhxLLtMeWPRVAcxmQKxCMJd6enutMf2LY8lnB25jTDHJA9ItGPKSR/v+eV9j+hfHJLERMMvOxhhLkXDUYEovEPdJXmP6l55g+dxHGAa/KlDPEmOp4VU/zhS9ZtW8v7/XOCP3tNHbpkEEWoNRyxleOpjtZiadB+FwcHynyMHFp0S8p3jPpWoAY4lLpqnUu3QeE9iEI4RDGet1CYjbPjHHedtpjrqtuVcLeLT9JpsIvfbhPREo0LAxLPgCXTdcjxixdnfLpnWsfbjIAn1o1NuFTdrrHynRFnz8fZRMswvtwzWoA6QctPXWdZt/XDVgqoXTc+8FDvifUKoDpghnCfLYEVAAbJcPKJZPR2IHa+eHrxwxF7gPDKFornOndc/gdHo72VMaCXWwBsrlo0TPQamo0Wn/4yBbYwtta/Xcse8UNfoql6Vs3oSKsD8M8RchnBcqavTFZLKtnbcMz/HXCUPx+U5RYygeNUwWPWeXhuMxRY2hbnY3dovEocsVhOMxRY2h2KaaG5XXsv9S1BhTiT04/Bv1kaLGmFhet/gPEtrjMoO/bgAlOuupzJ0AAAAASUVORK5CYII=",contentType:"image/png"},interimStopSymbol:{angle:0,xoffset:0,yoffset:9,type:"esriPMS",width:17,height:24,imageData:"iVBORw0KGgoAAAANSUhEUgAAABYAAAAgCAYAAAAWl4iLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAC4klEQVRIS5WWMYujQBiG/RnbprS0tE2ZMmVaS6slpBCxEbEIYYsQtljCFQemWLA5yBYHXnPgFgfZ4sAtDrLl/ozv3m/G0RkzXnLFs5t8jk9eP2dGHSIapX6rafO8o/Apo8XDkubrgMLHTNSOvyoMsZ/HXBTOH2cqf5Y0zwOaJiG5UUZeuid/XZEH3GRP7iojH8dmaYCxR5xmOhjjS/PeIFFMfhSQn5c0fTwb+FuJ98A05KYleauAApyje5he+ueMAUvyopim25MQzZ56bHJ33dAkr2myitGqEBqLONhCmmQXwiFK3qUWcoD26MnFn/1LIS7J3zadeP5F8dl91sVS3ovv0hN6H9L+ZS/kaEEjboKXH420UvhJi6/yP6OO6am7xCxPjrg/CykuviMtWsADzbRSqpByu9hV4pRbEovUDvfFTYsLMcsC5qDLL8Uei7t2gKigYBuTw9G9vBqIpYilCpX6qjiBC07HX0GMAbeJb0gM3HuIvSi0iGUrlFx9Hu3xQOxFS4itifvUvXRczFIzcdD2eH0yxLq8p5Ua4j7tpJXyfOb2OjyH3RTzDwPtcomqKanP/TUWSAvm8iwPyckOO+xge6MdulxHHGsDjPX3brWjDNuqU73y9MDKwwBOocv5sjthiy1tLz7hxgVUv9dyw+CtkjcRlVrI9R9g2jozmvY+pviwkUua/zDTRPZal9vg49a0UYnNPxBSQ1z9rkVLXOyv8mSI1I+033WpkVasNtmCCzFTd3JOjok+pBUaaS1SxhAzLJ8mCzzbik4ypJPi8qeYrkMpY3zR4fk9wTPNJrwmZS4KitMHVhAucZJWplD1FDdqTMpYi4rj6xGPm6W2XBmeqyFVb//5XjGEH7K8eSvxBKtUzdV/YS3q8OVyQpWW+zocY8NaHCJTl9gHbkvLWItDCrxyudFGPHR5IQ2P27AWbfAs0JfsNaxFG+ETXqPQkmF9DGvRRvmjpN03+ZZzHXL+Atsof8D3QNX7AAAAAElFTkSuQmCC",contentType:"image/png"},lastStopSymbol:{angle:0,xoffset:0,yoffset:9,type:"esriPMS",width:17,height:24,imageData:"iVBORw0KGgoAAAANSUhEUgAAABYAAAAgCAYAAAAWl4iLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAADBklEQVRIS62WsWvbQBTG9Sdk9OrRWwwZbMhiQwYbPNiQwYYMJmQIxYOHDiFr6djJo+lQULfLUFCHgrIU1KFwHQoetebPeP2+J519ks9uSBL4YutJ99O77969cyQiB2W/G0k/fZBkeS1mPpF42sf3mcY2PxI8Eh5HBYP5YyJmOpR40BZz3pCk15Rs0JLsoikJrs3ZicS9lsTjrtgHgyH7jL2AWVzrIII20y7Uls1lqTFio5bYQVMsXpZ2TmTdaYq5nWFolVO5SBYzMRhgCbsC1Jd7AeCWcGRvew3JAI8xgzp8+8UQeoGMCJn3Jadu+vp9M6/BXdaEwxoLuDmDRR5c/9mva0y/WUy9BOa31LD4dC9w8HG7kjXBmnkHM/i8UriC48u+ZHhwBx1KisFbjaiWpPA9way4mMk5BJADUyksWeO+gpmt4UIhGwfNF0NZnTa0vI6Jz3ARnR2FJcgeWau3zIQ+KhjQfDmRFTx7+mv59uDf0++sAHs+UwkX8mYCG1CrGaarNjDbJfT+5eCstCNao2bVhi14Ivnd7MVgirUdxWWJbf19AzArbJfxG4KLjOGxZdH7VrzGY4gu7NfwK6uCtWzAjNgCU9wM1XH68f6oQuDkFHDci3K8mXZUt/MQfQNdC1PSTyyGCruNbdRgx8WYUQxIsfMKMG1Y45nsIS672t07HcSsffhWuGZc75e9QhsRs/W2tMGLyCJTwfkfK/GoW3jtw0vtoJBrnbXu5vpEXqzLrm3mj6laYpkNIfqC8rMGrWQLMHcbDwf/uNqCqfxXAdfM9fRwAlChEKFetiEoVQFTNJ62aGMizMk/lspsOX1d+MDBWrlw0kphfQPggEEo+vSh03ov4LT5WdpCEIEeNGO5sccc+QkQDDrpIcBGrsASCl9jlKb9Fj72nYJBX2aOY4obgGUF8ThytXpMwaAvTlczLHcW7eEa1J+rKxisy1whaywWj53nZEsFg3XxcNQ+AZ+PLZivYDAkVoE72p+jYDAk/aUES+rxQwoGQ2J5ZV+KXzn/l0T/AJfvVAR5fRz8AAAAAElFTkSuQmCC",contentType:"image/png"},unlocatedStopSymbol:{angle:0,xoffset:0,yoffset:9,type:"esriPMS",width:17,height:24,imageData:"iVBORw0KGgoAAAANSUhEUgAAABYAAAAgCAYAAAAWl4iLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAACiUlEQVRIS42VMWvcQBCF77+a/IDgKhxuwuEiCBfhSBGOFIFLEZCLwKUI2E3AKQJOEbgUgUuRwj9jM9+TZhmtxoqLZ+tmd799ejuSVqWURe3f78v2zbZ0r7qyuex0Te3w6WDD+RqUFvvrgyDAtq+3Zfd2V/Yf9gLWTV5uJOa269GsAGhzuRHo5suNdPh8GGQu++u+9B97jbPJ+mKtzVvO5AcTuqtOkJtbg0b5Bg2cu8E5dxFZEygCcvf1bqYM7vHs3u1qbBMwu3P7LBToW6IIj65HMFpfEGEvuMBAmeTQ++/3M1X46HoSxwj2zAVmMEYg0I9BWmAZch1dcw6ojQMNB98P2TIQ3R5/HjXp7NmZJPjomvleB96CGe+uthaDejHEYO4AH38Z3IARHn9zWFnOHofAbQxAT79P5fTnNIFV6NiSGRitXwCmGwLY3QJ9+PugDdjcoSyaHWADZv6KFllyTIbRLeJ2Fx17FEyagM01YBY5TJ1guUb4MtheNgzWwxvjiE6BUmec6CrcOqAFsyFz9FqkoDhGsPcteQpqvwW2zZnHwvPn50OrNe3GfA68PnnxcRbcBMSvqQs8HhxAubX/DkXEwPjwAjL78ekTZNzAr93t0rsCg7D0SPNncD1kXeGNKtTcZG83jPl7YgJmATuyQJBWDTTGoAMbu2sGRhWOcwNFOVTgEYrbDIomYCS4TWSRYC6HBrfcfgZFkx9RZC54BD4RimaFKGIB4kCH0qdLUJQWXYA8c2UKlLYy6GOffVdajNJH0g6IWBBPlvfqktJiFLeLw/oQ2HU7J1NabOWf9qe6RWmxFR9H4GjpwKLSYiYiiI/s/5QWMykKc9zWH1NazER70XZtPVdZ/QN2IySZrUmdSgAAAABJRU5ErkJggg==",contentType:"image/png"},waypointSymbol:{color:[255,255,255,255],size:10,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[20,89,127,255],width:2.5,type:"esriSLS",style:"esriSLSSolid"}},directionSymbol:{color:[0,122,194,255],width:6,type:"esriSLS",style:"esriSLSSolid"},directionPointSymbol:{color:[100,100,255,255],size:12,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:2,type:"esriSLS",style:"esriSLSSolid"}},directionEventSymbol:{color:[100,255,100,255],size:8,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,69,0,255],width:1,type:"esriSLS",style:"esriSLSSolid"}},directionLineSymbol:{color:[0,122,194,255],width:6,type:"esriSLS",style:"esriSLSSolid"},routeSymbol:{color:[20,89,127,255],width:8,type:"esriSLS",style:"esriSLSSolid"},barrierRenderer:new c({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{type:"esriPMS",imageData:"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAByklEQVRIS7WVPU4DMRCF9yhwjEg05BiRKFBOgSIalCOkilYUSDkCDVJokHKE0CUFRY5h5hvbg71MYDeBJ739GXt+/MbebUIIP3L7vg2zu1lol22Y3EyM7XIR1i/PMsX3y3SNEOfx9TisnlZht9+JqQa2zdsmtI+tFiBw43wzUDHVrl/X8toBiY4kG12NAr6CKl71kquucC/VYWNq5sVltDGWcPg4uKuxB4i2BirtBvZIsmK1JCl7oxdIcNMah26g35hWQ4xUqBh1JEpjmpOk69yXKQZJslRi7UjTR5ZjRK6ELJVYQ8OLgrvnOIS3Uw3FFtYEHBjTnkHPaQjTKthVyNQkrSIYLCYNQi6u8J1J4xsuhk4Vg1CuPjWb3n41uNw95yZIkk/FVkuUd9C5CRJUouoMlJNOJUUmaJP1c5z78MfblB0qlv85aPOHuX5dxRplssMm+9d17sMkNZJXnwrIP8AO3ClS5QIFSXIx6kh8YDmVVCQ74XNNcBQRyKDOiA8wJ7GVcJdfpjaOQGVQkpeHVEBwGiuwmPaQuZMkyGU7qwT9cUBBvX6ZJVmmViTaev9ngmozZU5uqEfXmElFcUWLGEiIhJCgpdY+Q/MJtbNzCJoj+q0AAAAASUVORK5CYII=",contentType:"image/png",width:18,height:18},uniqueValueInfos:[{value:"2",symbol:{type:"esriPMS",imageData:"iVBORw0KGgoAAAANSUhEUgAAABkAAAAYCAYAAAAPtVbGAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAABuklEQVRIS7WVsUrEQBCGfQwLC30MwUbLA19AsBArCb6EHBZHHuGwOEgj5BFyzUF8Ay2Es7C4B7CwsBjnn80su5vJmogufMnsn81k/91JskdEo9m+PvPJvpbDFIeY38+puCk47F/LYYoW1WpJ7VNLu/cd4WHp9RymaFHcigNpXWyOszDFFHVB64boYSlupiybKaaUi5JP3E7PiA6PJIQ2thBMMcS7YAcyHEx0Y4ohkQt9yMG+SLjWYAmD8RamqKCKMGNaVdxjKWSCG1NUfEVhH+64bL84Bog7N+2m/dGNKQLMMHLhErmGGNrVtYyZnc+gRveHmCKIXGAYNl6bFkFXafVjlXVjit06xxWVLpfqnZvc3vQE1L6vKE0ELi+IPj4diFXH3rxt2U096KYndOsbz1Z54ZcPpLq6GfjcRB3MBOsrLU0EMFPd9BC4kXttN1HHu+CZ9RIB7FG4TyEZNz5wLmoO0WNpKqg0zoFPED5FyKL4wFfUkIuh6go5OZYUqRs54Mnigqukd6Pi1to1xNYYYLiRQ7ngmaGFH8GUMU6A4Sb+IVk3/QbOFb6g0W/1r5u6kbJF5z9A7mbd0Deb57AijFvMOAAAAABJRU5ErkJggg==",contentType:"image/png",width:19,height:18}}]}),polylineBarrierRenderer:new c({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,85,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"}}]}),polygonBarrierRenderer:new c({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,156],outline:{color:[255,0,0,153],width:2.4,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,170,0,156],outline:{color:[255,0,0,153],width:7.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]}),_geometryService:null,_jsonStringFieldSize:1048576,constructor:function(e,t){e&&(this.portal=new b.Portal(e),this._outSR=t)},getFolders:function(){return this.portal?this.portal.signIn().then(a.hitch(this,function(){return this.portal.getPortalUser().getFolders()},!1)).then(a.hitch(this,function(e){var t=this.portal.getPortalUser(),i=e||[];return i.splice(0,0,{created:t.created,portal:this.portal,title:t.username+" ("+n.networkAnalysis.sharing.rootFolder+")",url:t.userContentUrl}),i})):[]},canCreateItem:function(){var e=new r;return this.portal?this.portal.signIn().then(a.hitch(this,function(){e.resolve((this.portal.getPortalUser().privileges||[]).indexOf("portal:user:createItem")>-1)}),e.reject):e.reject(new Error("No URL to a Portal instance or ArcGIS Online was specified at construction time.")),e.promise},toMinutes:function(e,t,i){switch(e=e||0,t){case"esriNAUSeconds":e/=Math.pow(60,i?-1:1);break;case"esriNAUHours":e*=Math.pow(60,i?-1:1);break;case"esriNAUDays":e*=Math.pow(1440,i?-1:1)}return e},fromMinutes:function(e,t){return this.toMinutes(e,t,!0)},toMeters:function(e,t,i){switch(e=e||0,(t||"").replace("esriNAU","esri")){case"esriInches":e*=Math.pow(.0254,i?-1:1);break;case"esriFeet":e*=Math.pow(.3048,i?-1:1);break;case"esriYards":e*=Math.pow(.9144,i?-1:1);break;case"esriMiles":e*=Math.pow(1609.344,i?-1:1);break;case"esriNauticalMiles":e*=Math.pow(1851.995396854,i?-1:1);break;case"esriMillimeters":e/=Math.pow(1e3,i?-1:1);break;case"esriCentimeters":e/=Math.pow(100,i?-1:1);break;case"esriKilometers":e*=Math.pow(1e3,i?-1:1);break;case"esriDecimeters":e/=Math.pow(10,i?-1:1)}return e},fromMeters:function(e,t){return this.toMeters(e,t,!0)},toGeolocalTime:function(e,t){return void 0===e||null===e?void 0:e+60*(t||0)*1e3},toUTCTime:function(e,t){return-22091616e5===e&&(e=void 0),null!==t&&void 0!==t?e-60*t*1e3:e},getUTCOffset:function(e,t){return null!==t&&void 0!==t&&t>0?(e-t)/60/1e3:void 0},getAttributeUnits:function(e,t){for(var i,r=t.networkDataset.networkAttributes,s=0;s<r.length;s++)if(r[s].name===e&&"esriNAUTCost"===r[s].usageType){i=r[s].units;break}return i},addAttributePrefix:function(e,t){var i={};for(var r in e)e.hasOwnProperty(r)&&(i[t+r]=e[r]);return i},project:function(e,i,n){var o=new r;if(e&&e.length&&i&&n&&i.wkid!==n.wkid){var l=i instanceof g?i:new g(i),u=n instanceof g?n:new g(n);if(S.canProject(l,u))t.forEach(e,function(t,i){t.geometry&&(t.geometry.spatialReference||(t.geometry.spatialReference=l.toJson()),t=new d(t),t.setGeometry(S.project(t.geometry,u)),e[i]=t.toJson())}),o.resolve(e);else if(!this._geometryService&&this.portal&&this.portal.helperServices.geometry&&(this._geometryService=new v(this.portal.helperServices.geometry.url)),this._geometryService){var c=a.hitch(this,function(t,i){var s=new A,n=new r;return s.outSR=u,s.geometries=[t.geometry],this._geometryService.project(s).then(a.hitch(this,function(r){t.setGeometry(r[0]),e[i]=t.toJson(),n.resolve()}),n.reject),n.promise}),p=[];t.forEach(e,a.hitch(this,function(e,t){e.geometry&&(e.geometry.spatialReference||(e.geometry.spatialReference=l.toJson()),p.push(c(new d(e),t)))})),s(p).then(o.resolve,o.reject)}else o.resolve(e)}else o.resolve(e);return o.promise},load:function(e,t){var o=new r,d=t,u=a.hitch(this,this.fromMeters),c=a.hitch(this,this.fromMinutes),p=a.hitch(this,this.addAttributePrefix);return this.portal?this.portal.signIn().then(a.hitch(this,function(){var t=this.portal.getPortalUser(),r=t.userContentUrl.replace(/\/users\/.+\/?$/,"/items/");l({url:r+e,content:{f:"json"},callbackParamName:"callback"}).then(a.hitch(this,function(f){l({url:r+e+"/data",content:{f:"json"},callbackParamName:"callback"}).then(a.hitch(this,function(e){var r=function(t){for(var i=0;i<e.layers.length;i++)if(e.layers[i].layerDefinition.name===t)return e.layers[i]},l=r("Directions"),m=l&&l.featureSet.features||[],b=r("DirectionEvents"),v=b&&b.featureSet.features||[],A=r("DirectionPoints"),S=A&&A.featureSet.features||[],D=r("DirectionLines"),M=D&&D.featureSet.features||[],E=r("Stops"),L=E&&E.featureSet.features||[],O=r("PolygonBarriers"),F=O&&O.featureSet.features||[],N=r("PolylineBarriers"),x=N&&N.featureSet.features||[],C=r("Barriers"),I=C&&C.featureSet.features||[],w=r("RouteInfo"),R=w&&w.featureSet.features,P=L&&L.length?E.featureSet.spatialReference||L[0].geometry.spatialReference:null,_=this._outSR?this._outSR:P,B=[this.project(m,P,this._outSR),this.project(v,P,this._outSR),this.project(S,P,this._outSR),this.project(M,P,this._outSR),this.project(L,P,this._outSR),this.project(F,P,this._outSR),this.project(x,P,this._outSR),this.project(I,P,this._outSR),this.project(R,P,this._outSR)],U=w&&w.layerDefinition&&[{geometry:w.layerDefinition.extent}];U&&B.push(this.project(U,P,this._outSR)),s(B).then(a.hitch(this,function(){R=R&&R[0],U=U&&U[0].geometry;var e=R&&R.attributes,r=e?i.parse(e.AnalysisSettings):void 0,s=r?r.travelMode.timeAttributeName:void 0,b=r?r.travelMode.distanceAttributeName:void 0,D=this.getAttributeUnits(s,d),O=this.getAttributeUnits(b,d),N=d.directionsLengthUnits,C=e?e.Messages:void 0,w=[],P=(l||A)&&e?{directions:{routeId:1,routeName:e.RouteName,summary:{totalLength:this.fromMeters(e.TotalMeters,N),totalTime:this.fromMinutes(e.TotalMinutes,D),totalDriveTime:this.fromMinutes(e.TotalMinutes-e.TotalWaitMinutes,D),envelope:U},spatialReference:_,geometryType:"esriGeometryPolyline",features:a.hitch(this,function(){var t,i,r=(e.Version||"0.0.0").split(".");if("0"===r[0])return this._loadDirectionsFeatureSet(m,v,N,D,_);if("1"===r[0]){for(t=0;t<S.length;t++)if(void 0!==S[t].attributes.StopID)for(i=0;i<L.length;i++)if(L[i].attributes[E.layerDefinition.objectIdField||"__OBJECTID"]==S[t].attributes.StopID){S[t].attributes.StopSequence=L[i].attributes.Sequence;break}for(t=0;t<M.length;t++)if(void 0!==M[t].attributes.DirectionPointID)for(i=0;i<S.length;i++)if(S[i].attributes[A.layerDefinition.objectIdField||"__OBJECTID"]==M[t].attributes.DirectionPointID){M[t].attributes.DirectionSequence=S[i].attributes.Sequence;break}for(t=0;t<M.length-1;){for(i=t+1;i<M.length;)M[t].attributes.DirectionPointID===M[i].attributes.DirectionPointID&&(M[t].geometry&&M[t].geometry.paths[0]?M[t].geometry.paths[0]=M[t].geometry.paths[0].concat(M[i].geometry.paths[0]||[]):M[t].geometry=M[i].geometry,M[t].attributes.DirectionLineType=this._lineTypeStringToLineTypeCode("esriDLTSegment"),M[t].attributes.Meters+=M[i].attributes.Meters||0,M[t].attributes.Minutes+=M[i].attributes.Minutes||0,M[t].attributes.ToLevel=M[i].attributes.ToLevel||M[t].attributes.ToLevel,M.splice(i,1)),i++;t++}return this._loadDirectionsFeatureSet_100(S,M,L,N,D,_)}o.reject(new Error("Unsupported version of route layer."))})()},stops:a.hitch(this,function(){for(var e=[],t=0;t<L.length;t++){var r=L[t].attributes,n={geometry:L[t].geometry,attributes:{ObjectID:r.__OBJECTID,Name:r.Name,RouteName:null,Sequence:r.Sequence,TimeWindowStart:r.TimeWindowStart,TimeWindowEnd:r.TimeWindowEnd,ArriveCurbApproach:r.ArrivalCurbApproach,DepartCurbApproach:r.DepartureCurbApproach,CurbApproach:r.CurbApproach,Status:r.Status,ArriveTime:this.toGeolocalTime(r.ArrivalTime,r.ArrivalUTCOffset),DepartTime:this.toGeolocalTime(r.DepartureTime,r.DepartureUTCOffset),ArriveTimeUTC:r.ArrivalTime,DepartTimeUTC:r.DepartureTime,isWaypoint:1===r.LocationType}},o=n.attributes;o["Attr_"+s]=this.fromMinutes(r.ServiceMinutes,D),o["Attr_"+b]=this.fromMeters(r.ServiceMeters,O),a.mixin(o,p(i.parse(r.ServiceCosts||"{}"),"Attr_")),o["Cumul_"+s]=this.fromMinutes(r.CumulativeMinutes,D),o["Cumul_"+b]=this.fromMeters(r.CumulativeMeters,O),a.mixin(o,p(i.parse(r.CumulativeCosts||"{}"),"Cumul_")),e.push(n)}return e})(),routeName:e.RouteName,spatialReference:_}:void 0,B=!1,j=E?a.mixin({returnStops:!0,returnDirections:!0,returnRoutes:!1,ignoreInvalidLocations:!0,outputLines:"esriNAOutputLineTrueShape",directionsOutputType:"complete",directionsLengthUnits:N,doNotLocateOnRestrictedElements:!0,outSpatialReference:new g(_),startTime:e&&e.StartTime>0?new Date(e.StartTime):null,startTimeIsUTC:!0,timeWindowsAreUTC:!0,stops:new y(function(){return{spatialReference:_,geometryType:"esriGeometryPoint",features:function(){for(var e=[],t=0;t<L.length;t++){var r=L[t].attributes,n={geometry:L[t].geometry,attributes:{CurbApproach:r.CurbApproach,Name:r.Name,Sequence:r.Sequence,isWaypoint:1===r.LocationType,TimeWindowStart:r.TimeWindowStart,TimeWindowEnd:r.TimeWindowEnd}};n.attributes["Attr_"+s]=c(r.ServiceMinutes,D),n.attributes["Attr_"+b]=u(r.ServiceMeters,O),a.mixin(n.attributes,p(i.parse(r.ServiceCosts||"{}"),"Attr_")),e.push(n),B=B||r.TimeWindowStart>0}return e}()}}()),barriers:new y(function(){return{spatialReference:_,geometryType:"esriGeometryPoint",features:function(){for(var e=[],t=0;t<I.length;t++){var r=I[t].attributes,s={geometry:I[t].geometry,attributes:{CurbApproach:r.CurbApproach,Name:r.Name,FullEdge:r.FullEdge,BarrierType:r.BarrierType}};a.mixin(s.attributes,p(i.parse(r.Costs||r.OtherCosts||"{}"),"Attr_")),e.push(s)}return e}()}}()),polylineBarriers:new y(function(){return{spatialReference:_,geometryType:"esriGeometryPolyline",features:function(){for(var e=[],t=0;t<x.length;t++){var r=x[t].attributes,s={geometry:x[t].geometry,attributes:{Name:r.Name,ScaleFactor:r.ScaleFactor,BarrierType:r.BarrierType}};a.mixin(s.attributes,p(i.parse(r.Costs||r.OtherCosts||"{}"),"Attr_")),e.push(s)}return e}()}}()),polygonBarriers:new y(function(){return{spatialReference:_,geometryType:"esriGeometryPolygon",features:function(){for(var e=[],t=0;t<F.length;t++){var r=F[t].attributes,s={geometry:F[t].geometry,attributes:{Name:r.Name,ScaleFactor:r.ScaleFactor,BarrierType:r.BarrierType}};a.mixin(s.attributes,p(i.parse(r.Costs||r.OtherCosts||"{}"),"Attr_")),e.push(s)}return e}()}}())},r):void 0;a.mixin(j||{},{useTimeWindows:B}),D&&O||w.push({message:n.networkAnalysis.sharing.costAttributeMissing,messageType:"Warning"}),o.resolve({routeParameters:a.mixin(new h,j),solveResult:{barriers:j&&j.barriers&&j.barriers.features||[],polygonBarriers:j&&j.polygonBarriers&&j.polygonBarriers.features||[],polylineBarriers:j&&j.polylineBarriers&&j.polylineBarriers.features||[],messages:i.parse(C||"[]"),routeResults:P?[new T(P)]:void 0},loadMessages:w,isItemOwner:t.username===f.owner,title:f.title,ownerFolder:f.ownerFolder})}),o.reject)}),o.reject)}),o.reject)}),o.reject):o.reject(new Error("No URL to a Portal instance or ArcGIS Online was specified at construction time.")),o.promise},store:function(e,t,i){var s=new r;return e?i||e.directions?"1.0.0"!==i||e.directionPoints&&e.directionLines?e.stops&&e.stops.length?e.extent?e.routeInfo?e.folder?e.name?this.portal?this.portal.signIn().then(a.hitch(this,function(){var r=this._getRouteId();this._addOrUpdateItem(this._populateLayerInfo(r,e,i),e,r,t,i).then(s.resolve,s.reject)}),s.reject):s.reject(new Error("No URL to a Portal instance or ArcGIS Online was specified at construction time.")):s.reject(new Error("Layer name is required.")):s.reject(new Error("Folder Url is required.")):s.reject(new Error("RouteInfo is required.")):s.reject(new Error("Extent is required.")):s.reject(new Error("Stops are required.")):s.reject(new Error("DirectionPoints and DirectionLines are required.")):s.reject(new Error("Directions are required.")):s.reject(new Error("Missing required parameters.")),s.promise},createFeatureCollection:function(e){var t=new r;if(e)if(e.directions&&e.directions&&e.directions.length)if(e.stops&&e.stops.length)if(e.extent)if(e.routeInfo)if(e.name){var i=this._getRouteId();t.resolve({title:e.name,layerInfo:this._populateLayerInfo(i,e)})}else t.reject(new Error("Layer name is required."));else t.reject(new Error("RouteInfo are required."));else t.reject(new Error("Extent is required."));else t.reject(new Error("Stops are required."));else t.reject(new Error("Directions are required."));else t.reject(new Error("Missing required parameters."));return t.promise},_addOrUpdateItem:function(e,t,d,u,c){var p=function(t){for(var i=0;i<e.layers.length;i++)if(e.layers[i].layerDefinition.name===t)return e.layers[i].featureSet.features;return[]};return a.hitch(this,function(){var e=new r;if(t.extent){var i=p("Stops"),n=[{geometry:t.extent}],o=t.extent.spatialReference,l=new g(4326),d=[this.project(i,o,l),this.project(n,o,l)];s(d).then(a.hitch(this,function(){var t=n[0]&&n[0].geometry,r="";t&&(r=t.xmin+","+t.ymin+","+t.xmax+","+t.ymax),e.resolve({extent:r,stops:i})}),e.resolve)}else e.resolve();return e.promise})().then(a.hitch(this,function(r){var s=(r||{}).extent,d=(r||{}).stops,f=u?t.folder+"/items/"+u+"/update":t.folder+"/addItem";return l({url:f,content:{text:i.stringify(e),extent:s,title:t.name,type:"Feature Collection",typeKeywords:"Data, Feature Collection, Multilayer, Route Layer",description:n.networkAnalysis.sharing.itemSnippet+" "+t.name+a.hitch(this,function(){var e=p(c?"DirectionPoints":"Directions"),t=p("Stops"),i=p("RouteInfo")[0].attributes,r=function(e){if(void 0!==e)for(var i=0;i<t.length;i++)if(t[i].attributes.Sequence===e)return t[i].attributes;return{}},s="english"===this.portal.getPortalUser().units?"esriMiles":"esriMeters",l=function(e){return o.format(e,{places:2,locale:"root"})},u=a.hitch(this,function(e){return l(this.fromMeters(e,s))+" "+("esriMiles"===s?n.networkAnalysis.sharing.Miles:n.networkAnalysis.sharing.Meters)}),f=a.hitch(this,function(t){for(var i="<ol>",s=0;s<e.length;s++){var a=r(e[s].attributes.StopSequence),o=c?this._itemToManeuverType(this._itemCodeToItemString(e[s].attributes.DirectionPointType)):e[s].attributes.ManeuverType;(t||!s&&"esriDMTDepart"===o||s&&"esriDMTStop"===o)&&(i+='<li><img style="display:inline-block;margin:-3px 15px;" src="js/jsapi/esri/dijit/images/Directions/maneuvers/'+(null===a.ArrivalCurbApproach&&null!==a.DepartureCurbApproach?"esriDMTStopOrigin":null!==a.ArrivalCurbApproach&&null===a.DepartureCurbApproach?"esriDMTStopDestination":o)+'.png"><span>'+(e[s].attributes.DirectionText||e[s].attributes.DisplayText)+"</span><br>",t&&!c&&(i+="<span>"+l(e[s].attributes.Minutes)+" "+n.networkAnalysis.sharing.Minutes+"&nbsp;&middot;&nbsp;"+u(e[s].attributes.Meters)+"</span>"),i+="</li>")}return i+="</ol>"}),m="<br><br><b>"+n.networkAnalysis.sharing.routeInfoLayer+"</b><ul><li>"+l(i.TotalMinutes)+" "+n.networkAnalysis.sharing.Minutes+"</li><li>"+u(i.TotalMeters)+"</li>"+(i.StartTime?"<li>"+n.networkAnalysis.sharing.StartTime+" "+new Date(i.StartTime).toString()+"</li>":"")+"</ul>"+(d?"<a href='"+function(){var e="arcgis-navigator://";return d.map(function(t,i){var r=t.geometry;e+=(i?"&":"?")+"stop="+r.y+","+r.x+(""!==t.attributes.Name?"&stopname="+encodeURIComponent(t.attributes.Name).replace("'","%27"):"")}),e}()+"'>"+n.networkAnalysis.sharing.navigatorStopList+"</a><br><br>":"")+"<b>"+n.networkAnalysis.sharing.directionsLayer+"</b>",b=f(!0);return(m+b).length>=65536&&(b=f(!1)),m+=b})(),tags:n.networkAnalysis.sharing.itemTags+(t.name?", "+encodeURIComponent(t.name):""),snippet:n.networkAnalysis.sharing.itemSnippet+" "+t.name,thumbnailUrl:t.thumbnail,licenseInfo:n.widgets.directions.printDisclaimer,f:"json"},callbackParamName:"callback"},{usePost:!0})}))},_getRouteId:function(){for(var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",t="",i=0;32>i;i++)t+=e[Math.floor(Math.random()*e.length)];return t},_populateLayerInfo:function(e,t,i){var r={visibility:!0,layers:[],visibleLayers:[0,1,(t.barriers||[]).length?2:0,(t.barriers||[]).length?4:3,4,5,6],opacity:1};return void 0===i?(this._addRouteInfoToLayerInfo(r,e,t.routeInfo,t.extent),this._addDirectionsToLayerInfo(r,e,t.directions,t.extent),this._addDirectionEventsToLayerInfo(r,e,t.directionEvents||[],t.extent),this._addBarriersToLayerInfo(r,e,t.barriers||[],t.extent),this._addPolylineBarriersToLayerInfo(r,e,t.polylineBarriers||[],t.extent),this._addPolygonBarriersToLayerInfo(r,e,t.polygonBarriers||[],t.extent),this._addStopsToLayerInfo(r,e,t.stops,t.extent)):"1.0.0"===i&&((t.polygonBarriers||[]).length&&this._addPolygonBarriersToLayerInfo(r,e,t.polygonBarriers||[],t.extent),(t.polylineBarriers||[]).length&&this._addPolylineBarriersToLayerInfo(r,e,t.polylineBarriers||[],t.extent),this._addRouteInfoToLayerInfo_100(r,e,t.routeInfo,t.extent,i),this._addDirectionLinesToLayerInfo_100(r,e,t.directionLines||[],t.extent),(t.barriers||[]).length&&this._addBarriersToLayerInfo(r,e,t.barriers||[],t.extent),this._addDirectionPointsToLayerInfo_100(r,e,t.directionPoints,t.extent),this._addStopsToLayerInfo_100(r,e,t.stops,t.extent)),r},_addStopsToLayerInfo:function(e,t,i,r){var s=n.networkAnalysis,o={type:"codedValue",name:"esriNACurbApproachType",codedValues:[{name:s.enums.esriNACurbApproachType.esriNAEitherSideOfVehicle,code:0},{name:s.enums.esriNACurbApproachType.esriNARightSideOfVehicle,code:1},{name:s.enums.esriNACurbApproachType.esriNALeftSideOfVehicle,code:2},{name:s.enums.esriNACurbApproachType.esriNANoUTurn,code:3}]},l=this._generateFeatureCollectionTemplate("Stops",s.sharing.stopsLayer,"esriGeometryPoint"),d=l.layerDefinition.fields,u=i[0].attributes.ArrivalTime>0;d.push(this._createField("CurbApproach",s.fields.stops.CurbApproach,"integer",!1,o)),d.push(this._createField("ArrivalCurbApproach",s.fields.stops.ArrivalCurbApproach,"integer",!0,o)),d.push(this._createField("DepartureCurbApproach",s.fields.stops.DepartureCurbApproach,"integer",!0,o)),d.push(this._createField("Name",s.fields.stops.Name,"string",!0)),d.push(this._createField("Sequence",s.fields.stops.Sequence,"integer",!0)),d.push(this._createField("Status",s.fields.stops.Status,"integer",!0,{type:"codedValue",name:"esriNAObjectStatus",codedValues:[{name:s.enums.esriNAObjectStatus.esriNAObjectStatusOK,code:0},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusNotLocated,code:1},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusElementNotLocated,code:2},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusElementNotTraversable,code:3},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusInvalidFieldValues,code:4},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusNotReached,code:5},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusTimeWindowViolation,code:6}]})),d.push(this._createField("LocationType",s.fields.stops.LocationType,"integer",!0,{type:"codedValue",name:"esriNALocationType",codedValues:[{name:s.enums.esriNALocationType.stop,code:0},{name:s.enums.esriNALocationType.waypoint,code:1}]})),d.push(this._createField("TimeWindowStart",s.fields.stops.TimeWindowStart,"date",!1)),d.push(this._createField("TimeWindowEnd",s.fields.stops.TimeWindowEnd,"date",!1)),d.push(this._createField("ServiceMinutes",s.fields.stops.ServiceMinutes,"double",!1)),d.push(this._createField("ServiceMeters",s.fields.stops.ServiceMeters,"double",!1)),d.push(this._createField("ServiceCosts",s.fields.stops.ServiceCosts,"string",!1,null,this._jsonStringFieldSize)),d.push(this._createField("CumulativeMinutes",s.fields.stops.CumulativeMinutes,"double",!0)),d.push(this._createField("CumulativeMeters",s.fields.stops.CumulativeMeters,"double",!0)),d.push(this._createField("CumulativeCosts",s.fields.stops.CumulativeCosts,"string",!1,null,this._jsonStringFieldSize)),d.push(this._createField("LateMinutes",s.fields.stops.LateMinutes,"double",!1)),d.push(this._createField("WaitMinutes",s.fields.stops.WaitMinutes,"double",!1)),d.push(this._createField("ArrivalTime",s.fields.stops.ArrivalTime,"date",u)),d.push(this._createField("DepartureTime",s.fields.stops.DepartureTime,"date",u)),d.push(this._createField("ArrivalUTCOffset",s.fields.stops.ArrivalUTCOffset,"integer",u)),d.push(this._createField("DepartureUTCOffset",s.fields.stops.DepartureUTCOffset,"integer",u));var m,b=0;for(m=0;m<i.length;m++){var h=i[m],T=h.geometry;l.featureSet.features.push({geometry:T.toJson?T.toJson():T,attributes:a.mixin(h.attributes,{__OBJECTID:b++})})}l.layerDefinition.extent=r.toJson?r.toJson():r;var g=new c(new p(i.length<=2?this.firstStopSymbol:this.interimStopSymbol),"Sequence");for(m=0;m<i.length;m++){var y=i[m].attributes,v=null,A=s.enums.esriNALocationType.stop;1===y.LocationType?(v=new f(this.waypointSymbol),A=s.enums.esriNALocationType.waypoint):null===y.ArrivalCurbApproach&&null===y.DepartureCurbApproach?(v=new p(this.unlocatedStopSymbol),A=s.enums.esriNALocationType.stop+" : "+s.enums.esriNAObjectStatus.esriNAObjectStatusNotReached):null===y.ArrivalCurbApproach&&null!==y.DepartureCurbApproach?v=new p(this.firstStopSymbol):null!==y.ArrivalCurbApproach&&null===y.DepartureCurbApproach&&(v=new p(this.lastStopSymbol)),v&&g.addValue({value:y.Sequence,symbol:v,label:A})}l.layerDefinition.drawingInfo.renderer=g.toJson(),l.popupInfo={title:"{Name}",fieldInfos:[{fieldName:"Name",label:s.fields.stops.Name,isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"Sequence",label:s.fields.stops.Sequence,isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ArrivalTime",label:s.fields.stops.ArrivalTime,isEditable:!0,tooltip:"",visible:u,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ArrivalUTCOffset",label:s.fields.stops.ArrivalUTCOffset,isEditable:!1,tooltip:"",visible:u,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"DepartureTime",label:s.fields.stops.DepartureTime,isEditable:!0,tooltip:"",visible:u,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"DepartureUTCOffset",label:s.fields.stops.DepartureUTCOffset,isEditable:!1,tooltip:"",visible:u,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"CurbApproach",label:s.fields.stops.CurbApproach,isEditable:!0,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"ArrivalCurbApproach",label:s.fields.stops.ArrivalCurbApproach,isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"DepartureCurbApproach",label:s.fields.stops.DepartureCurbApproach,isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Status",label:s.fields.stops.Status,isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"LocationType",label:s.fields.stops.LocationType,isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"TimeWindowStart",label:s.fields.stops.TimeWindowStart,isEditable:!0,tooltip:"",visible:!1,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"TimeWindowEnd",label:s.fields.stops.TimeWindowEnd,isEditable:!0,tooltip:"",visible:!1,format:{dateFormat:"shortDateShortTime24"
},stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"ServiceMinutes",label:s.fields.stops.ServiceMinutes,isEditable:!0,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"ServiceMeters",label:s.fields.stops.ServiceMeters,isEditable:!0,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"ServiceCosts",label:s.fields.stops.ServiceCosts,isEditable:!0,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"CumulativeMinutes",label:s.fields.stops.CumulativeMinutes,isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"CumulativeMeters",label:s.fields.stops.CumulativeMeters,isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"CumulativeCosts",label:s.fields.stops.CumulativeCosts,isEditable:!0,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"LateMinutes",label:s.fields.stops.LateMinutes,isEditable:!1,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"WaitMinutes",label:s.fields.stops.WaitMinutes,isEditable:!1,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1}],description:null,showAttachments:!1,mediaInfos:[]},e.layers.push(l)},_addDirectionsToLayerInfo:function(e,t,i,r){var s=n.networkAnalysis,o=s.enums.esriDirectionsManeuverType,l=this._generateFeatureCollectionTemplate("Directions",s.sharing.directionsLayer,"esriGeometryPolyline"),d=l.layerDefinition.fields,c=i[0]&&i[0].attributes&&i[0].attributes.ArrivalTime>0;d.push(this._createField("Sequence",s.fields.directions.Sequence,"integer")),d.push(this._createField("StopSequence",s.fields.directions.StopSequence,"integer")),d.push(this._createField("ArrivalTime",s.fields.directions.ArrivalTime,"date",c)),d.push(this._createField("UTCOffset",s.fields.directions.UTCOffset,"integer",c)),d.push(this._createField("ManeuverType",s.fields.directions.ManeuverType,"string",!0,{type:"codedValue",name:"esriDirectionsManeuverType",codedValues:[{name:o.esriDMTBearLeft,code:"esriDMTBearLeft"},{name:o.esriDMTBearRight,code:"esriDMTBearRight"},{name:o.esriDMTDepart,code:"esriDMTDepart"},{name:o.esriDMTDoorPassage,code:"esriDMTDoorPassage"},{name:o.esriDMTElevator,code:"esriDMTElevator"},{name:o.esriDMTEndOfFerry,code:"esriDMTEndOfFerry"},{name:o.esriDMTEscalator,code:"esriDMTEscalator"},{name:o.esriDMTFerry,code:"esriDMTFerry"},{name:o.esriDMTForkCenter,code:"esriDMTForkCenter"},{name:o.esriDMTForkLeft,code:"esriDMTForkLeft"},{name:o.esriDMTForkRight,code:"esriDMTForkRight"},{name:o.esriDMTHighwayChange,code:"esriDMTHighwayChange"},{name:o.esriDMTHighwayExit,code:"esriDMTHighwayExit"},{name:o.esriDMTHighwayMerge,code:"esriDMTHighwayMerge"},{name:o.esriDMTPedestrianRamp,code:"esriDMTPedestrianRamp"},{name:o.esriDMTRampLeft,code:"esriDMTRampLeft"},{name:o.esriDMTRampRight,code:"esriDMTRampRight"},{name:o.esriDMTRoundabout,code:"esriDMTRoundabout"},{name:o.esriDMTSharpLeft,code:"esriDMTSharpLeft"},{name:o.esriDMTSharpRight,code:"esriDMTSharpRight"},{name:o.esriDMTStairs,code:"esriDMTStairs"},{name:o.esriDMTStop,code:"esriDMTStop"},{name:o.esriDMTStraight,code:"esriDMTStraight"},{name:o.esriDMTTripItem,code:"esriDMTTripItem"},{name:o.esriDMTTurnLeft,code:"esriDMTTurnLeft"},{name:o.esriDMTTurnLeftLeft,code:"esriDMTTurnLeftLeft"},{name:o.esriDMTTurnLeftRight,code:"esriDMTTurnLeftRight"},{name:o.esriDMTTurnRight,code:"esriDMTTurnRight"},{name:o.esriDMTTurnRightLeft,code:"esriDMTTurnRightLeft"},{name:o.esriDMTTurnRightRight,code:"esriDMTTurnRightRight"},{name:o.esriDMTUnknown,code:"esriDMTUnknown"},{name:o.esriDMTUTurn,code:"esriDMTUTurn"}]})),d.push(this._createField("Meters",s.fields.directions.Meters,"double",!0)),d.push(this._createField("Minutes",s.fields.directions.Minutes,"double",!0)),d.push(this._createField("DirectionText",s.fields.directions.DirectionText,"string",!0,null,2048)),d.push(this._createField("ManeuverMessages",s.fields.directions.ManeuverMessages,"string",!1,null,this._jsonStringFieldSize));for(var p=0,f=0;f<i.length;f++){var b=i[f],h=b.geometry;l.featureSet.features.push({geometry:h&&h.toJson?h.toJson():h,attributes:a.mixin(b.attributes,{__OBJECTID:p++})})}l.layerDefinition.extent=r.toJson?r.toJson():r;var T=new u(new m(this.directionSymbol));l.layerDefinition.drawingInfo.renderer=T.toJson(),l.popupInfo={title:"{Text}",fieldInfos:[{fieldName:"ManeuverType",label:s.fields.directions.ManeuverType,isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"DirectionText",label:s.fields.directions.DirectionText,isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Sequence",label:s.fields.directions.Sequence,isEditable:!1,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"StopSequence",label:s.fields.directions.StopSequence,isEditable:!1,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ArrivalTime",label:s.fields.directions.ArrivalTime,isEditable:!0,tooltip:"",visible:c,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"UTCOffset",label:s.fields.directions.UTCOffset,isEditable:!1,tooltip:"",visible:c,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Meters",label:s.fields.directions.Meters,isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Minutes",label:s.fields.directions.Minutes,isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ManeuverMessages",label:s.fields.directions.ManeuverMessages,isEditable:!1,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!1}],description:null,showAttachments:!1,mediaInfos:[]},e.layers.push(l)},_addDirectionEventsToLayerInfo:function(e,t,i,r){var s=n.networkAnalysis,o=this._generateFeatureCollectionTemplate("DirectionEvents",s.sharing.directionEventsLayer,"esriGeometryPoint"),l=o.layerDefinition.fields,d=i[0]&&i[0].attributes&&i[0].attributes.ArrivalTime>0;l.push(this._createField("ArrivalTime",s.fields.directionEvents.ArrivalTime,"date",d)),l.push(this._createField("UTCOffset",s.fields.directionEvents.UTCOffset,"integer",d)),l.push(this._createField("DirectionSequence",s.fields.directionEvents.DirectionSequence,"integer")),l.push(this._createField("Sequence",s.fields.directionEvents.Sequence,"integer")),l.push(this._createField("EventText",s.fields.directionEvents.EventText,"string",!0,null,2048)),l.push(this._createField("EventMessages",s.fields.directionEvents.EventMessages,"string",!1,null,this._jsonStringFieldSize));for(var c=0,p=0;p<i.length;p++){var m=i[p],b=m.geometry;o.featureSet.features.push({geometry:b&&b.toJson?b.toJson():b,attributes:a.mixin(m.attributes,{__OBJECTID:c++})})}o.layerDefinition.extent=r.toJson?r.toJson():r;var h=new u(new f(this.directionEventSymbol));o.layerDefinition.drawingInfo.renderer=h.toJson(),o.popupInfo={title:s.sharing.directionEventsLayer,fieldInfos:[{fieldName:"EventText",label:s.fields.directionEvents.EventText,isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ArrivalTime",label:s.fields.directionEvents.ArrivalTime,isEditable:!0,tooltip:"",visible:d,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"UTCOffset",label:s.fields.directionEvents.UTCOffset,isEditable:!1,tooltip:"",visible:d,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"DirectionSequence",label:s.fields.directionEvents.DirectionSequence,isEditable:!1,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Sequence",label:s.fields.directionEvents.Sequence,isEditable:!1,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"EventMessages",label:s.fields.directionEvents.EventMessages,isEditable:!1,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!1}],description:null,showAttachments:!1,mediaInfos:[]},e.layers.push(o)},_addBarriersToLayerInfo:function(e,t,i,r){var s=n.networkAnalysis,o=this._generateFeatureCollectionTemplate("Barriers",s.sharing.barriersLayer,"esriGeometryPoint"),l=o.layerDefinition.fields;l.push(this._createField("Name",s.fields.barriers.Name,"string",!0)),l.push(this._createField("BarrierType",s.fields.barriers.BarrierType,"integer",!0,{type:"codedValue",name:"esriNABarrierType",codedValues:[{name:s.enums.esriNABarrierType.esriNABTRestriction,code:0},{name:s.enums.esriNABarrierType.esriNABTScaledCost,code:1},{name:s.enums.esriNABarrierType.esriNABTAddedCost,code:2}]})),l.push(this._createField("FullEdge",s.fields.barriers.FullEdge,"integer",!0,{type:"codedValue",name:"esriNAIntYesNo",codedValues:[{name:s.enums.esriNAIntYesNo.No,code:0},{name:s.enums.esriNAIntYesNo.Yes,code:1}]})),l.push(this._createField("AddedCost",s.fields.barriers.AddedCost,"double",!0)),l.push(this._createField("Costs",s.fields.barriers.Costs,"string",!1,null,this._jsonStringFieldSize)),l.push(this._createField("Status",s.fields.barriers.Status,"integer",!0,{type:"codedValue",name:"esriNAObjectStatus",codedValues:[{name:s.enums.esriNAObjectStatus.esriNAObjectStatusOK,code:0},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusNotLocated,code:1},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusElementNotLocated,code:2},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusElementNotTraversable,code:3},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusInvalidFieldValues,code:4},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusNotReached,code:5},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusTimeWindowViolation,code:6}]})),l.push(this._createField("CurbApproach",s.fields.barriers.CurbApproach,"integer",!1,{type:"codedValue",name:"esriNACurbApproachType",codedValues:[{name:s.enums.esriNACurbApproachType.esriNAEitherSideOfVehicle,code:0},{name:s.enums.esriNACurbApproachType.esriNARightSideOfVehicle,code:1},{name:s.enums.esriNACurbApproachType.esriNALeftSideOfVehicle,code:2},{name:s.enums.esriNACurbApproachType.esriNANoUTurn,code:3}]}));for(var d=0,u=!1,c=!1,p=0;p<i.length;p++){var f=i[p],m=f.geometry,b=f.attributes;u=u||void 0!==m.m,c=c||void 0!==m.z,o.featureSet.features.push({geometry:a.mixin(m&&m.toJson?m.toJson():m,u?{m:m.m}:{}),attributes:a.mixin(f.attributes,{__OBJECTID:++d,FullEdge:b.FullEdge||0,Status:b.Status||0,CurbApproach:b.CurbApproach||0})})}a.mixin(o.layerDefinition,{extent:r.toJson?r.toJson():r,hasM:u,hasZ:c}),o.layerDefinition.drawingInfo.renderer=this.barrierRenderer.toJson(),o.popupInfo={title:s.sharing.barriersLayer,fieldInfos:[{fieldName:"Name",label:s.fields.barriers.Name,isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"BarrierType",label:s.fields.barriers.BarrierType,isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"CurbApproach",label:s.fields.barriers.CurbApproach,isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"FullEdge",label:s.fields.barriers.FullEdge,isEditable:!0,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"AddedCost",label:s.fields.barriers.AddedCost,isEditable:!0,tooltip:"",visible:!0,format:{places:3,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Costs",label:s.fields.barriers.Costs,isEditable:!0,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Status",label:s.fields.barriers.Status,isEditable:!1,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!1}],description:null,showAttachments:!1,mediaInfos:[]},e.layers.push(o)},_addPolylineBarriersToLayerInfo:function(e,t,i,r){var s=n.networkAnalysis,o=this._generateFeatureCollectionTemplate("PolylineBarriers",s.sharing.polylineBarriersLayer,"esriGeometryPolyline"),l=o.layerDefinition.fields;l.push(this._createField("Name",s.fields.polylineBarriers.Name,"string",!0)),l.push(this._createField("BarrierType",s.fields.polylineBarriers.BarrierType,"integer",!0,{type:"codedValue",name:"esriNABarrierType",codedValues:[{name:s.enums.esriNABarrierType.esriNABTRestriction,code:0},{name:s.enums.esriNABarrierType.esriNABTScaledCost,code:1},{name:s.enums.esriNABarrierType.esriNABTAddedCost,code:2}]})),l.push(this._createField("ScaleFactor",s.fields.polylineBarriers.ScaleFactor,"double",!0)),l.push(this._createField("Costs",s.fields.polylineBarriers.Costs,"string",!1,null,this._jsonStringFieldSize));for(var d=0,u=!1,c=!1,p=0;p<i.length;p++){var f=i[p],m=f.geometry,b=f.attributes;m&&b&&(u=u||m.hasM||!1,c=c||m.hasZ||!1,o.featureSet.features.push({geometry:m&&m.toJson?m.toJson():m,attributes:a.mixin(f.attributes,{__OBJECTID:++d})}))}a.mixin(o.layerDefinition,{extent:r.toJson?r.toJson():r,hasM:u,hasZ:c}),o.layerDefinition.drawingInfo.renderer=this.polylineBarrierRenderer.toJson(),o.popupInfo={title:s.sharing.polylineBarriersLayer,fieldInfos:[{fieldName:"Name",label:s.fields.polylineBarriers.Name,isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"BarrierType",label:s.fields.polylineBarriers.BarrierType,isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ScaleFactor",label:s.fields.polylineBarriers.ScaleFactor,isEditable:!0,tooltip:"",visible:!0,format:{places:3,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Costs",label:s.fields.polylineBarriers.Costs,isEditable:!0,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!1}],description:null,showAttachments:!1,mediaInfos:[]},e.layers.push(o)},_addPolygonBarriersToLayerInfo:function(e,t,i,r){var s=n.networkAnalysis,o=this._generateFeatureCollectionTemplate("PolygonBarriers",s.sharing.polygonBarriersLayer,"esriGeometryPolygon"),l=o.layerDefinition.fields;l.push(this._createField("Name",s.fields.polygonBarriers.Name,"string",!0)),l.push(this._createField("BarrierType",s.fields.polygonBarriers.BarrierType,"integer",!0,{type:"codedValue",name:"esriNABarrierType",codedValues:[{name:s.enums.esriNABarrierType.esriNABTRestriction,code:0},{name:s.enums.esriNABarrierType.esriNABTScaledCost,code:1},{name:s.enums.esriNABarrierType.esriNABTAddedCost,code:2}]})),l.push(this._createField("ScaleFactor",s.fields.polygonBarriers.ScaleFactor,"double",!0)),l.push(this._createField("Costs",s.fields.polygonBarriers.Costs,"string",!1,null,this._jsonStringFieldSize));for(var d=0,u=!1,c=!1,p=0;p<i.length;p++){var f=i[p],m=f.geometry,b=f.attributes;m&&b&&(u=u||m.hasM||!1,c=c||m.hasZ||!1,o.featureSet.features.push({geometry:m&&m.toJson?m.toJson():m,attributes:a.mixin(f.attributes,{__OBJECTID:++d})}))}a.mixin(o.layerDefinition,{extent:r.toJson?r.toJson():r,hasM:u,hasZ:c}),o.layerDefinition.drawingInfo.renderer=this.polygonBarrierRenderer.toJson(),o.popupInfo={title:s.sharing.polygonBarriersLayer,fieldInfos:[{fieldName:"Name",label:s.fields.polygonBarriers.Name,isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"BarrierType",label:s.fields.polygonBarriers.BarrierType,isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ScaleFactor",label:s.fields.polygonBarriers.ScaleFactor,isEditable:!0,tooltip:"",visible:!0,format:{places:3,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Costs",label:s.fields.polygonBarriers.Costs,isEditable:!0,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!1}],description:null,showAttachments:!1,mediaInfos:[]},e.layers.push(o)},_addRouteInfoToLayerInfo:function(e,t,i,r){var s=n.networkAnalysis,o=this._generateFeatureCollectionTemplate("RouteInfo",s.sharing.routeInfoLayer,"esriGeometryPolyline"),l=o.layerDefinition.fields,d=void 0!==i.attributes.StartTime&&null!==i.attributes.StartTime;l.push(this._createField("RouteName",s.fields.routeInfo.RouteName,"string",!0,null,1024)),l.push(this._createField("TotalMinutes",s.fields.routeInfo.TotalMinutes,"double",!0)),l.push(this._createField("TotalMeters",s.fields.routeInfo.TotalMeters,"double",!0)),l.push(this._createField("TotalLateMinutes",s.fields.routeInfo.TotalLateMinutes,"double")),l.push(this._createField("TotalWaitMinutes",s.fields.routeInfo.TotalWaitMinutes,"double")),l.push(this._createField("TotalCosts",s.fields.routeInfo.TotalCosts,"string",!1,null,this._jsonStringFieldSize)),l.push(this._createField("StartTime",s.fields.routeInfo.StartTime,"date",d)),l.push(this._createField("StartUTCOffset",s.fields.routeInfo.StartUTCOffset,"integer",d)),l.push(this._createField("EndTime",s.fields.routeInfo.EndTime,"date",d)),l.push(this._createField("EndUTCOffset",s.fields.routeInfo.EndUTCOffset,"integer",d)),l.push(this._createField("Messages",s.fields.routeInfo.Messages,"string",!1,null,this._jsonStringFieldSize)),l.push(this._createField("AnalysisSettings",s.fields.routeInfo.AnalysisSettings,"string",!1,null,this._jsonStringFieldSize));var c=i.geometry;o.featureSet.features.push({geometry:c&&c.toJson?c.toJson():c,attributes:a.mixin(i.attributes,{__OBJECTID:1})}),o.layerDefinition.extent=r.toJson?r.toJson():r;var p=new u(new m(this.routeSymbol));o.layerDefinition.drawingInfo.renderer=p.toJson(),o.popupInfo={title:s.sharing.routeInfoLayer,fieldInfos:[{fieldName:"RouteName",label:s.fields.routeInfo.RouteName,isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"TotalMinutes",label:s.fields.routeInfo.TotalMinutes,isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"TotalMeters",label:s.fields.routeInfo.TotalMeters,isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"TotalLateMinutes",label:s.fields.routeInfo.TotalLateMinutes,isEditable:!1,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"TotalWaitMinutes",label:s.fields.routeInfo.TotalWaitMinutes,isEditable:!1,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"TotalCosts",label:s.fields.routeInfo.TotalCosts,isEditable:!1,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"StartTime",label:s.fields.routeInfo.StartTime,isEditable:!1,tooltip:"",visible:d,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"StartUTCOffset",label:s.fields.routeInfo.StartUTCOffset,isEditable:!1,tooltip:"",visible:d,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"EndTime",label:s.fields.routeInfo.EndTime,isEditable:!1,tooltip:"",visible:d,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"EndUTCOffset",label:s.fields.routeInfo.EndUTCOffset,isEditable:!1,tooltip:"",visible:d,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Messages",label:s.fields.routeInfo.Messages,isEditable:!1,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"SolverSettings",label:s.fields.routeInfo.SolverSettings,isEditable:!1,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!1}],description:null,showAttachments:!1,mediaInfos:[]},e.layers.push(o)},_loadDirectionsFeatureSet:function(e,t,r,s,n){for(var o=[],l=function(t){var i=t,r=e[i].geometry,s=function(t){for(;!r&&(0>t&&i>0||t>0&&i<e.length-1);){i+=t;var s=e[i].geometry;if(s&&s.paths&&s.paths[0])return r={paths:[[s.paths[0][t>0?0:s.paths[0].length-1],s.paths[0][t>0?0:s.paths[0].length-1]]],spatialReference:n}}return r};return s(1)||s(-1)},d=a.hitch(this,function(e){for(var r=[],s=0;s<t.length;s++)t[s].attributes.DirectionSequence===e&&(r.push({ETA:this.toGeolocalTime(t[s].attributes.ArrivalTime,t[s].attributes.UTCOffset),arriveTimeUTC:null===t[s].attributes.UTCOffset?void 0:t[s].attributes.ArrivalTime,strings:i.parse(t[s].attributes.EventMessages)||[],point:{x:t[s].geometry.x,y:t[s].geometry.y}}),t[s].attributes.EventText&&r[r.length-1].strings.splice(0,0,{string:t[s].attributes.EventText,stringType:"esriDSTGeneral"}));return r}),u=0;u<e.length;u++){var c={attributes:{length:this.fromMeters(e[u].attributes.Meters,r),time:this.fromMinutes(e[u].attributes.Minutes,s),text:e[u].attributes.DirectionText,ETA:this.toGeolocalTime(e[u].attributes.ArrivalTime,e[u].attributes.UTCOffset),arriveTimeUTC:null===e[u].attributes.UTCOffset?void 0:e[u].attributes.ArrivalTime,maneuverType:e[u].attributes.ManeuverType,_stopSequence:e[u].attributes.StopSequence},geometry:l(u)||ss[0]&&ss[0].geometry&&{paths:[[[ss[0].geometry.x,ss[0].geometry.y]]],spatialReference:n},strings:i.parse(e[u].attributes.ManeuverMessages||"[]"),events:d(u)};0===c.strings.length&&delete c.strings,o.push(c)}return o},_addStopsToLayerInfo_100:function(e,t,i,r){var s=n.networkAnalysis,o={type:"codedValue",name:"esriNACurbApproachType",codedValues:[{name:s.enums.esriNACurbApproachType.esriNAEitherSideOfVehicle,code:0},{name:s.enums.esriNACurbApproachType.esriNARightSideOfVehicle,code:1},{name:s.enums.esriNACurbApproachType.esriNALeftSideOfVehicle,code:2},{name:s.enums.esriNACurbApproachType.esriNANoUTurn,code:3}]},l=this._generateFeatureCollectionTemplate("Stops",s.sharing.stopsLayer,"esriGeometryPoint"),d=l.layerDefinition.fields,u=i[0].attributes.ArrivalTime>0;d.push(this._createField("CurbApproach",s.fields.stops.CurbApproach,"integer",!1,o)),d.push(this._createField("ArrivalCurbApproach",s.fields.stops.ArrivalCurbApproach,"integer",!0,o)),d.push(this._createField("DepartureCurbApproach",s.fields.stops.DepartureCurbApproach,"integer",!0,o)),d.push(this._createField("Name",s.fields.stops.Name,"string",!0)),d.push(this._createField("RouteName",s.fields.routeInfo.RouteName,"string",!0)),d.push(this._createField("Sequence",s.fields.stops.Sequence,"integer",!0)),d.push(this._createField("Status",s.fields.stops.Status,"integer",!0,{type:"codedValue",name:"esriNAObjectStatus",codedValues:[{name:s.enums.esriNAObjectStatus.esriNAObjectStatusOK,code:0},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusNotLocated,code:1},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusElementNotLocated,code:2},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusElementNotTraversable,code:3},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusInvalidFieldValues,code:4},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusNotReached,code:5},{name:s.enums.esriNAObjectStatus.esriNAObjectStatusTimeWindowViolation,code:6}]})),d.push(this._createField("LocationType",s.fields.stops.LocationType,"integer",!0,{type:"codedValue",name:"esriNALocationType",codedValues:[{name:s.enums.esriNALocationType.stop,code:0},{name:s.enums.esriNALocationType.waypoint,code:1}]})),d.push(this._createField("TimeWindowStart",s.fields.stops.TimeWindowStart,"date",!1)),d.push(this._createField("TimeWindowEnd",s.fields.stops.TimeWindowEnd,"date",!1)),d.push(this._createField("TimeWindowStartUTCOffset",s.fields.stops.TimeWindowStart+": "+s.fields.directions.UTCOffset,"integer",u)),d.push(this._createField("TimeWindowEndUTCOffset",s.fields.stops.TimeWindowEnd+": "+s.fields.directions.UTCOffset,"integer",u)),d.push(this._createField("ServiceMinutes",s.fields.stops.ServiceMinutes,"double",!1)),d.push(this._createField("ServiceMeters",s.fields.stops.ServiceMeters,"double",!1)),d.push(this._createField("ServiceCosts",s.fields.stops.ServiceCosts,"string",!1,null,this._jsonStringFieldSize)),d.push(this._createField("CumulativeMinutes",s.fields.stops.CumulativeMinutes,"double",!0)),d.push(this._createField("CumulativeMeters",s.fields.stops.CumulativeMeters,"double",!0)),d.push(this._createField("CumulativeCosts",s.fields.stops.CumulativeCosts,"string",!1,null,this._jsonStringFieldSize)),d.push(this._createField("LateMinutes",s.fields.stops.LateMinutes,"double",!1)),d.push(this._createField("WaitMinutes",s.fields.stops.WaitMinutes,"double",!1)),d.push(this._createField("ArrivalTime",s.fields.stops.ArrivalTime,"date",u)),d.push(this._createField("DepartureTime",s.fields.stops.DepartureTime,"date",u)),d.push(this._createField("ArrivalUTCOffset",s.fields.stops.ArrivalUTCOffset,"integer",u)),d.push(this._createField("DepartureUTCOffset",s.fields.stops.DepartureUTCOffset,"integer",u));var m,b=0,h=!1,T=!1;for(m=0;m<i.length;m++){var g=i[m],y=g.geometry;h=h||void 0!==y.m,T=T||void 0!=y.m,l.featureSet.features.push({geometry:a.mixin(y&&y.toJson?y.toJson():y,h?{m:y.m}:{}),attributes:void 0!==g.attributes.__OBJECTID?g.attributes:a.mixin(g.attributes,{__OBJECTID:++b})})}a.mixin(l.layerDefinition,{extent:r.toJson?r.toJson():r,hasM:h,hasZ:T});var v=new c(new p(i.length<=2?this.firstStopSymbol:this.interimStopSymbol),"Sequence");for(m=0;m<i.length;m++){var A=i[m].attributes,S=null,D=s.enums.esriNALocationType.stop;1===A.LocationType?(S=new f(this.waypointSymbol),D=s.enums.esriNALocationType.waypoint):null===A.ArrivalCurbApproach&&null===A.DepartureCurbApproach?(S=new p(this.unlocatedStopSymbol),D=s.enums.esriNALocationType.stop+" : "+s.enums.esriNAObjectStatus.esriNAObjectStatusNotReached):null===A.ArrivalCurbApproach&&null!==A.DepartureCurbApproach?S=new p(this.firstStopSymbol):null!==A.ArrivalCurbApproach&&null===A.DepartureCurbApproach&&(S=new p(this.lastStopSymbol)),S&&v.addValue({value:A.Sequence,symbol:S,label:D})}l.layerDefinition.drawingInfo.renderer=v.toJson(),l.popupInfo={title:"{Name}",fieldInfos:[{fieldName:"Name",label:s.fields.stops.Name,isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"RouteName",label:s.fields.routeInfo.RouteName,isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"Sequence",label:s.fields.stops.Sequence,isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ArrivalTime",label:s.fields.stops.ArrivalTime,isEditable:!0,tooltip:"",visible:u,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ArrivalUTCOffset",label:s.fields.stops.ArrivalUTCOffset,isEditable:!1,tooltip:"",visible:u,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"DepartureTime",label:s.fields.stops.DepartureTime,isEditable:!0,tooltip:"",visible:u,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"DepartureUTCOffset",label:s.fields.stops.DepartureUTCOffset,isEditable:!1,tooltip:"",visible:u,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"CurbApproach",label:s.fields.stops.CurbApproach,isEditable:!0,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"ArrivalCurbApproach",label:s.fields.stops.ArrivalCurbApproach,isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"DepartureCurbApproach",label:s.fields.stops.DepartureCurbApproach,isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Status",label:s.fields.stops.Status,isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"LocationType",label:s.fields.stops.LocationType,isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"TimeWindowStart",label:s.fields.stops.TimeWindowStart,isEditable:!0,tooltip:"",visible:!1,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"TimeWindowStartUTCOffset",label:s.fields.stops.TimeWindowStart+": "+s.fields.directions.UTCOffset,isEditable:!1,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"TimeWindowEnd",label:s.fields.stops.TimeWindowEnd,isEditable:!0,tooltip:"",visible:!1,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"TimeWindowEndUTCOffset",label:s.fields.stops.TimeWindowEnd+": "+s.fields.directions.UTCOffset,isEditable:!1,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ServiceMinutes",label:s.fields.stops.ServiceMinutes,isEditable:!0,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"ServiceMeters",label:s.fields.stops.ServiceMeters,isEditable:!0,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"ServiceCosts",label:s.fields.stops.ServiceCosts,isEditable:!0,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"CumulativeMinutes",label:s.fields.stops.CumulativeMinutes,isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"CumulativeMeters",label:s.fields.stops.CumulativeMeters,isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"CumulativeCosts",label:s.fields.stops.CumulativeCosts,isEditable:!0,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!0},{fieldName:"LateMinutes",label:s.fields.stops.LateMinutes,isEditable:!1,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"WaitMinutes",label:s.fields.stops.WaitMinutes,isEditable:!1,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1}],description:null,showAttachments:!1,mediaInfos:[]},e.layers.push(l)},_addRouteInfoToLayerInfo_100:function(e,t,i,r,s){this._addRouteInfoToLayerInfo(e,t,i,r);var o=n.networkAnalysis,l=e.layers[e.layers.length-1];l.layerDefinition.fields.push(this._createField("Version",o.fields.routeInfo.Version,"string",!0,null,16)),l.popupInfo.fieldInfos.push({fieldName:"Version",label:o.fields.routeInfo.Version,isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1}),l.featureSet.features[0].attributes.Version=s;var d=i.geometry;a.mixin(l.layerDefinition,{hasM:d.hasM||!1,hasZ:d.hasZ||!1})},_addDirectionPointsToLayerInfo_100:function(e,t,i,r){var s=n.networkAnalysis,o=s.enums.esriDirectionItemType,l=this._generateFeatureCollectionTemplate("DirectionPoints",s.sharing.directionPointsLayer,"esriGeometryPoint"),d=l.layerDefinition.fields,c=i[0]&&i[0].attributes&&i[0].attributes.ArrivalTime>0;d.push(this._createField("Sequence",s.fields.directions.Sequence,"integer",!0)),d.push(this._createField("StopID",s.fields.directions.StopID,"integer",!0)),d.push(this._createField("DirectionPointType",s.fields.directions.ItemType,"integer",!0,{type:"codedValue",name:"esriDirectionPointType",codedValues:[{name:o.esriDITUnknown,code:0},{name:"",code:1},{name:o.esriDITManeuverArrive,code:50},{name:o.esriDITManeuverDepart,code:51},{name:o.esriDITManeuverStraight,code:52},{name:o.esriDITManeuverFerryOn,code:100},{name:o.esriDITManeuverFerryOff,
code:101},{name:o.esriDITManeuverForkCenter,code:102},{name:o.esriDITManeuverRoundabout,code:103},{name:o.esriDITManeuverUTurn,code:104},{name:o.esriDITManeuverDoor,code:150},{name:o.esriDITManeuverStairs,code:151},{name:o.esriDITManeuverElevator,code:152},{name:o.esriDITManeuverEscalator,code:153},{name:o.esriDITManeuverPedestrianRamp,code:154},{name:o.esriDITManeuverForkLeft,code:200},{name:o.esriDITManeuverRampLeft,code:201},{name:o.esriDITManeuverRoundaboutLeft,code:202},{name:o.esriDITManeuverUTurnLeft,code:203},{name:o.esriDITManeuverBearLeft,code:204},{name:o.esriDITManeuverTurnLeft,code:205},{name:o.esriDITManeuverSharpLeft,code:206},{name:o.esriDITManeuverTurnLeftLeft,code:207},{name:o.esriDITManeuverTurnLeftRight,code:208},{name:o.esriDITManeuverForkRight,code:300},{name:o.esriDITManeuverRampRight,code:301},{name:o.esriDITManeuverRoundaboutRight,code:302},{name:o.esriDITManeuverUTurnRight,code:303},{name:o.esriDITManeuverBearRight,code:304},{name:o.esriDITManeuverTurnRight,code:305},{name:o.esriDITManeuverSharpRight,code:306},{name:o.esriDITManeuverTurnRightLeft,code:307},{name:o.esriDITManeuverTurnRightRight,code:308},{name:o.esriDITManeuverElevatorUp,code:400},{name:o.esriDITManeuverEscalatorUp,code:401},{name:o.esriDITManeuverStairsUp,code:402},{name:o.esriDITManeuverElevatorDown,code:500},{name:o.esriDITManeuverEscalatorDown,code:501},{name:o.esriDITManeuverStairsDown,code:502},{name:o.esriDITEvent,code:1e3},{name:o.esriDITEventLandmark,code:1001},{name:o.esriDITEventTimeZone,code:1002},{name:o.esriDITEventTraffic,code:1003},{name:o.esriDITEventBarrier,code:1004},{name:o.esriDITEventBoundary,code:1005},{name:o.esriDITEventRestrictionViolation,code:1006}]})),d.push(this._createField("DisplayText",s.fields.directions.DisplayText,"string",!0,null,2048)),d.push(this._createField("ArrivalTime",s.fields.directions.ArrivalTime,"date",c)),d.push(this._createField("ArrivalUTCOffset",s.fields.directions.UTCOffset,"integer",c)),d.push(this._createField("Azimuth",s.fields.directions.Azimuth,"double",!0)),d.push(this._createField("Name",s.fields.directions.Name,"string",!0,null,2048)),d.push(this._createField("AlternateName",s.fields.directions.AlternativeName,"string",!0,null,2048)),d.push(this._createField("ExitName",s.fields.directions.ExitName,"string",!0,null,2048)),d.push(this._createField("IntersectingName",s.fields.directions.IntersectingName,"string",!0,null,2048)),d.push(this._createField("BranchName",s.fields.directions.BranchName,"string",!0,null,2048)),d.push(this._createField("TowardName",s.fields.directions.TowardName,"string",!0,null,2048)),d.push(this._createField("ShortVoiceInstruction",s.fields.directions.VoiceShortText,"string",!0,null,2048)),d.push(this._createField("VoiceInstruction",s.fields.directions.VoiceFullText,"string",!0,null,2048)),d.push(this._createField("Level",s.fields.directions.Level,"integer",!0));for(var p=0,m=!1,b=!1,h=0;h<i.length;h++){var T=i[h],g=T.geometry,y=T.attributes;g&&y&&(m=m||void 0!==g.m,b=b||void 0!==g.hasZ,y.DirectionPointType=this._itemStringToItemCode(y.DirectionPointType),l.featureSet.features.push({geometry:a.mixin(g&&g.toJson?g.toJson():g,m?{m:g.m}:{}),attributes:void 0!==y.__OBJECTID?y:a.mixin(y,{__OBJECTID:++p})}))}a.mixin(l.layerDefinition,{extent:r.toJson?r.toJson():r,hasM:m,hasZ:b});var v=new u(new f(this.directionPointSymbol));l.layerDefinition.drawingInfo.renderer=v.toJson(),l.popupInfo={title:"{DisplayText}",fieldInfos:[{fieldName:"DirectionPointType",label:s.fields.directions.ItemType,isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"DisplayText",label:s.fields.directions.DisplayText,isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Sequence",label:s.fields.directions.Sequence,isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"StopID",label:s.fields.directions.StopID,isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ArrivalTime",label:s.fields.directions.ArrivalTime,isEditable:!0,tooltip:"",visible:c,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ArrivalUTCOffset",label:s.fields.directions.UTCOffset,isEditable:!1,tooltip:"",visible:c,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Azimuth",label:s.fields.directions.Azimuth,isEditable:!1,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Name",label:s.fields.directions.Name,isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"AlternateName",label:s.fields.directions.AlternativeName,isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ExitName",label:s.fields.directions.ExitName,isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"IntersectingName",label:s.fields.directions.IntersectingName,isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"BranchName",label:s.fields.directions.BranchName,isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"TowardName",label:s.fields.directions.TowardName,isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ShortVoiceInstruction",label:s.fields.directions.VoiceShortText,isEditable:!1,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"VoiceInstruction",label:s.fields.directions.VoiceFullText,isEditable:!1,tooltip:"",visible:!1,stringFieldOption:"textbox",isEditableOnLayer:!1}],description:null,showAttachments:!1,mediaInfos:[]},e.layers.push(l)},_addDirectionLinesToLayerInfo_100:function(e,t,i,r){var s=n.networkAnalysis,o=s.enums.esriDirectionsLineType,l=this._generateFeatureCollectionTemplate("DirectionLines",s.sharing.directionLinesLayer,"esriGeometryPolyline"),d=l.layerDefinition.fields;d.push(this._createField("DirectionPointID",s.fields.directionLines.DirectionPointID,"integer")),d.push(this._createField("DirectionLineType",s.fields.directionLines.LineType,"integer",!0,{type:"codedValue",name:"esriDirectionsLineType",codedValues:[{name:o.esriDLTUnknown,code:0},{name:o.esriDLTSegment,code:1},{name:o.esriDLTSegmentManeuver,code:2},{name:o.esriDLTSoftRestrictionViolation,code:3},{name:o.esriDLTBarrier,code:4},{name:o.esriDLTStopAndGoTraffic,code:5},{name:o.esriDLTSlowTraffic,code:6},{name:o.esriDLTModerateTraffic,code:7}]})),d.push(this._createField("Meters",s.fields.directionLines.Meters,"double",!0)),d.push(this._createField("Minutes",s.fields.directionLines.Minutes,"double",!0)),d.push(this._createField("FromLevel",s.fields.directionLines.LevelFrom,"integer")),d.push(this._createField("ToLevel",s.fields.directionLines.LevelTo,"integer"));for(var c=0,p=!1,f=!1,b=0;b<i.length;b++){var h=i[b],T=h.geometry,g=h.attributes;T&&g&&(p=p||T.hasM||!1,f=f||T.hasZ||!1,g.DirectionLineType=this._lineTypeStringToLineTypeCode(g.DirectionLineType),l.featureSet.features.push({geometry:T&&T.toJson?T.toJson():T,attributes:void 0!==g.__OBJECTID?g:a.mixin(g,{__OBJECTID:++c})}))}a.mixin(l.layerDefinition,{extent:r.toJson?r.toJson():r,hasM:p,hasZ:f});var y=new u(new m(this.directionLineSymbol));l.layerDefinition.drawingInfo.renderer=y.toJson(),l.popupInfo={title:s.sharing.directionLinesLayer,fieldInfos:[{fieldName:"DirectionLineType",label:s.fields.directionLines.LineType,isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Meters",label:s.fields.directionLines.Meters,isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"Minutes",label:s.fields.directionLines.Minutes,isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"DirectionPointID",label:s.fields.directionLines.DirectionPointID,isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"FromLevel",label:s.fields.directionLines.LevelFrom,isEditable:!1,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1},{fieldName:"ToLevel",label:s.fields.directionLines.LevelTo,isEditable:!1,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox",isEditableOnLayer:!1}],description:null,showAttachments:!1,mediaInfos:[]},e.layers.push(l)},_loadDirectionsFeatureSet_100:function(e,t,i,r,s,n){var o,l=[],d=function(e){for(var i=0;i<t.length;i++)if(t[i].attributes.DirectionSequence==e)return t[i];return null},u=a.hitch(this,function(t){for(var i=[],r=t;r<e.length&&0===e[r].attributes.DirectionPointType.indexOf("esriDPTEvent");)i.push({ETA:this.toGeolocalTime(e[r].attributes.ArrivalTime,e[r].attributes.ArrivalUTCOffset),arriveTimeUTC:null===e[r].attributes.ArrivalUTCOffset?void 0:e[r].attributes.ArrivalTime,strings:e[r].attributes.DisplayText?[{string:e[r].attributes.DisplayText,stringType:"esriDSTGeneral"}]:[],point:{x:e[r].geometry.x,y:e[r].geometry.y}}),r++;return i});for(o=0;o<e.length;o++)if(e[o].attributes.DirectionPointType=this._itemCodeToItemString(e[o].attributes.DirectionPointType),e[o].attributes.StopSequence)for(var c=0;c<i.length;c++)i[c].attributes.Sequence===e[o].attributes.StopSequence&&(e[o]._associatedStopRecord=i[c]);for(o=0;o<e.length;o++){var p=e[o].attributes.DirectionPointType;if(0===p.indexOf("esriDPTManeuver")||"esriDPTUnknown"===p){var f=d(e[o].attributes.Sequence),m=void 0!==e[o].geometry.m,b={attributes:{length:this.fromMeters(f&&f.attributes.Meters||e[o]._associatedStopRecord&&e[o]._associatedStopRecord.attributes.ServiceMeters||0,r),time:this.fromMinutes(f&&f.attributes.Minutes||e[o]._associatedStopRecord&&e[o]._associatedStopRecord.attributes.ServiceMinutes||0,s),text:e[o].attributes.DisplayText,ETA:this.toGeolocalTime(e[o].attributes.ArrivalTime,e[o].attributes.ArrivalUTCOffset),arriveTimeUTC:null===e[o].attributes.ArrivalUTCOffset?void 0:e[o].attributes.ArrivalTime,maneuverType:this._itemToManeuverType(p),_stopSequence:e[o].attributes.StopSequence},geometry:f?f.geometry:{paths:m?[[[e[o].geometry.x,e[o].geometry.y,e[o].geometry.m],[e[o].geometry.x,e[o].geometry.y,e[o].geometry.m]]]:[[[e[o].geometry.x,e[o].geometry.y],[e[o].geometry.x,e[o].geometry.y]]],hasM:m,spatialReference:n},strings:function(){var t=[],i=e[o].attributes;return i.Name&&t.push({string:i.Name,stringType:"esriDSTStreetName"}),i.AlternateName&&t.push({string:i.Name,stringType:"esriDSTAltName"}),i.ExitName&&t.push({string:i.Name,stringType:"esriDSTExit"}),i.IntersectingName&&t.push({string:i.Name,stringType:"esriDSTCrossStreet"}),i.BranchName&&t.push({string:i.Name,stringType:"esriDSTBranch"}),i.TowardName&&t.push({string:i.Name,stringType:"esriDSTToward"}),t}(),events:u(e[o].attributes.Sequence)};0===b.strings.length&&delete b.strings,l.push(b)}}return l},_generateFeatureCollectionTemplate:function(e,t,i){return{layerDefinition:{name:e,title:t,geometryType:i,objectIdField:"__OBJECTID",type:"Feature Layer",typeIdField:"",drawingInfo:{fixedSymbols:!0},fields:[{name:"__OBJECTID",alias:"OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1,domain:null}],types:[],capabilities:"Query,Update"},featureSet:{features:[],geometryType:i}}},_createField:function(e,t,i,r,s,a){return"integer"===i?{name:e,alias:t,type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!!r,domain:s}:"double"===i?{name:e,alias:t,type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!!r,domain:s}:"date"===i?{name:e,alias:t,type:"esriFieldTypeDate",length:36,editable:!0,nullable:!0,visible:!!r,domain:s}:{name:e,alias:t,type:"esriFieldTypeString",length:a||255,editable:!0,nullable:!0,visible:!!r,domain:s}},_itemToManeuverType:function(e){switch(e){case"esriDPTManeuverArrive":return"esriDMTStop";case"esriDPTManeuverDepart":return"esriDMTDepart";case"esriDPTManeuverDoor":return"esriDMTDoorPassage";case"esriDPTManeuverBearLeft":return"esriDMTBearLeft";case"esriDPTManeuverBearRight":return"esriDMTBearRight";case"esriDPTManeuverElevator":case"esriDPTManeuverElevatorUp":case"esriDPTManeuverElevatorDown":return"esriDMTElevator";case"esriDPTManeuverEscalator":case"esriDPTManeuverEscalatorDown":case"esriDPTManeuverEscalatorUp":return"esriDMTEscalator";case"esriDPTManeuverFerryOn":return"esriDMTFerry";case"esriDPTManeuverFerryOff":return"esriDMTEndOfFerry";case"esriDPTManeuverForkCenter":return"esriDMTForkCenter";case"esriDPTManeuverForkLeft":return"esriDMTForkLeft";case"esriDPTManeuverForkRight":return"esriDMTForkRight";case"esriDPTManeuverPedestrianRamp":return"esriDMTPedestrianRamp";case"esriDPTManeuverRampLeft":return"esriDMTRampLeft";case"esriDPTManeuverRampRight":return"esriDMTRampRight";case"esriDPTManeuverRoundabout":case"esriDPTManeuverRoundaboutLeft":case"esriDPTManeuverRoundaboutRight":return"esriDMTRoundabout";case"esriDPTManeuverTurnLeft":return"esriDMTTurnLeft";case"esriDPTManeuverTurnLeftLeft":return"esriDMTLeftLeft";case"esriDPTManeuverTurnLeftRight":return"esriDMTLeftRight";case"esriDPTManeuverTurnRight":return"esriDMTTurnRight";case"esriDPTManeuverTurnRightLeft":return"esriDMTRightLeft";case"esriDPTManeuverTurnRightRight":return"esriDMTRightRight";case"esriDPTManeuverSharpLeft":return"esriDMTSharpLeft";case"esriDPTManeuverSharpRight":return"esriDMTSharpRight";case"esriDPTManeuverStraight":return"esriDMTStraight";case"esriDPTManeuverStairs":case"esriDPTManeuverStairsUp":case"esriDPTManeuverStairsDown":return"esriDMTStrairs";case"esriDPTManeuverUTurn":case"esriDPTManeuverUTurnLeft":case"esriDPTManeuverUTurnRight":return"esriDMTUTurn"}return"esriDMTUnknown"},_itemStringToItemCode:function(e){switch(e){case"esriDPTUnknown":return 0;case"esriDPTHeader":return 1;case"esriDPTManeuverArrive":return 50;case"esriDPTManeuverDepart":return 51;case"esriDPTManeuverStraight":return 52;case"esriDPTManeuverFerryOn":return 100;case"esriDPTManeuverFerryOff":return 101;case"esriDPTManeuverForkCenter":return 102;case"esriDPTManeuverRoundabout":return 103;case"esriDPTManeuverUTurn":return 104;case"esriDPTManeuverDoor":return 150;case"esriDPTManeuverStairs":return 151;case"esriDPTManeuverElevator":return 152;case"esriDPTManeuverEscalator":return 153;case"esriDPTManeuverPedestrianRamp":return 154;case"esriDPTManeuverForkLeft":return 200;case"esriDPTManeuverRampLeft":return 201;case"esriDPTManeuverRoundaboutLeft":return 202;case"esriDPTManeuverUTurnLeft":return 203;case"esriDPTManeuverBearLeft":return 204;case"esriDPTManeuverTurnLeft":return 205;case"esriDPTManeuverSharpLeft":return 206;case"esriDPTManeuverTurnLeftLeft":return 207;case"esriDPTManeuverTurnLeftRight":return 208;case"esriDPTManeuverForkRight":return 300;case"esriDPTManeuverRampRight":return 301;case"esriDPTManeuverRoundaboutRight":return 302;case"esriDPTManeuverUTurnRight":return 303;case"esriDPTManeuverBearRight":return 304;case"esriDPTManeuverTurnRight":return 305;case"esriDPTManeuverSharpRight":return 306;case"esriDPTManeuverTurnRightLeft":return 307;case"esriDPTManeuverTurnRightRight":return 308;case"esriDPTManeuverElevatorUp":return 400;case"esriDPTManeuverEscalatorUp":return 401;case"esriDPTManeuverStairsUp":return 402;case"esriDPTManeuverElevatorDown":return 500;case"esriDPTManeuverEscalatorDown":return 501;case"esriDPTManeuverStairsDown":return 502;case"esriDPTEvent":return 1e3;case"esriDPTEventLandmark":return 1001;case"esriDPTEventTimeZone":return 1002;case"esriDPTEventTraffic":return 1003;case"esriDPTEventBarrier":return 1004;case"esriDPTEventBoundary":return 1005;case"esriDPTEventRestrictionViolation":return 1006}return 0},_itemCodeToItemString:function(e){switch(e){case 0:return"esriDPTUnknown";case 1:return"esriDPTHeader";case 50:return"esriDPTManeuverArrive";case 51:return"esriDPTManeuverDepart";case 52:return"esriDPTManeuverStraight";case 100:return"esriDPTManeuverFerryOn";case 101:return"esriDPTManeuverFerryOff";case 102:return"esriDPTManeuverForkCenter";case 103:return"esriDPTManeuverRoundabout";case 104:return"esriDPTManeuverUTurn";case 150:return"esriDPTManeuverDoor";case 151:return"esriDPTManeuverStairs";case 152:return"esriDPTManeuverElevator";case 153:return"esriDPTManeuverEscalator";case 154:return"esriDPTManeuverPedestrianRamp";case 200:return"esriDPTManeuverForkLeft";case 201:return"esriDPTManeuverRampLeft";case 202:return"esriDPTManeuverRoundaboutLeft";case 203:return"esriDPTManeuverUTurnLeft";case 204:return"esriDPTManeuverBearLeft";case 205:return"esriDPTManeuverTurnLeft";case 206:return"esriDPTManeuverSharpLeft";case 207:return"esriDPTManeuverTurnLeftLeft";case 208:return"esriDPTManeuverTurnLeftRight";case 300:return"esriDPTManeuverForkRight";case 301:return"esriDPTManeuverRampRight";case 302:return"esriDPTManeuverRoundaboutRight";case 303:return"esriDPTManeuverUTurnRight";case 304:return"esriDPTManeuverBearRight";case 305:return"esriDPTManeuverTurnRight";case 306:return"esriDPTManeuverSharpRight";case 307:return"esriDPTManeuverTurnRightLeft";case 308:return"esriDPTManeuverTurnRightRight";case 400:return"esriDPTManeuverElevatorUp";case 401:return"esriDPTManeuverEscalatorUp";case 402:return"esriDPTManeuverStairsUp";case 500:return"esriDPTManeuverElevatorDown";case 501:return"esriDPTManeuverEscalatorDown";case 502:return"esriDPTManeuverStairsDown";case 1e3:return"esriDPTEvent";case 1001:return"esriDPTEventLandmark";case 1002:return"esriDPTEventTimeZone";case 1003:return"esriDPTEventTraffic";case 1004:return"esriDPTEventBarrier";case 1005:return"esriDPTEventBoundary";case 1006:return"esriDPTEventRestrictionViolation"}return"esriDPTUnknown"},_lineTypeStringToLineTypeCode:function(e){switch(e){case"esriDLTSegment":return 1;case"esriDLTManeuverSegment":return 2;case"esriDLTRestrictionViolation":return 3;case"esriDLTBarrier":return 4;case"esriDLTStopAndGoTraffic":return 5;case"esriDLTSlowTraffic":return 6;case"esriDLTModerateTraffic":return 7}return 0},_lineTypeCodeToLineTypeString:function(e){switch(e){case 1:return"esriDLTSegment";case 2:return"esriDLTManeuverSegment";case 3:return"esriDLTRestrictionViolation";case 4:return"esriDLTBarrier";case 5:return"esriDLTStopAndGoTraffic";case 6:return"esriDLTSlowTraffic";case 7:return"esriDLTModerateTraffic"}return"esriDLTUnknown"}});return D});