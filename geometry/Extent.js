// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.6/esri/copyright.txt for details.

define(["require","exports","../core/tsSupport/declareExtendsHelper","../core/tsSupport/decorateHelper","../core/accessorSupport/decorators","./Geometry","./Point","./SpatialReference","../core/lang","./support/spatialReferenceUtils","./support/webMercatorUtils","./support/coordsUtils"],function(t,e,i,n,r,s,a,m,h,o,x,p){function c(t){return t&&("esri.SpatialReference"===t.declaredClass||null!=t.wkid)}function u(t,e,i){return null==e?i:null==i?e:t(e,i)}var y=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.apply(this,e)||this;return n.type="extent",n.xmin=0,n.ymin=0,n.mmin=void 0,n.zmin=void 0,n.xmax=0,n.ymax=0,n.mmax=void 0,n.zmax=void 0,n}return i(e,t),s=e,e.prototype.normalizeCtorArgs=function(t,e,i,n,r){return c(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:"object"==typeof t?(t.spatialReference=null!=t.spatialReference?t.spatialReference:m.WGS84,t):{xmin:t,ymin:e,xmax:i,ymax:n,spatialReference:null!=r?r:m.WGS84}},Object.defineProperty(e.prototype,"center",{get:function(){var t=new a({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extent",{get:function(){return this.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return null!=this.mmin&&null!=this.mmax},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return null!=this.zmin&&null!=this.zmax},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return Math.abs(this.ymax-this.ymin)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return Math.abs(this.xmax-this.xmin)},enumerable:!0,configurable:!0}),e.prototype.centerAt=function(t){var e=this.center;return null!=t.z&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)},e.prototype.clone=function(){var t=new s;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,null!=this.zmin&&(t.zmin=this.zmin,t.zmax=this.zmax),null!=this.mmin&&(t.mmin=this.mmin,t.mmax=this.mmax),t},e.prototype.contains=function(t){if(!t)return!1;if("point"===t.type){var e=this.spatialReference,i=t.spatialReference,n=void 0,r=t.x,s=t.y,a=t.z;return e&&i&&!e.equals(i)&&x.canProject(e,i)&&(n=e.isWebMercator?x.lngLatToXY(r,s):x.xyToLngLat(r,s,[0,0],0,!0),r=n[0],s=n[1]),r>=this.xmin&&r<=this.xmax&&s>=this.ymin&&s<=this.ymax?null!=a&&this.hasZ?a>=this.zmin&&a<=this.zmax:!0:!1}return"extent"===t.type?this._containsExtent(t):!1},e.prototype.equals=function(t){if(!t)return!1;var e=this.spatialReference;if(!e.equals(t.spatialReference)){if(!x.canProject(t.spatialReference,e))return!1;t=x.project(t,e)}return this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax},e.prototype.expand=function(t){var e=.5*(1-t),i=this.width*e,n=this.height*e;if(this.xmin+=i,this.ymin+=n,this.xmax-=i,this.ymax-=n,this.hasZ){var r=(this.zmax-this.zmin)*e;this.zmin+=r,this.zmax-=r}if(this.hasM){var s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this},e.prototype.intersects=function(t){if(!t)return!1;var e=this.spatialReference,i=t.spatialReference;switch(e&&i&&!e.equals(i)&&x.canProject(e,i)&&(t=e.isWebMercator?x.geographicToWebMercator(t):x.webMercatorToGeographic(t,!0)),t.type){case"point":return this.contains(t);case"multipoint":return this._intersectsMultipoint(t);case"extent":return this._intersectsExtent(t);case"polygon":return this._intersectsPolygon(t);case"polyline":return this._intersectsPolyline(t)}},e.prototype.normalize=function(){var t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]},e.prototype.offset=function(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,null!=i&&(this.zmin+=i,this.zmax+=i),this},e.prototype.shiftCentralMeridian=function(){return this._normalize(!0)},e.prototype.union=function(t){return this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=u(Math.min,this.zmin,t.zmin),this.zmax=u(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=u(Math.min,this.mmin,t.mmin),this.mmax=u(Math.max,this.mmax,t.mmax)),this},e.prototype.intersection=function(t){return this._intersectsExtent(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=u(Math.max,this.zmin,t.zmin),this.zmax=u(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=u(Math.max,this.mmin,t.mmin),this.mmax=u(Math.min,this.mmax,t.mmax)),this):null},e.prototype.toJSON=function(t){return this.write(null,t)},e.prototype._containsExtent=function(t){var e=t.xmin,i=t.ymin,n=t.zmin,r=t.xmax,s=t.ymax,m=t.zmax,h=t.spatialReference;return null!=n&&this.hasZ?this.contains(new a(e,i,n,h))&&this.contains(new a(e,s,n,h))&&this.contains(new a(r,s,n,h))&&this.contains(new a(r,i,n,h))&&this.contains(new a(e,i,m,h))&&this.contains(new a(e,s,m,h))&&this.contains(new a(r,s,m,h))&&this.contains(new a(r,i,m,h)):this.contains(new a(e,i,h))&&this.contains(new a(e,s,h))&&this.contains(new a(r,s,h))&&this.contains(new a(r,i,h))},e.prototype._intersectsMultipoint=function(t){for(var e=t.points.length,i=0;e>i;i++)if(this.contains(t.getPoint(i)))return!0;return!1},e.prototype._intersectsExtent=function(t){var e,i,n,r=this.hasZ&&t.hasZ;if(this.xmin<=t.xmin){if(e=t.xmin,this.xmax<e)return!1}else if(e=this.xmin,t.xmax<e)return!1;if(this.ymin<=t.ymin){if(i=t.ymin,this.ymax<i)return!1}else if(i=this.ymin,t.ymax<i)return!1;if(r&&t.hasZ)if(this.zmin<=t.zmin){if(n=t.zmin,this.zmax<n)return!1}else if(n=this.zmin,t.zmax<n)return!1;return!0},e.prototype._intersectsPolygon=function(t){for(var e=[this.xmin,this.ymax],i=[this.xmax,this.ymax],n=[this.xmin,this.ymin],r=[this.xmax,this.ymin],s=[e,i,n,r],m=new a(0,0,this.spatialReference),h=s.length,o=0;h>o;o++)if(m.x=s[o][0],m.y=s[o][1],t.contains(m))return!0;m.set({x:0,y:0,spatialReference:t.spatialReference});for(var x=t.rings,p=x.length,c=[[n,e],[e,i],[i,r],[r,n]],o=0;p>o;o++){var u=x[o],y=u.length;if(y){var l=u[0];if(m.x=l[0],m.y=l[1],this.contains(m))return!0;for(var f=1;y>f;f++){var d=u[f];if(m.x=d[0],m.y=d[1],this.contains(m)||this._intersectsLine([l,d],c))return!0;l=d}}}return!1},e.prototype._intersectsPolyline=function(t){for(var e=[[[this.xmin,this.ymin],[this.xmin,this.ymax]],[[this.xmin,this.ymax],[this.xmax,this.ymax]],[[this.xmax,this.ymax],[this.xmax,this.ymin]],[[this.xmax,this.ymin],[this.xmin,this.ymin]]],i=t.paths,n=i.length,r=new a(0,0,t.spatialReference),s=0;n>s;s++){var m=i[s],h=m.length;if(h){var o=m[0];if(r.x=o[0],r.y=o[1],this.contains(r))return!0;for(var x=1;h>x;x++){var p=m[x];if(r.x=p[0],r.y=p[1],this.contains(r)||this._intersectsLine([o,p],e))return!0;o=p}}}return!1},e.prototype._intersectsLine=function(t,e){for(var i=0;i<e.length;i++)if(p._getLineIntersection2(t,e[i]))return!0;return!1},e.prototype._shiftCM=function(t){if(void 0===t&&(t=o.getInfo(this.spatialReference)),!t||!this.spatialReference)return this;var e=this.spatialReference,i=this._getCM(t);if(i){var n=e.isWebMercator?x.webMercatorToGeographic(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(n.x=this._normalizeX(n.x,t).x),this.spatialReference=new m(h.substitute({Central_Meridian:n.x},e.isWGS84?t.altTemplate:t.wkTemplate))}return this},e.prototype._getCM=function(t){var e=null,i=t.valid,n=i[0],r=i[1],s=this.xmin,a=this.xmax,m=s>=n&&r>=s,h=a>=n&&r>=a;return m&&h||(e=this.center),e},e.prototype._normalize=function(t,e,i){var n=this.spatialReference;if(!n)return this;if(i=i||o.getInfo(n),!i)return this;var r=this._getParts(i).map(function(t){return t.extent});if(r.length<2)return r[0]||this;if(r.length>2)return t?this._shiftCM(i):this.set({xmin:i.valid[0],xmax:i.valid[1]});if(t)return this._shiftCM(i);if(e)return r;var s=!0,a=!0;return r.forEach(function(t){t.hasZ||(s=!1),t.hasM||(a=!1)}),{rings:r.map(function(t){var e=[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]];if(s)for(var i=(t.zmax-t.zmin)/2,n=0;n<e.length;n++)e[n].push(i);if(a)for(var r=(t.mmax-t.mmin)/2,n=0;n<e.length;n++)e[n].push(r);return e}),hasZ:s,hasM:a,spatialReference:n}},e.prototype._getParts=function(t){var e=this.cache._parts;if(!e){e=[];var i=this,n=i.ymin,r=i.ymax,a=i.spatialReference,m=this.width,h=this.xmin,x=this.xmax,p=void 0;t=t||o.getInfo(a);var c=t.valid,u=c[0],y=c[1];p=this._normalizeX(this.xmin,t);var l=p.x,f=p.frameId;p=this._normalizeX(this.xmax,t);var d=p.x,v=p.frameId,z=l===d&&m>0;if(m>2*y){var g=new s(x>h?l:d,n,y,r,a),M=new s(u,n,x>h?d:l,r,a),b=new s(0,n,y,r,a),w=new s(u,n,0,r,a),R=[],_=[];g.contains(b)&&R.push(f),g.contains(w)&&_.push(f),M.contains(b)&&R.push(v),M.contains(w)&&_.push(v);for(var P=f+1;v>P;P++)R.push(P),_.push(P);e.push({extent:g,frameIds:[f]},{extent:M,frameIds:[v]},{extent:b,frameIds:R},{extent:w,frameIds:_})}else l>d||z?e.push({extent:new s(l,n,y,r,a),frameIds:[f]},{extent:new s(u,n,d,r,a),frameIds:[v]}):e.push({extent:new s(l,n,d,r,a),frameIds:[f]});this.cache._parts=e}var O=this.hasZ,j=this.hasM;if(O||j){var Z={};O&&(Z.zmin=this.zmin,Z.zmax=this.zmax),j&&(Z.mmin=this.mmin,Z.mmax=this.mmax);for(var I=0;I<e.length;I++)e[I].extent.set(Z)}return e},e.prototype._normalizeX=function(t,e){var i,n=e.valid,r=n[0],s=n[1],a=2*s,m=0;return t>s?(i=Math.ceil(Math.abs(t-s)/a),t-=i*a,m=i):r>t&&(i=Math.ceil(Math.abs(t-r)/a),t+=i*a,m=-i),{x:t,frameId:m}},n([r.property({dependsOn:["xmin","ymin","zmin","mmin","xmax","ymax","zmax","mmax","spatialReference"]})],e.prototype,"cache",void 0),n([r.property({readOnly:!0,dependsOn:["cache"]})],e.prototype,"center",null),n([r.property({readOnly:!0,dependsOn:["cache"]})],e.prototype,"extent",null),n([r.property({readOnly:!0,dependsOn:["mmin","mmax"],json:{write:{enabled:!1,overridePolicy:null}}})],e.prototype,"hasM",null),n([r.property({readOnly:!0,dependsOn:["zmin","zmax"],json:{write:{enabled:!1,overridePolicy:null}}})],e.prototype,"hasZ",null),n([r.property({readOnly:!0,dependsOn:["ymin","ymax"]})],e.prototype,"height",null),n([r.property({readOnly:!0,dependsOn:["xmin","xmax"]})],e.prototype,"width",null),n([r.property({type:Number,json:{write:!0}})],e.prototype,"xmin",void 0),n([r.property({type:Number,json:{write:!0}})],e.prototype,"ymin",void 0),n([r.property({type:Number,json:{write:{overridePolicy:function(){return{enabled:this.hasM}}}}})],e.prototype,"mmin",void 0),n([r.property({type:Number,json:{write:{overridePolicy:function(){return{enabled:this.hasZ}}}}})],e.prototype,"zmin",void 0),n([r.property({type:Number,json:{write:!0}})],e.prototype,"xmax",void 0),n([r.property({type:Number,json:{write:!0}})],e.prototype,"ymax",void 0),n([r.property({type:Number,json:{write:{overridePolicy:function(){return{enabled:this.hasM}}}}})],e.prototype,"mmax",void 0),n([r.property({type:Number,json:{write:{overridePolicy:function(){return{enabled:this.hasZ}}}}})],e.prototype,"zmax",void 0),e=s=n([r.subclass("esri.geometry.Extent")],e);var s}(r.declared(s));return y.prototype.toJSON.isDefaultToJSON=!0,y});