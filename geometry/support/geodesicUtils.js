// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.6/esri/copyright.txt for details.

define(["require","exports","../Point","../Polygon","../Polyline","../SpatialReference"],function(e,a,t,r,s,i){function n(e,a,r,s){for(var n,h,o,M,c=6378137,l=6356752.31424518,u=1/298.257223563,v=Math.sin(r),f=Math.cos(r),p=(1-u)*Math.tan(e),g=1/Math.sqrt(1+p*p),d=p*g,y=Math.atan2(p,f),q=g*v*(g*v),m=1-q,S=m*(c*c-l*l)/(l*l),P=1+S/16384*(4096+S*(-768+S*(320-175*S))),D=S/1024*(256+S*(-128+S*(74-47*S))),w=s/(l*P),I=2*Math.PI;Math.abs(w-I)>1e-12;)o=Math.cos(2*y+w),n=Math.sin(w),h=Math.cos(w),M=D*n*(o+D/4*(h*(-1+2*o*o)-D/6*o*(-3+4*n*n)*(-3+4*o*o))),I=w,w=s/(l*P)+M;var x=d*n-g*h*f,R=Math.atan2(d*h+g*n*f,(1-u)*Math.sqrt(q+x*x)),z=Math.atan2(n*v,g*h-d*n*f),A=u/16*m*(4+u*(4-3*m)),b=z-(1-A)*u*Math.sqrt(q)*(w+A*n*(o+A*h*(-1+2*o*o))),N=R/(Math.PI/180),_=(a+b)/(Math.PI/180);return new t(_,N,new i({wkid:4326}))}function h(e,a,t,r){var s,i,n,h,o,M,c,l,u,v,f=6378137,p=6356752.31424518,g=1/298.257223563,d=r-a,y=Math.atan((1-g)*Math.tan(e)),q=Math.atan((1-g)*Math.tan(t)),m=Math.sin(y),S=Math.cos(y),P=Math.sin(q),D=Math.cos(q),w=1e3,I=d;do{if(c=Math.sin(I),l=Math.cos(I),n=Math.sqrt(D*c*(D*c)+(S*P-m*D*l)*(S*P-m*D*l)),0===n)return{geodesicDistance:0};o=m*P+S*D*l,M=Math.atan2(n,o),u=S*D*c/n,i=1-u*u,h=o-2*m*P/i,isNaN(h)&&(h=0),v=g/16*i*(4+g*(4-3*i)),s=I,I=d+(1-v)*g*u*(M+v*n*(h+v*o*(-1+2*h*h)))}while(Math.abs(I-s)>1e-12&&--w>0);if(0===w){var x=6371009,R=Math.acos(Math.sin(e)*Math.sin(t)+Math.cos(e)*Math.cos(t)*Math.cos(r-a))*x,z=r-a,A=Math.sin(z)*Math.cos(t),b=Math.cos(e)*Math.sin(t)-Math.sin(e)*Math.cos(t)*Math.cos(z),N=Math.atan2(A,b);return{geodesicDistance:R,azimuth:N}}var _=i*(f*f-p*p)/(p*p),C=1+_/16384*(4096+_*(-768+_*(320-175*_))),F=_/1024*(256+_*(-128+_*(74-47*_))),G=F*n*(h+F/4*(o*(-1+2*h*h)-F/6*h*(-3+4*n*n)*(-3+4*h*h))),K=p*C*(M-G),Y=Math.atan2(D*Math.sin(I),S*P-m*D*Math.cos(I)),j=Math.atan2(S*Math.sin(I),S*P*Math.cos(I)-m*D);return{geodesicDistance:K,azimuth:Y,reverseAzimuth:j}}function o(e,a){var t=Math.PI/180,i=6371008.771515059;if(i/1e4>a&&(a=i/1e4),"polyline"!==e.type&&"polygon"!==e.type){var o="_geodesicDensify: the input geometry is neither polyline nor polygon";throw console.error(o),new Error(o)}for(var M="polyline"===e.type?e.paths:e.rings,c=[],l=0,u=M;l<u.length;l++){var v=u[l],f=[];c.push(f),f.push([v[0][0],v[0][1]]);for(var p=v[0][0]*t,g=v[0][1]*t,d=void 0,y=void 0,q=0;q<v.length-1;q++)if(d=v[q+1][0]*t,y=v[q+1][1]*t,p!==d||g!==y){var m=h(g,p,y,d),S=m.azimuth,P=m.geodesicDistance,D=P/a;if(D>1){for(var w=1;D-1>=w;w++){var I=w*a,x=n(g,p,S,I);f.push([x.x,x.y])}var R=(P+Math.floor(D-1)*a)/2,z=n(g,p,S,R);f.push([z.x,z.y])}var A=n(g,p,S,P);f.push([A.x,A.y]),p=A.x*t,g=A.y*t}}return"polyline"===e.type?new s({paths:c,spatialReference:e.spatialReference}):new r({rings:c,spatialReference:e.spatialReference})}function M(e,a){for(var t=Math.PI/180,r=[],s=0;s<e.length;s++){for(var i=e[s].paths,n=0,o=0;o<i.length;o++){for(var M=i[o],c=0,l=1;l<M.length;l++){var v=M[l-1][0]*t,f=M[l][0]*t,p=M[l-1][1]*t,g=M[l][1]*t;if(p!==g||v!==f){var d=h(p,v,g,f);c+=d.geodesicDistance/1609.344}}n+=c}n*=u[a],r.push(n)}return r}function c(e,a){for(var t=[],r=0;r<e.length;r++){var s=e[r],i=o(s,1e4);t.push(i)}for(var n=[],h=0;h<t.length;h++){for(var M=t[h].rings,c=0,p=0;p<M.length;p++){var g=M[p];l(v,g[0]),l(f,g[g.length-1]);for(var d=f[0]*v[1]-v[0]*f[1],y=0;y<g.length-1;y++)l(v,g[y+1]),l(f,g[y]),d+=f[0]*v[1]-v[0]*f[1];d/=4046.87,c+=d}c*=u[a],n.push(c/-2)}return n}function l(e,a){var t=Math.PI/180,r=6378137,s=.006694379990197414,i=.0818191908429643,n=Math.sin(a[1]*t),h=(1-s)*(n/(1-s*(n*n))-1/(2*i)*Math.log((1-i*n)/(1+i*n))),o=r*a[0]*t,M=r*h*.5;return e[0]=o,e[1]=M,e}Object.defineProperty(a,"__esModule",{value:!0});var u={esriMiles:1,esriKilometers:1.609344,esriFeet:5280,esriMeters:1609.34,esriYards:1760,esriNauticalMiles:.869,esriCentimeters:160934,esriDecimeters:16093.4,esriInches:63360,esriMillimeters:1609340,esriAcres:1,esriAres:40.4685642,esriSquareKilometers:.00404685642,esriSquareMiles:.0015625,esriSquareFeet:43560,esriSquareMeters:4046.85642,esriHectares:.404685642,esriSquareYards:4840,esriSquareInches:6272640,esriSquareMillimeters:4046856420,esriSquareCentimeters:40468564.2,esriSquareDecimeters:404685.642};a.directGeodeticSolver=n,a.inverseGeodeticSolver=h,a.geodesicDensify=o,a.geodesicLengths=M;var v=[0,0],f=[0,0];a.geodesicAreas=c});