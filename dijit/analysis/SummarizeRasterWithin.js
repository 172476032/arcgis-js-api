// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.21/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/has","dojo/dom-class","dojo/dom-style","dojo/string","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_OnDijitClickMixin","dijit/_FocusMixin","../../kernel","../../lang","./RasterAnalysisMixin","./utils","dojo/i18n!../../nls/jsapi","dojo/text!./templates/SummarizeRasterWithin.html"],function(e,t,a,i,s,l,n,r,u,o,h,y,d,p,m,v,c,L,_){var g=e([u,o,h,y,d,v],{declaredClass:"esri.dijit.analysis.SummarizeRasterWithin",templateString:_,widgetsInTemplate:!0,inputLayer:null,valueLayer:null,valueLayers:null,zoneField:null,ignoreNoData:!0,statsType:null,toolName:"SummarizeRasterWithin",helpFileName:"SummarizeRasterWithin",toolNlsName:L.summarizeRasterWithinTool,rasterGPToolName:"SummarizeRasterWithin",resultParameter:"outputRaster",_getJobParameters:function(){var e=i.toJson(c.constructAnalysisInputLyrObj(this.get("inputLayer"))),t=i.toJson(c.constructAnalysisInputLyrObj(this.get("valueLayer"))),a=this.get("zoneField"),s=this.get("ignoreNoData"),l=this.get("statsType");return{zoneField:a,ignoreMissingValues:s,statisticType:l,inputZoneLayer:e,inputRasterLayertoSummarize:t}},_setDefaultInputs:function(){this.valueLayers&&a.forEach(this.valueLayers,function(e,t){this._layersSelect.addOption({value:t,label:e.name}),0===t&&this.set("valueLayer",e)},this),this.zoneField&&this._zoneFieldSelect.set("value",this.zoneField),this.statsType&&this._statsTypeSelect.set("value",this.statsType),this._ignoreNoDataCheck.set("check",this.ignoreNoData)},_resetUI:function(){this.set("zoneField",this.zoneField),this.inputLayer&&this.valueLayer&&(this.outputLayerName=r.substitute(this.i18n.outputLayerNameFull,{layername:this.inputLayer.name,valuelayername:this.valueLayer.name}),this._outputLayerInput.set("value",this.outputLayerName))},_loadStatsType:function(){this._statsTypeSelect.removeOption(this._statsTypeSelect.getOptions()),this.valueLayer&&("U"===this.valueLayer.pixelType.charAt(0)||"S"===this.valueLayer.pixelType.charAt(0)?this._statsTypeSelect.addOption([{value:"MEAN",label:this.i18n.average},{value:"MAJORITY",label:this.i18n.majority},{value:"MAXIMUM",label:this.i18n.maximum},{value:"MEDIAN",label:this.i18n.median},{value:"MINIMUM",label:this.i18n.minimum},{value:"MINORITY",label:this.i18n.minority},{value:"RANGE",label:this.i18n.range},{value:"STD",label:this.i18n.standardDeviation},{value:"SUM",label:this.i18n.sum},{value:"VARIETY",label:this.i18n.variety}]):this._statsTypeSelect.addOption([{value:"MEAN",label:this.i18n.average},{value:"MAJORITY",label:this.i18n.majority},{value:"MAXIMUM",label:this.i18n.maximum},{value:"MINIMUM",label:this.i18n.minimum},{value:"RANGE",label:this.i18n.range},{value:"STD",label:this.i18n.standardDeviation},{value:"SUM",label:this.i18n.sum}]))},_handleLayerChange:function(e){this.set("valueLayer",this.valueLayers[this._layersSelect.get("value")]),this.inputLayer&&this.valueLayer&&(this.outputLayerName=r.substitute(this.i18n.outputLayerNameFull,{layername:this.inputLayer.name,valuelayername:this.valueLayer.name}),this._outputLayerInput.set("value",this.outputLayerName))},_getValueLayerAttr:function(){return this.valueLayer=this.valueLayers[this._layersSelect.get("value")],this.valueLayer},_setValueLayerAttr:function(e){this.valueLayer=e,this._loadStatsType()},_setValueLayersAttr:function(e){this.valueLayers=e,this.valueLayer=this.valueLayers[0]},_getValueLayersAttr:function(){return this.valueLayers},_setZoneFieldAttr:function(e){if(this._zoneFieldSelect.removeOption(this._zoneFieldSelect.getOptions()),this.inputLayer){var t;if("esri.layers.ArcGISImageServiceLayer"===this.inputLayer.declaredClass){if(!this.inputLayer.hasRasterAttributeTable)return void this._zoneFieldSelect.addOption({value:"VALUE",label:"VALUE"});t=this.inputLayer._rasterAttributeTableFields}else if(t=this.inputLayer.fields,!t)return;a.forEach(t,function(e){"esriFieldTypeOID"!==e.type&&this._zoneFieldSelect.addOption({value:e.name,label:m.isDefined(e.alias)&&""!==e.alias?e.alias:e.name})},this)}},_getZoneFieldAttr:function(){return this._zoneFieldSelect&&this._zoneFieldSelect.get("value")&&(this.zoneField=this._zoneFieldSelect.get("value")),this.zoneField},_setIgnoreNoDataAttr:function(e){this.ignoreNoData=e},_getIgnoreNoDataAttr:function(){return this._ignoreNoDataCheck&&(this.ignoreNoData=this._ignoreNoDataCheck.get("checked")),this.ignoreNoData},_setStatsTypeAttr:function(e){this.statsType=e},_getStatsTypeAttr:function(){return this._statsTypeSelect&&this._statsTypeSelect.get("value")&&(this.statsType=this._statsTypeSelect.get("value")),this.statsType}});return s("extend-esri")&&t.setObject("dijit.analysis.SummarizeRasterWithin",g,p),g});