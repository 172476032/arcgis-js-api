// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.23/esri/copyright.txt for details.

define(["require","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/event","dojo/_base/kernel","dojo/aspect","dojo/has","dojo/dom-construct","dojo/dom-class","dojo/dom-attr","dojo/dom-style","dojo/query","dojo/window","dojo/dom-geometry","dijit/_Widget","dijit/TooltipDialog","dijit/popup","../../kernel","../../lang","../../urlUtils","../../request","../_EventedWidget","dojo/i18n!../../nls/jsapi"],function(e,i,t,s,o,l,n,h,a,r,p,d,c,f,g,m,u,v,w,H,y,j,_,M,x){var P=t([u],{declaredClass:"esri.dijit.analysis.HelpWindow",i18n:null,onlineHelpMap:null,showLearnMore:!1,class:"esriAnalyisHelpWindow",constructor:function(e){this.isPortal=e&&e.isPortal},postMixInProperties:function(){this.inherited(arguments),this.i18n={},s.mixin(this.i18n,x.common),s.mixin(this.i18n,x.analysisHelp)},postCreate:function(){this.inherited(arguments);var i,t,o,l,h=["ar","he"];for(this.onlineHelpMap={},i=0;i<h.length;i+=1)t=h[i],n.locale&&-1!==n.locale.indexOf(t)&&(-1!==n.locale.indexOf("-")?-1!==n.locale.indexOf(t+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);l=this.isPortal?"./help/helpmap_enterprise.json":"./help/helpmap.json",o=e.toUrl(l),_({url:o}).then(s.hitch(this,function(e){this.onlineHelpMap=e.map}))},_getAbsoluteUrl:function(e){var i=j.getProtocolForWebResource();return/^https?\:/i.test(e)?e:/^\/\//i.test(e)?i+e:/^\//i.test(e)?i+"//"+window.location.host+e:void 0},_computeSize:function(e){var i={w:400,h:200};return a("esri-mobile")?i={w:"50%",h:"90%"}:-1!==e.indexOf("Category")?(i.w=400,i.h=320):-1!==e.indexOf("Tool")?(i.w=400,i.h=320):-1!==e.indexOf("toolDescription")&&(i.w=400,i.h=520),i},_setHelpTopicAttr:function(t){this.tooltipHelpDlg&&(w.close(this.tooltipHelpDlg),this.tooltipHelpDlg.destroy(),this.tooltipHelpDlg=null);var o,l,h,a,r,p,d,c,f,g,m,u="";this.showLearnMore=!1,f=this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("dev")?"dev":this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("qa")?"uat":"",u=this.isPortal?"-PortalOnly":"-OnlineOnly",o=s.clone(n.locale),"nb"===o&&(o="no"),l=["ar","bs","cs","da","de","es","el","et","fi","fr","hi","hr","id","it","ja","ko","lt","lv","ru","nl","no","pl","pt-br","pt-pt","ro","sl","sv","sr","th","tr","vi","zh-cn","zh-hk","zh-tw"],g=["ar","de","es","fr","it","ja","ko","ru","pl","pt-br","zh-cn","zh-hk","zh-tw"],h="esri/dijit/analysis/help/","SHOWHELPURL"===t?(p=this.helpIdUrl,this.showLearnMore=!1):(p=e.toUrl(h+this.helpFileName+".html"),m=this.helpFileName,y.isDefined(this.onlineHelpMap[m])&&y.isDefined(this.onlineHelpMap[m][t])&&(this.showLearnMore=!0,c="http://doc"+f+".arcgis.com/en/arcgis-online/analyze/"+this.onlineHelpMap[m][t],this.isPortal&&this.helpBase?c=this.helpBase+"index.html#"+this.onlineHelpMap[m][t]:this.isPortal&&!this.helpBase&&(c="http://server"+f+".arcgis.com/en/portal/latest/use/"+this.onlineHelpMap[m][t])),-1!==i.indexOf(l,o)&&(-1!==o.indexOf("-")&&(d=o.split("-"),o=d[0]+"-"+d[1].toUpperCase()),p=e.toUrl(h+o+"/"+this.helpFileName+".html")),-1!==i.indexOf(g,o)&&this.showLearnMore&&(c="http://doc"+f+".arcgis.com/"+o+"/arcgis-online/analyze/"+this.onlineHelpMap[m][t],this.isPortal&&this.helpBase?c=this.helpBase+"index.html#"+this.onlineHelpMap[m][t]:this.isPortal&&!this.helpBase&&(c="http://server"+f+".arcgis.com/"+o+"/portal/latest/use/"+this.onlineHelpMap[m][t]))),a=this._computeSize(t),this._size=a,r="<div class='' style='position:relative'<div class='sizer content'><div class='contentPane'><div class='esriFloatTrailing' style='padding:0;'><a href='#' class='esriAnalysisCloseIcon' title='"+this.i18n.close+"'></a></div><iframe frameborder='0'  id='"+t+"' src='"+p+"#"+t+u+"' width='"+a.w+"' height='"+a.h+"' marginheight='0' marginwidth='0'></iframe></div></div><div class='sizer'><div class='actionsPane'><div class='actionList"+(this.showLearnMore?"'>":" hidden'>")+"<a class='action zoomTo' href='"+(this.showLearnMore?c:"#")+"' target='_help'>"+this.i18n.learnMore+"</a></div></div></div></div></div>",this.tooltipHelpDlg=new v({preload:!0,content:r,class:"esriHelpPopup esriHelpPopupWrapper esriAnalyisHelpWindow"}),this.tooltipHelpDlg.startup()},show:function(e,i){this.helpFileName=i.helpFileName,this._analysisGpServer=i.analysisGpServer,this.isPortal=i.isPortal,this.helpBase=i.helpBase,i.analysisMode&&(this.analysisMode=i.analysisMode),i.showHelpFromUrl&&i.helpUrl&&(this.showHelpFromUrl=i.showHelpFromUrl,this.helpIdUrl=i.helpUrl,i.helpId="SHOWHELPURL"),this.set("helpTopic",i.helpId);var t,o,l,n=h.after(w,"open",s.hitch(this,function(){f(".esriAnalysisCloseIcon",this.tooltipHelpDlg.domNode).on("click",s.hitch(this,this.close)),n.remove()})),a=e.pageX,r=g.getBox();l=!1,i.helpParentNode&&(t=i.helpParentNode),t&&(o=m.position(t)),o&&r.w-e.pageX<o.w?(l=!0,a=o.x-this._size.w-10,this._isRightToLeft&&(a-=10)):this._isRightToLeft&&a-40<this._size.w&&(a=o.w+this._size.w+80),w.open({popup:this.tooltipHelpDlg,x:!0===this._isRightToLeft||l?a-40:a+40,y:e.screenY-e.pageY+10,onCancel:s.hitch(this,function(){this.close()}),onExecute:function(){this.close()}}),this.tooltipHelpDlg.domNode.parentNode&&c.set(this.tooltipHelpDlg.domNode.parentNode,"overflowY","hidden")},close:function(e,i){w.close(this.tooltipHelpDlg)}});return a("extend-esri")&&s.setObject("dijit.analysis.HelpWindow",P,H),P});