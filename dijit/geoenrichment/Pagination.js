// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.21/esri/copyright.txt for details.

define(["../../declare","dojo/_base/lang","dojo/_base/array","dojox/mvc/Templated","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/dom-construct","dojo/dom-style","dojo/on","dojo/sniff","dijit/layout/_LayoutWidget","dgrid/List","./AnimationHelper","dojo/text!./templates/Pagination.html","dijit/layout/ContentPane"],function(t,i,e,n,a,s,r,o,h,l,c,d,g,u,m){return t("esri.dijit.geoenrichment.Pagination",[n,d],{templateString:m,autoCenter:!1,scrollAnimation:!0,cyclicPagination:!1,alwaysShowArrows:!1,items:null,currentPage:0,_pageCount:0,_pageSize:0,_animation:null,_itemMargins:null,clickEventType:null,constructor:function(){this._animation=new u,this.clickEventType=c("touch")?"touchstart, click":"click"},createItemContainer:function(){},updateItemContainer:function(t,i){},onSelect:function(t){},layout:function(){function t(){return n.scrollHeight-2>n.clientHeight}this._animation.finish();var e=this.items;if(!e||!e.length)return void this.set("items",[]);var n=this.itemsNode.parentNode;if(n&&n.clientHeight){var a=this._parseAutoCenterOption(this.autoCenter);a.type&&h.set(n,"padding","0px");var s=this.itemsNode.firstChild;s||(s=o.create("div",null,this.itemsNode)),"stretch"==a.type&&(this._itemMargins={},s.innerHTML="");for(var c=s.children;!t()&&(a.type||c.length<e.length);){var d=this.createItemContainer();l(d,this.clickEventType,i.hitch(this,this._onItemClick,d)),s.appendChild(d)}for(;t()&&c.length>1;)o.destroy(s.lastChild);var g=c.length;if(a.type){d=s.firstChild;var u=h.getComputedStyle(d),m=r.getMarginBox(d,u);if("stretch"==a.type)var p=r.getMarginExtents(d,u);var f=Math.floor(s.clientHeight/m.h),_=s.clientHeight/f;f=Math.max(Math.floor(n.clientHeight/_),f);var v=g/f;a.heightLimit&&f>a.heightLimit&&(f=a.heightLimit),a.widthLimit&&v>a.widthLimit&&(v=a.widthLimit),g=f*v;var C=Math.max(n.clientWidth-v*m.w,0),y=Math.max(n.clientHeight-f*_,0)}var P=this._pageSize=Math.min(g,e.length),w=this._pageCount=Math.ceil(this.items.length/P);if(a.type&&a.height){if("stretch"==a.type){var M=Math.floor(y/f);y-=M*f,this._itemMargins.marginTop=(Math.floor(M/2)+p.t).toString()+"px",this._itemMargins.marginBottom=(Math.ceil(M/2)+p.b).toString()+"px"}h.set(n,{paddingTop:Math.floor(y/2).toString()+"px",paddingBottom:"0"})}this.currentPage=this._coerceCurrentPage(this.currentPage);for(var N=0,b=P*this.currentPage;P>N&&b<e.length;)this.updateItemContainer(c[N++],e[b++]);for(;N<c.length;)o.destroy(s.lastChild);for(a.type&&a.width&&("stretch"==a.type?(M=Math.floor(C/v),C-=M*v,this._itemMargins.marginLeft=(Math.floor(M/2)+p.l).toString()+"px",this._itemMargins.marginRight=(Math.ceil(M/2)+p.r).toString()+"px"):M=0,1==w&&v>P&&!a.preventSingleRowCenter&&(C=Math.max(n.clientWidth-(m.w+M)*P,0)),C=Math.floor(C/2).toString()+"px",h.set(n,{paddingLeft:C,paddingRight:C})),N=this._itemMargins?0:c.length;N<c.length;)h.set(c[N++],this._itemMargins);if(this.bulletsNode&&(o.empty(this.bulletsNode),w>1))for(var A=0;w>A;A++){var S=o.create("span",{"class":"Pagination_Bullet",innerHTML:"&nbsp;"},this.bulletsNode);l(S,this.clickEventType,i.hitch(this,function(t){this._started=!0,this.set("currentPage",t),this.emit("page-is-changed-manually")},A))}this._updateNavigationControls()}},_parseAutoCenterOption:function(t){if(!t)return{};var i={type:"center"};switch("string"!=typeof t&&(t=""),"$"==t.charAt(0)&&(i.preventSingleRowCenter=!0,t=t.substr(1)),t){case"width":return i.width=!0,i;case"height":return i.height=!0,i;default:if(0!=t.indexOf("stretch"))return i.width=i.height=!0,i}i.type="stretch",t=t.substr(7);var n=t.indexOf(":"),a=0>n?t:t.substr(0,n);switch(t=0>n?"":t.substr(n+1),a){case"-width":i.width=!0;break;case"-height":i.height=!0;break;default:i.width=i.height=!0}return t?(t=t.split(","),n=0,e.forEach(["width","height"],function(e){if(i[e]){var a=Number(t[n++]);!isNaN(a)&&a>0&&(i[e+"Limit"]=a)}}),i):i},_onItemClick:function(t){this.onSelect(t)},_coerceCurrentPage:function(t){return t>=this._pageCount&&(t=this._pageCount-1),0>t&&(t=0),t},_updateNavigationControls:function(){var t=this.currentPage,i=this._pageCount<=1,e=i&&!this.alwaysShowArrows?"none":"",n=["Pagination_TriangleDisabled","Pagination_TriangleEnabled"];if(this.backNode){var a=i||0==t&&!this.cyclicPagination?0:1;s.replace(this.backNode,n[a],n[1-a]),this.backNode.style.display=e}if(this.forwardNode&&(a=i||t==this._pageCount-1&&!this.cyclicPagination?0:1,s.replace(this.forwardNode,n[a],n[1-a]),this.forwardNode.style.display=e),this.bulletsNode)for(var r=this.bulletsNode.children,o=0;o<r.length;o++)o==t?s.add(r[o],"Pagination_BulletCurrent"):s.remove(r[o],"Pagination_BulletCurrent")},_setItemsAttr:function(t){this.items=t,o.empty(this.itemsNode),this.bulletsNode&&o.empty(this.bulletsNode),this.currentPage=0,this._pageCount=0,this._updateNavigationControls()},selectPageByItemIndex:function(t,i){0>t||!this.items||t>=this.items.length||this._pageCount<=1||this.set("currentPage",Math.floor(t/this._pageSize),i)},selectItem:function(t){var i=e.indexOf(this.items,t);if(-1!=i&&!(0>i||!this.items||i>=this.items.length||this._pageCount<=1)){var n=this.items.length%this._pageSize,a=this.itemsNode.firstChild.children[n];a&&this.onSelect(a)}},navigateToItem:function(t){var i=e.indexOf(this.items,t);this.selectPageByItemIndex(i,!0)},_setCurrentPageAttr:function(t,e){this._animation.finish();var n;if("next"==t?(n="forward",t=this.currentPage+1,this.cyclicPagination&&t==this._pageCount&&(t=0)):"prev"==t?(n="backward",t=this.currentPage-1,this.cyclicPagination&&-1==t&&(t=this._pageCount-1)):n=this.scrollAnimation===!0?"fade1":this.scrollAnimation,e===!0&&(n=""),t=this._coerceCurrentPage(t),this.currentPage!=t){for(var a=this.items||[],s=this.itemsNode,r=0,c=this._pageSize*t,d=this.itemsNode.firstChild,g=o.create("div");r++<this._pageSize&&c<a.length;){var u=this.createItemContainer();l(u,this.clickEventType,i.hitch(this,this._onItemClick,u)),this._itemMargins&&h.set(u,this._itemMargins),this.updateItemContainer(u,a[c++]),g.appendChild(u)}switch(n){case"forward":this._slideAnimation(s,d,g,!0);break;case"backward":this._slideAnimation(s,d,g,!1);break;default:if(n&&(n=n?"_"+n+"Animation":null,"function"==typeof this[n])){this[n](s,d,g,t>this.currentPage);break}o.empty(s),s.appendChild(g)}this.currentPage=t,this._updateNavigationControls()}},_slideAnimation:function(t,i,e,n){n?t.appendChild(e):t.insertBefore(e,t.firstChild),this.isLeftToRight()||(n=!n),t.parentNode.style.overflow="hidden",this._animation.start([{node:t,classes:["Pagination_SlideAnim",n?"Anim_SlideLeft":"Anim_SlideRight"]}],i).then(function(){t.parentNode.style.overflow=""})},_fade1Animation:function(t,i,e){t.appendChild(e),this._animation.start([{node:i,classes:["Pagination_FadeAnim","Anim_FadeOut"]},{node:e,classes:["Pagination_FadeAnim","Anim_FadeIn"]}],i)},_fade2Animation:function(t,i,e){var n=this._animation;n.start([{node:i,classes:["Pagination_FadeAnim","Anim_FadeOut"]}],i).then(function(){t.appendChild(e),n.start([{node:e,classes:["Pagination_FadeAnim","Anim_FadeIn"]}],i)})},_backward:function(){this.set("currentPage","prev")},_forward:function(){this.set("currentPage","next")}})});