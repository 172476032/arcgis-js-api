// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.25/esri/copyright.txt for details.

define(["../../declare","dojo/_base/lang","dojo/_base/array","dojox/mvc/Templated","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/dom-construct","dojo/dom-style","dojo/on","dojo/sniff","dijit/layout/_LayoutWidget","dgrid/List","./AnimationHelper","dojo/text!./templates/Pagination.html","dijit/layout/ContentPane"],function(t,i,e,n,a,s,o,r,h,d,l,c,g,u,m){return t("esri.dijit.geoenrichment.Pagination",[n,c],{templateString:m,autoCenter:!1,scrollAnimation:!0,cyclicPagination:!1,alwaysShowArrows:!1,items:null,currentPage:0,_pageCount:0,_pageSize:0,_animation:null,_itemMargins:null,clickEventType:null,constructor:function(){var t=this;this._animation=new u,this._animation.onNodePreDestroy=function(i){t.onNodePreDestroy(i)},this.clickEventType=l("touch")?"touchstart, click":"click"},createItemContainer:function(){},updateItemContainer:function(t,i){},onNodePreDestroy:function(t){},onNodePlaced:function(t,i){},onSelect:function(t){},onPageChanged:function(){},layout:function(){function t(){return n.scrollHeight-2>n.clientHeight}this._animation.finish();var e=this.items;if(!e||!e.length)return void this.set("items",[]);var n=this.itemsNode.parentNode;if(n&&n.clientHeight){var a=this._parseAutoCenterOption(this.autoCenter);a.type&&h.set(n,"padding","0px");var l=this.itemsNode.firstChild;l||(l=r.create("div",null,this.itemsNode),s.add(l,"PaginationItemsNodeChildDiv")),"stretch"==a.type&&(this._itemMargins={},l.innerHTML="");for(var c=l.children;!t()&&(a.type||c.length<e.length);){var g=this.createItemContainer();d(g,this.clickEventType,i.hitch(this,this._onItemClick,g)),l.appendChild(g)}for(;t()&&c.length>1;)r.destroy(l.lastChild);var u=c.length;if(a.type){g=l.firstChild;var m=h.getComputedStyle(g),f=o.getMarginBox(g,m);if("stretch"==a.type)var p=o.getMarginExtents(g,m);var _=Math.max(1,Math.floor(l.clientHeight/f.h)),v=l.clientHeight/_;_=Math.max(Math.floor(n.clientHeight/v),_);var y=u/_;a.heightLimit&&_>a.heightLimit&&(_=a.heightLimit),a.widthLimit&&y>a.widthLimit&&(y=a.widthLimit),u=_*y;var C=Math.max(n.clientWidth-y*f.w,0),P=Math.max(n.clientHeight-_*v,0)}var N=this._pageSize=Math.min(u,e.length),w=this._pageCount=Math.ceil(this.items.length/N);if(a.type&&a.height){if("stretch"==a.type){var M=Math.floor(P/_);P-=M*_,this._itemMargins.marginTop=(Math.floor(M/2)+p.t).toString()+"px",this._itemMargins.marginBottom=(Math.ceil(M/2)+p.b).toString()+"px"}h.set(n,{paddingTop:Math.floor(P/2).toString()+"px",paddingBottom:"0"})}this.currentPage=this._coerceCurrentPage(this.currentPage);for(var b=0,A=N*this.currentPage;b<N&&A<e.length;){g=c[b++];var x=e[A++];this.updateItemContainer(g,x),this.onNodePlaced(g,x)}for(;b<c.length;)r.destroy(l.lastChild);for(a.type&&a.width&&("stretch"==a.type?(M=Math.floor(C/y),C-=M*y,this._itemMargins.marginLeft=(Math.floor(M/2)+p.l).toString()+"px",this._itemMargins.marginRight=(Math.ceil(M/2)+p.r-1).toString()+"px"):M=0,1==w&&N<y&&!a.preventSingleRowCenter&&(C=Math.max(n.clientWidth-(f.w+M)*N,0)),C=Math.floor(C/2).toString()+"px",h.set(n,{paddingLeft:C,paddingRight:C})),b=this._itemMargins?0:c.length;b<c.length;)h.set(c[b++],this._itemMargins);if(this.bulletsNode&&(r.empty(this.bulletsNode),w>1))for(var S=0;S<w;S++){var k=r.create("span",{class:"Pagination_Bullet",innerHTML:"&nbsp;"},this.bulletsNode);d(k,this.clickEventType,i.hitch(this,function(t){this._started=!0,this.set("currentPage",t),this.emit("page-is-changed-manually")},S))}this._updateNavigationControls()}},_parseAutoCenterOption:function(t){if(!t)return{};var i={type:"center"};switch("string"!=typeof t&&(t=""),"$"==t.charAt(0)&&(i.preventSingleRowCenter=!0,t=t.substr(1)),t){case"width":return i.width=!0,i;case"height":return i.height=!0,i;default:if(0!=t.indexOf("stretch"))return i.width=i.height=!0,i}i.type="stretch",t=t.substr(7);var n=t.indexOf(":"),a=n<0?t:t.substr(0,n);switch(t=n<0?"":t.substr(n+1),a){case"-width":i.width=!0;break;case"-height":i.height=!0;break;default:i.width=i.height=!0}return t?(t=t.split(","),n=0,e.forEach(["width","height"],function(e){if(i[e]){var a=Number(t[n++]);!isNaN(a)&&a>0&&(i[e+"Limit"]=a)}}),i):i},_onItemClick:function(t){this.onSelect(t)},_coerceCurrentPage:function(t){return t>=this._pageCount&&(t=this._pageCount-1),t<0&&(t=0),t},_updateNavigationControls:function(){var t=this.currentPage,i=this._pageCount<=1,e=i&&!this.alwaysShowArrows?"none":"",n=["Pagination_TriangleDisabled","Pagination_TriangleEnabled"];if(this.backNode){var a=i||0==t&&!this.cyclicPagination?0:1;s.replace(this.backNode,n[a],n[1-a]),this.backNode.style.display=e}if(this.forwardNode&&(a=i||t==this._pageCount-1&&!this.cyclicPagination?0:1,s.replace(this.forwardNode,n[a],n[1-a]),this.forwardNode.style.display=e),this.bulletsNode)for(var o=this.bulletsNode.children,r=0;r<o.length;r++)r==t?s.add(o[r],"Pagination_BulletCurrent"):s.remove(o[r],"Pagination_BulletCurrent")},_setItemsAttr:function(t){this.items=t,r.empty(this.itemsNode),this.bulletsNode&&r.empty(this.bulletsNode),this.currentPage=0,this._pageCount=0,this._updateNavigationControls()},selectPageByItemIndex:function(t,i){t<0||!this.items||t>=this.items.length||this._pageCount<=1||this.set("currentPage",Math.floor(t/this._pageSize),i)},selectItem:function(t){var i=e.indexOf(this.items,t);if(-1!=i&&!(i<0||!this.items||i>=this.items.length||this._pageCount<=1)){var n=this.items.length%this._pageSize,a=this.itemsNode.firstChild.children[n];a&&this.onSelect(a)}},navigateToItem:function(t){var i=e.indexOf(this.items,t);this.selectPageByItemIndex(i,!0)},_setCurrentPageAttr:function(t,e){this._animation.finish();var n;if("next"==t?(n="forward",t=this.currentPage+1,this.cyclicPagination&&t==this._pageCount&&(t=0)):"prev"==t?(n="backward",t=this.currentPage-1,this.cyclicPagination&&-1==t&&(t=this._pageCount-1)):n=!0===this.scrollAnimation?"fade1":this.scrollAnimation,!0===e&&(n=""),t=this._coerceCurrentPage(t),this.currentPage!=t){var a=this.items||[],o=this.itemsNode,l=0,c=this._pageSize*t,g=this.itemsNode.firstChild,u=r.create("div");s.add(u,"PaginationItemsNodeChildDiv");for(var m=[];l++<this._pageSize&&c<a.length;){var f=this.createItemContainer();d(f,this.clickEventType,i.hitch(this,this._onItemClick,f)),this._itemMargins&&h.set(f,this._itemMargins),u.appendChild(f);var p=a[c++];this.updateItemContainer(f,p),m.push({node:f,item:p})}switch(n){case"forward":this._slideAnimation(o,g,u,!0,m);break;case"backward":this._slideAnimation(o,g,u,!1,m);break;default:if(n&&(n=n?"_"+n+"Animation":null,"function"==typeof this[n])){this[n](o,g,u,t>this.currentPage,m);break}r.empty(o),o.appendChild(u),this._notifyNodesPlaced(m)}this.currentPage=t,this._updateNavigationControls(),this.onPageChanged()}},_notifyNodesPlaced:function(t){e.forEach(t,function(t){this.onNodePlaced(t.node,t.item)},this)},_slideAnimation:function(t,i,e,n,a){n?t.appendChild(e):t.insertBefore(e,t.firstChild),this._notifyNodesPlaced(a),this.isLeftToRight()||(n=!n),t.parentNode.style.overflow="hidden",this._animation.start([{node:t,classes:["Pagination_SlideAnim",n?"Anim_SlideLeft":"Anim_SlideRight"]}],i).then(function(){t.parentNode.style.overflow=""})},_fade1Animation:function(t,i,e,n,a){t.appendChild(e),this._notifyNodesPlaced(a),this._animation.start([{node:i,classes:["Pagination_FadeAnim","Anim_FadeOut"]},{node:e,classes:["Pagination_FadeAnim","Anim_FadeIn"]}],i)},_fade2Animation:function(t,i,e,n,a){var s=this,o=this._animation;o.start([{node:i,classes:["Pagination_FadeAnim","Anim_FadeOut"]}],i).then(function(){t.appendChild(e),s._notifyNodesPlaced(a),o.start([{node:e,classes:["Pagination_FadeAnim","Anim_FadeIn"]}],i)})},_backward:function(){this.set("currentPage","prev")},_forward:function(){this.set("currentPage","next")}})});