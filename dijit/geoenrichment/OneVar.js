// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.25/esri/copyright.txt for details.

define(["../../declare","./BaseWidget","./dom","dojo/dom-class","dojo/dom-construct","dojo/dom-attr","dojo/query","dojo/string","./lang","dojo/i18n!../../nls/jsapi","./utils","./formatVariable"],function(e,t,a,s,r,n,l,i,o,u,d,h){return u=u.geoenrichment.dijit.OneVar,e("esri.dijit.geoenrichment.OneVar",[t],{baseClass:"Infographics_OneVar",constructor:function(){this._state={sortBy:1,sortDesc:!0}},_calculate:function(){var e=this.getDataFields(),t=this.getFieldByIndex(e[0]);return this.primary.innerHTML=this.formatByIndex(0,e[0])+" ",{firstCol:t}},updateUIExpanded:function(){this.inherited(arguments);var e,t=this._calculate(),l=t.firstCol,c=null;if(l){var C=[],p=this.data.features.length;for(e=0;e<p;e++){var m=[];c||(c=m),m.push(this.getFeatureTitle(e)),m.push(this.getValueByName(e,l.name)),C.push(m)}this.site.innerHTML=u.subtitleSite2,this._sortRows(C);var _=this.getValueByName(0,l.name),V=o.isNumber(_);if(V){var M=this.getValueByName(p-1,l.name),g=this.getFeatureTitle(p-1),w=1-M/_;Math.abs(w)<.005&&(w=0);var f;f=w<0?this._getLessThanPattern():w>0?this._getMoreThanPattern():this._getSamePattern(),this.comp.innerHTML=i.substitute(f,{site:g})}else this.comp.innerHTML="";for(var O=this.table,v=C.length+1;O.rows.length>1;)O.deleteRow(-1);var T=O.rows[0];if(V)for(;T.cells.length<4;)T.insertCell(-1);else for(;T.cells.length>2;)r.destroy(T.cells[T.cells.length-1]);for(e=1;e<v;e++){var H=O.insertRow(-1);if(e%2==0&&e>0&&(H.className="AlternatingRow"),n.set(H.insertCell(-1),"class","OneVarMultiComparison_TextColumn"),n.set(H.insertCell(-1),"class","OneVarMultiComparison_ValueColumn"),V){var y=n.set(H.insertCell(-1),"class","OneVarMultiComparison_ChartColumn");n.set(y,"colspan","2")}}var b=Number.NEGATIVE_INFINITY;if(V){for(e=0;e<C.length;e++)C[e][1]>b&&(b=C[e][1]);b=d.getCeiling(b),O.rows[0].cells[2].innerHTML=h(l,0),O.rows[0].cells[3].innerHTML=h(l,b)}for(e=0;e<C.length;e++)if(T=O.rows[e+1],T.cells[0].innerHTML=C[e][0],T.cells[1].innerHTML=h(l,C[e][1]),V){var R;C[e]===c?(s.remove(T,"OneVarMultiComparison_Row"),s.add(T,"OneVarMultiComparison_CurrentRow"),R="OneVarMultiComparison_Expanded_CurrentBar"):(s.remove(T,"OneVarMultiComparison_CurrentRow"),s.add(T,"OneVarMultiComparison_Row"),R="OneVarMultiComparison_Expanded_Bar");var x=a.pct(C[e][1]/b);T.cells[2].innerHTML="<div class='"+R+"' style='width:"+x+"' />",n.set(T.cells[0],"style","width:50%"),n.set(T.cells[1],"style","width:20%")}else n.set(T.cells[0],"style","width:50%"),n.set(T.cells[1],"style","width:50%")}},_getLessThanPattern:function(){return u.lessThan},_getMoreThanPattern:function(){return u.moreThan},_getSamePattern:function(){return u.same},updateUICollapsed:function(){this.inherited(arguments);var e,t=this._calculate(),a=t.firstCol,r=null;if(a){var i=[],u=this.data.features.length;for(e=0;e<u;e++){var d=[];r||(r=d),d.push(this.getFeatureTitle(e)),d.push(this.getValueByName(e,a.name)),i.push(d)}this._sortRows(i);var c=this.getValueByName(0,a.name),C=this.table,p=i.length+1;for(e=C.rows.length;e<p;e++){var m=C.insertRow(-1);e%2==0&&(m.className="AlternatingRow"),n.set(m.insertCell(-1),"class","OneVarMultiComparison_TextColumn"),n.set(m.insertCell(-1),"class","OneVarMultiComparison_ValueColumn")}for(;C.rows.length>p;)C.deleteRow(-1);var _=o.isNumber(c),V=l("col",this.table);for(_?(n.set(V[0],"style","width:70%"),n.set(V[1],"style","width:30%")):(n.set(V[0],"style","width:50%"),n.set(V[1],"style","width:50%")),e=0;e<i.length;e++){var M=C.rows[e+1];M.cells[0].innerHTML=i[e][0],M.cells[1].innerHTML=h(a,i[e][1]),i[e]===r?(s.remove(M,"OneVarMultiComparison_Row"),s.add(M,"OneVarMultiComparison_CurrentRow")):(s.remove(M,"OneVarMultiComparison_CurrentRow"),s.add(M,"OneVarMultiComparison_Row"))}}},createUIExpanded:function(e){this.inherited(arguments);var t=e.addHeader("div",{class:"OneVarMultiComparison_Value"}),s=r.create("table",{cellpadding:"0",cellspacing:"0"},t),l=s.insertRow(0),i=l.insertCell(-1);this.site=r.create("span",{class:"OneVarMultiComparison_Expanded_Value_Site"},i),l=s.insertRow(-1),i=l.insertCell(-1),this.primary=r.create("span",{class:"OneVarMultiComparison_Expanded_Value_Primary"},i),this.comp=r.create("span",{class:"OneVarMultiComparison_Comparison"},i),this.table=e.addContent("table",{class:"OneVarMultiComparison_Table"}),a.createCols(this.table,[.5,.2,.15,.15]),l=this.table.insertRow(-1),this._appendSortHeader(l,u.areaCol,0,{class:"OneVarMultiComparison_TextColumnHeader"}),this._appendSortHeader(l,u.valueCol,1,{class:"OneVarMultiComparison_ValueColumnHeader"}),n.set(l.insertCell(-1),"class","OneVarMultiComparison_ChartColumnHeader_Lower"),n.set(l.insertCell(-1),"class","OneVarMultiComparison_ChartColumnHeader_Upper"),this.autoHeight&&e.contentClass.push("OneVarMultiComparison_Expanded_ContentPane"),e.addFooter("div")},createUICollapsed:function(e){this.inherited(arguments);var t=e.addHeader("div",{class:"OneVarMultiComparison_Value"}),s=r.create("table",{cellpadding:"0",cellspacing:"0"},t),l=s.insertRow(0),i=l.insertCell(-1);this.site=r.create("span",{class:"OneVarMultiComparison_Expanded_Value_Site"},i),l=s.insertRow(-1),i=l.insertCell(-1),this.primary=r.create("span",{class:"OneVarMultiComparison_Expanded_Value_Primary"},i),this.table=e.addContent("table",{class:"OneVarMultiComparison_Table"}),a.createCols(this.table,[.7,.3]),l=this.table.insertRow(-1),this._appendSortHeader(l,u.areaCol,0,{class:"OneVarMultiComparison_TextColumnHeader"}),this._appendSortHeader(l,u.valueCol,1,{class:"OneVarMultiComparison_ValueColumnHeader"}),n.set(l.insertCell(-1),"class","OneVarMultiComparison_ChartColumnHeader_Lower"),n.set(l.insertCell(-1),"class","OneVarMultiComparison_ChartColumnHeader_Upper"),this.autoHeight&&e.contentClass.push("OneVarMultiComparison_Expanded_ContentPane"),e.addFooter("div")}})});