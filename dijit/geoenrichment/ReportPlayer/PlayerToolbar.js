// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.26/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/on","dojo/string","dojo/dom-class","dojo/dom-construct","dijit/_WidgetBase","dijit/_TemplatedMixin","./PlayerSelect","./PlayerCommands","./PlayerThemes","./supportClasses/ToolbarArranger","esri/dijit/geoenrichment/utils/DomUtil","esri/dijit/geoenrichment/utils/InvokeUtil","esri/dijit/geoenrichment/utils/MouseUtil","esri/dijit/geoenrichment/utils/PopupUtil","esri/dijit/geoenrichment/utils/TooltipUtil","dojo/text!./templates/PlayerToolbarHolder.html","dojo/i18n!esri/nls/jsapi"],function(e,t,o,i,a,n,l,r,s,h,c,u,d,p,m,f,v,b){function S(e){var t=[];return g.forEach(function(o){"number"==typeof o.value&&t.push({value:o.value,score:e<o.value?e/o.value:o.value/e})}),t.sort(function(e,t){return t.score-e.score}),t[0].value}b=b.geoenrichment.dijit.ReportPlayer.PlayerToolbar;var g=[{value:"fitPage",label:b.fitPage},{value:"fitPageWidth",label:b.fitPageWidth},{value:150,label:"150%"},{value:125,label:"125%"},{value:100,label:"100%"},{value:90,label:"90%"},{value:80,label:"80%"},{value:70,label:"70%"},{value:60,label:"60%"},{value:50,label:"50%"}],T=e([n,l],{templateString:v,nls:b,formatAreaTitleFunc:null,formatAreaTitleMultiFunc:null,showAreaTitle:!1,stretchToolbarNode:null,areasSelect:null,pageSelect:null,zoomSelect:null,_toolbarArranger:null,_infographicSelect:null,postCreate:function(){u.hide(this.commandButtonsContainer),this._toolbarArranger=new c({showAreaTitle:this.showAreaTitle,stretchToolbarNode:this.stretchToolbarNode,domNode:this.domNode,infographicsSelectDiv:this.infographicsSelectDiv,areaTitleDiv:this.areaTitleDiv,areaTitleInnerDiv:this.areaTitleInnerDiv,rightSideControlsBlock:this.rightSideControlsBlock,areasSelectDiv:this.areasSelectDiv,zoomSelectDiv:this.zoomSelectDiv,pageSelectDiv:this.pageSelectDiv,commandButtonsContainer:this.commandButtonsContainer}),this._initAreaSelect(),this._initPageSelect(),this._initZoomSelect(),f.autoTooltip(this.domNode)},_initAreaSelect:function(){var e=this;this.areasSelect=new r({onChange:function(t){e.onShowAnalysisAreaAt(t.value)}}).placeAt(this.areasSelectDiv),this.own(this.areasSelect)},updateAreaSelect:function(e,t,o,i){var a=e.length,n=e.map(function(e,t){return{label:1===a?e.name:e.shortName||e.name||"",value:t}});if(this.areasSelect.set("options",n),this.areasSelect.set("value",o),u[a>1&&!i?"show":"hide"](this.areasSelectDiv),i)this.formatAreaTitleMultiFunc?this.formatAreaTitleMultiFunc(this.areaTitleInnerDiv,t):this._formatAreaTitleMulti(t);else{var l=e[o];this.formatAreaTitleFunc?this.formatAreaTitleFunc(this.areaTitleInnerDiv,l):this._formatAreaTitle(l)}},_formatAreaTitle:function(e){this.areaTitleInnerDiv.innerHTML=e.locationName||e.name},_formatAreaTitleMulti:function(e){this.areaTitleInnerDiv.innerHTML=e.locationName||e.name||e.shortName||""},_pageControlsVisible:!0,_initPageSelect:function(){var e=this;this.pageSelect=new r({onChange:function(t){e.onShowPageAt(t.value)}}).placeAt(this.pageSelectDiv),this.own(this.pageSelect)},setPageControlsVisible:function(e){this._pageControlsVisible=e,u[e?"show":"hide"](this.pageSelectDiv)},updatePageSelect:function(e,t){for(var i=[],a=0;a<e;a++)i.push({label:o.substitute(b.pageIndex,{index:a+1}),value:a});this.pageSelect.set("options",i),this.pageSelect.set("value",t),u[this._pageControlsVisible&&e>1?"show":"hide"](this.pageSelectDiv)},_initZoomSelect:function(){var e=this;this.zoomSelect=new r({onChange:function(t){"fitPage"===t.value?e.onZoomToFitPage():"fitPageWidth"===t.value?e.onZoomToFitPageWidth():e.onSetZoomPercent(t.value)}}).placeAt(this.zoomSelectDiv),this.own(this.zoomSelect),this.zoomSelect.set("options",g),this.zoomSelect.set("value",100)},setZoomSupportsInfo:function(e){u[e.supported?"show":"hide"](this.zoomSelectDiv),this.zoomSelect.store.data.forEach(function(t){t.hidden="fitPage"===t.value&&!e.canFitPage||"fitPageWidth"===t.value&&!e.canFitPageWidth})},setZoomInfo:function(e){var t=e.isFitPageScale?"fitPage":e.isFitPageWidthScale?"fitPageWidth":S(100*e.scale);t!==this.zoomSelect.get("value")&&this.zoomSelect.set("value",t)},createCommandButton:function(e,t){return this.createCustomCommandButton({callback:t,buttonClass:e.id===s.PRINT?"playerPrintButton":"playerExportButton",tooltip:e.id===s.PRINT?b.printInfographic:b.exportInfographic,visibleOnError:!1})},createCustomCommandButton:function(e){u.show(this.commandButtonsContainer);var o=a.create("div",{class:"playerToolbar_commandButtonContainer dijitInline"},this.commandButtonsContainer,e.addFirst?"first":"last");o.__visibleOnError=e.visibleOnError;var n=a.create("div",{class:"playerToolbar_commandButton"},o);return e.buttonClass&&i.add(n,e.buttonClass),e.tooltip&&f.setTooltipToNode(n,e.tooltip),t(n,"click",e.callback),n},setTheme:function(e){i.remove(this.domNode,"playerThemeDark playerThemeLight"),i.add(this.domNode,e===h.DARK?"playerThemeDark":"playerThemeLight"),this.areasSelect.setTheme(e),this.pageSelect.setTheme(e),this.zoomSelect.setTheme(e)},setErrorShown:function(e){if(e){u.hide([this.areaTitleDiv,this.areasSelectDiv,this.pageSelectDiv,this.zoomSelectDiv]);for(var t=0;t<this.commandButtonsContainer.children.length;t++){var o=this.commandButtonsContainer.children[t];u[o.__visibleOnError?"show":"hide"](o)}this.arrangeControls()}},arrangeControls:function(){this._toolbarArranger.arrangeControls()},hasVisibleControls:function(){return this._toolbarArranger.hasVisibleControls()},addInfographicsSelect:function(e){this._infographicSelect=e,e.placeAt(this.infographicsSelectDiv)},isMouseOver:function(){return p.isMouseOver(this.domNode)||this.areasSelect&&this.areasSelect.isMouseOver()||this.pageSelect&&this.pageSelect.isMouseOver()||this.zoomSelect&&this.zoomSelect.isMouseOver()||this._infographicSelect&&this._infographicSelect.isMouseOver&&this._infographicSelect.isMouseOver()},onShowPageAt:function(e){},onShowAnalysisAreaAt:function(e){},onZoomToFitPage:function(){},onZoomToFitPageWidth:function(){},onSetZoomPercent:function(e){}});return e([n,l],{templateString:"<div class='esriGEPlayerToolbarOuter'></div>",popupButtonDiv:null,formatAreaTitleFunc:null,formatAreaTitleMultiFunc:null,showToolbarInPopup:!1,showAreaTitle:!1,stretchToolbarNode:null,isMobileDevice:!1,showCloseButton:!1,toolbarHolder:null,postCreate:function(){var e=this;this.inherited(arguments),this.toolbarHolder=new T({showAreaTitle:this.showAreaTitle,stretchToolbarNode:this.stretchToolbarNode,onShowPageAt:function(t){e.onShowPageAt(t)},onShowAnalysisAreaAt:function(t){e.onShowAnalysisAreaAt(t)},onZoomToFitPage:function(){e.onZoomToFitPage()},onZoomToFitPageWidth:function(){e.onZoomToFitPageWidth()},onSetZoomPercent:function(t){e.onSetZoomPercent(t)}}).placeAt(this.domNode),this.own(this.toolbarHolder)},updateAreaSelect:function(e,t,o,i){this.toolbarHolder.formatAreaTitleFunc=this.formatAreaTitleFunc,this.toolbarHolder.formatAreaTitleMultiFunc=this.formatAreaTitleMultiFunc,this.toolbarHolder.updateAreaSelect(e,t,o,i)},setPageControlsVisible:function(e){this.toolbarHolder.setPageControlsVisible(e)},updatePageSelect:function(e,t){this.toolbarHolder.updatePageSelect(e,t)},setZoomSupportsInfo:function(e){this.toolbarHolder.setZoomSupportsInfo(e)},setZoomInfo:function(e){this.toolbarHolder.setZoomInfo(e)},createCommandButton:function(e,t){return this.toolbarHolder.createCommandButton(e,t)},setTheme:function(e){this.toolbarHolder.setTheme(e)},setErrorShown:function(e){this.toolbarHolder.setErrorShown(e)},_popupHandle:null,_popupButton:null,update:function(){d.invoke(this,"_doUpdateToolbar")},_doUpdateToolbar:function(){i[this.isScrollShown()?"add":"remove"](this.popupButtonDiv,"playerToolbar_parentHasScroll"),i[this.isMobileDevice?"add":"remove"](this.popupButtonDiv,"isMobileDevice"),i[this.isMobileDevice?"add":"remove"](this.toolbarHolder.domNode,"isMobileDevice"),this._resetToolbarNode();var e=m.isOpen(this.toolbarHolder);this._popupHandle&&this._popupHandle.remove(),this._popupHandle=null,this.showToolbarInPopup?(this._popupButton=a.create("div",{class:"dijitInline playerToolbar_outerButton playerToolbar_settingsButton"},this.popupButtonDiv,"first"),this._popupHandle=m.makePopup(this.toolbarHolder,this,this._popupButton,{orient:["before","below"],openPopup:e})):a.place(this.toolbarHolder.domNode,this.domNode),this.toolbarHolder.arrangeControls(),u[this.toolbarHolder.hasVisibleControls()?"show":"hide"](this.domNode)},_resetToolbarNode:function(){this.toolbarHolder.domNode.parentNode&&this.toolbarHolder.domNode.parentNode.removeChild(this.toolbarHolder.domNode),a.empty(this.domNode),this._popupButton&&a.destroy(this._popupButton),this._popupButton=null},closePopup:function(){m.close(this.toolbarHolder)},isScrollShown:function(){return!1},placeInfographicsSelect:function(e){e.placeAt(this.toolbarHolder.infographicsSelectDiv)},createCustomCommandButton:function(e){return this.toolbarHolder.createCustomCommandButton(e)},notifyCommandButtonsAdded:function(){if(this.showCloseButton)if(this.showToolbarInPopup){var e=a.create("div",{class:"dijitInline playerToolbar_outerButton playerToolbar_closeButtonOuter"},this.popupButtonDiv);f.setTooltipToNode(e,b.close),t(e,"click",function(){this.onClose()}.bind(this))}else this.createCustomCommandButton({buttonClass:"playerToolbar_closeButton",tooltip:b.close,callback:function(){this.closePopup(),this.onClose()}.bind(this),visibleOnError:!0})},addInfographicsSelect:function(e){this.toolbarHolder.addInfographicsSelect(e)},isMouseOver:function(){return p.isMouseOver(this.domNode)||this.toolbarHolder.isMouseOver()},onShowPageAt:function(e){},onShowAnalysisAreaAt:function(e){},onZoomToFitPage:function(){},onZoomToFitPageWidth:function(){},onSetZoomPercent:function(e){},onClose:function(){}})});