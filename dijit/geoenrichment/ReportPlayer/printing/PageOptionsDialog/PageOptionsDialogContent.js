// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.25/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/string","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/form/TextBox","esri/dijit/geoenrichment/TriStateItem","esri/dijit/geoenrichment/utils/DomUtil","esri/dijit/geoenrichment/utils/TooltipUtil","esri/dijit/geoenrichment/OnDemandSelect","dijit/form/RadioButton","esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/DocumentOptions","esri/dijit/geoenrichment/ReportPlayer/printing/PageSizeUtil","esri/dijit/geoenrichment/ReportPlayer/PlayerCommands","dojo/text!./templates/PageOptionsDialogContent.html","dojo/i18n!esri/nls/jsapi"],function(t,e,i,o,n,a,s,c,r,l,d,h,u,p,g,S,x,m,k,b){b=b.geoenrichment.dijit.ReportPlayer.PageOptionsDialog;var C={};return C[m.HTML]=b.createHTMLLabel,C[m.IMAGE]=b.createImageLabel,C[m.PDF]=b.createPDFLabel,C[m.PRINT]=b.printLabel,C[m.DYNAMIC_HTML]=b.createDynamicHTMLLabel,t([c,r],{templateString:k,nls:b,exportSelect:null,sizeList:null,autoScaleCheckbox:null,addHeaderCheckbox:null,addDataSourceCheckbox:null,addFooterCheckbox:null,postCreate:function(){var t=this;this.inherited(arguments),i(this.exportButton,"click",function(){t.onPrint()}),i(this.cancelButton,"click",function(){t.onCancel()}),this.exportSelect=new p({class:"exportSelect",options:[],onChange:function(){t._currentSettings.commandId=t.exportSelect.get("value"),t._syncViewForSelectedCommand()}}).placeAt(this.exportSelectDiv),this.own(this.exportSelect),this.autoScaleCheckbox=new d(this.autoScaleLabel),this.autoScaleCheckbox.set("checked",!0),this.sizeList=new p({class:"sizeList",listClass:"esriGEOnDemandSelectUnlimitedTallList"}).placeAt(this.sizeListDiv),this.own(this.sizeList),this.portraitButton=new g({checked:!1,name:this.id}).placeAt(this.portraitRadioButtonDiv),this.own(this.portraitButton),this.portraitButton.startup(),i(this.portraitRadioButtonLabel,"click",function(){t.portraitButton.set("checked",!0)}),this.landscapeButton=new g({checked:!1,name:this.id}).placeAt(this.landscapeRadioButtonDiv),this.own(this.landscapeButton),this.landscapeButton.startup(),i(this.landscapeRadioButtonLabel,"click",function(){t.landscapeButton.set("checked",!0)}),this.addHeaderCheckbox=new d(this.headerLabel),this.addHeaderCheckbox.onClick=function(){this._syncHeaderTitleBlockVisibility()}.bind(this),this.addDataSourceCheckbox=new d(this.dataSourceLabel),this.addFooterCheckbox=new d(this.footerLabel),this.reportTitleTextBox=new l({value:"",placeHolder:b.titlePlaceholder}).placeAt(this.reportTitleTextBoxDiv),this.own(this.reportTitleTextBox),this.reportSubtitleTextBox=new l({value:"",placeHolder:b.subtitlePlaceholder}).placeAt(this.reportSubtitleTextBoxDiv),this.own(this.reportSubtitleTextBox),this.dataDrillingCheckbox=new d(this.dataDrillingLabel),this.dataDrillingCheckbox.set("checked",!0),u.setTooltipToNode(this.autoScaleInfoIcon,b.autoScaleRowsTooltip)},_currentSettings:null,update:function(t){this._currentSettings=e.mixin({},t),this._configureExportOptions(t),this._configureAutoScale(t),this._configurePageSize(t),this._configureHeaderAndFooter(t),this._syncViewForSelectedCommand()},_configureExportOptions:function(t){if(!t.exportCommands||!t.exportCommands.length)return void h.hide(this.exportOptionsBlock);h.show(this.exportOptionsBlock);var e=t.exportCommands.map(function(t){return{label:t.label,value:t.id}});this.exportSelect.set("options",e),this.exportSelect.set("value",t.commandId||e[0])},_syncViewForSelectedCommand:function(){this.exportButton.innerHTML=C[this._currentSettings.commandId],h.hide([this.staticExportSettings,this.dynamicExportSettings]),h.show(this._currentSettings.commandId===m.DYNAMIC_HTML?this.dynamicExportSettings:this.staticExportSettings)},_configureAutoScale:function(t){h[t.canAutoScale?"show":"hide"](this.autoScaleBlock)},_configureHeaderAndFooter:function(t){this.reportTitleTextBox.set("value",t.reportTitle||""),this.reportSubtitleTextBox.set("value",t.reportSubtitle||""),this._syncHeaderTitleBlockVisibility()},_syncHeaderTitleBlockVisibility:function(){h[this.addHeaderCheckbox.get("checked")?"show":"hide"](this.reportTitleBlock)},_configurePageSize:function(t){var e,i=!S.hasStandardSize(t.currentPageSettings.pagesize);if(i){var n=S.getPageDim(t.currentPageSettings.pagesize,t.currentPageSettings.orientation,{places:2});e=o.substitute(b.customWithDimensions,{w:n.w,h:n.h})}this.sizeList.set("options",x.getSupportedPageSizes(i,e)),this.sizeList.set("value",i?"custom":t.currentPageSettings.pagesize),this.portraitButton.set("checked","portrait"===t.currentPageSettings.orientation),this.landscapeButton.set("checked","landscape"===t.currentPageSettings.orientation)},getSettings:function(){var t=e.mixin({},this._currentSettings.currentPageSettings);return"custom"!==this.sizeList.get("value")&&(t.orientation=this.portraitButton.get("checked")?"portrait":"landscape",t.pagesize=this.sizeList.get("value")),{needAutoScale:this.autoScaleCheckbox.get("checked"),addHeader:this.addHeaderCheckbox.get("checked"),addDataSource:this.addDataSourceCheckbox.get("checked"),addFooter:this.addFooterCheckbox.get("checked"),allowDataDrilling:this.dataDrillingCheckbox.get("checked"),reportTitle:this.reportTitleTextBox.get("value"),reportSubtitle:this.reportSubtitleTextBox.get("value"),pageSettings:t,commandId:this._currentSettings.commandId}},setState:function(t){this.autoScaleCheckbox.set("checked",t.needAutoScale),this.addHeaderCheckbox.set("checked",t.addHeader),this.addDataSourceCheckbox.set("checked",t.addDataSource),this.addFooterCheckbox.set("checked",t.addFooter),this.dataDrillingCheckbox.set("checked",t.allowDataDrilling),this._syncHeaderTitleBlockVisibility(),this.exportSelect.options.some(function(e){return e.value===t.commandId})||(t.commandId=this.exportSelect.options[0]&&this.exportSelect.options[0].value),this.exportSelect.set("value",t.commandId),this.exportSelect.onChange()},onPrint:function(){},onCancel:function(){}})});