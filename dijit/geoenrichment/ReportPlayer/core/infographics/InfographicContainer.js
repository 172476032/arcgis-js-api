// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.26/esri/copyright.txt for details.

define(["require","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","dijit/_WidgetBase","dijit/_TemplatedMixin","esri/dijit/geoenrichment/ReportPlayer/core/infographics/InfographicTypes","esri/dijit/geoenrichment/utils/DomUtil","esri/dijit/geoenrichment/utils/WaitingUtil","esri/dijit/geoenrichment/ReportPlayer/config","dojo/text!../templates/InfographicContainer.html"],function(t,i,n,e,r,o,a,h,s,c,p,g){return i([o,a],{templateString:g,viewModel:null,theme:null,parentWidget:null,currentFeatureIndex:null,adjustElementsWhenResized:!1,_pendingResizeFlag:!1,_pendingUpdateFlag:!1,_currentInfographic:null,getInnerInfographic:function(){return this._currentInfographic},getContentInitPromise:function(){return this._infographicInitPromise},_getTypeToClassPathMap:function(){var t={};return t[h.STATIC]=p.modules.dataDrilling?"./simpleInfographic/SimpleInfographicWithDataDrilling":"./simpleInfographic/SimpleInfographic",t[h.ATTACHMENTS]="./AttachmentsInfographic",t[h.AREA_DETAILS]="./areaDetails/AreaDetailsInfographic",t[h.LOCATOR_TABLE]="./locator/LocatorTableInfographic",t[h.COMPARISON_TABLE]="./comparison/ComparisonTableInfographic",t.dynamic="./dynamic/DynamicInfographic",t},_getRelativeRequire:function(){return t},_infographicInitPromise:!1,_lastAppliedJson:null,updateInfographic:function(t){var i=this;if(this.viewDiv&&t&&h.isSupported(t.type)&&!this._infographicInitPromise){if(this._lastAppliedJson=t,this._type=t.type,this._currentInfographic)return this._currentInfographic.updateInfographic(t);var n=this._getTypeToClassPathMap(),r=n[h.isDynamic(t.type)?"dynamic":t.type],o=new e;return this._getRelativeRequire()([r],function(t){o.resolve(t)}),c.showProgressPromise(this.domNode,o.promise),this.onContentLoadingStart(),this._infographicInitPromise=o.promise.then(function(n){i._createInfographicForClass(t,n),i.onContentLoadingEnd()}),this._infographicInitPromise.then(function(){return i._infographicInitPromise=null,s.isNodeInLayout(i.domNode)?i._currentInfographic.updateInfographic(t):void(i._pendingUpdateFlag=!0)})}},_createInfographicForClass:function(t,i){var e=this,r=n.mixin({viewModel:this.viewModel,theme:this.theme,parentWidget:this,currentFeatureIndex:this.currentFeatureIndex,width:this.width,height:this.height,adjustElementsWhenResized:this.adjustElementsWhenResized,onContentLoadingStart:function(){e.onContentLoadingStart()},onContentLoadingEnd:function(){e.onContentLoadingEnd()}},this._prepareCreationParameters(t),r);return this._currentInfographic=new i(r),this._currentInfographic.placeAt(this.viewDiv),this._currentInfographic},_prepareCreationParameters:function(t){return null},_type:null,getType:function(){return this._type},width:null,height:null,resize:function(t,i){void 0!==t&&(this.width=t,this.height=i),r(this._infographicInitPromise,function(){if(!s.isNodeInLayout(this.domNode))return void(this._pendingResizeFlag=!0);this._currentInfographic&&this._currentInfographic.resize(this.width,this.height)}.bind(this))},getPreferredHeight:function(){return this._currentInfographic.getPreferredHeight&&this._currentInfographic.getPreferredHeight()},collapseContent:function(){this._currentInfographic.collapseContent&&this._currentInfographic.collapseContent()},toJson:function(){return this._currentInfographic?this._currentInfographic.toJson():this._lastAppliedJson&&n.clone(this._lastAppliedJson)},getVisualState:function(){return this._currentInfographic&&this._currentInfographic.getVisualState&&this._currentInfographic.getVisualState()},setVisualState:function(t){return this._currentInfographic&&this._currentInfographic.setVisualState&&this._currentInfographic.setVisualState(t)},notifyShown:function(){r(this._infographicInitPromise,function(){if(s.isNodeInLayout(this.domNode)){this._pendingResizeFlag&&this.resize(),this._pendingResizeFlag=!1;var t=this._pendingUpdateFlag&&this._currentInfographic.updateInfographic(this._lastAppliedJson);this._pendingUpdateFlag=!1,r(t,function(){this._currentInfographic&&this._currentInfographic.notifyShown&&this._currentInfographic.notifyShown()}.bind(this))}}.bind(this))},collectFieldInfos:function(){return this._currentInfographic&&this._currentInfographic.collectFieldInfos&&this._currentInfographic.collectFieldInfos()},onContentLoadingStart:function(){},onContentLoadingEnd:function(){},destroy:function(){this._currentInfographic&&this._currentInfographic.destroy(),this.inherited(arguments)}})});