// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.23/esri/copyright.txt for details.

define(["dojo/_base/lang","../../ConversionUtil","esri/dijit/geoenrichment/ReportPlayer/core/infographics/InfographicTypes","esri/dijit/geoenrichment/ReportPlayer/core/sections/SectionTypes","../../../infographics/infographicUtils/InfographicJsonUtil"],function(t,e,a,i,s){var r={};return r.portalToEditor=function(r,o,l){function n(){function a(){l.revisionVersion>=1.1?b.forEach(function(t){switch(t.attributes.type){case i.INFOGRAPHIC_HEADER:o=t.tags[0];break;case i.INFOGRAPHIC_VARIABLE:c.push(t);break;case i.INFOGRAPHIC_BACKGROUND:n=t.tags;break;case i.INFOGRAPHIC_FOREGROUND:u=t.tags}}):c=b.filter(function(t){return"infographicHeader"===t.attributes.type?(o=t,!1):!0})}function s(t){return l.parsers.getParser("section").parseTable(t,l)}var o,n,u,b=r.tags.slice(),c=[];a();var h;d={type:r.attributes.type,isDefault:r.attributes.isDefault,style:{width:e.ptToPx(r.attributes.width),height:e.ptToPx(r.attributes.height),minWidth:e.ptToPx(r.attributes.minWidth)||void 0,minHeight:e.ptToPx(r.attributes.minHeight)||void 0,backgroundColor:r.attributes.backgroundColor},background:n?n.map(s):null,header:o&&s(o),variableTables:c.map(function(a){function i(t){h=h||{},h[o.variable.fieldInfo.templateName]=t}var r,o={style:e.ptToPxObj({left:a.attributes.left,top:a.attributes.top,width:a.attributes.width,height:a.attributes.height})};if(a.tags.forEach(function(e){if("dataDrillingPanels"===e.name)return void(r=e);var a=e.attributes.type,i=s(e),l=i.data.data[0],n=i.data.columns[0].field,u={isContrastColor:e.attributes.isContrastColor,isHighlighted:e.attributes.isHighlighted,style:t.mixin({width:i.data.columns[0].style.width,height:l.style.height,left:i.style.left,top:i.style.spaceBefore},l.style.fields[n])};"shape"===a&&(u.shapeJson=l.fieldInfos[n].shapeJson),"image"===a?u.imageJson=l.fieldInfos[n].imageJson:"variable"===a?u.fieldInfo=l.fieldInfos[n]:"description"===a&&(u.text=l[n]),o[a]=u}),r&&r.tags&&r.tags.length){var n=r.tags[0];if(n.attributes&&n.attributes.isStandard)i("standard");else{var u=n.tags&&n.tags[0];u&&"section"===u.name&&i({states:n.attributes&&n.attributes.states,sectionJson:l.parsers.getParser("section").parseSection(u,l)})}}return o}),foreground:u?u.map(s):null},d.dataDrilling=h}function u(){d={type:r.attributes.type,useCircularMask:r.attributes.useCircularMask,alwaysShowCaptions:r.attributes.alwaysShowCaptions,scaleToCover:r.attributes.scaleToCover,style:{width:e.ptToPx(r.attributes.width),height:e.ptToPx(r.attributes.height),backgroundColor:r.attributes.backgroundColor}}}function b(){var t,a,i;r.tags.forEach(function(e){switch(e.name){case"header":t=e;break;case"attributes":a=e;break;case"notes":i=e}}),d={type:r.attributes.type,showNotes:r.attributes.showNotes,showAttributes:r.attributes.showAttributes,attributesLayout:r.attributes.attributesLayout,style:{width:e.ptToPx(r.attributes.width),height:e.ptToPx(r.attributes.height),backgroundColor:r.attributes.backgroundColor},header:l.parsers.getParser("section").parseTable(t.tags[0],l),attributesStyle:l.parsers.getParser("section").parseTableCellAttributes(a&&a.attributes||{},null,l),notesStyle:l.parsers.getParser("section").parseTableCellAttributes(i&&i.attributes||{},null,l)}}function c(){d={type:r.attributes.type,style:{width:e.ptToPx(r.attributes.width),height:e.ptToPx(r.attributes.height),backgroundColor:r.attributes.backgroundColor}}}function h(){var t=r.attributes.name,i=l.templateJson.metadata.comparisonCalculatorsHash[t];d={type:a.fixTapestryNameToWidget(r.attributes.type),title:r.attributes.title||"",variables:i&&i.variables,calcData:i&&{calculatorName:t,variableObjects:i.variableObjects},style:{width:e.ptToPx(r.attributes.width),height:e.ptToPx(r.attributes.height),backgroundColor:r.attributes.backgroundColor},showVerticalAxis:r.attributes.showVerticalAxis,dataCollectionID:r.attributes.dataCollectionID,variableID:r.attributes.variableID},i&&i.levels&&s.setLevels(d,i.levels),d.variables||(d.variables=d.dataCollectionID?[d.dataCollectionID+".*"]:[d.variableID]),delete d.dataCollectionID,delete d.variableID}var d,p=a.fixTapestryNameToWidget(r.attributes.type);switch(p){case a.STATIC:n();break;case a.ATTACHMENTS:u();break;case a.AREA_DETAILS:b();break;case a.INTERESTING_FACTS:c();break;case a.AGE_PYRAMID:case a.TAPESTRY:case a.RELATED_VARS:case a.ONE_VAR:h();break;default:return null}return d},r});