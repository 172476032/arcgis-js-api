// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.23/esri/copyright.txt for details.

define(["dojo/_base/lang","./templateJsonUtils/fieldInfo/FieldInfoBuilder","esri/dijit/geoenrichment/ReportPlayer/core/sections/SectionTypes"],function(e,t,a){var l={};return l.createTable=function(a){var l=a.numColumns,i=a.numRows,n=a.widths,r=a.width,o=a.style,s=a.attributes&&a.attributes.fixedColumns,d=a.attributes&&a.attributes.dynamicColumns;if(r){var f=r/l;n=[];for(var u=0;u<l;u++)n.push(f)}if(n)r||isNaN(Number(n[0]))||(r=0,n.forEach(function(e){r+=e}));else{var c=Number(100/l).toFixed(3)+"%";n=[];for(var h=0;h<l;h++)n.push(c)}for(var y=[],m=0;m<l;m++)y.push({field:"field"+m,style:{width:n[m]}});for(var p=[],S=!0,v=a.height?a.height/i:15.07,b=0;b<i;b++){var g={style:{height:v,fields:{}},fieldInfos:{}};for(m=0;m<l;m++){var T="field"+m;!1!==a.useDefaultTheme&&(g.style.fields[T]={horizontalAlign:0===m?"left":"right",overrideStyle:0===b?i>1?"TableHeader":void 0:S?"AlternatingRow":"Default"}),d&&m>=s&&0===b&&(g.fieldInfos[T]=t.createFieldInfoFromSpecialFieldName("AREA_DESC"))}p.push(g),S=!S}return{id:"table",attributes:e.mixin({},a.attributes),style:e.mixin({width:r||772.33},o),data:{columns:y,data:p}}},l.createSingleCellTable=function(e){var t=l.createTable({numColumns:1,numRows:1,attributes:e.attributes,useDefaultTheme:!1});return l.modifyTableJson(t,0,0,e),t},l.modifyTableJson=function(e,t,a,l){var i=e.data.data[t],n=e.data.columns[a],r=n.field;l.text&&(i[r]=l.text),l.fieldInfo&&(i.fieldInfos[r]=l.fieldInfo),l.cellStyle&&(i.style.fields[r]=l.cellStyle),l.columnSpan&&(i.columnSpans=i.columnSpans||{},i.columnSpans[r]=l.columnSpan),l.rowSpan&&(i.rowSpans=i.rowSpans||{},i.rowSpans[r]=l.rowSpan),i.themeStyle=l.themeStyle,l.width&&(e.style.width=l.width,n.style.width=l.width),l.height&&(i.style.height=l.height),void 0!==l.left&&(e.style.left=l.left),void 0!==l.spaceBefore&&(e.style.spaceBefore=l.spaceBefore)},l.getTableWidth=function(e){return e.style.width},l.getTableHeight=function(e){var t=0;return e.data.data.forEach(function(e){t+=e.style?e.style.height:0}),t},l.createDetailsSection=function(e){return{type:a.DETAILS,stack:[l.createTable(e)]}},l.createDetailsSectionForFieldInfos=function(t,i){return{type:a.DETAILS,stack:[function(){var a=l.createTable(e.mixin({numColumns:2,numRows:t.length+1},i));return a.data.data.forEach(function(e,a){if(0===a)return void(e.field0=t[0].hasVariable?t[0].fieldCategory:"");var l=t[a-1];e.field0=l.script?l.script.alias:l.alias,e.fieldInfos.field1=l}),l.provideSpaceAfter(a),a}()]}},l.createLocatorTablesForFieldInfos=function(e){return l.createLocatorAndHeaderTables({layerID:e[0].layerID},e.length,null,e)},l.createLocatorAndHeaderTables=function(t,i,n,r){r=r||[];for(var o=l.createTable({numColumns:i,numRows:1,style:n}),s=0;s<i;s++){var d=o.data.columns[s].field;o.data.data[0][d]=r[s]?r[s].alias:"",o.data.data[0].style.fields[d].overrideStyle="TableHeader"}o.style.alternatingStyle="AlternatingRow",o.attributes.isLocatorHeader=!0;var f=l.createTable({numColumns:i,numRows:1,style:n});for(s=0;s<i;s++){var d=f.data.columns[s].field;f.data.data[0].fieldInfos[d]=r[s]}return f.attributes.locatorSettings=e.mixin({layerID:null,filters:[],pagination:null,sorting:null},t),f.style.alternatingStyle="AlternatingRow",l.provideSpaceAfter(f),{headerTableJson:o,dataTableJson:f,headerSectionJson:{type:a.DETAILS_HEADER,stack:[o]},dataSectionJson:{type:a.DETAILS,stack:[f]}}},l.createDetailsSectionForFieldInfoGroups=function(t,i){return{type:a.DETAILS,stack:[function(){var a=t[0],n=l.createTable(e.mixin({numColumns:t.length+1,numRows:a.length+1},i));return n.data.data.forEach(function(e,a){n.data.columns.forEach(function(l,i){if(0!==i){if(0===a)return void(e[l.field]=t[i-1][0].fieldCategory||"");var n=t[i-1][a-1];e.field0=e.field0||(n.script?n.script.alias:n.alias),e.fieldInfos[l.field]=n}})}),l.provideSpaceAfter(n),n}()]}},l.provideSpaceAfter=function(e,t){e.style.spaceAfter=Math.max(t||0,90-15.07*e.data.data.length)},l.applyDefaultStyling=function(e){var t=!0;e.data.data.forEach(function(a,l){e.data.columns.forEach(function(e){a.style.fields[e.field].overrideStyle=0===l?"TableHeader":t?"AlternatingRow":void 0}),t=!t})},l.setTableHeaderStyle=function(e){if(e.style)for(var t in e.style.fields){var a=e.style.fields[t]=e.style.fields[t]||{};a.overrideStyle="TableHeader"}},l.DEFAULT_ROW_HEIGHT=15.07,l});