// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.26/esri/copyright.txt for details.

define(["dojo/_base/lang","dojox/charting/Theme","../../themes/ThemeLibrary","./ChartTypes","./ChartLineMarkers","../../supportClasses/templateJsonUtils/fieldInfo/FieldInfoBuilder"],function(e,o,r,n,i,t){function a(e,o,r){var i,t=o;switch(e){case n.COLUMN:i=t.column&&t.column.colors;break;case n.BAR:i=t.bar&&t.bar.colors;break;case n.LINE:case n.VERTICAL_LINE:i=t.line&&t.line.colors;break;case n.PIE:i=t.pie&&t.pie.colors;break;case n.DONUT:i=t.donut&&t.donut.colors;break;case n.GAUGE:i=t.gauge&&t.gauge.colors;break;case n.RING:i=t.ring&&t.ring.colors;break;case n.PICTURE_COLUMN:i=t.pictureColumn&&t.pictureColumn.colors;break;case n.PICTURE_BAR:i=t.pictureBar&&t.pictureBar.colors}return i&&i.length||(i=null),i||r<=3&&t.colors3series||t.colors||s}var l={},s=["#AAAAAA","#888888","#555555","#333333"];return l.DEFAULT_LINE_THICKNESS=1,l.DEFAULT_COLUMN_THICKNESS="Medium",l.DEFAULT_DONUT_HOLE_PERCENT=50,l.DEFAULT_DONUT_GAP=3,l.DEFAULT_DONUT_ARC_PERCENT=100,l.DEFAULT_GAUGE_HOLE_PERCENT=80,l.DEFAULT_GAUGE_GAP=2,l.DEFAULT_GAUGE_ANGLE=0,l.DEFAULT_GAUGE_ARC_PERCENT=100,l.getThemeForSettings=function(r,i){var a=i,u=new o({colors:a.colors||s});if(!r)return u;var c=r.visualProperties;u.plotarea.fill=c.backgroundColor||a.backgroundColor,u.plotarea.stroke={width:0},u.chart.fill="transparent",u.axis.title.font="normal normal normal 11px Verdana",!n.isPieLike(r.type)&&r.type!==n.RING&&c.backgroundImageData&&(u.plotarea.backgroundImageData=c.backgroundImageData);var g=e.mixin({},a.dataLabelsStyle,c.dataLabelsStyle);if(g.color&&(u.series.fontColor=g.color),u.series.font=l.combineFontString(g),u.series.showColumnBarBackground=c.showColumnBarBackground,u.series.columnBarBackgroundColor=c.columnBarBackgroundColor||a.columnBarBackground&&a.columnBarBackground.backgroundColor,u.series.renderColumnBarsInOppositeDirections=c.renderColumnBarsInOppositeDirections,u.series.baseLineValue=c.yAxis.baseLineValue,r.type===n.DONUT&&(u.series.donutHolePercent=void 0!==c.donutHolePercent?c.donutHolePercent:l.DEFAULT_DONUT_HOLE_PERCENT,u.series.donutGap=void 0!==c.donutGap?c.donutGap:l.DEFAULT_DONUT_GAP,u.series.donutArcPercent=void 0!==c.donutArcPercent?c.donutArcPercent:l.DEFAULT_DONUT_ARC_PERCENT,u.series.donutArcPercent=Math.min(100,Math.max(50,u.series.donutArcPercent))),r.type===n.GAUGE){u.series.donutHolePercent=void 0!==c.gaugeHolePercent?c.gaugeHolePercent:l.DEFAULT_GAUGE_HOLE_PERCENT,u.series.donutGap=void 0!==c.gaugeGap?c.gaugeGap:l.DEFAULT_GAUGE_GAP,u.series.startAngle=void 0!==c.gaugeStartAngle?c.gaugeStartAngle:l.DEFAULT_GAUGE_ANGLE,u.series.donutArcPercent=void 0!==c.gaugeArcPercent?c.gaugeArcPercent:l.DEFAULT_GAUGE_ARC_PERCENT,u.series.donutArcPercent=Math.min(100,Math.max(50,u.series.donutArcPercent)),u.series.donutShowIcons=c.showChartIcons,c.gaugeShowArrow&&(u.series.donutShowArrowIndicator=!0,u.series.donutGap=0,100!==u.series.donutArcPercent&&(u.series.startAngle=0),u.series.donutArrowIndicatorLineColor=c.gaugeArrowLineColor||a.gauge&&a.gauge.arrowIndicator.lineColor,u.series.donutArrowIndicatorFillColor=c.gaugeArrowFillColor||a.gauge&&a.gauge.arrowIndicator.backgroundColor);var d=e.mixin({},a.gauge&&a.gauge.dataLabelStyle,c.gaugeLabelStyle);if(u.series.donutMainLabelPosition=c.gaugeLabelPlacement,u.series.donutMainLabelFont=l.combineFontString(d),u.series.donutMainLabelFontColor=c.gaugeConditionalStylingLabel?null:d.color,u.series.donutMainLabelFontColorFromConditionalStyling=c.gaugeConditionalStylingLabel&&!!c.conditionalStyling,u.series.donutMainLabelFontSize=c.gaugeLabelStyle&&c.gaugeLabelStyle.fontSize,u.series.donutMainLabelTextDecoration=d.textDecoration,c.gaugeShowFromToLabels){u.series.donutShowFromToLabels=c.gaugeShowFromToLabels;var F=e.mixin({},a.gauge&&a.gauge.dataLabelStyle,c.gaugeFromLabelStyle);u.series.donutFromLabelText=c.gaugeRangeMin||0,u.series.donutFromLabelFont=l.combineFontString(F),u.series.donutFromLabelFontColor=F.color,u.series.donutFromLabelFontSize=F.fontSize,u.series.donutFromLabelTextDecoration=F.textDecoration;var L=e.mixin({},a.gauge&&a.gauge.dataLabelStyle,c.gaugeToLabelStyle);u.series.donutToLabelText=c.gaugeRangeMax||"",u.series.donutToLabelFont=l.combineFontString(L),u.series.donutToLabelFontColor=L.color,u.series.donutToLabelFontSize=L.fontSize,u.series.donutToLabelTextDecoration=L.textDecoration}var A=r.seriesItems[0].points[0];u.series.isPercentState=t.isFieldInfoInPercentState(A.fieldInfo)}return r.type===n.RING&&(u.series.show100PercentLabel=!0,u.series.ringBackgroundColor=c.ringBackgroundColor||a.ring&&a.ring.ringBackground&&a.ring.ringBackground.backgroundColor),n.isPictureLike(r.type)&&(u.series.showWholePictures=c.showWholePictures),u.marker.fill="#FFFFFF",u.series.outline=null,u},l.getComparisonSymbol=function(){return i.getMarkerPath(i.CIRCLE)},l.calcColorForPoint=function(e){var o,r,i=e.point,t=e.seriesItem,l=e.pointIndex,s=e.seriesIndex,u=e.numSeries,c=e.chartType,g=e.themeSettings,d=e.isComparisonSeries,F=e.comparisonInfo,L=(e.isMultiFeature,n.isPieLike(c)||!g.renderSingleDataSeriesWithSameColor&&1===u),A=a(c,g,L?t.points.length:u);if(n.isLineLike(c))d&&F?r=F.color||g.comparisonInfo.lineColor:(o=A[s%A.length],r=t.color||o||"#FFFFFF");else if(d&&F&&F.color)r=F.color;else{if(c===n.GAUGE&&1===l&&g.gauge.othersColor)return i&&i.color||g.gauge.othersColor;o=o||(L?A[l%A.length]:A[s%A.length]),r=i&&i.color||!n.isPieLike(c)&&t.color||o||"#FFFFFF"}return r},l.calcColorForSeries=function(e){var o,r,i=e.seriesItem,t=e.seriesIndex,l=e.numSeries,s=e.chartType,u=e.themeSettings,c=(e.isMultiFeature,n.isPieLike(s)||!u.renderSingleDataSeriesWithSameColor&&1===l),g=a(s,u,c?i.points.length:l);if(n.isLineLike(s))o=g[t%g.length],r=i&&i.color||o||"#FFFFFF";else var o=c?null:g[t%g.length],r=i&&i.color||o||"#FFFFFF";return r},l.provideMissingIconsForPoints=function(o,r){if(!n.isPictureLike(r))return null;var i,t=[];o.forEach(function(o){o.iconFieldInfo?(i=o.iconFieldInfo,t.forEach(function(o){o.iconFieldInfo=e.clone(i)}),t.length=0):i?o.iconFieldInfo=e.clone(i):t.push(o)})},l.calcIconForPoint=function(e,o,r){if(!n.isPictureLike(r))return null;var i=e.iconFieldInfo;return i&&i.shapeJson&&o&&(i.shapeJson.themeStyle={fillColor:o,borderColor:o}),i},l.calcBackgroundIconForPoint=function(o,r,i,t){if(!n.isPictureLike(r))return null;var a=t.columnBarBackgroundColor||i.columnBarBackground&&i.columnBarBackground.backgroundColor,l=o.iconFieldInfo;return l&&l.shapeJson&&a?(l=e.clone(l),l.shapeJson.themeStyle={fillColor:a,borderColor:a},l):null},l.combineFontString=function(e){return e=e||{},(e.fontStyle||"normal")+" normal "+(e.fontWeight||"normal")+" "+(e.fontSize||r.CHART_DATA_FONT_SIZE)+"px "+(e.fontFamily||r.DEFAULT_FONT_FAMILY_CLASSIC)},l});