// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.22/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/dom-style"],function(t,e){var i=5,o=t(null,{section:null,constructor:function(t){this.section=t},getWidth:function(){return e.get(this.section.domNode,"width")},_widthInitializedFlag:!1,setWidth:function(t,i){i=i||{};var o=this._widthInitializedFlag?e.get(this.section.domNode,"width"):0;i&&i.previousDim&&(o=i.previousDim.w,this._widthInitializedFlag=!0),e.set(this.section.domNode,"width",t+"px"),this._widthInitializedFlag=this._widthInitializedFlag||t>1,this.section.hasFixedLayout&&this.section.getTables().forEach(function(e){e.getMaxWidth()!=t&&e.setMaxWidth(t,{resizeToFitAllowedWidth:i.resizeContentToFit,preserveRightOffset:i.preserveRightOffset})}),!this.section.hasFixedLayout&&this._widthInitializedFlag&&i&&i.resizeContentProportionally&&o&&t&&o!=t&&this.scaleFloatingContentProportionally({xScale:t/o,yScale:1})},getHeight:function(t){if(!this.section.hasFixedLayout)return 0;var i=0;return this.section._stackElements.forEach(function(o){switch(o.stackId){case"table":i+=o.getHeight(t);break;case"img":break;case"hr":i+=e.get(o,"height");break;case"pageBreak":i+=e.get(o,"height")}}),i},getResizedHeight:function(){return this.section.hasFixedLayout?this.getHeight(!0):e.get(this.section.domNode,"height")},_resizedHeightInitializedFlag:!1,_setResizedHeight:function(t,i){if(this.section.hasFixedLayout){var o=this.section.getLastTable();o&&o.setSpaceAfter(t-this.getHeight())}var n=this._resizedHeightInitializedFlag?e.get(this.section.domNode,"height"):0;i&&i.previousDim&&(n=i.previousDim.h,this._resizedHeightInitializedFlag=!0),e.set(this.section.domNode,"height",t+"px"),this._resizedHeightInitializedFlag=this._resizedHeightInitializedFlag||t>1,!this.section.hasFixedLayout&&i&&i.resizeContentProportionally&&n&&t&&n!=t&&this.scaleFloatingContentProportionally({xScale:1,yScale:t/n})},setResizedHeight:function(t,e){if(this._setResizedHeight(t,e),this.section.hasFixedLayout){var i=this;this.section.getTables().forEach(function(t){t.needScaleToFitHeight()&&i._scaleFixedTableToFitHeight(t)})}},updateHeightAfterContentChange:function(){this.section.hasFixedLayout&&this._setResizedHeight(this.getResizedHeight())},scaleFloatingContentProportionally:function(t){this.section.hasFixedLayout||(1!=t.xScale||1!=t.yScale)&&this.section._stackElements.forEach(function(e){switch(e.stackId){case"table":e.scaleProportionallyWithinParent&&e.scaleProportionallyWithinParent(t);break;case"img":e.scaleProportionallyWithinParent&&e.scaleProportionallyWithinParent(t)}})},getFloatingContentBox:function(){function t(t){e.minX=Math.min(e.minX,t.l),e.minY=Math.min(e.minY,t.t),e.maxX=Math.max(e.maxX,t.l+t.w),e.maxY=Math.max(e.maxY,t.t+t.h)}var e={minX:1/0,minY:1/0,maxX:0,maxY:0};return this.section._stackElements.forEach(function(e){switch(e.stackId){case"table":t(e.getTableBox());break;case"img":t(e.getImageBox(!1))}}),{l:e.minX,t:e.minY,w:e.maxX-e.minX,h:e.maxY-e.minY}},fitContentNicely:function(t,e){t=t||{},this.section.hasFixedLayout?this._fitFixedTablesNicely(t,e):this._fitFloatingContentNicely(t,e)},_fitFixedTablesNicely:function(t,e){if("none"!=t.fitMode){"all"==t.fitMode&&delete t.fitMode;var i=this,o=e||this.section.getTables();o.forEach(function(e){"table"==e.stackId&&("width"!=t.fitMode&&t.fitMode||e.resizeToFitAllowedWidth(),"height"!=t.fitMode&&t.fitMode||i._scaleFixedTableToFitHeight(e))}),this.section._notifyContentChanged()}},_scaleFixedTableToFitHeight:function(t){t.resizeToFitHeight(this.section.getResizedHeight()),t.setSpaceAfter(0)},_fitFloatingContentNicely:function(t,o){function n(t){e.set(t.domNode,{left:h+e.get(t.domNode,"left")+"px",top:l+e.get(t.domNode,"top")+"px"})}if("none"!=t.fitMode){var a=this.getFloatingContentBox(),s={xScale:"height"==t.fitMode?1:(this.section.getWidth()-2-2*i)/a.w,yScale:"width"==t.fitMode?1:(e.get(this.section.domNode,"height")-2-2*i)/a.h},h=i-a.l*s.xScale,l=i-a.t*s.yScale;o=o||this.section._stackElements,o.forEach(function(t){switch(t.stackId){case"table":t.scaleProportionallyWithinParent&&t.scaleProportionallyWithinParent(s),n(t);break;case"img":t.scaleProportionallyWithinParent&&t.scaleProportionallyWithinParent(s),n(t)}})}},getPreferredHeight:function(){var t=this.section.getInfographicWithTable();if(!t||!t.infographic.getPreferredHeight)return 0;var e=t.table.getTableBox(),i=e.t,o=this.getResizedHeight()-e.t-e.h,n=t.infographic.getPreferredHeight()||0;return i+o+n}});return o.TABLE_FIT_PRETTY_OFFSET=i,o});