// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.5/esri/copyright.txt for details.

define(["require","exports","dojo/_base/lang","../../../Color","./support/colors","./support/utils"],function(o,e,a,t,r,i){function n(){for(var o in u){var e=u[o],a=e.basemapGroups,t=y[o]={basemaps:[].concat(a.light).concat(a.dark),point:{},polyline:{},polygon:{}};for(var r in a)for(var i=a[r],n=0;n<i.length;n++){var l=i[n];e.pointSchemes&&(t.point[l]=e.pointSchemes[r]),e.polylineSchemes&&(t.polyline[l]=e.polylineSchemes[r]),e.polygonSchemes&&(t.polygon[l]=e.polygonSchemes[r])}}}function l(o,e){return o.map(function(o){var a=new t(o);return null!=e&&(a.a=e),a})}function c(o,e,a,i){var n,c=r[o],s=l(c.stops);if(c)switch(i){case"point":case"multipoint":if("point-cloud-class"===a)n={theme:a,colors:s};else{var p=e;n={theme:a,colors:s,noDataColor:new t(p.noDataColor),opacity:1,outline:{color:new t(p.outline.color),width:p.outline.width},size:p.size}}break;case"polyline":var m=e;n={theme:a,colors:s,noDataColor:new t(m.noDataColor),opacity:1,width:m.width};break;case"polygon":var d=e;n={theme:a,colors:s,noDataColor:new t(d.noDataColor),opacity:d.fillOpacity||1,outline:{color:new t(d.outline.color),width:d.outline.width}};break;case"mesh":var h=e;n={theme:a,colors:s,noDataColor:new t(h.noDataColor),opacity:h.fillOpacity||1}}return n}function s(o,e,a){var t=y[e],r=i.getStorageType(a),n=t&&t[r];return n&&n[o]}var p={light:{color:[153,153,153,1],width:"1px"},dark:{color:[51,51,51,1],width:"1px"},darker:{color:[26,26,26,1],width:"1px"}},m={light:["streets","gray","topo","terrain","national-geographic","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]},d=["tropical-bliss","desert-blooms","under-the-sea","vibrant-rainbow","ocean-bay","prairie-summer","pastel-chalk"],h="#aaaaaa",u={"default":{name:"default",label:"Default",description:"Default theme for visualizing features by their type.",basemapGroups:m,pointSchemes:{light:{common:{noDataColor:h,outline:p.light,size:"8px"},primary:"cat-dark",secondary:["cat-light"].concat(d)},dark:{common:{noDataColor:h,outline:p.darker,size:"8px"},primary:"cat-light",secondary:["cat-dark"].concat(d)}},polylineSchemes:{light:{common:{noDataColor:h,width:"2px"},primary:"cat-dark",secondary:["cat-light"].concat(d)},dark:{common:{noDataColor:h,width:"2px"},primary:"cat-light",secondary:["cat-dark"].concat(d)}},polygonSchemes:{light:{common:{noDataColor:h,outline:p.light,fillOpacity:.8},primary:"cat-dark",secondary:["cat-light"].concat(d)},dark:{common:{noDataColor:h,outline:p.dark,fillOpacity:.8},primary:"cat-light",secondary:["cat-dark"].concat(d)}}},"point-cloud-class":{name:"point-cloud-class",label:"Point Cloud Class",description:"Default theme for visualizing point cloud data based on classification.",basemapGroups:m,pointSchemes:{light:{primary:"point-cloud-class-scheme",secondary:[]},dark:{primary:"point-cloud-class-scheme",secondary:[]}}}},y={};n();var g={getThemes:function(o){var e=[];for(var a in u){var t=u[a],r=y[a],n=i.getBasemapId(o,r.basemaps);n&&-1===r.basemaps.indexOf(n)||e.push({name:t.name,label:t.label,description:t.description,basemaps:r.basemaps.slice(0)})}return e},getSchemes:function(o){var e,a=o.geometryType,t="mesh"!==a&&o.worldScale,r=o.view,n=o.theme||"default",l=i.getBasemapId(o.basemap,y[n].basemaps),p=s(l,n,a);if(p){var m=c(p.primary,p.common,n,a);e={primaryScheme:t?g.toWorldScale({scheme:m,view:r}):m,secondarySchemes:p.secondary.map(function(o){var e=c(o,p.common,n,a);return t?g.toWorldScale({scheme:e,view:r}):e}),basemapId:l}}return e},cloneScheme:function(o){var e;return o&&(e=a.mixin({},o),e.colors=l(e.colors),e.noDataColor&&(e.noDataColor=new t(e.noDataColor)),e.outline&&(e.outline={color:e.outline.color&&new t(e.outline.color),width:e.outline.width})),e},toWorldScale:function(o){if(o.scheme&&o.view){var e=o.scheme,a=o.scheme;return e.hasOwnProperty("size")?(e.size&&(e.size=i.toWorldScale(e.size,o.view)),e):a.hasOwnProperty("width")?(a.width&&(a.width=i.toWorldScale(a.width,o.view)),a):o.scheme}}};return g});