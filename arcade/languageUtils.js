// COPYRIGHT © 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.6/esri/copyright.txt for details.

define(["require","exports","../geometry/Geometry","../moment","dojo/number","./ImmutableArray","../kernel","./ImmutablePointArray","./ImmutablePathArray","dojo/_base/array","../geometry/Point","../geometry/Polyline","../geometry/Polygon","../geometry/Extent","../geometry/Multipoint","./FunctionWrapper"],function(n,e,r,t,i,u,o,a,f,l,c,s,d,m,g,y){function p(n,e,r){if(""===e)return n;if(null===e)return n;if(void 0===e)return n;if(e===r)return n;if(e===r)return n;do n=n.replace(e,r);while(-1!==n.indexOf(e));return n}function v(n){return n instanceof Y||n instanceof y||n instanceof $}function x(n){return N(n)?!0:O(n)?!0:I(n)?!0:S(n)?!0:null===n?!0:n===e.voidOperation?!0:"number"==typeof n?!0:!1}function h(n,e){return void 0===n?e:n}function N(n){return"string"==typeof n||n instanceof String}function S(n){return"boolean"==typeof n}function O(n){return"number"==typeof n}function T(n){return n instanceof Array}function b(n){return n&&void 0!==n.isFeatureCursor}function _(n){return n instanceof u}function I(n){return n instanceof Date}function C(n,e,r){if(n.length<e||n.length>r)throw new Error("Function called with wrong number of Parameters")}function j(){var n=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?r:3&r|8).toString(16)});return e}function R(n,e){return isNaN(n)===!1?void 0===e||null===e||""===e?n.toString():(e=p(e,"‰",""),e=p(e,"¤",""),i.format(n,{pattern:e})):n.toString()}function k(n,e){var r=t(n);return void 0===e||null===e||""===e?r.format():r.format(D(e))}function D(n){var e=n.replace(/(LTS)|L|l/g,function(n){return"["+n+"]"});return e}function F(n,e,r){switch(r){case">":return n>e;case"<":return e>n;case">=":return n>=e;case"<=":return e>=n}return!1}function w(n,r,t){if(null===n){if(null===r||r===e.voidOperation)return F(null,null,t);if(O(r))return F(0,r,t);if(N(r))return F(0,z(r),t);if(S(r))return F(0,z(r),t);if(I(r))return F(0,r.getTime(),t)}if(n===e.voidOperation){if(null===r||r===e.voidOperation)return F(null,null,t);if(O(r))return F(0,r,t);if(N(r))return F(0,z(r),t);if(S(r))return F(0,z(r),t);if(I(r))return F(0,r.getTime(),t)}else if(O(n)){if(O(r))return F(n,r,t);if(S(r))return F(n,z(r),t);if(null===r||r===e.voidOperation)return F(n,0,t);if(N(r))return F(n,z(r),t);if(I(r))return F(n,r.getTime(),t)}else if(N(n)){if(N(r))return F(V(n),V(r),t);if(I(r))return F(z(n),r.getTime(),t);if(O(r))return F(z(n),r,t);if(null===r||r===e.voidOperation)return F(z(n),0,t);if(S(r))return F(z(n),z(r),t)}else if(I(n)){if(I(r))return F(n,r,t);if(null===r||r===e.voidOperation)return F(n.getTime(),0,t);if(O(r))return F(n.getTime(),r,t);if(S(r))return F(n.getTime(),z(r),t);if(N(r))return F(n.getTime(),z(r),t)}else if(S(n)){if(S(r))return F(n,r,t);if(O(r))return F(z(n),z(r),t);if(I(r))return F(z(n),r.getTime(),t);if(null===r||r===e.voidOperation)return F(z(n),0,t);if(N(r))return F(z(n),z(r),t)}return J(n,r)&&("<="===t||">="===t)?!0:!1}function J(n,r){if(n===r)return!0;if(null===n&&r===e.voidOperation||null===r&&n===e.voidOperation)return!0;if(I(n)&&I(r))return n.getTime()===r.getTime();if(n instanceof f)return n.equalityTest(r);if(n instanceof a)return n.equalityTest(r);if(n instanceof c&&r instanceof c){var t=void 0,i=void 0;if(e.isVersion4?(t=n.cache._arcadeCacheId,i=r.cache._arcadeCacheId):(t=n.getCacheValue("_arcadeCacheId"),i=r.getCacheValue("_arcadeCacheId")),void 0!==t&&null!==t)return t===i}if(void 0!==n&&void 0!==r&&null!==n&&null!==r&&"object"==typeof n&&"object"==typeof r){if(n._arcadeCacheId===r._arcadeCacheId&&void 0!==n._arcadeCacheId&&null!==n._arcadeCacheId)return!0;if(n._underlyingGraphic===r._underlyingGraphic&&void 0!==n._underlyingGraphic&&null!==n._underlyingGraphic)return!0}return!1}function V(n,t){if(N(n))return n;if(null===n)return"";if(O(n))return R(n,t);if(S(n))return n.toString();if(I(n))return k(n,t);if(n instanceof r)return JSON.stringify(n.toJSON());if(T(n)){for(var i=[],o=0;o<n.length;o++)i[o]=M(n[o]);return"["+i.join(",")+"]"}if(n instanceof u){for(var i=[],o=0;o<n.length();o++)i[o]=M(n.get(o));return"["+i.join(",")+"]"}return null!==n&&"object"==typeof n&&void 0!==n.castToText?n.castToText():v(n)?"object, Function":(n===e.voidOperation,"")}function A(n){var e=[];if(T(n)===!1)return null;if(n instanceof u){for(var r=0;r<n.length();r++)e[r]=z(n.get(r));return e}for(var r=0;r<n.length;r++)e[r]=z(n[r]);return e}function P(n,t){if(N(n))return n;if(null===n)return"";if(O(n))return R(n,t);if(S(n))return n.toString();if(I(n))return k(n,t);if(n instanceof r)return n instanceof m?'{"xmin":'+n.xmin.toString()+',"ymin":'+n.ymin.toString()+","+(n.hasZ?'"zmin":'+n.zmin.toString()+",":"")+(n.hasM?'"mmin":'+n.mmin.toString()+",":"")+'"xmax":'+n.xmax.toString()+',"ymax":'+n.ymax.toString()+","+(n.hasZ?'"zmax":'+n.zmax.toString()+",":"")+(n.hasM?'"mmax":'+n.mmax.toString()+",":"")+'"spatialReference":'+H(n.spatialReference)+"}":H(n.toJSON(),function(n,e){return n.key===e.key?0:"spatialReference"===n.key?1:"spatialReference"===e.key?-1:n.key<e.key?-1:n.key>e.key?1:0});if(T(n)){for(var i=[],o=0;o<n.length;o++)i[o]=M(n[o]);return"["+i.join(",")+"]"}if(n instanceof u){for(var i=[],o=0;o<n.length();o++)i[o]=M(n.get(o));return"["+i.join(",")+"]"}return null!==n&&"object"==typeof n&&void 0!==n.castToText?n.castToText():v(n)?"object, Function":(n===e.voidOperation,"")}function M(n){if(null===n)return"null";if(S(n)||O(n)||N(n))return JSON.stringify(n);if(n instanceof r)return P(n);if(n instanceof u)return P(n);if(n instanceof Array)return P(n);if(n instanceof Date)return JSON.stringify(k(n,""));if(null!==n&&"object"==typeof n){if(void 0!==n.castToText)return n.castToText()}else if(n===e.voidOperation)return"null";return"null"}function z(n,r){return O(n)?n:null===n?0:""===n?0:I(n)?NaN:S(n)?n?1:0:T(n)?NaN:""===n?NaN:void 0===n?NaN:void 0!==r&&N(n)?(r=p(r,"‰",""),r=p(r,"¤",""),i.parse(n,{pattern:r})):n===e.voidOperation?0:Number(n)}function E(n,e){if(I(n))return n;if(N(n)){var r=t(n,[void 0===e||null===e||""===e?t.ISO_8601:e]);if(r.isValid())return r.toDate()}return null}function G(n,e){if(I(n))return t(n);if(N(n)){var r=t(n,[void 0===e||null===e||""===e?t.ISO_8601:e]);if(r.isValid())return r}return null}function L(n){return S(n)?n:N(n)?(n=n.toLowerCase(),"true"===n?!0:!1):O(n)?0===n?!1:isNaN(n)?!1:!0:!1}function q(n,e){return null===n||void 0===n?null:((null===n.spatialReference||void 0===n.spatialReference)&&(n.spatialReference=e),n)}function U(n){return null===n?null:n instanceof c?"NaN"===n.x||null===n.x||isNaN(n.x)?null:n:n instanceof d?0===n.rings.length?null:n:n instanceof s?0===n.paths.length?null:n:n instanceof g?0===n.points.length?null:n:n instanceof m?"NaN"===n.xmin||null===n.xmin||isNaN(n.xmin)?null:n:null}function B(n,e){if(!n)return null;if(!n.domain)return null;var r=null;e="string"===n.field.type||"esriFieldTypeString"===n.field.type?V(e):z(e);for(var t=0;t<n.domain.codedValues.length;t++){var i=n.domain.codedValues[t];i.code===e&&(r=i)}return null===r?null:r.name}function Z(n,e){if(!n)return null;if(!n.domain)return null;var r=null;e=V(e);for(var t=0;t<n.domain.codedValues.length;t++){var i=n.domain.codedValues[t];i.name===e&&(r=i)}return null===r?null:r.code}function K(n,e,r,t){if(void 0===r&&(r=null),!e)return null;if(!e.fields)return null;for(var i=null,u=0;u<e.fields.length;u++){var o=e.fields[u];o.name.toLowerCase()===n.toString().toLowerCase()&&(i=o)}if(null===i)return null;var a,f;return t||(t=r&&e.typeIdField&&r._field(e.typeIdField)),null!=t&&l.some(e.types,function(n){return n.id===t?(a=n.domains&&n.domains[i.name],a&&"inherited"===a.type&&(a=W(i.name,e),f=!0),!0):!1}),f||a||(a=W(n,e)),{field:i,domain:a}}function W(n,e){var r;return l.some(e.fields,function(e){return e.name===n&&(r=e.domain),!!r}),r}function H(n,e){e||(e={}),"function"==typeof e&&(e={cmp:e});var r="boolean"==typeof e.cycles?e.cycles:!1,t=e.cmp&&function(n){return function(e){return function(r,t){var i={key:r,value:e[r]},u={key:t,value:e[t]};return n(i,u)}}}(e.cmp),i=[];return function u(n){if(n&&n.toJSON&&"function"==typeof n.toJSON&&(n=n.toJSON()),void 0!==n){if("number"==typeof n)return isFinite(n)?""+n:"null";if("object"!=typeof n)return JSON.stringify(n);var e,o;if(Array.isArray(n)){for(o="[",e=0;e<n.length;e++)e&&(o+=","),o+=u(n[e])||"null";return o+"]"}if(null===n)return"null";if(-1!==i.indexOf(n)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=i.push(n)-1,f=Object.keys(n).sort(t&&t(n));for(o="",e=0;e<f.length;e++){var l=f[e],c=u(n[l]);c&&(o&&(o+=","),o+=JSON.stringify(l)+":"+c)}return i.splice(a,1),"{"+o+"}"}}(n)}Object.defineProperty(e,"__esModule",{value:!0});var Q=function(){function n(n){this.value=n}return n}(),X=function(){function n(n){this.value=n}return n}(),Y=function(){function n(n){this.fn=n}return n}(),$=function(){function n(n){this.fn=n}return n}();e.NativeFunction=Y,e.ImplicitResult=X,e.ReturnResult=Q,e.SizzleFunction=$,e.isVersion4=0===o.version.indexOf("4."),e.voidOperation={type:"VOID"},e.breakResult={type:"BREAK"},e.continueResult={type:"CONTINUE"},e.multiReplace=p,e.isFunctionParameter=v,e.isSimpleType=x,e.defaultUndefined=h,e.isString=N,e.isBoolean=S,e.isNumber=O,e.isArray=T,e.isFeatureCursor=b,e.isImmutableArray=_,e.isDate=I,e.pcCheck=C,e.generateUUID=j,e.formatNumber=R,e.formatDate=k,e.standardiseDateFormat=D,e.greaterThanLessThan=w,e.equalityTest=J,e.toString=V,e.toNumberArray=A,e.toStringExplicit=P,e.toNumber=z,e.toDate=E,e.toDateM=G,e.toBoolean=L,e.fixSpatialReference=q,e.fixNullGeometry=U,e.getDomainValue=B,e.getDomainCode=Z,e.getDomain=K,e.stableStringify=H});