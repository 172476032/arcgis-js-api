// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.6/esri/copyright.txt for details.

define(["require","exports","../../../../core/tsSupport/extendsHelper","dojo/text!./HUDMaterial.xml","./internal/MaterialUtil","../lib/Util","../../../webgl/Util","./internal/MaterialBase","./internal/GLMaterialTextureBase","../lib/gl-matrix","../lib/RenderSlot","../lib/RenderPass","../lib/ShaderVariations","../lib/ComponentUtils","../../support/aaBoundingRect","../lib/screenSizePerspectiveUtils"],function(e,t,r,i,n,o,a,s,l,c,f,d,v,u,p,S){function m(e,t){return void 0===t&&(t=w),e.textureIsSignedDistanceField?h(e.anchorPos,e.distanceFieldBoundingBox,t):P.set(e.anchorPos,t),t}function g(e,t,r,i){return void 0===i&&(i=w),P.set(e.anchorPos,i),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*r,i[1]+=e.screenOffset[1]*r,i}function h(e,t,r){r[0]=e[0]*(t[2]-t[0])+t[0],r[1]=e[1]*(t[3]-t[1])+t[1]}function x(e){var t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],f=1/Math.sqrt(t*t+r*r+i*i),d=1/Math.sqrt(n*n+o*o+a*a),v=1/Math.sqrt(s*s+l*l+c*c);return e[0]=t*f,e[1]=r*f,e[2]=i*f,e[3]=n*d,e[4]=o*d,e[5]=a*d,e[6]=s*v,e[7]=l*v,e[8]=c*v,e}var P=c.vec2d,A=c.vec3d,O=c.mat3d,z=c.mat4d,C=76,y=C/4,V="hud-material-shader-variations",b="hud-material-highlight-shader-variations",I="hud-material-occlusion-test-pixel-shader-variations",E={"bottom-left":[0,0],bottom:[.5,0],"bottom-right":[1,0],left:[0,.5],center:[.5,.5],right:[1,.5],"top-left":[0,1],top:[.5,1],"top-right":[1,1]},U=[{name:"position",count:3,type:5126,offset:0,stride:C,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:C,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:C,normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:C,normalized:!1},{name:"size",count:2,type:5126,offset:36,stride:C,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:44,stride:C,normalized:!1},{name:"auxpos2",count:4,type:5126,offset:60,stride:C,normalized:!1}],T={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,anchorPos:E.center,shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},D=function(e){function t(t,r){var i=e.call(this,r)||this;return i._textureDirty=!1,i.params=n.copyParameters(t,T),"string"==typeof i.params.anchorPos&&(i.params.anchorPos=E[i.params.anchorPos]),i}return r(t,e),t.prototype.dispose=function(){},t.prototype.getParameterValues=function(){var e=this.params;return{color:e.color,texCoordScale:e.texCoordScale,polygonOffset:e.polygonOffset,anchorPos:e.anchorPos,screenOffset:e.screenOffset,verticalOffset:e.verticalOffset,screenSizePerspective:e.screenSizePerspective,screenSizePerspectiveAlignment:e.screenSizePerspectiveAlignment,shaderPolygonOffset:e.shaderPolygonOffset,textureIsSignedDistanceField:e.textureIsSignedDistanceField,outlineColor:e.outlineColor,outlineSize:e.outlineSize,distanceFieldBoundingBox:e.distanceFieldBoundingBox,vvSizeEnabled:e.vvSizeEnabled,vvSizeMinSize:e.vvSizeMinSize,vvSizeMaxSize:e.vvSizeMaxSize,vvSizeOffset:e.vvSizeOffset,vvSizeFactor:e.vvSizeFactor,vvColorEnabled:e.vvColorEnabled,vvColorValues:e.vvColorValues,vvColorColors:e.vvColorColors,textureId:e.textureId,occlusionTest:e.occlusionTest,binaryHighlightOcclusion:e.binaryHighlightOcclusion,centerOffsetUnits:e.centerOffsetUnits,debugDrawBorder:e.debugDrawBorder,drawInSecondSlot:e.drawInSecondSlot}},t.prototype.setParameterValues=function(e){for(var t in e)"textureId"===t&&o.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[t]=e[t];this.notifyDirty("matChanged")},t.prototype.getParams=function(){return this.params},t.prototype.getOutputAmount=function(e){return e*y*6},t.prototype.getInstanceBufferLayout=function(){},t.prototype.getVertexBufferLayout=function(){return U},t.prototype.fillInterleaved=function(e,t,r,i,s,l){for(var c=4*l,f=e.indices[o.VertexAttrConstants.POSITION],d=e.vertexAttr[o.VertexAttrConstants.POSITION].data,v=l+a.findAttribute(U,o.VertexAttrConstants.POSITION).offset/4,u=0;u<f.length;++u){var p=3*f[u];n.fill(d,p,s,v,t,3),v+=y,n.fill(d,p,s,v,t,3),v+=y,n.fill(d,p,s,v,t,3),v+=y,n.fill(d,p,s,v,t,3),v+=y,n.fill(d,p,s,v,t,3),v+=y,n.fill(d,p,s,v,t,3),v+=y}for(var S=e.indices[o.VertexAttrConstants.NORMAL],m=e.vertexAttr[o.VertexAttrConstants.NORMAL].data,g=l+a.findAttribute(U,o.VertexAttrConstants.NORMAL).offset/4,u=0;u<S.length;++u){var p=3*S[u];n.fill(m,p,s,g,r,3),g+=y,n.fill(m,p,s,g,r,3),g+=y,n.fill(m,p,s,g,r,3),g+=y,n.fill(m,p,s,g,r,3),g+=y,n.fill(m,p,s,g,r,3),g+=y,n.fill(m,p,s,g,r,3),g+=y}var h,x,P,A,O=e.vertexAttr[o.VertexAttrConstants.UV0].data;null==O||O.length<=3?(h=0,x=0,P=this.params.texCoordScale[0],A=this.params.texCoordScale[1]):(h=e.vertexAttr[o.VertexAttrConstants.UV0].data[0],x=e.vertexAttr[o.VertexAttrConstants.UV0].data[1],P=e.vertexAttr[o.VertexAttrConstants.UV0].data[2],A=e.vertexAttr[o.VertexAttrConstants.UV0].data[3]),P=Math.min(1.99999,P+1),A=Math.min(1.99999,A+1);for(var z=l+a.findAttribute(U,o.VertexAttrConstants.UV0).offset/4,u=0;u<f.length;++u)s[z]=h,s[z+1]=x,z+=y,s[z]=P,s[z+1]=x,z+=y,s[z]=P,s[z+1]=A,z+=y,s[z]=P,s[z+1]=A,z+=y,s[z]=h,s[z+1]=A,z+=y,s[z]=h,s[z+1]=x,z+=y;for(var V=e.indices[o.VertexAttrConstants.COLOR],b=e.vertexAttr[o.VertexAttrConstants.COLOR].data,I=c+a.findAttribute(U,o.VertexAttrConstants.COLOR).offset,E=new Uint8Array(s.buffer),u=0;u<V.length;++u){var p=4*V[u];n.fill(b,p,E,I,null,4),I+=C,n.fill(b,p,E,I,null,4),I+=C,n.fill(b,p,E,I,null,4),I+=C,n.fill(b,p,E,I,null,4),I+=C,n.fill(b,p,E,I,null,4),I+=C,n.fill(b,p,E,I,null,4),I+=C}for(var T=e.indices[o.VertexAttrConstants.SIZE],D=e.vertexAttr[o.VertexAttrConstants.SIZE].data,R=l+a.findAttribute(U,o.VertexAttrConstants.SIZE).offset/4,u=0;u<T.length;++u){var M=D[2*T[u]],F=D[2*T[u]+1];s[R]=M,s[R+1]=F,R+=y,s[R]=M,s[R+1]=F,R+=y,s[R]=M,s[R+1]=F,R+=y,s[R]=M,s[R+1]=F,R+=y,s[R]=M,s[R+1]=F,R+=y,s[R]=M,s[R+1]=F,R+=y}if(null!=e.indices[o.VertexAttrConstants.AUXPOS1]&&null!=e.vertexAttr[o.VertexAttrConstants.AUXPOS1])for(var L=e.indices[o.VertexAttrConstants.AUXPOS1],w=e.vertexAttr[o.VertexAttrConstants.AUXPOS1].data,B=l+a.findAttribute(U,"auxpos1").offset/4,u=0;u<L.length;++u){var p=4*L[u];n.fill(w,p,s,B,null,4),B+=y,n.fill(w,p,s,B,null,4),B+=y,n.fill(w,p,s,B,null,4),B+=y,n.fill(w,p,s,B,null,4),B+=y,n.fill(w,p,s,B,null,4),B+=y,n.fill(w,p,s,B,null,4),B+=y}if(null!=e.indices[o.VertexAttrConstants.AUXPOS2]&&null!=e.vertexAttr[o.VertexAttrConstants.AUXPOS2])for(var _=e.indices[o.VertexAttrConstants.AUXPOS2],N=e.vertexAttr[o.VertexAttrConstants.AUXPOS2].data,H=l+a.findAttribute(U,"auxpos2").offset/4,u=0;u<_.length;++u){var p=4*_[u];n.fill(N,p,s,H,null,4),H+=y,n.fill(N,p,s,H,null,4),H+=y,n.fill(N,p,s,H,null,4),H+=y,n.fill(N,p,s,H,null,4),H+=y,n.fill(N,p,s,H,null,4),H+=y,n.fill(N,p,s,H,null,4),H+=y}},t.prototype.intersect=function(e,t,r,i,n,a,s,l){if(i.isSelection&&i.enableHUDSelection&&!u.isAllHidden(t.componentVisibilities,e.data.componentOffsets)){var c=e.getData(),f=this.params,d=1,v=1;if(z.toMat3(r,X),l){var p=l(q);d=p[0],v=p[5],x(X)}var g=c.getVertexAttr()[o.VertexAttrConstants.POSITION],h=c.getVertexAttr()[o.VertexAttrConstants.SIZE],P=c.getVertexAttr()[o.VertexAttrConstants.NORMAL];o.assert(g.size>=3);for(var O=i.point,C=i.camera,y=m(f),V=0;V<g.data.length/g.size;V++){var b=V*g.size;A.set3(g.data[b],g.data[b+1],g.data[b+2],B),z.multiplyVec3(r,B,B);var I=V*h.size;W[0]=h.data[I]*d,W[1]=h.data[I+1]*v,z.multiplyVec3(C.viewMatrix,B);var E=V*P.size;if(A.set3(P.data[E],P.data[E+1],P.data[E+2],_),this.applyVerticalOffsetTransformation(B,_,X,C,L),C.applyProjection(B,N),N[0]>-1){var U=Math.floor(N[0]),T=Math.floor(N[1]);S.applyPrecomputedScaleFactorVec2(W,L.factor,W);var D=U-Q-(y[0]>0?W[0]*y[0]:0),R=D+W[0]+2*Q,M=T-Q-(y[1]>0?W[1]*y[1]:0),F=M+W[1]+2*Q;if(f.textureIsSignedDistanceField){var w=f.outlineSize/2,H=f.distanceFieldBoundingBox;D+=W[0]*H[0],M+=W[1]*H[1],R-=W[0]*(1-H[2]),F-=W[1]*(1-H[3]),D-=w,R+=w,M-=w,F+=w}if(O[0]>D&&O[0]<R&&O[1]>M&&O[1]<F){var j=i.p0,Y=i.p1;z.multiplyVec3(z.inverse(C.viewMatrix,Z),B,G),N[0]=O[0],N[1]=O[1],C.unprojectPoint(N,B);var k=A.negate(i.getDirection(),A.create()),J=A.dist(j,B)/A.dist(j,Y);s(J,k,-1,1,!0,G)}}}}},t.prototype.normalAndViewAngle=function(e,t,r,i){return void 0===i&&(i=j),O.multiplyVec3(t,e,i.normal),z.multiplyVec3(r.viewInverseTransposeMatrix,i.normal),i.cosAngle=A.dot(H,Y),i},t.prototype.updateScaleInfo=function(e,t,r){var i=this.params;i.screenSizePerspective?e.factor=S.precomputeScaleFactor(j.cosAngle,r,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),i.screenSizePerspectiveAlignment?(e.scaleAlignment=S.precomputeScale(j.cosAngle,r,i.screenSizePerspectiveAlignment),e.minPixelSizeAlignment=i.screenSizePerspectiveAlignment.parameters.minPixelSize):(e.scaleAlignment=e.factor.scale,e.minPixelSizeAlignment=e.factor.minPixelSize)},t.prototype.applyVerticalOffsetTransformation=function(e,t,r,i,o,a){var s=this.params;if(16===r.length&&(r=z.toMat3(r,X)),!s.verticalOffset||!s.verticalOffset.screenLength){if(o&&(s.screenSizePerspective||s.screenSizePerspectiveAlignment)){var l=this.normalAndViewAngle(t,r,i),c=A.length(e);this.updateScaleInfo(o,l.cosAngle,c)}else o&&(o.factor.scale=1,o.scaleAlignment=1);return a?A.set(e,a):e}var f=this.normalAndViewAngle(t,r,i),d=A.length(e),v=s.screenSizePerspectiveAlignment||s.screenSizePerspective,u=n.verticalOffsetAtDistance(i,d,s.verticalOffset,f.cosAngle,v);return o&&this.updateScaleInfo(o,f.cosAngle,d),A.add(e,A.scale(f.normal,u),a)},t.prototype.getGLMaterials=function(){return{color:M,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:F}},t.prototype.getAllTextureIds=function(){return[this.params.textureId]},t.prototype.setTextureDirty=function(){this._textureDirty=!0},t.prototype.calculateRelativeScreenBounds=function(e,t,r){return void 0===r&&(r=p.create()),g(this.params,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r},t.prototype.calculateAnchorPosForRendering=function(e){return m(this.params,e)},t.loadShaders=function(e,t,r,n){e._parse(i);var o=function(e){e.addDefine("OcclTest","OCCL_TEST"),e.addDefine("SDF","SIGNED_DISTANCE_FIELD"),e.addDefine("vvSize","VV_SIZE"),e.addDefine("vvColor","VV_COLOR"),e.addDefine("verticalOffset","VERTICAL_OFFSET"),e.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),e.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN")},a=new v("hud",["vertexShaderHUD","fragmentShaderHUD"],null,r,t,e,n);o(a),a.addDefine("debugDrawBorder","DEBUG_DRAW_BORDER"),r.addShaderVariations(V,a);var s=new v("hudHighlight",["vertexShaderHUD","fragmentShaderHUDHighlight"],null,r,t,e,n);o(s),s.addDefine("binaryHighlightOcclusion","BINARY_HIGHLIGHT_OCCLUSION"),r.addShaderVariations(b,s);var l=new v("hudOcclusionTestPixel",["vertexShaderOcclusionTestPixel","fragmentShaderSimple"],null,r,t,e,n);l.addDefine("verticalOffset","VERTICAL_OFFSET"),l.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),l.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN"),r.addShaderVariations(I,l)},t.shouldRenderVisibilityDuringRenderPass=function(e){return e===d.MATERIAL||d.MATERIAL_HIGHLIGHT},t}(s.MaterialBase),R=function(e){function t(t,r,i){var o=e.call(this,t,t.getParams(),r,i)||this;return o.programRep=r,o.params=n.copyParameters(t.getParams()),o.selectProgram(),o.selectSlot(),o}return r(t,e),t.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?f.HUDMATERIAL2:f.HUDMATERIAL1},t.prototype.beginSlot=function(e){return e===this.mainSlot},t.prototype.getProgram=function(){return this.program},t.prototype.getAllPrograms=function(){return[this.program]},t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.color=e.color,t.texCoordScale=e.texCoordScale,t.polygonOffset=e.polygonOffset,t.anchorPos=e.anchorPos,t.screenOffset=e.screenOffset,t.verticalOffset=e.verticalOffset,t.screenSizePerspective=e.screenSizePerspective,t.screenSizePerspectiveAlignment=e.screenSizePerspectiveAlignment,t.shaderPolygonOffset=e.shaderPolygonOffset,t.textureIsSignedDistanceField=e.textureIsSignedDistanceField,t.outlineColor=e.outlineColor,t.outlineSize=e.outlineSize,t.vvSizeEnabled=e.vvSizeEnabled,t.vvSizeMinSize=e.vvSizeMinSize,t.vvSizeMaxSize=e.vvSizeMaxSize,t.vvSizeOffset=e.vvSizeOffset,t.vvSizeFactor=e.vvSizeFactor,t.vvColorEnabled=e.vvColorEnabled,t.vvColorValues=e.vvColorValues,t.vvColorColors=e.vvColorColors,this.updateTexture(e.textureId),this.selectProgram(),this.selectSlot()},t.prototype.bindRender=function(e,t){var r=this.params,i=this.getProgram();this.bindTexture(e,i),i.setUniform1i("hudVisibilityTexture",1),e.bindTexture(t.hudVisibilityTexture,1),e.setActiveTexture(0),i.setUniform4fv("overrideColor",r.color),i.setUniform1f("pixelRatio",t.pixelRatio),r.textureIsSignedDistanceField&&(i.setUniform4fv("outlineColor",r.outlineColor),i.setUniform1f("outlineSize",r.outlineSize)),r.vvSizeEnabled&&(i.setUniform3fv("vvSizeMinSize",r.vvSizeMinSize),i.setUniform3fv("vvSizeMaxSize",r.vvSizeMaxSize),i.setUniform3fv("vvSizeOffset",r.vvSizeOffset),i.setUniform3fv("vvSizeFactor",r.vvSizeFactor)),r.vvColorEnabled&&(i.setUniform1fv("vvColorValues",r.vvColorValues),i.setUniform4fv("vvColorColors",r.vvColorColors)),i.setUniform2fv("texScale",r.texCoordScale),i.setUniform2f("screenOffset",2*r.screenOffset[0],2*r.screenOffset[1]),i.setUniform2fv("anchorPos",m(r)),r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setBlendingEnabled(!0),e.setBlendFunction(1,771)},t.prototype.bindProjection=function(e,t){this.material._textureDirty&&(this.renderTexture(e),this.material._textureDirty=!1);var r=t.cameraAboveGround?1:-1,i=this.getProgram(),o=this.params;e.bindProgram(i),i.setUniform1f("cameraGroundRelative",r),i.setUniform1f("polygonOffset",o.shaderPolygonOffset),i.setUniform4fv("viewport",t.viewport),n.bindVerticalOffset(o.verticalOffset,t,i),i.setUniformMatrix4fv("viewNormal",t.viewInvTransp),o.screenSizePerspective&&(n.bindScreenSizePerspective(o.screenSizePerspective,i,"screenSizePerspective"),n.bindScreenSizePerspective(o.screenSizePerspectiveAlignment||o.screenSizePerspective,i,"screenSizePerspectiveAlignment"))},t.prototype.releaseRender=function(e){e.setPolygonOffsetFillEnabled(!1),e.setBlendFunction(770,771),e.setBlendingEnabled(!1)},t.prototype.bindView=function(e,t){var r=t.origin,i=this.getProgram();n.bindView(r,t.view,i),n.bindCamPos(r,t.viewInvTransp,i)},t.prototype.bindInstance=function(e,t){var r=this.getProgram();r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){var t=e.gl;return t.TRIANGLES},t}(l.GLMaterialTextureBase),M=function(e){function t(t,r,i){var n=e.call(this,t,r,i)||this;return n.isOcclusionSlot=!1,n}return r(t,e),t.prototype.selectProgram=function(){var e=this.params;this.programOcclusionTestPixel=this.programRep.getShaderVariationsProgram(I,[!!e.verticalOffset,!!e.screenSizePerspective,"screen"===e.centerOffsetUnits]),this.program=this.programRep.getShaderVariationsProgram(V,[e.occlusionTest,e.textureIsSignedDistanceField,!!e.vvSizeEnabled,!!e.vvColorEnabled,!!e.verticalOffset,!!e.screenSizePerspective,"screen"===e.centerOffsetUnits,!!e.debugDrawBorder])},t.prototype.getDrawMode=function(e){var t=e.gl;return this.isOcclusionSlot?t.POINTS:t.TRIANGLES},t.prototype.release=function(e){var t=e.gl;e.setDepthFunction(t.LESS),this.isOcclusionSlot||this.releaseRender(e)},t.prototype.bind=function(e,t){var r=e.gl;this.bindProjection(e,t);var i=this.getProgram();e.setDepthFunction(r.LEQUAL),this.isOcclusionSlot?i.setUniform4f("color",1,1,1,1):(this.bindRender(e,t),this.bindTexture(e,i))},t.prototype.getProgram=function(){return this.isOcclusionSlot?this.programOcclusionTestPixel:this.program},t.prototype.getAllPrograms=function(){return[this.programOcclusionTestPixel,this.program]},t.prototype.beginSlot=function(e){return this.params.occlusionTest?(this.isOcclusionSlot=e===f.OCCLUSION_PIXELS,e===f.OCCLUSION_PIXELS||e===this.mainSlot):(this.isOcclusionSlot=!1,e===this.mainSlot)},t}(R),F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getShaderVariationsProgram(b,[e.occlusionTest,e.textureIsSignedDistanceField,!!e.vvSizeEnabled,!!e.vvColorEnabled,!!e.verticalOffset,!!e.screenSizePerspective,"screen"===e.centerOffsetUnits,e.binaryHighlightOcclusion])},t.prototype.bind=function(e,t){this.bindProjection(e,t),this.bindRender(e,t)},t.prototype.release=function(e){this.releaseRender(e)},t}(R),L={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},w=[0,0],B=A.create(),_=A.create(),N=A.create(),H=A.create(),G=A.create(),X=O.create(),Z=z.create(),j={normal:H,cosAngle:0},q=z.create();z.identity(q);var Q=1,W=[0,0],Y=[0,0,1];return D});