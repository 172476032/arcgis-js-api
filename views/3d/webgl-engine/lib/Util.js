// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.6/esri/copyright.txt for details.

define(["require","exports","./gl-matrix"],function(t,e,r){function a(t,e){if(!t){var r=new Error("dummy");throw r.stack&&console.log(r.stack),new Dt(e)}}function n(t,e){t||(console.log("Verify failed: "+e),console.log(new Error("dummy").stack))}function o(t){return 0==(t&t-1)}function c(t,e,r){return t+(e-t)*r}function i(t,e,r){return t<e?e:t>r?r:t}function u(t){return i(Math.round(32767*t),-32767,32767)}function v(t,e){var r=Math.abs(t[0]),a=Math.abs(t[1]),n=Math.abs(t[2]),o=1/(r+a+n),c=r*o,i=a*o,u=Math.min(t[2]*o,0);e[0]=Ut(t[0])*(c-u),e[1]=Ut(t[1])*(i-u)}function d(t,e){return void 0===t?e:t}function f(t){return t=Math.floor(t),[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]}function s(t){return"0x"+((i(Math.round(255*t[0]),0,255)<<16)+(i(Math.round(255*t[1]),0,255)<<8)+i(Math.round(255*t[2]),0,255)).toString(16)}function h(t){var e=t.toString(16);return"00000000".substr(0,8-e.length)+e}function M(t){return t/180*Math.PI}function l(t){return 180*t/Math.PI}function m(t,e){var r=1.5*Math.PI-t,a=.5*Math.PI-e;return[Math.cos(r)*Math.sin(a),Math.cos(a),Math.sin(r)*Math.sin(a)]}function p(t,e,a,n){var o=r.vec3d.dot(a,e);if(0===o)return!1;var c=-(r.vec3d.dot(a,t)+a[3])/o;return r.vec3d.add(t,r.vec3d.scale(e,c,n),n),!0}function g(t,e,a,n,o){a=a||wt;var c=r.vec3d.subtract(t,a,mt),i=r.vec3d.dot(e,e),u=2*r.vec3d.dot(e,c),v=r.vec3d.dot(c,c)-n*n,d=u*u-4*i*v;if(d<0)return!1;var f=Math.sqrt(d),s=(-u-f)/(2*i),h=(-u+f)/(2*i);return(s<0||h<s&&h>0)&&(s=h),s>0&&(r.vec3d.add(t,r.vec3d.scale(e,s,At),o),!0)}function E(t,e,a,n,o,c,i,u,v){void 0===v&&(v=r.vec3d.create());var d=n[i]-a[c],f=n[i+1]-a[c+1],s=n[i+2]-a[c+2],h=o[u]-a[c],M=o[u+1]-a[c+1],l=o[u+2]-a[c+2],m=e[1]*l-M*e[2],p=e[2]*h-l*e[0],g=e[0]*M-h*e[1],E=d*m+f*p+s*g;if(E>-1e-5&&E<1e-5)return!1;var b=1/E,I=t[0]-a[c],T=t[1]-a[c+1],y=t[2]-a[c+2];if(v[1]=b*(I*m+T*p+y*g),v[1]<0||v[1]>1)return!1;var C=T*s-f*y,R=y*d-s*I,x=I*f-d*T;return v[2]=b*(e[0]*C+e[1]*R+e[2]*x),!(v[2]<0||v[1]+v[2]>1)&&(v[0]=b*(h*C+M*R+l*x),!0)}function b(t,e,r,a){var n,o=(r[0]-t[0])/e[0],c=(a[0]-t[0])/e[0];o>c&&(n=o,o=c,c=n);var i=(r[1]-t[1])/e[1],u=(a[1]-t[1])/e[1];if(i>u&&(n=i,i=u,u=n),o>u||i>c)return!1;i>o&&(o=i),u<c&&(c=u);var v=(r[2]-t[2])/e[2],d=(a[2]-t[2])/e[2];return v>d&&(n=v,v=d,d=n),!(o>d||v>c)&&(d<c&&(c=d),!(c<0))}function I(t,e,a,n,o,c){void 0===c&&(c=r.vec2d.create());var i=(n[o]-a[o])*(e[0]-t[0])-(n[0]-a[0])*(e[o]-t[o]),u=(n[0]-a[0])*(t[o]-a[o])-(n[o]-a[o])*(t[0]-a[0]);if(0===i)return!1;var v=u/i;return c[0]=t[0]+v*(e[0]-t[0]),c[1]=t[o]+v*(e[o]-t[o]),!0}function T(t,e,a){r.mat4d.multiply(e,t,st),r.mat4d.inverse(st);for(var n=0;n<8;++n)r.mat4d.multiplyVec4(st,ht[n],Mt),r.vec3d.set3(Mt[0]/Mt[3],Mt[1]/Mt[3],Mt[2]/Mt[3],a[n])}function y(t,e,r,a){void 0===a&&(a=r,r=lt),T(t,e,r),C(r[4],r[0],r[3],a[0]),C(r[1],r[5],r[6],a[1]),C(r[4],r[5],r[1],a[2]),C(r[3],r[2],r[6],a[3]),C(r[0],r[1],r[2],a[4]),C(r[5],r[4],r[7],a[5])}function C(t,e,a,n){r.vec3d.subtract(t,e,mt),r.vec3d.subtract(a,e,pt),r.vec3d.cross(pt,mt,n),r.vec3d.normalize(n),n[3]=-r.vec3d.dot(n,t)}function R(t,e){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]}function x(t,e,n,o,c){c||(c=t),Mt[0]=t[0],Mt[1]=t[1],Mt[2]=t[2],Mt[3]=1,r.mat4d.multiplyVec4(e,Mt),c.length>2&&(c[2]=-Mt[2]),r.mat4d.multiplyVec4(n,Mt),a(0!==Mt[3]),c[0]=Mt[0]/Mt[3],c[1]=Mt[1]/Mt[3],c[2]=Mt[2]/Mt[3],c[0]=(.5*c[0]+.5)*o[2]+o[0],c[1]=(.5*c[1]+.5)*o[3]+o[1]}function O(t){return Math.atan((1-e.ECCENTRICITY_SQUARED)*Math.tan(t))}function S(t,r,a,n){var o=6378137/Math.sqrt(1-e.ECCENTRICITY_SQUARED*Math.pow(Math.sin(t),2)),c=Math.cos(t);n[0]=(o+a)*Math.cos(r)*c,n[1]=(o*(1-e.ECCENTRICITY_SQUARED)+a)*Math.sin(t),n[2]=-(o+a)*Math.sin(r)*c}function A(t,e){var a=r.vec3d.length(t);e[0]=Math.asin(i(t[1]/a,-1,1));var n=Math.cos(e[0]);e[1]=(t[2]<0?1:-1)*Math.acos(i(t[0]/(n*a),-1,1)),e[0]=l(e[0]),e[1]=l(e[1]),e[2]=a}function w(t,r){var a=6378137,n=t[0],o=-t[2],c=t[1],i=Math.sqrt(Math.pow(a,2)*(1-e.ECCENTRICITY_SQUARED)),u=Math.sqrt((Math.pow(a,2)-Math.pow(i,2))/Math.pow(i,2)),v=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),d=Math.atan2(a*c,i*v),f=Math.atan2(o,n),s=Math.atan2(c+Math.pow(u,2)*i*Math.pow(Math.sin(d),3),v-e.ECCENTRICITY_SQUARED*a*Math.pow(Math.cos(d),3)),h=a/Math.sqrt(1-e.ECCENTRICITY_SQUARED*Math.pow(Math.sin(s),2)),M=v/Math.cos(s)-h+e.EARTH_RADIUS;r[0]=s,r[1]=f,r[2]=M}function D(t,e,a){var n=M(t[0]),o=M(t[1]);return S(n,o,e,gt),r.mat4d.translate(a,gt),r.mat4d.rotateY(a,.5*Math.PI+o),r.mat4d.rotateX(a,.5*Math.PI-n),a}function U(t,e){return t[e]+(t[e+1]<<8)}function P(t,e){return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)}function N(t,e,r){void 0!==e[t]&&(r[t]=e[t])}function q(t,e){var r={};if(void 0!==e)for(var a=0,n=t;a<n.length;a++){var o=n[a];r[e(o)]=o}else for(var c=0,i=t;c<i.length;c++){var o=i[c];r[o]=o}return r}function F(t){var e=[];for(var r in t)e.push(t[r]);return e}function L(t,e,r){if(void 0===r&&(r={}),r!==t)for(var a in t)r[a]=t[a];if(r!==e)for(var n in e)r[n]=e[n];return r}function _(t,e){var r={};for(var a in t)void 0===e[a]&&(r[a]=t[a]);return r}function j(t,e){var r={};for(var a in t)void 0!==e[a]&&(r[a]=t[a]);return r}function Y(t){for(var e in t)return e}function G(t){return t[Y(t)]}function V(t){for(var e in t)return!1;return!0}function k(t,e){if(t.length!==e.length)return!1;for(var r=0,a=t.length;r<a;++r)if(t[r]!==e[r])return!1;return!0}function Q(t,e){for(var r=Math.max(0,Pt-5),a=Math.min(r+10,t.length),n=-1,o=r;o<a;++o)if(t[o]===e){n=o;break}return-1===n&&-1===(n=t.indexOf(e))?null:(t[n]=t[t.length-1],t.pop(),Pt=n,e)}function B(t,e,r,n,o){var c=4*e;a(t.length===c*r,"buffer length must match image resolution");var i=document.createElement("canvas");i.width=e,i.height=r;for(var u=i.getContext("2d"),v=u.getImageData(0,0,e,r),d=v.data,f=0;f<r;++f)for(var s=f*c,h=(r-1-f)*c,M=0;M<c;++M)d[s++]=t[h++];return u.putImageData(v,0,0),i.toDataURL(n,o)}function X(t){return Math.round(100*t)/100}function H(t,e){return Math.log(t)/Math.log(e)}function z(t,e){t[12]=e[0],t[13]=e[1],t[14]=e[2]}function W(t,e,r,a){t[12]=e,t[13]=r,t[14]=a}function K(t,e){return void 0===e&&(e=r.vec3d.create()),e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Z(t,e){return t=r.mat4d.identity(t),z(t,e),t}function J(t){return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&1===t[15]}function $(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/e)}function tt(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/r)}function et(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function rt(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function at(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function nt(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function ot(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1}function ct(t){return Math.pow(10,Math.ceil(Math.LOG10E*Math.log(t)))}function it(t,e,a,n,o){var c=Et,u=bt;if(c[0]=t[0]-a[0],c[1]=t[1]-a[1],c[2]=t[2]-a[2],u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],Math.abs(u[0])<1e-4&&Math.abs(u[1])<1e-4&&Math.abs(u[2])<1e-4)return o.success=!1,o;var v=It;if(v[0]=e[0]-t[0],v[1]=e[1]-t[1],v[2]=e[2]-t[2],Math.abs(v[0])<1e-4&&Math.abs(v[1])<1e-4&&Math.abs(v[2])<1e-4)return o.success=!1,o;var d=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],f=u[0]*v[0]+u[1]*v[1]+u[2]*v[2],s=c[0]*v[0]+c[1]*v[1]+c[2]*v[2],h=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],M=v[0]*v[0]+v[1]*v[1]+v[2]*v[2],l=M*h-f*f;if(Math.abs(l)<1e-4)return o.success=!1,o;var m=d*f-s*h,p=i(m/l,0,1),g=i((d+f*p)/h,0,1),E=Tt,b=yt;E[0]=t[0]+p*v[0],E[1]=t[1]+p*v[1],E[2]=t[2]+p*v[2],b[0]=a[0]+g*u[0],b[1]=a[1]+g*u[1],b[2]=a[2]+g*u[2];var I=r.vec3d.dist2(E,b);return o.success=!0,o.dist2=I,o.pa=E,o.pb=b,o}function ut(t,e,a){var n=Ot,o=St,c=At,u=xt,v=Ct,d=Rt;n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=0,o[0]=a[0]-t[0],o[1]=a[1]-t[1],o[2]=0,c[0]=a[0],c[1]=a[1],c[2]=0;var f=r.vec2d.dot(o,n),s=r.vec2d.dot(n,n),h=i(f/s,0,1);u[0]=n[0]*h,u[1]=n[1]*h,v[0]=t[0]+u[0],v[1]=t[1]+u[1],r.vec2d.subtract(c,v,d);var M=r.vec2d.dot(d,d),l=r.vec2d.dot(o,o),m=r.vec2d.dot(n,n),p=r.vec2d.dot(u,u);return(p>l||p>m)&&(M=Number.MAX_VALUE),M}function vt(t,e,r){void 0===r&&(r=0);for(var a=i(t,0,Ft),n=0;n<4;n++)e[r+n]=Math.floor(256*ft(a*Nt[n]))}function dt(t,e){void 0===e&&(e=0);for(var r=0,a=0;a<4;a++)r+=t[e+a]*qt[a];return r}function ft(t){return t-Math.floor(t)}Object.defineProperty(e,"__esModule",{value:!0});var st=r.mat4d.create(),ht=[r.vec4d.createFrom(-1,-1,-1,1),r.vec4d.createFrom(1,-1,-1,1),r.vec4d.createFrom(1,1,-1,1),r.vec4d.createFrom(-1,1,-1,1),r.vec4d.createFrom(-1,-1,1,1),r.vec4d.createFrom(1,-1,1,1),r.vec4d.createFrom(1,1,1,1),r.vec4d.createFrom(-1,1,1,1)],Mt=r.vec4d.create(),lt=[r.vec3d.create(),r.vec3d.create(),r.vec3d.create(),r.vec3d.create(),r.vec3d.create(),r.vec3d.create(),r.vec3d.create(),r.vec3d.create()],mt=r.vec3d.create(),pt=r.vec3d.create(),gt=r.vec3d.create(),Et=r.vec3d.create(),bt=r.vec3d.create(),It=r.vec3d.create(),Tt=r.vec3d.create(),yt=r.vec3d.create(),Ct=r.vec3d.create(),Rt=r.vec3d.create(),xt=r.vec3d.create(),Ot=r.vec3d.create(),St=r.vec3d.create(),At=r.vec3d.create(),wt=r.vec3d.createFrom(0,0,0),Dt=function(){function t(t){this.message=t}return t.prototype.toString=function(){return"AssertException: "+this.message},t}();e.AssertException=Dt,e.EARTH_RADIUS=6378137,e.METER2FEET=3.28084,e.ECCENTRICITY_SQUARED=.0066943799901414,e.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex"},e.assert=a,e.verify=n,e.isPowerOfTwo=o,e.lerp=c,e.clamp=i,e.encodeInt16=u,e.encodeNormal=v;var Ut="function"==typeof Math.sign?Math.sign:function(t){return+(t>0)-+(t<0)||0};e.fallbackIfUndefined=d,e.hex2rgb=f,e.rgb2hex=s,e.dec2hex=h,e.deg2rad=M,e.rad2deg=l,e.azimuthElevationAngle2Direction=m,e.rayPlane=p,e.raySphere=g,e.rayTriangle3D=E,e.rayBoxTest=b,e.rayRay2D=I,e.matrix2frustum=T,e.matrix2frustumPlanes=y,e.point2plane=C,e.planeDistance=R,e.project=x,e.geodeticToGeocentricLatidude=O,e.latLon2positionWGS84Ellipsoid=S,e.pos2latLon=A,e.pos2latLonWGS84Ellipsoid=w,e.computeGlobeTransformation=D,e.readUInt16=U,e.readUInt32=P,e.setIfDefined=N,e.array2object=q,e.object2array=F,e.mergeObjects=L,e.subtractObjects=_,e.intersectObjects=j,e.getFirstObjectKey=Y,e.getFirstObjectValue=G,e.objectEmpty=V,e.arraysEqual=k;var Pt=0;e.arrayRemove=Q,e.byteBuffer2base64image=B,e.cround=X,e.logWithBase=H,e.setMatrixTranslation=z,e.setMatrixTranslation3=W,e.getMatrixTranslation=K,e.createTranslationMatrix=Z,e.isTranslationMatrix=J,e.fovx2fovy=$,e.fovy2fovx=tt,e.fovx2fovd=et,e.fovy2fovd=rt,e.fovd2fovx=at,e.fovd2fovy=nt,e.nextHighestPowerOfTwo=ot,e.nextHighestPowerOfTen=ct,e.lineLineDistanceSquared3D=it,e.pointLineSegmentDistanceSquared2D=ut,e.packFloatRGBA=vt,e.unpackFloatRGBA=dt;var Nt=[1,256,65536,16777216],qt=[1/256,1/65536,1/16777216,1/4294967296],Ft=dt(new Uint8ClampedArray([255,255,255,255]))});