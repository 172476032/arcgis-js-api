// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.

define(["require","exports"],function(t,e){function s(t){for(var e={items:new Array,count:0},s=0;t>s;++s)e.items.push({v1:{vector:[void 0,void 0],side:void 0},v2:{vector:[void 0,void 0],side:void 0},v3:{vector:[void 0,void 0],side:void 0}});return e}function r(t){for(var e={items:new Array,count:0},s=0;t>s;++s)e.items.push(void 0);return e}function o(t){for(var e={items:new Array,count:0},s=0;t>s;++s)e.items.push({vector:[void 0,void 0],side:void 0});return e}function i(t){for(var e={items:new Array,count:0},s=0;t>s;++s)e.items.push([void 0,void 0]);return e}function v(){var t=o(30),e={};e[_.ENTRY]=r(20),e[_.EXIT]=r(20),e[_.CAP]=r(20);var s={vectors:t,lists:e};return s}function c(t,e){return t[0]*e[0]+t[1]*e[1]}function n(t){return Math.sqrt(c(t,t))}function a(t,e){var s=n(e);return t[0]=e[0]/s,t[1]=e[1]/s,t}function m(t,e){return t[0]=-e[1],t[1]=e[0],t}function u(t,e){var s=t[0]*e[1]-t[1]*e[0];return s}function d(t,e){return t[0]=-e[0],t[1]=-e[1],t}function l(t,e,s){return t[0]=e[0]*s,t[1]=e[1]*s,t}function f(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t}function T(t){return Math.round(t*L)}function E(t,e){var s=c(t,e);return s>.999?0:-.999>s?Math.PI:Math.acos(s)}function C(t,e,s,r,o){if(0===r)return void(t.count=0);for(var i=n(e),v=l(D[0],e,1/i),c=l(D[1],s,1/i),a=E(v,c),m=(o?-1:1)*a/r,u=Math.cos(m),d=Math.sin(m),f=e[0],T=e[1],C=0;r-1>C;++C){var A=f,M=T;f=u*A-d*M,T=d*A+u*M,t.items[C][0]=f,t.items[C][1]=T}t.count=r-1}function A(t){for(var e=t.count,s=Math.floor(e/2),r=0;s>r;++r){var o=t.items[r];t.items[r]=t.items[e-r-1],t.items[e-r-1]=o}}function M(t,e,s,r){var o,i,v,c,n=e.vectors,a=e.lists[_.EXIT],m=s.vectors,u=s.lists[_.ENTRY];if(a.count===u.count+1)o=a.items,i=n.items,v=u.items,c=m.items;else if(u.count===a.count+1)o=u.items,i=m.items,v=a.items,c=n.items;else{if(a.count!==u.count)throw new Error("Cannot bridge "+a.count+" to "+u.count+".");r?(o=a.items,i=n.items,v=u.items,c=m.items):(o=u.items,i=m.items,v=a.items,c=n.items)}var d=a.count+u.count-2;t.count=d,z[0]=o,z[1]=v,F[0]=i,F[1]=c;for(var l=0;d>l;++l){var f=t.items[l],T=(l+0)%2,E=Math.floor((l+0)/2),C=F[T][z[T][E]];f.v1.vector[0]=C.vector[0],f.v1.vector[1]=C.vector[1],f.v1.side=C.side,f.v1.base=C.base;var A=(l+1)%2,M=Math.floor((l+1)/2),h=F[A][z[A][M]];f.v2.vector[0]=h.vector[0],f.v2.vector[1]=h.vector[1],f.v2.side=h.side,f.v2.base=h.base;var R=(l+2)%2,I=Math.floor((l+2)/2),p=F[R][z[R][I]];f.v3.vector[0]=p.vector[0],f.v3.vector[1]=p.vector[1],f.v3.side=p.side,f.v3.base=p.base}}function h(t,e){if(0===e.lists[_.CAP].count)return void(t.count=0);if(1===e.lists[_.CAP].count)throw new Error("A single vector is not enough to define a pie.");t.count=e.lists[_.CAP].count-1;for(var s=0;s<t.count;++s){var r=t.items[s],o=e.lists[_.CAP].items[s],i=e.vectors.items[o];r.v1.vector[0]=i.vector[0],r.v1.vector[1]=i.vector[1],r.v1.side=i.side,r.v1.base=i.base;var v=e.lists[_.CAP].items[s+1],c=e.vectors.items[v];r.v2.vector[0]=c.vector[0],r.v2.vector[1]=c.vector[1],r.v2.side=c.side,r.v2.base=c.base;var n=e.capCenter,a=e.vectors.items[n];r.v3.vector[0]=a.vector[0],r.v3.vector[1]=a.vector[1],r.v3.side=a.side,r.v3.base=a.base}}function R(t,e,s){Y(t,e,s)}function I(t,e,s,r,o){Y(t,e,s);var i=r===g.START?0:1,v=r===g.START?1:0;t.capCenter=t.vectors.count;var c=t.vectors.items[t.capCenter];c.vector[0]=0,c.vector[1]=0,c.side=y,++t.vectors.count,C(x,t.vectors.items[i].vector,t.vectors.items[v].vector,o,!1);var n=t.vectors.count,a=t.lists[_.CAP];a.items[0]=i;for(var m=t.vectors.items[i].side,u=t.vectors.items[v].side,d=0;d<x.count;++d){var l=d<x.count/2?m:u,f=x.items[d],T=t.vectors.items[n+d];T.vector[0]=f[0],T.vector[1]=f[1],T.side=l,a.items[d+1]=n+d}a.items[x.count+1]=v,a.count=x.count+2,t.vectors.count=n+x.count}function p(t,e,s,r){Y(t,e,s);var o=r===g.START?0:1,i=r===g.START?1:0,v=D[0],c=D[1],n=D[2],a=D[3],m=D[4],u=t.vectors.items[o].vector;v[0]=O*u[0]-j*u[1],v[1]=j*u[0]+O*u[1],l(a,v,k),c[0]=O*v[0]-j*v[1],c[1]=j*v[0]+O*v[1],n[0]=O*c[0]-j*c[1],n[1]=j*c[0]+O*c[1],l(m,n,k);var d=t.vectors.items[o];d.vector[0]=a[0],d.vector[1]=a[1];var f=t.vectors.items[i];f.vector[0]=m[0],f.vector[1]=m[1]}function P(t,e,s,r){Y(t,e,s);var o=r===g.START?0:1,i=r===g.START?1:0;t.capCenter=t.vectors.count;var v=t.vectors.items[t.capCenter];v.vector[0]=0,v.vector[1]=0,v.side=y,++t.vectors.count;var c=D[0],n=D[1],a=D[2],m=D[3],u=D[4],d=t.vectors.items[o].vector;c[0]=O*d[0]-j*d[1],c[1]=j*d[0]+O*d[1],l(m,c,k),n[0]=O*c[0]-j*c[1],n[1]=j*c[0]+O*c[1],a[0]=O*n[0]-j*n[1],a[1]=j*n[0]+O*n[1],l(u,a,k);var f=t.vectors.count,T=t.lists[_.CAP];T.items[0]=o;var E=t.vectors.items[f+0];E.vector[0]=m[0],E.vector[1]=m[1],E.side=t.vectors.items[o].side,T.items[1]=f+0;var C=t.vectors.items[f+1];C.vector[0]=u[0],C.vector[1]=u[1],C.side=t.vectors.items[i].side,T.items[2]=f+1,T.items[3]=i,T.count=4,t.vectors.count+=2}function Y(t,e,s){var r=m(D[0],s),o=r,i=d(D[1],r),v=t.vectors.items[0];v.vector[0]=o[0],v.vector[1]=o[1],v.side=w;var c=t.vectors.items[1];c.vector[0]=i[0],c.vector[1]=i[1],c.side=J,t.vectors.count=2;var n=t.lists[_.ENTRY];n.items[0]=0,n.items[1]=1,n.count=2;var a=t.lists[_.EXIT];a.items[0]=0,a.items[1]=1,a.count=2,t.lists[_.CAP].count=0,t.capCenter=void 0}function b(t,e,s){var r=m(D[0],e),o=m(D[1],s),i=D[2];i[0]=r[0]+o[0],i[1]=r[1]+o[1];var v=a(D[3],i),n=c(v,r);v=l(D[4],v,1/n);var u=d(D[5],v),f=t.vectors.items[0];f.vector[0]=v[0],f.vector[1]=v[1],f.side=w;var T=t.vectors.items[1];T.vector[0]=u[0],T.vector[1]=u[1],T.side=J,t.vectors.count=2;var E=t.lists[_.ENTRY];E.items[0]=0,E.items[1]=1,E.count=2;var C=t.lists[_.EXIT];C.items[0]=0,C.items[1]=1,C.count=2,t.lists[_.CAP].count=0,t.capCenter=void 0}function N(t,e,s,r){var o=r*r,i=u(e,s),v=i>0?[w,J]:[J,w],n=v[0],T=v[1],E=i>0?d(D[0],m(D[1],e)):m(D[2],e),C=i>0?d(D[3],m(D[4],s)):m(D[5],s),M=D[6];M[0]=E[0]+C[0],M[1]=E[1]+C[1];var h=a(D[7],M),R=d(D[8],h),I=c(h,E),p=u(h,E),P=Math.abs(p/I),Y=1+P*P,b=q>Y?[P,!1]:[Math.sqrt(q-1),!0],N=b[0],S=b[1],X=o>Y?[P,!1]:[Math.sqrt(o-1),!0],g=X[0],G=X[1];if(G&&S){var L=t.vectors.items[0];f(L.vector,d(D[9],E),l(D[10],d(D[11],e),N)),L.side=n;var V=t.vectors.items[1];f(V.vector,d(D[12],C),l(D[13],s,N)),V.side=n;var x=t.vectors.items[2];x.vector[0]=0,x.vector[1]=0,x.side=y;var z=t.vectors.items[3];f(z.vector,E,l(D[14],e,g)),z.side=T;var F=t.vectors.items[4];f(F.vector,C,l(D[15],d(D[16],s),g)),F.side=T,t.vectors.count=5;var O=t.lists[_.ENTRY];O.items[0]=0,O.items[1]=2,O.items[2]=3,O.count=3;var j=t.lists[_.EXIT];j.items[0]=1,j.items[1]=2,j.items[2]=4,j.count=3;var k=t.lists[_.CAP];k.items[0]=3,k.items[1]=4,k.count=2,t.capCenter=2}else if(!G&&S){var L=t.vectors.items[0];f(L.vector,d(D[9],E),l(D[10],d(D[11],e),N)),L.side=n;var V=t.vectors.items[1];f(V.vector,d(D[12],C),l(D[13],s,N)),V.side=n;var x=t.vectors.items[2];x.vector[0]=0,x.vector[1]=0,x.side=y;var z=t.vectors.items[3];l(z.vector,h,1/I),z.side=T,t.vectors.count=4;var O=t.lists[_.ENTRY];O.items[0]=0,O.items[1]=2,O.items[2]=3,O.count=3;var j=t.lists[_.EXIT];j.items[0]=1,j.items[1]=2,j.items[2]=3,j.count=3,t.lists[_.CAP].count=0,t.capCenter=void 0}else if(G&&!S){var L=t.vectors.items[0];l(L.vector,R,1/I),L.side=n;var V=t.vectors.items[1];V.vector[0]=0,V.vector[1]=0,V.side=y;var x=t.vectors.items[2];f(x.vector,E,l(D[9],e,g)),x.side=T;var z=t.vectors.items[3];f(z.vector,C,l(D[10],d(D[11],s),g)),z.side=T,t.vectors.count=4;var O=t.lists[_.ENTRY];O.items[0]=0,O.items[1]=1,O.items[2]=2,O.count=3;var j=t.lists[_.EXIT];j.items[0]=0,j.items[1]=1,j.items[2]=3,j.count=3;var k=t.lists[_.CAP];k.items[0]=2,k.items[1]=3,k.count=2,t.capCenter=1}else if(!G&&!S){var L=t.vectors.items[0];l(L.vector,R,1/I),L.side=n;var V=t.vectors.items[1];l(V.vector,h,1/I),V.side=T,t.vectors.count=2;var O=t.lists[_.ENTRY];O.items[0]=0,O.items[1]=1,O.count=2;var j=t.lists[_.EXIT];j.items[0]=0,j.items[1]=1,j.count=2,t.lists[_.CAP].count=0,t.capCenter=void 0}0>i&&(A(t.lists[_.ENTRY]),A(t.lists[_.EXIT]))}function S(t,e,s,r){var o=u(e,s),i=o>0?[w,J]:[J,w],v=i[0],n=i[1],T=o>0?d(D[0],m(D[1],e)):m(D[2],e),E=o>0?d(D[3],m(D[4],s)):m(D[5],s),M=D[6];M[0]=T[0]+E[0],M[1]=T[1]+E[1];var h=a(D[7],M),R=d(D[8],h),I=c(h,T),p=u(h,T),P=Math.abs(p/I),Y=1+P*P,b=q>Y?[P,!1]:[Math.sqrt(q-1),!0],N=b[0],S=b[1];if(S){var X=t.vectors.items[0];X.vector[0]=T[0],X.vector[1]=T[1],X.side=n;var g=t.vectors.items[1];g.vector[0]=E[0],g.vector[1]=E[1],g.side=n;var G=t.vectors.items[2];f(G.vector,d(D[9],T),l(D[10],d(D[11],e),N)),G.side=v;var L=t.vectors.items[3];f(L.vector,d(D[12],E),l(D[13],s,N)),L.side=v;var V=t.vectors.items[4];V.vector[0]=0,V.vector[1]=0,V.side=y,t.vectors.count=5;var z=t.lists[_.ENTRY];z.items[0]=2,z.items[1]=4,z.items[2]=0,z.count=3;var F=t.lists[_.EXIT];F.items[0]=3,F.items[1]=4,F.items[2]=1,F.count=3,t.capCenter=4}else{var X=t.vectors.items[0];X.vector[0]=T[0],X.vector[1]=T[1],X.side=n;var g=t.vectors.items[1];g.vector[0]=E[0],g.vector[1]=E[1],g.side=n;var G=t.vectors.items[2];l(G.vector,R,1/I),G.side=v;var L=t.vectors.items[3];L.vector[0]=0,L.vector[1]=0,L.side=y,t.vectors.count=4;var z=t.lists[_.ENTRY];z.items[0]=2,z.items[1]=3,z.items[2]=0,z.count=3;var F=t.lists[_.EXIT];F.items[0]=2,F.items[1]=3,F.items[2]=1,F.count=3,t.capCenter=3}C(x,T,E,r,0>o);var O=t.vectors.count,j=t.lists[_.CAP];j.items[0]=0;for(var k=0;k<x.count;++k){var B=x.items[k],H=t.vectors.items[O+k];H.vector[0]=B[0],H.vector[1]=B[1],H.side=n,j.items[k+1]=O+k}j.items[x.count+1]=1,j.count=x.count+2,t.vectors.count=O+x.count,0>o&&(A(t.lists[_.ENTRY]),A(t.lists[_.EXIT]))}function X(t,e,s,r){var o=u(e,s),i=o>0?[w,J]:[J,w],v=i[0],c=i[1],n=o>0?d(D[0],m(D[1],e)):m(D[2],e),a=o>0?d(D[3],m(D[4],s)):m(D[5],s),l=t.vectors.items[0];l.vector[0]=n[0],l.vector[1]=n[1],l.side=c;var f=t.vectors.items[1];f.vector[0]=a[0],f.vector[1]=a[1],f.side=c;var T=t.vectors.items[2];d(T.vector,n),T.side=v;var E=t.vectors.items[3];d(E.vector,a),E.side=v;var M=t.vectors.items[4];M.vector[0]=0,M.vector[1]=0,M.side=y,t.vectors.count=5;var h=t.lists[_.ENTRY];h.items[0]=2,h.items[1]=4,h.items[2]=0,h.count=3;var R=t.lists[_.EXIT];R.items[0]=3,R.items[1]=4,R.items[2]=1,R.count=3,t.capCenter=4,C(x,n,a,r,0>o);var I=t.vectors.count,p=t.lists[_.CAP];p.items[0]=0;for(var P=0;P<x.count;++P){var Y=x.items[P],b=t.vectors.items[I+P];b.vector[0]=Y[0],b.vector[1]=Y[1],b.side=c,p.items[P+1]=I+P}p.items[x.count+1]=1,p.count=x.count+2,t.vectors.count=I+x.count,0>o&&(A(t.lists[_.ENTRY]),A(t.lists[_.EXIT]))}var _;!function(t){t[t.ENTRY=1]="ENTRY",t[t.EXIT=2]="EXIT",t[t.CAP=3]="CAP"}(_=e.VectorRole||(e.VectorRole={}));var g;!function(t){t[t.START=1]="START",t[t.END=2]="END"}(g=e.CapPosition||(e.CapPosition={})),e.SYSTEM_MAG_LIMIT=3.8,e.MITER_SAFE_RADS=2*Math.acos(1/e.SYSTEM_MAG_LIMIT);var q=e.SYSTEM_MAG_LIMIT*e.SYSTEM_MAG_LIMIT,w=-1,J=1,y=0,G=16,L=G/(2*Math.PI);e.allocTriangles=s,e.allocExtrudeVectors=v;for(var D=[],V=0;32>V;++V)D.push([void 0,void 0]);var x=i(G);e.length=n,e.normalize=a,e.getNumberOfSlices=T,e.getRads=E;var z=[void 0,void 0],F=[void 0,void 0];e.bridge=M,e.pie=h,e.buttCap=R,e.roundCap=I;var O=Math.cos(Math.PI/4),j=Math.sin(Math.PI/4),k=Math.sqrt(2);e.squareCap=p,e.squareCapAlt=P,e.fastMiterJoin=Y,e.miterJoin=b,e.bevelJoin=N,e.roundJoin=S,e.unitRoundJoin=X});