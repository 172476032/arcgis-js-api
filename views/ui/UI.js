// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.6/esri/copyright.txt for details.

define(["require","exports","../../core/tsSupport/declareExtendsHelper","../../core/tsSupport/decorateHelper","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/_base/lang","../../core/Accessor","../../core/Evented","../../core/Handles","../../core/watchUtils","../../core/accessorSupport/decorators","./Component"],function(t,o,n,e,i,r,a,p,s,c,u,d,h,l){function f(t){return t&&!t._started&&"function"==typeof t.postMixInProperties&&"function"==typeof t.buildRendering&&"function"==typeof t.postCreate&&"function"==typeof t.startup}function m(t){var o=t;return!!o&&o.isInstanceOf&&o.isInstanceOf(l)}function y(t){var o=t;return"object"==typeof o&&!m(o)&&("component"in o||"index"in o||"position"in o)?t:null}var _={left:0,top:0,bottom:0,right:0},v={bottom:30,top:15,right:15,left:15},g={ui:"esri-ui",corner:"esri-ui-corner",innerContainer:"esri-ui-inner-container",manualContainer:"esri-ui-manual-container",cornerContainer:"esri-ui-corner-container",topLeft:"esri-ui-top-left",topRight:"esri-ui-top-right",bottomLeft:"esri-ui-bottom-left",bottomRight:"esri-ui-bottom-right"};return function(t){function o(){var o=t.call(this)||this;return o._cornerNameToContainerLookup={},o._positionNameToContainerLookup={},o._components=[],o._handles=new u,o._componentToKey=new Map,o.padding=v,o.view=null,o._initContainers(),o}return n(o,t),o.prototype.initialize=function(){this._handles.add([d.init(this,"view.padding, container",this._applyViewPadding.bind(this)),d.init(this,"padding",this._applyUIPadding.bind(this))])},o.prototype.destroy=function(){this.container=null,this._components.forEach(function(t){t.destroy()}),this._components.length=0,this._handles.destroy(),this._componentToKey.clear(),this._componentToKey=null},Object.defineProperty(o.prototype,"container",{set:function(t){var o=this._get("container");t!==o&&(t&&(i.add(t,g.ui),this._attachContainers(t)),o&&(i.remove(o,g.ui),a.set(o,{top:"",bottom:"",left:"",right:""}),r.empty(o)),this._set("container",t))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"height",{get:function(){var t=this.get("view.height")||0;if(0===t)return t;var o=this._getViewPadding(),n=o.top+o.bottom;return Math.max(t-n,0)},enumerable:!0,configurable:!0}),o.prototype.castPadding=function(t){return"number"==typeof t?{bottom:t,top:t,right:t,left:t}:p.mixin({},v,t)},Object.defineProperty(o.prototype,"width",{get:function(){var t=this.get("view.width")||0;if(0===t)return t;var o=this._getViewPadding(),n=o.left+o.right;return Math.max(t-n,0)},enumerable:!0,configurable:!0}),o.prototype.add=function(t,o){var n,e,i=this;if(Array.isArray(t))return void t.forEach(function(t){return i.add(t,o)});var r=y(t);r&&(n=r.index,o=r.position,t=r.component,e=r.key),o&&"object"==typeof o&&(n=o.index,e=o.key,o=o.position),!t||o&&!this._isValidPosition(o)||(m(t)||(t=new l({node:t})),this._place({component:t,position:o,index:n}),this._components.push(t),e&&this._componentToKey.set(t,e))},o.prototype.remove=function(t,o){var n=this;if(t){if(Array.isArray(t))return t.map(function(t){return n.remove(t,o)});var e=this.find(t);if(e){var i=this._componentToKey;if(i.has(t)&&i.get(t)!==o)return;var r=this._components.indexOf(e);return e.node.parentNode&&e.node.parentNode.removeChild(e.node),this._componentToKey.delete(t),this._components.splice(r,1)[0]}}},o.prototype.empty=function(t){var o=this;if(Array.isArray(t))return t.map(function(t){return o.empty(t)}).reduce(function(t,o){return t.concat(o)});if("manual"===(t=t||"manual")){return Array.prototype.slice.call(this._manualContainer.children).filter(function(t){return!i.contains(t,g.corner)}).map(function(t){return o.remove(t)})}return this._isValidPosition(t)?Array.prototype.slice.call(this._cornerNameToContainerLookup[t].children).map(this.remove,this):void 0},o.prototype.move=function(t,o){var n=this;if(Array.isArray(t)&&t.forEach(function(t){return n.move(t,o)}),t){var e,i=y(t)||y(o);if(i&&(e=i.index,o=i.position,t=i.component||t),!o||this._isValidPosition(o)){var r=this.remove(t);r&&this.add(r,{position:o,index:e})}}},o.prototype.find=function(t){return t?m(t)?this._findByComponent(t):"string"==typeof t?this._findById(t):this._findByNode(t.domNode||t):null},o.prototype._getViewPadding=function(){return this.get("view.padding")||_},o.prototype._attachContainers=function(t){r.place(this._manualContainer,t),r.place(this._innerContainer,t)},o.prototype._initContainers=function(){var t=r.create("div",{className:g.innerContainer+" "+g.cornerContainer}),o=r.create("div",{className:g.innerContainer+" "+g.manualContainer}),n=r.create("div",{className:g.topLeft+" "+g.corner},t),e=r.create("div",{className:g.topRight+" "+g.corner},t),i=r.create("div",{className:g.bottomLeft+" "+g.corner},t),a=r.create("div",{className:g.bottomRight+" "+g.corner},t);this._innerContainer=t,this._manualContainer=o,this._cornerNameToContainerLookup={"top-left":n,"top-right":e,"bottom-left":i,"bottom-right":a},this._positionNameToContainerLookup=p.mixin({manual:o},this._cornerNameToContainerLookup)},o.prototype._isValidPosition=function(t){return!!this._positionNameToContainerLookup[t]},o.prototype._place=function(t){var o,n=t.component,e=t.position||"manual",i=t.index,r=this._positionNameToContainerLookup[e],a=i>-1;return a?(o=Array.prototype.slice.call(r.children),0===i?void this._placeComponent(n,r,"first"):i>=o.length?void this._placeComponent(n,r,"last"):void this._placeComponent(n,o[i],"before")):void this._placeComponent(n,r,"last")},o.prototype._placeComponent=function(t,o,n){f(t.widget)&&t.widget.startup(),r.place(t.node,o,n)},o.prototype._applyViewPadding=function(){var t=this.container;t&&a.set(t,this._toPxPosition(this._getViewPadding()))},o.prototype._applyUIPadding=function(){this._innerContainer&&a.set(this._innerContainer,this._toPxPosition(this.padding))},o.prototype._toPxPosition=function(t){return{top:this._toPxUnit(t.top),left:this._toPxUnit(t.left),right:this._toPxUnit(t.right),bottom:this._toPxUnit(t.bottom)}},o.prototype._toPxUnit=function(t){return 0===t?0:t+"px"},o.prototype._findByComponent=function(t){var o,n=null;return this._components.some(function(e){return o=e===t,o&&(n=e),o}),n},o.prototype._findById=function(t){var o,n=null;return this._components.some(function(e){return o=e.id===t,o&&(n=e),o}),n},o.prototype._findByNode=function(t){var o,n=null;return this._components.some(function(e){return o=e.node===t,o&&(n=e),o}),n},e([h.property()],o.prototype,"container",null),e([h.property({dependsOn:["view.height"]})],o.prototype,"height",null),e([h.property()],o.prototype,"padding",void 0),e([h.cast("padding")],o.prototype,"castPadding",null),e([h.property()],o.prototype,"view",void 0),e([h.property({dependsOn:["view.width"]})],o.prototype,"width",null),o=e([h.subclass("esri.views.ui.UI")],o)}(h.declared(s,c))});